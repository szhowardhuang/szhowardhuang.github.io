<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"szhowardhuang.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="åµŒå…¥å¼è€å…µåšå®¢">
<meta property="og:url" content="https://szhowardhuang.github.io/index.html">
<meta property="og:site_name" content="åµŒå…¥å¼è€å…µåšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Howard Huang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://szhowardhuang.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>åµŒå…¥å¼è€å…µåšå®¢</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">åµŒå…¥å¼è€å…µåšå®¢</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard Huang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/28/singleimageto3d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/28/singleimageto3d/" class="post-title-link" itemprop="url">é€šè¿‡å•ä¸ªå›¾åƒè¿›è¡Œ 3D é‡å»º</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-28 20:10:00" itemprop="dateCreated datePublished" datetime="2024-05-28T20:10:00+08:00">2024-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-29 11:34:06" itemprop="dateModified" datetime="2024-05-29T11:34:06+08:00">2024-05-29</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>33 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ä½¿ç”¨ Python ä¸­çš„å¤šè§†å›¾æ‰©æ•£æ¨¡å‹æ¥é‡å»º 3D .</p>
<p>é¦–å…ˆæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªé€‚å½“çš„è®¡ç®—ç¯å¢ƒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºä»»åŠ¡é…ç½®å¿…è¦çš„æ¨¡å‹ã€‚ç„¶åï¼Œæˆ‘ä»¬å¤„ç†å›¾åƒä»¥ç”Ÿæˆå¤šä¸ªè§†å›¾ï¼Œè¿™äº›è§†å›¾æ˜¯åˆ›å»ºæœ€ç»ˆçš„ 3D é‡å»ºå¯¹è±¡æ‰€éœ€çš„ã€‚</p>
<p>æ¯ä¸ªæ­¥éª¤éƒ½ä¼šè¯¦ç»†è®¨è®ºã€‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•å‡†å¤‡ç¯å¢ƒï¼Œè®¾ç½®æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/Entreprenerdly/InstantMesh">InstantMesh</a> å°†å›¾åƒä»å•ä¸ªå›¾åƒè½¬æ¢ä¸º 3D é‡å»ºã€‚</p>
<p><img src="/../asset_singlleimageto3d/01.gif"></p>
<h2 id="InstantMesh-çš„ç†è®ºæ¡†æ¶"><a href="#InstantMesh-çš„ç†è®ºæ¡†æ¶" class="headerlink" title="InstantMesh çš„ç†è®ºæ¡†æ¶"></a>InstantMesh çš„ç†è®ºæ¡†æ¶</h2><h3 id="åŠ¨æœº"><a href="#åŠ¨æœº" class="headerlink" title="åŠ¨æœº"></a>åŠ¨æœº</h3><p>InstantMesh è§£å†³äº†ä»å•ä¸ªå›¾åƒè¿›è¡Œ 3D é‡å»ºçš„æŒ‘æˆ˜ï¼Œè¿™å¯¹è™šæ‹Ÿç°å®å’ŒåŠ¨ç”»ç­‰åº”ç”¨éå¸¸é‡è¦ã€‚æœ‰é™çš„ 3D æ•°æ®å’Œä¸å®Œå–„çš„æ³¨é‡Šå†æ¥ä½¿å¾—è¿™é¡¹ä»»åŠ¡å›°éš¾ã€‚ç„¶è€Œï¼ŒInstantMesh åˆ©ç”¨å¤§è§„æ¨¡æ‰©æ•£æ¨¡å‹å’Œæ–°é¢–çš„æ¶æ„æ¥å¢å¼º 3D ç½‘æ ¼ç”Ÿæˆã€‚</p>
<h3 id="èƒŒæ™¯å’Œç›¸å…³å·¥ä½œ"><a href="#èƒŒæ™¯å’Œç›¸å…³å·¥ä½œ" class="headerlink" title="èƒŒæ™¯å’Œç›¸å…³å·¥ä½œ"></a>èƒŒæ™¯å’Œç›¸å…³å·¥ä½œ</h3><p>å…ˆå‰çš„ç ”ç©¶å·²ç»å°† 2D æ‰©æ•£æ‰©å±•åˆ° 3D ç©ºé—´ï¼Œä½¿ç”¨äº†è¯¸å¦‚å¾—åˆ†è’¸é¦é‡‡æ ·ï¼ˆSDSï¼‰å’Œå¤§å‹é‡å»ºæ¨¡å‹ï¼ˆLRMsï¼‰è¿™æ ·çš„æ–¹æ³•ï¼Œç›´æ¥å°†å›¾åƒæ ‡è®°æ˜ å°„åˆ° 3D è¡¨ç¤ºã€‚</p>
<h3 id="æ ¸å¿ƒç»„ä»¶å’Œåˆ›æ–°"><a href="#æ ¸å¿ƒç»„ä»¶å’Œåˆ›æ–°" class="headerlink" title="æ ¸å¿ƒç»„ä»¶å’Œåˆ›æ–°"></a>æ ¸å¿ƒç»„ä»¶å’Œåˆ›æ–°</h3><p>å¤šè§†è§’æ‰©æ•£æ¨¡å‹ï¼ˆMVDï¼‰ã€‚è¯¥ç»„ä»¶ä»å•ä¸ªå›¾åƒä¸­åˆæˆå¤šä¸ªè§†å›¾ï¼Œç”¨äºæ„å»º 3D æ¨¡å‹ã€‚æ­¤å¤–ï¼Œå®ƒä½¿ç”¨äº† <a target="_blank" rel="noopener" href="https://stability.ai/news/stable-zero123-3d-generation">Zero123++æ¨¡å‹</a>çš„ä¿®æ”¹ç‰ˆæœ¬ï¼Œç»è¿‡ä¼˜åŒ–ä»¥é€šè¿‡åœ¨ç”Ÿæˆçš„å›¾åƒä¸­ä¿æŒä¸€è‡´çš„èƒŒæ™¯æ¥å‡å°‘ä¼ªå½±ã€‚</p>
<p>MVD çš„æ•°å­¦è¡¨è¾¾ã€‚</p>
<p><img src="/../asset_singlleimageto3d/02.png"></p>
<p>æ‰©æ•£æ¨¡å‹ä½¿ç”¨ç”±ğœƒè¡¨ç¤ºçš„å‚æ•°ï¼Œç»è¿‡å¾®è°ƒä»¥ç”Ÿæˆä¸€è‡´çš„èƒŒæ™¯ï¼Œä»¥ğ¼ä½œä¸ºè¾“å…¥å›¾åƒï¼Œå¹¶åˆæˆå¤šè§†è§’å›¾åƒğ¼â€²ã€‚</p>
<p>ç¨€ç–è§†å›¾å¤§å‹é‡å»ºæ¨¡å‹ï¼ˆLRMï¼‰ã€‚ä½¿ç”¨åŸºäº Transformer çš„æ¶æ„ï¼Œèƒ½å¤Ÿå¤„ç†ç¨€ç–è¾“å…¥ï¼ŒLRM å°†å¤šè§†å›¾å›¾åƒè½¬æ¢ä¸º 3D ç½‘æ ¼ã€‚</p>
<p>ç­‰å€¼é¢æå–ï¼ˆFlexiCubesï¼‰ã€‚</p>
<p><img src="/../asset_singlleimageto3d/03.png"></p>
<p>ğ‘€æ˜¯ç½‘æ ¼è¾“å‡ºï¼Œğ‘‰ä»£è¡¨ LRM ä¸­çš„ä½“ç§¯æ•°æ®ï¼Œğœ™æ˜¯ FlexiCubes æ¨¡å—çš„å‚æ•°ï¼Œå®ƒä»¬ç›´æ¥åº”ç”¨äºç½‘æ ¼ä¸Šçš„å‡ ä½•çº¦æŸã€‚</p>
<h3 id="è®­ç»ƒç­–ç•¥å’Œä¼˜åŒ–æŠ€æœ¯"><a href="#è®­ç»ƒç­–ç•¥å’Œä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="è®­ç»ƒç­–ç•¥å’Œä¼˜åŒ–æŠ€æœ¯"></a>è®­ç»ƒç­–ç•¥å’Œä¼˜åŒ–æŠ€æœ¯</h3><p>æ•°æ®å‡†å¤‡å’Œè®­ç»ƒç­–ç•¥ï¼šè®­ç»ƒé‡‡ç”¨ä¸¤é˜¶æ®µæ–¹æ³•ï¼Œé¦–å…ˆä¾§é‡äº NeRF è¡¨ç¤ºï¼Œç„¶åè¿‡æ¸¡åˆ°ç½‘æ ¼ä¼˜åŒ–ã€‚</p>
<p>é˜¶æ®µ 1ï¼šåŸºäº NeRF çš„è®­ç»ƒã€‚</p>
<p>è¿™ä¸ªé˜¶æ®µçš„é‡ç‚¹æ˜¯åˆ©ç”¨ NeRF çš„ä½“ç§¯æ¸²æŸ“èƒ½åŠ›å»ºç«‹ä¸€ä¸ªå¼ºå¤§çš„åŸºç¡€æ¨¡å‹ã€‚ç›®æ ‡æ˜¯å­¦ä¹ ä¸€ä¸ªåˆå§‹è¡¨ç¤ºï¼Œä»åˆæˆçš„å¤šè§†è§’å›¾åƒä¸­æ•æ‰æ•´ä½“å½¢çŠ¶å’Œå¤–è§‚ã€‚</p>
<p><img src="/../asset_singlleimageto3d/04.png"></p>
<p>ğ¼^ğ‘–å’Œğ‘€^ğ‘–æ˜¯é¢„æµ‹å›¾åƒå’Œæ©æ¨¡ï¼Œğ¼ğ‘”ğ‘¡ğ‘–å’Œğ‘€ğ‘”ğ‘¡ğ‘–æ˜¯å®é™…å›¾åƒå’Œæ©æ¨¡ï¼Œğœ†å€¼æ˜¯æ­£åˆ™åŒ–ç³»æ•°ã€‚</p>
<p>é˜¶æ®µ 2ï¼šåŸºäºç½‘æ ¼çš„ä¼˜åŒ–ã€‚</p>
<p>è¿™ä¸ªé˜¶æ®µè½¬å‘åŸºäºç½‘æ ¼çš„æ–¹æ³•ï¼Œå…¶ä¸­ä½¿ç”¨ FlexiCubes æ¥ç»†åŒ–è¡¨é¢ç»†èŠ‚å¹¶æé«˜ç½‘æ ¼çš„å‡ ä½•ç²¾åº¦ã€‚æ­¤å¤–ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä» NeRF ä¸­å­¦åˆ°çš„åˆæ­¥çŸ¥è¯†è¢«åˆ©ç”¨æ¥ä¸“æ³¨äºå¢å¼ºè¡¨é¢ç»†èŠ‚å¹¶åº”ç”¨é€¼çœŸçš„çº¹ç†ã€‚</p>
<p><img src="/../asset_singlleimageto3d/05.png"></p>
<p>ğ·^ğ‘–å’Œğ‘^ğ‘–æ˜¯é¢„æµ‹çš„æ·±åº¦å›¾å’Œæ³•çº¿å›¾ï¼Œğ·ğ‘”ğ‘¡ğ‘–å’Œğ‘ğ‘”ğ‘¡ğ‘–æ˜¯åœ°é¢çœŸå®å€¼ï¼ŒâŠ—è¡¨ç¤ºé€å…ƒç´ ä¹˜æ³•ï¼Œğ¿reg æ˜¯ FlexiCubes çš„æ­£åˆ™åŒ–é¡¹ã€‚</p>
<p>ç›¸æœºå¢å¼ºå’Œæ‰°åŠ¨æŠ€æœ¯ã€‚å¢å¼ºåŒ…æ‹¬å¯¹ç›¸æœºå§¿åŠ¿è¿›è¡Œéšæœºæ—‹è½¬å’Œç¼©æ”¾ï¼Œä»¥æé«˜æ¨¡å‹å¯¹ä¸åŒè¾“å…¥çš„ç¨³å¥æ€§ã€‚</p>
<p>ä¼˜åŒ–æŠ€æœ¯:</p>
<ul>
<li>AdaLNï¼ˆè‡ªé€‚åº”å±‚å½’ä¸€åŒ–ï¼‰ï¼šæ­¤æŠ€æœ¯ç”¨äºtransformer å†…ï¼Œä»¥è°ƒæ•´æ¨¡å‹å¯¹ä¸åŒç›¸æœºå§¿åŠ¿çš„æ•æ„Ÿæ€§ï¼Œä»è€Œæé«˜å…¶åœ¨å„ç§è§†è§’ä¸‹çš„æ³›åŒ–èƒ½åŠ›ã€‚</li>
<li>æ­£è§„åŒ–å’Œç›‘ç£ï¼šæ·±åº¦å’Œæ³•çº¿ç›‘ç£å¯¹äºä¼˜åŒ–æ¨¡å‹çš„è¾“å‡ºè‡³å…³é‡è¦ã€‚æ­¤å¤–ï¼Œå®ƒç¡®ä¿ 3D ç½‘æ ¼åœ¨è§†è§‰ä¸Šç±»ä¼¼äºè¾“å…¥ï¼Œå¹¶ä¸”ç¬¦åˆç‰©ç†å°ºå¯¸å’Œæ–¹å‘ã€‚</li>
</ul>
<p>æŸå¤±å‡½æ•°ç»„ä»¶:</p>
<ul>
<li>æ·±åº¦å’Œæ³•çº¿ç›‘ç£ã€‚é€šè¿‡å°†é¢„æµ‹çš„æ·±åº¦å›¾å’Œæ³•çº¿ä¸å®ƒä»¬çš„åœ°é¢çœŸå®å¯¹åº”ç‰©è¿›è¡Œæ¯”è¾ƒï¼Œå¢å¼ºæ¨¡å‹é¢„æµ‹å‡†ç¡®å‡ ä½•å±æ€§çš„èƒ½åŠ›ã€‚</li>
<li>æ­£åˆ™åŒ–é¡¹ã€‚åŒ…æ‹¬ç»´æŒç½‘æ ¼å®Œæ•´æ€§ã€é˜²æ­¢è¿‡æ‹Ÿåˆå’Œé¼“åŠ±ç”Ÿæˆç½‘æ ¼å¹³æ»‘çš„é¡¹ã€‚</li>
</ul>
<h3 id="å·¥ä½œæµç¨‹å›¾"><a href="#å·¥ä½œæµç¨‹å›¾" class="headerlink" title="å·¥ä½œæµç¨‹å›¾"></a>å·¥ä½œæµç¨‹å›¾</h3><p>ä¸‹é¢çš„å›¾è¡¨ä»£è¡¨äº† InstantMesh æ¡†æ¶çš„å·¥ä½œæµç¨‹ï¼Œç”¨äºä»å•ä¸ªå›¾åƒç”Ÿæˆ 3D é‡å»ºã€‚ä»¥ä¸‹æ˜¯å›¾è¡¨ä¸­æ¯ä¸ªç»„ä»¶å¦‚ä½•äº§ç”Ÿä½œç”¨ï¼š</p>
<ul>
<li><p>è¾“å…¥å›¾åƒã€‚æµç¨‹å§‹äºå•ä¸ªè¾“å…¥å›¾åƒï¼Œå›¾ç¤ºä¸ºä¸€ä¸ªæ’å›¾äººç‰©ã€‚</p>
</li>
<li><p>å¤šè§†è§’æ‰©æ•£æ¨¡å‹ã€‚ç”Ÿæˆè¾“å…¥å›¾åƒçš„å¤šä¸ªè§†å›¾ï¼Œè¯¥æ¨¡å‹å¢å¼ºäº†è¿›è¡Œ 3D é‡å»ºæ‰€éœ€çš„ç©ºé—´ç†è§£ã€‚æ¥ä¸‹æ¥ï¼Œè§†å›¾è¢«å±•ç¤ºä¸ºäººç‰©çš„å‡ ä¸ªä¸åŒè§†è§’ï¼Œæœ‰åŠ©äºå…¨é¢æ•æ‰å…¶ 3D ç»“æ„ã€‚</p>
</li>
<li><p>ç¨€ç–è§†å›¾å¤§é‡å»ºæ¨¡å‹ã€‚è¯¥æ¨¡å‹ç”±å‡ ä¸ªå…³é”®ç»„ä»¶ç»„æˆï¼š</p>
<ul>
<li>ViT ç¼–ç å™¨ã€‚å¤„ç†å¤šè§†å›¾å›¾åƒï¼Œè§†è§‰ Transformerï¼ˆViTï¼‰ç¼–ç å™¨å°†å®ƒä»¬è½¬æ¢ä¸ºä¸€ç³»åˆ—å›¾åƒæ ‡è®°ï¼Œè¿™äº›æ ‡è®°å°è£…äº†æ¯ä¸ªè§†å›¾çš„å…³é”®ç‰¹å¾ã€‚</li>
<li>ä¸‰å±‚é¢è§£ç å™¨ã€‚è¯¥ç»„ä»¶å°†å›¾åƒä»¤ç‰Œè§£ç ä¸ºä¸‰å±‚é¢è¡¨ç¤ºï¼Œè¿™æ˜¯ä¸€ç§ä¸‰ç»´æ ¼å¼ï¼Œç”¨ä½œæœ€ç»ˆç½‘æ ¼ç”Ÿæˆä¹‹å‰çš„ä¸­é—´æ­¥éª¤ã€‚</li>
<li>FlexiCubesã€‚ä½œä¸ºç­‰å€¼é¢æå–æ¨¡å—ï¼ŒFlexiCubes å°†ä¸‰é¢æ•°æ®è½¬æ¢ä¸ºç½‘æ ¼ï¼Œç›´æ¥åº”ç”¨å‡ ä½•ç›‘ç£æ¥ç»†åŒ–å’Œè¯¦ç»†åŒ– 3D è¾“å‡ºã€‚</li>
</ul>
</li>
<li><p>128Â³ ç½‘æ ¼ã€‚è¯¥ç½‘æ ¼ç»“æ„ä¸º 128x128x128ï¼Œç½‘æ ¼çªå‡ºäº†æœ€ç»ˆ 3D æ¨¡å‹ä¸­æ•æ‰åˆ°çš„åˆ†è¾¨ç‡å’Œç»†èŠ‚ã€‚</p>
</li>
<li><p>æ¸²æŸ“ã€‚ä»å„ä¸ªè§’åº¦æ¸²æŸ“ï¼Œæœ€ç»ˆçš„ç½‘æ ¼å±•ç¤ºäº†å®Œæˆçš„ 3D æ¨¡å‹ï¼Œå¹¶å±•ç¤ºäº†è¯¥æ¨¡å‹åœ¨æ•æ‰åŸå§‹è¾“å…¥çš„å…¨é¢å‡ ä½•ç»†èŠ‚æ–¹é¢çš„æœ‰æ•ˆæ€§ã€‚</p>
</li>
</ul>
<p><img src="/../asset_singlleimageto3d/06.png"></p>
<h3 id="æ¨¡å‹å˜ä½“å’Œé…ç½®"><a href="#æ¨¡å‹å˜ä½“å’Œé…ç½®" class="headerlink" title="æ¨¡å‹å˜ä½“å’Œé…ç½®"></a>æ¨¡å‹å˜ä½“å’Œé…ç½®</h3><p>InstantMesh æä¾›äº†å‡ ç§æ¨¡å‹å˜ä½“ï¼Œä»¥æ»¡è¶³å„ç§è®¡ç®—éœ€æ±‚å’Œåº”ç”¨åœºæ™¯ã€‚</p>
<p>è¿™äº›å˜ä½“æ ¹æ®å®ƒä»¬çš„ 3D è¡¨ç¤ºï¼ˆNeRF vs. Meshï¼‰å’Œå‚æ•°è§„æ¨¡ï¼ˆbase vs. largeï¼‰åˆ†ä¸ºä¸åŒç±»åˆ«ã€‚</p>
<p>æ¨¡å‹å˜ä½“çš„å‚æ•°é…ç½®:</p>
<ul>
<li>NeRF å’Œ Mesh å˜ä½“ã€‚NeRF å˜ä½“æœ€åˆé‡‡ç”¨ç¥ç»è¾å°„åœºæ–¹æ³•ï¼Œæ“…é•¿æ•æ‰å¤æ‚çš„ä½“ç§¯ç»†èŠ‚ã€‚å¦ä¸€æ–¹é¢ï¼ŒMesh å˜ä½“ä»ä¸€å¼€å§‹å°±é‡‡ç”¨ç½‘æ ¼è¡¨ç¤ºï¼Œå®ç°ç›´æ¥çš„å‡ ä½•æ“ä½œï¼Œé€šå¸¸ä½¿ç”¨ FlexiCubes æ¨¡å—å¯ä»¥å®ç°æ›´å¿«çš„å¤„ç†æ—¶é—´ã€‚</li>
<li>åŸºç¡€å’Œå¤§å‹æ¨¡å‹ã€‚transformer ç½‘ç»œçš„å¤§å°ä»¥åŠä¸‰è§’é¢æˆ–ç½‘æ ¼è¡¨ç¤ºçš„å¤æ‚æ€§æ¥åŒºåˆ†è¿™äº›é…ç½®ã€‚æ›´å¤§çš„æ¨¡å‹æ—¨åœ¨å¤„ç†æ›´å¤æ‚çš„åœºæ™¯ï¼Œä½†éœ€è¦æ›´å¤šçš„è®¡ç®—èµ„æºã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>Model</th>
<th>Representation</th>
<th>Input Views</th>
<th>Transformer Layers</th>
<th>Triplane&#x2F;Mesh Details</th>
</tr>
</thead>
<tbody><tr>
<td>InstantNeRF</td>
<td>NeRF</td>
<td>6</td>
<td>12 (Base) &#x2F; 16 (Large)</td>
<td>Triplane 64x64</td>
</tr>
<tr>
<td>InstantMesh</td>
<td>Mesh</td>
<td>6</td>
<td>12 (Base) &#x2F; 16 (Large)</td>
<td>Mesh grid size 128x128</td>
</tr>
</tbody></table>
<h2 id="Python-å®ç°"><a href="#Python-å®ç°" class="headerlink" title="Python å®ç°"></a>Python å®ç°</h2><h3 id="ç¯å¢ƒè®¾ç½®"><a href="#ç¯å¢ƒè®¾ç½®" class="headerlink" title="ç¯å¢ƒè®¾ç½®"></a>ç¯å¢ƒè®¾ç½®</h3><p>ä» GitHub å…‹éš†â€˜InstantMeshâ€™å­˜å‚¨åº“ï¼Œ å®‰è£…å„ç§ Python åº“çš„ç‰¹å®šç‰ˆæœ¬ã€‚å…¶ä¸­åŒ…æ‹¬æ·±åº¦å­¦ä¹  ( pytorch-lightning , torchmetrics )ï¼Œä»¥åŠå…¶ä»–å®ç”¨å·¥å…· ( einops , omegaconf )ã€‚</p>
<ul>
<li>PyMCubes å’Œ trimesh ç”¨äºç½‘æ ¼å¤„ç†ã€‚æå–ç­‰å€¼é¢ï¼ˆå°† 3D ä½“ç´ æ•°æ®è½¬æ¢ä¸ºç½‘æ ¼ï¼‰éœ€è¦ PyMCubes ã€‚ç›¸åï¼Œ trimesh ç”¨äºè½»æ¾æ“ä½œå’ŒæŸ¥çœ‹ 3D ç½‘æ ¼æ•°æ®ã€‚</li>
<li>rembg ç”¨äºä»å›¾åƒä¸­å»é™¤èƒŒæ™¯ï¼Œå¯¹äºéœ€è¦å°†å›¾åƒä¸»é¢˜éš”ç¦»å‡ºæ¥çš„å¤„ç†è‡³å…³é‡è¦ã€‚</li>
<li>nvdiffrast å’Œ jax å’Œ jaxlib. è¿™äº›åº“å¯¹å¯å¾®å…‰æ …åŒ–å’Œæ•°å€¼è®¡ç®—æ˜¯å¿…éœ€çš„ï¼Œä»è€Œå®ç°åŸºäºæ¢¯åº¦ä¸‹é™çš„å¤æ‚ 3D å‡ ä½•ä¼˜åŒ–ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install pytorch-lightning==2.1.2 gradio==3.50.2 einops omegaconf torchmetrics webdataset accelerate tensorboard</span><br><span class="line">pip install PyMCubes trimesh rembg transformers diffusers==0.20.2 bitsandbytes imageio[ffmpeg] xatlas plyfile</span><br><span class="line">pip install git+https://github.com/NVlabs/nvdiffrast jax==0.4.19 jaxlib==0.4.19 ninja</span><br></pre></td></tr></table></figure>

<h3 id="æ¨¡å‹åˆå§‹åŒ–"><a href="#æ¨¡å‹åˆå§‹åŒ–" class="headerlink" title="æ¨¡å‹åˆå§‹åŒ–"></a>æ¨¡å‹åˆå§‹åŒ–</h3><p>æ¨¡å‹ç®¡é“è®¾ç½®:</p>
<ul>
<li>ä¸€ä¸ª DiffusionPipeline æ˜¯ä»ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹å®ä¾‹åŒ–çš„ã€‚è¿™ä¸ªæ¨¡å‹ï¼Œç”± sudo-ai&#x2F;zero123plus-v1.2 æ ‡è¯†ï¼Œä¸“é—¨é…ç½®ä¸ºä»¥åŠç²¾åº¦ï¼ˆ torch_dtype&#x3D;torch.float16 ï¼‰è¿è¡Œã€‚</li>
<li>æ‰©æ•£æ¨¡å‹çš„è°ƒåº¦ç¨‹åºé…ç½®ä¸º trailing æ—¶é—´æ­¥è·ã€‚è¯¥é…ç½®å½±å“äº†æ‰©æ•£æ­¥éª¤çš„è®¡ç®—æ–¹å¼ï¼Œä¼˜åŒ–äº†å›¾åƒåˆæˆè¿‡ç¨‹ä¸­é™å™ªè¿›ç¨‹çš„å¤„ç†ã€‚</li>
</ul>
<p>æ¨¡å‹åŠ è½½ï¼š</p>
<ul>
<li>ä» Hugging Face Hubï¼ˆ hf_hub_download ï¼‰ä¸‹è½½æ¨¡å‹ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°æ¨¡å‹ï¼ˆ pipeline.unet.load_state_dict(state_dict, strict&#x3D;True) ï¼‰ä¸­ï¼Œç¡®ä¿æˆ‘ä»¬æ‹¥æœ‰å‡†å¤‡éƒ¨ç½²çš„ç²¾ç¡®è®­ç»ƒå‚æ•°ã€‚</li>
</ul>
<p>è®¾å¤‡é…ç½®:</p>
<ul>
<li>å°†è®¡ç®—è®¾å¤‡è®¾ç½®ä¸º GPUï¼ˆ device &#x3D; torch.device(â€˜cudaâ€™) ï¼‰å¹¶å°†ç®¡é“ç§»åŠ¨åˆ°è¯¥è®¾å¤‡ï¼ˆ pipeline &#x3D; pipeline.to(device) ï¼‰æ˜¯æ·±åº¦å­¦ä¹ ä»»åŠ¡çš„æ ‡å‡†åšæ³•ã€‚</li>
</ul>
<p>å¯é‡å¤æ€§:</p>
<ul>
<li>ä¸€ä¸ªéšæœºç§å­ï¼ˆ seed_everything(0) ï¼‰å¯ä»¥ç¡®ä¿æ¨¡å‹çš„è¾“å‡ºæ˜¯ç¡®å®šæ€§çš„å’Œå¯é‡ç°çš„ã€‚è¿™åœ¨ç§‘å­¦å®éªŒå’Œäº§å“å¼€å‘ä¸­å°¤ä¸ºé‡è¦ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load libraries</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="comment"># Empty Cache and clear any previous model references</span></span><br><span class="line">model = <span class="literal">None</span></span><br><span class="line">torch.cuda.empty_cache()</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> rembg</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pytorch_lightning <span class="keyword">import</span> seed_everything</span><br><span class="line"><span class="keyword">from</span> einops <span class="keyword">import</span> rearrange</span><br><span class="line"><span class="keyword">from</span> diffusers <span class="keyword">import</span> DiffusionPipeline, EulerAncestralDiscreteScheduler</span><br><span class="line"><span class="keyword">from</span> huggingface_hub <span class="keyword">import</span> hf_hub_download</span><br><span class="line"><span class="keyword">from</span> src.utils.infer_util <span class="keyword">import</span> remove_background, resize_foreground</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Initialize a DiffusionPipeline with a pretrained model specified by its identifier.</span></span><br><span class="line"><span class="comment"># This model uses a custom pipeline setting and operates at half precision (float16) to enhance performance on compatible GPUs.</span></span><br><span class="line">pipeline = DiffusionPipeline.from_pretrained(<span class="string">&quot;sudo-ai/zero123plus-v1.2&quot;</span>, custom_pipeline=<span class="string">&quot;zero123plus&quot;</span>, torch_dtype=torch.float16)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Configure the pipeline&#x27;s scheduler, setting the timestep spacing to &#x27;trailing&#x27; which affects how steps are calculated in the diffusion process.</span></span><br><span class="line">pipeline.scheduler = EulerAncestralDiscreteScheduler.from_config(pipeline.scheduler.config, timestep_spacing=<span class="string">&#x27;trailing&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download the model checkpoint from the Hugging Face Hub, specifying the repository and the file name.</span></span><br><span class="line">unet_ckpt_path = hf_hub_download(repo_id=<span class="string">&quot;TencentARC/InstantMesh&quot;</span>, filename=<span class="string">&quot;diffusion_pytorch_model.bin&quot;</span>, repo_type=<span class="string">&quot;model&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the state dictionary of the model from the downloaded checkpoint, ensuring it&#x27;s loaded to CPU memory first.</span></span><br><span class="line">state_dict = torch.load(unet_ckpt_path, map_location=<span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the state dictionary into the UNet model within the pipeline, ensuring strict loading to match all model parameters exactly.</span></span><br><span class="line">pipeline.unet.load_state_dict(state_dict, strict=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the device for model computation to GPU for faster processing if available.</span></span><br><span class="line">device = torch.device(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Move the pipeline to the specified device (GPU).</span></span><br><span class="line">pipeline = pipeline.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set a seed for random number generation to ensure reproducibility of the results.</span></span><br><span class="line">seed_everything(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="å›¾åƒå¤„ç†å’Œå¤šè§†å›¾åˆæˆåŠŸèƒ½"><a href="#å›¾åƒå¤„ç†å’Œå¤šè§†å›¾åˆæˆåŠŸèƒ½" class="headerlink" title="å›¾åƒå¤„ç†å’Œå¤šè§†å›¾åˆæˆåŠŸèƒ½"></a>å›¾åƒå¤„ç†å’Œå¤šè§†å›¾åˆæˆåŠŸèƒ½</h3><p>å®ç°è´Ÿè´£å›¾åƒé¢„å¤„ç†å’Œä»å•ä¸ªè¾“å…¥ç”Ÿæˆåˆæˆå¤šè§†å›¾å›¾åƒçš„å‡½æ•°, è¿™ä¸ªé˜¶æ®µé€šè¿‡transforms è¾“å…¥å¯ç”¨çš„ç©ºé—´ä¿¡æ¯ï¼Œå°†åˆå§‹è¾“å…¥è½¬æ¢ä¸ºé€‚åˆ 3D å»ºæ¨¡çš„æ ¼å¼ã€‚</p>
<p>é¢„å¤„ç†åŠŸèƒ½ï¼š</p>
<ul>
<li>preprocess å‡½æ•°æ—¨åœ¨å¯é€‰åœ°ä»è¾“å…¥å›¾åƒä¸­ç§»é™¤èƒŒæ™¯ã€‚è¿™ä¸€æ­¥éª¤å¯¹äºå°†æ¨¡å‹çš„æ³¨æ„åŠ›é›†ä¸­åœ¨å›¾åƒçš„ä¸»é¢˜ä¸Šå¹¶é¿å…å¼•å…¥å™ªéŸ³æ˜¯å¿…è¦çš„ã€‚</li>
<li>è°ƒæ•´å‰æ™¯å¤§å°ã€‚åœ¨å»é™¤èƒŒæ™¯åï¼Œå°†å‰æ™¯è°ƒæ•´ä¸ºå…¶åŸå§‹å¤§å°çš„ 85ï¼…æœ‰åŠ©äºæ ‡å‡†åŒ–è¾“å…¥å°ºå¯¸ï¼Œå¯èƒ½å‡å°‘å¤„ç†è¿‡ç¨‹ä¸­çš„è®¡ç®—è´Ÿè½½ã€‚</li>
</ul>
<p>å¤šè§†è§’åˆæˆ:</p>
<ul>
<li>generate_mvs å‡½æ•°ä½¿ç”¨æ‰©æ•£æ¨¡å‹ä»é¢„å¤„ç†å›¾åƒåˆ›å»ºå¤šä¸ªåˆæˆè§†å›¾ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºäººå·¥ç”ŸæˆåŒä¸€å¯¹è±¡çš„ä¸åŒè§†è§’å¯ä»¥å¢åŠ æ•°æ®é›†çš„ä¸°å¯Œæ€§ï¼Œå¹¶æ¨¡æ‹Ÿå¤šæ‘„åƒå¤´è®¾ç½®ã€‚</li>
<li>é€šè¿‡ä½¿ç”¨æ‰©æ•£æ¨¡å‹ï¼Œè¯¥åŠŸèƒ½åˆæˆä¿æŒä¸åŸå§‹å›¾åƒä¸Šä¸‹æ–‡ä¸€è‡´ä½†ä¸åŒè§’åº¦çš„æ–°è§†å›¾ã€‚</li>
<li>å›¾åƒé‡æ–°æ’åˆ—ã€‚åˆæˆè§†å›¾è¢«é‡æ–°æ’åˆ—æˆç½‘æ ¼æ ¼å¼ã€‚è¿™ä¸€æ­¥éª¤å¹¶ä¸ç®€å•ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°æ“çºµå›¾åƒå¼ é‡çš„å½¢çŠ¶å’Œå°ºå¯¸ï¼Œä»¥ä½¿å¤šä¸ªè§†å›¾å¯¹é½æ•´é½ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params">input_image, do_remove_background</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Preprocesses the input image by optionally removing the background.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    input_image (PIL.Image): The image to preprocess.</span></span><br><span class="line"><span class="string">    do_remove_background (bool): Flag to determine if the background should be removed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    PIL.Image: The preprocessed image.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Create a new rembg session only if background removal is requested</span></span><br><span class="line">    rembg_session = rembg.new_session() <span class="keyword">if</span> do_remove_background <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If background removal is enabled, apply the removal process and resize the foreground</span></span><br><span class="line">    <span class="keyword">if</span> do_remove_background:</span><br><span class="line">        input_image = remove_background(input_image, rembg_session)  <span class="comment"># Remove the background</span></span><br><span class="line">        input_image = resize_foreground(input_image, <span class="number">0.85</span>)  <span class="comment"># Resize the foreground to 85% of its original size</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> input_image</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_mvs</span>(<span class="params">input_image, sample_steps, sample_seed</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Generates multi-view synthetic images from a single input image using a diffusion model.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    input_image (PIL.Image): The image to process.</span></span><br><span class="line"><span class="string">    sample_steps (int): Number of inference steps for the diffusion process.</span></span><br><span class="line"><span class="string">    sample_seed (int): Seed for random number generation to ensure reproducibility.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    tuple: A tuple containing:</span></span><br><span class="line"><span class="string">        - z123_image (torch.Tensor): The raw tensor image from the diffusion model.</span></span><br><span class="line"><span class="string">        - show_image (PIL.Image): The rearranged image ready for display.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Set a seed to ensure reproducibility in the generation process</span></span><br><span class="line">    seed_everything(sample_seed)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create a new torch generator for random numbers on the specified device</span></span><br><span class="line">    generator = torch.Generator(device=device)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Generate a synthetic image using the diffusion pipeline</span></span><br><span class="line">    z123_image = pipeline(</span><br><span class="line">        input_image,</span><br><span class="line">        num_inference_steps=sample_steps,</span><br><span class="line">        generator=generator,</span><br><span class="line">    ).images[<span class="number">0</span>]  <span class="comment"># Access the first image from the generated set</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert the PyTorch tensor to a numpy array with type uint8</span></span><br><span class="line">    show_image = np.asarray(z123_image, dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Rearrange the image dimensions to organize multiple views into a grid format for display</span></span><br><span class="line">    show_image = torch.from_numpy(show_image)  <span class="comment"># Convert numpy array back to PyTorch tensor</span></span><br><span class="line">    show_image = rearrange(show_image, <span class="string">&#x27;(n h) (m w) c -&gt; (n m) h w c&#x27;</span>, n=<span class="number">3</span>, m=<span class="number">2</span>)  <span class="comment"># Rearrange for multi-view</span></span><br><span class="line">    show_image = rearrange(show_image, <span class="string">&#x27;(n m) h w c -&gt; (n h) (m w) c&#x27;</span>, n=<span class="number">2</span>, m=<span class="number">3</span>)  <span class="comment"># Adjust the final layout</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Convert the final tensor back to a PIL image for easy display and manipulation</span></span><br><span class="line">    show_image = Image.fromarray(show_image.numpy())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> z123_image, show_image</span><br></pre></td></tr></table></figure>

<h3 id="å›¾åƒåŠ è½½ã€å¤„ç†å’Œå¤šè§†å›¾ç”Ÿæˆ"><a href="#å›¾åƒåŠ è½½ã€å¤„ç†å’Œå¤šè§†å›¾ç”Ÿæˆ" class="headerlink" title="å›¾åƒåŠ è½½ã€å¤„ç†å’Œå¤šè§†å›¾ç”Ÿæˆ"></a>å›¾åƒåŠ è½½ã€å¤„ç†å’Œå¤šè§†å›¾ç”Ÿæˆ</h3><ul>
<li>å›¾åƒåŠ è½½ï¼šè¯¥è¿‡ç¨‹å§‹äºæŒ‡å®šè¾“å…¥å›¾åƒçš„è·¯å¾„ï¼Œå¹¶ä½¿ç”¨ Python Imaging Libraryï¼ˆPILï¼‰åŠ è½½å›¾åƒã€‚</li>
<li>èƒŒæ™¯å»é™¤å’Œå›¾åƒå¤„ç†ï¼šä½¿ç”¨å‰é¢è®¨è®ºè¿‡çš„ preprocess å‡½æ•°ï¼Œæˆ‘ä»¬å»é™¤åŠ è½½å›¾åƒçš„èƒŒæ™¯å¹¶è°ƒæ•´å¤§å°ã€‚</li>
<li>åˆæˆå¤šè§†å›¾ç”Ÿæˆï¼šç„¶åå°† generate_mvs å‡½æ•°åº”ç”¨äºé¢„å¤„ç†å›¾åƒï¼Œä»¥ç”Ÿæˆå¤šä¸ªåˆæˆè§†å›¾ã€‚æ­¤ç”Ÿæˆçš„å‚æ•° â€” ä¾‹å¦‚æ‰©æ•£è¿‡ç¨‹ä¸­çš„æ­¥æ•°ï¼ˆ75ï¼‰è¢«é€‰æ‹©ä»¥å¹³è¡¡è®¡ç®—éœ€æ±‚å’Œç”Ÿæˆè§†å›¾çš„è´¨é‡ä¹‹é—´çš„æƒè¡¡ã€‚</li>
<li>å›¾åƒä¿å­˜å’Œæ˜¾ç¤ºï¼šæ‰©æ•£è¿‡ç¨‹äº§ç”Ÿçš„åŸå§‹å¼ é‡å›¾åƒå’Œè§†è§‰ä¸Šæ’åˆ—çš„å¤šè§†å›¾å›¾åƒéƒ½ä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define the path to the input image stored in the notebook&#x27;s workspace environment.</span></span><br><span class="line">input_image_path = <span class="string">&#x27;examples/bird.jpg&#x27;</span> <span class="comment">#@param &#123;type:&quot;string&quot;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Open the image file from the specified path using PIL&#x27;s Image module.</span></span><br><span class="line">input_image = Image.<span class="built_in">open</span>(input_image_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Preprocess the input image by removing the background, leveraging the &#x27;preprocess&#x27; function.</span></span><br><span class="line">processed_image = preprocess(input_image, <span class="literal">True</span>)  <span class="comment"># Pass True to indicate background removal is needed.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the processed image; useful for verification in a Jupyter Notebook environment.</span></span><br><span class="line">processed_image</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate multi-view synthetic images from the preprocessed image using a diffusion model.</span></span><br><span class="line"><span class="comment"># Specify 75 steps for the diffusion process and a seed value of 42 for reproducibility.</span></span><br><span class="line">mv_images, mv_show_images = generate_mvs(processed_image, <span class="number">75</span>, <span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define the path where the generated multi-view images will be saved.</span></span><br><span class="line">output_image_path = <span class="string">&#x27;mv_images.png&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the raw tensor image (not visually arranged) to the specified file path.</span></span><br><span class="line">mv_images.save(output_image_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the rearranged multi-view images, which are formatted for easy viewing.</span></span><br><span class="line"><span class="comment"># This output can be directly viewed in a Jupyter Notebook environment.</span></span><br><span class="line">mv_show_images</span><br></pre></td></tr></table></figure>
<p><img src="/../asset_singlleimageto3d/07.png"></p>
<h3 id="æ¨¡å‹é…ç½®"><a href="#æ¨¡å‹é…ç½®" class="headerlink" title="æ¨¡å‹é…ç½®"></a>æ¨¡å‹é…ç½®</h3><p>æˆ‘ä»¬è®¾ç½®æ“ä½œå‚æ•°ï¼Œä»å¤–éƒ¨æ¥æºåŠ è½½å¿…è¦çš„é…ç½®ï¼Œå¹¶ç¡®ä¿æ¨¡å‹åœ¨ç»™å®šç¡¬ä»¶ä¸Šæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>é…ç½®åŠ è½½å’Œåº”ç”¨ã€‚</p>
<ul>
<li>OmegaConf ä»ä¸€ä¸ª YAML æ–‡ä»¶ä¸­åŠ è½½æ¨¡å‹çš„é…ç½®ã€‚è¿™ä¸€æ­¥æä¾›äº†ä¸€ç§çµæ´»ä¸”ç»“æ„åŒ–çš„æ–¹å¼æ¥ç®¡ç†è®¾ç½®å’Œæ“ä½œå‚æ•°ï¼Œå¯ä»¥åœ¨ä¸æ”¹å˜ä»£ç åº“çš„æƒ…å†µä¸‹è¿›è¡Œè°ƒæ•´ã€‚</li>
<li>æ­¤å¤–ï¼ŒYAML æ–‡ä»¶åŒ…å«å„ç§æ¨¡å‹æ–¹é¢çš„è§„èŒƒï¼ŒåŒ…æ‹¬æ¶æ„ç»†èŠ‚å’Œæ“ä½œå‚æ•°ï¼Œè¿™äº›è§„èŒƒæŒ‡å¯¼ç³»ç»Ÿåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¡Œä¸ºã€‚</li>
</ul>
<p>æ¨¡å‹åˆå§‹åŒ–ã€‚</p>
<ul>
<li>æ ¹æ®ä¸Šä¸€æ­¥åŠ è½½çš„é…ç½®ï¼Œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ¨¡å‹ã€‚è¿™æ¶‰åŠè®¾ç½®æ¨¡å‹æ¶æ„ï¼Œå¦‚åœ¨ YAML æ–‡ä»¶ä¸­æŒ‡å®šçš„é‚£æ ·ã€‚</li>
</ul>
<p>çŠ¶æ€å­—å…¸ç®¡ç†ã€‚</p>
<ul>
<li>ä»è¿œç¨‹å­˜å‚¨åº“ä¸‹è½½æ¨¡å‹åï¼Œç³»ç»Ÿå°†çŠ¶æ€å­—å…¸åŠ è½½åˆ°å®ä¾‹åŒ–çš„æ¨¡å‹ä¸­ã€‚è¯¥çŠ¶æ€å­—å…¸åŒ…å«ç»è¿‡è®­ç»ƒçš„æƒé‡å’Œåç½®ã€‚</li>
<li>çŠ¶æ€å­—å…¸çš„ç®¡ç†ç¡®ä¿æ¨¡å‹çš„æ‰€æœ‰ç»„ä»¶éƒ½æ­£ç¡®åœ°ä½¿ç”¨è®­ç»ƒå‚æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
</ul>
<p>GPU åŠ é€Ÿè®¾å¤‡é…ç½®ã€‚</p>
<ul>
<li>å¦‚æœå¯ç”¨ï¼Œç³»ç»Ÿä¼šé…ç½®æ¨¡å‹åœ¨ GPU ä¸Šè¿è¡Œä»¥åŠ å¿«è®¡ç®—é€Ÿåº¦ã€‚è¿™ç§è®¾ç½®æ¶‰åŠå°†æ¨¡å‹çš„è®¡ç®—ä»»åŠ¡è½¬ç§»åˆ° GPU ä¸Šï¼Œä»¥ä¾¿é«˜æ•ˆåœ°å¤„ç†å¹¶è¡Œå¤„ç†ã€‚</li>
<li>è¿™ä¸€æ­¥å¤„ç†æ¶‰åŠ 3D å»ºæ¨¡å’Œå›¾åƒå¤„ç†çš„å¤æ‚è®¡ç®—ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§æ•°æ®é‡æˆ–éœ€è¦å®æ—¶æ€§èƒ½æ—¶ã€‚</li>
</ul>
<p>FlexiCubes å‡ ä½•ç‰¹æ®Šé…ç½®ã€‚</p>
<ul>
<li>å¦å¤–ä¸€é¡¹æ£€æŸ¥è¯„ä¼°æ¨¡å‹æ˜¯å¦ä½¿ç”¨ FlexiCubesã€‚å¦‚æœ FlexiCubes æ˜¯é…ç½®çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™ä¼šæ‰§è¡Œé¢å¤–çš„åˆå§‹åŒ–æ­¥éª¤æ¥è®¾ç½®è¿™ä¸ªå‡ ä½•ç»“æ„ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Empty Cache and clear any previous pipeline references</span></span><br><span class="line">pipeline = <span class="literal">None</span></span><br><span class="line">torch.cuda.empty_cache()</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> torchvision.transforms <span class="keyword">import</span> v2</span><br><span class="line"><span class="keyword">from</span> omegaconf <span class="keyword">import</span> OmegaConf</span><br><span class="line"><span class="keyword">from</span> einops <span class="keyword">import</span> repeat</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> imageio</span><br><span class="line"><span class="keyword">from</span> src.utils.train_util <span class="keyword">import</span> instantiate_from_config</span><br><span class="line"><span class="keyword">from</span> src.utils.camera_util <span class="keyword">import</span> (FOV_to_intrinsics, get_zero123plus_input_cameras,get_circular_camera_poses,)</span><br><span class="line"><span class="keyword">from</span> src.utils.mesh_util <span class="keyword">import</span> save_obj, save_obj_with_mtl</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define the path to the configuration file for the model.</span></span><br><span class="line">config_path = <span class="string">&#x27;configs/instant-mesh-base.yaml&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the configuration from the YAML file using OmegaConf.</span></span><br><span class="line">config = OmegaConf.load(config_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract the base name of the configuration file, removing the &#x27;.yaml&#x27; extension for use in conditional logic or naming.</span></span><br><span class="line">config_name = os.path.basename(config_path).replace(<span class="string">&#x27;.yaml&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Access specific configuration blocks for the model and inference from the loaded configuration.</span></span><br><span class="line">model_config = config.model_config</span><br><span class="line">infer_config = config.infer_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># Download the model checkpoint from Hugging Face Hub, specifying the repository ID and filename.</span></span><br><span class="line">model_ckpt_path = hf_hub_download(repo_id=<span class="string">&quot;TencentARC/InstantMesh&quot;</span>, filename=<span class="string">&quot;instant_mesh_base.ckpt&quot;</span>, repo_type=<span class="string">&quot;model&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Instantiate the model using the configuration for the model.</span></span><br><span class="line">model = instantiate_from_config(model_config)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the model&#x27;s state dictionary from the checkpoint, ensuring it&#x27;s directed to CPU memory.</span></span><br><span class="line">state_dict = torch.load(model_ckpt_path, map_location=<span class="string">&#x27;cpu&#x27;</span>)[<span class="string">&#x27;state_dict&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter and adjust the keys in the state dictionary to match the expected format by removing a specific prefix and excluding any keys related to the &#x27;source_camera&#x27;.</span></span><br><span class="line">state_dict = &#123;k[<span class="number">14</span>:]: v <span class="keyword">for</span> k, v <span class="keyword">in</span> state_dict.items() <span class="keyword">if</span> k.startswith(<span class="string">&#x27;lrm_generator.&#x27;</span>) <span class="keyword">and</span> <span class="string">&#x27;source_camera&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> k&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the processed state dictionary into the model, ensuring a strict match.</span></span><br><span class="line">model.load_state_dict(state_dict, strict=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the device for model computation to GPU to accelerate processing.</span></span><br><span class="line">device = torch.device(<span class="string">&#x27;cuda&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Move the model to the specified device.</span></span><br><span class="line">model = model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check if the configuration name starts with &#x27;instant-mesh&#x27; to determine if FlexiCubes geometry initialization is required.</span></span><br><span class="line">IS_FLEXICUBES = <span class="literal">True</span> <span class="keyword">if</span> config_name.startswith(<span class="string">&#x27;instant-mesh&#x27;</span>) <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If the model uses FlexiCubes, initialize the FlexiCubes geometry with the specified field of view.</span></span><br><span class="line"><span class="keyword">if</span> IS_FLEXICUBES:</span><br><span class="line">    model.init_flexicubes_geometry(device, fovy=<span class="number">30.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the model to evaluation mode, which disables training-specific behaviors like dropout.</span></span><br><span class="line">model = model.<span class="built_in">eval</span>()</span><br></pre></td></tr></table></figure>

<h3 id="3D-æ¨¡å‹ç”Ÿæˆå’Œå¯è§†åŒ–çš„åŠŸèƒ½"><a href="#3D-æ¨¡å‹ç”Ÿæˆå’Œå¯è§†åŒ–çš„åŠŸèƒ½" class="headerlink" title="3D æ¨¡å‹ç”Ÿæˆå’Œå¯è§†åŒ–çš„åŠŸèƒ½"></a>3D æ¨¡å‹ç”Ÿæˆå’Œå¯è§†åŒ–çš„åŠŸèƒ½</h3><p>å®ç°ä»å¤„ç†è¿‡çš„å›¾åƒç”Ÿæˆå’Œå¯è§†åŒ– 3D æ¨¡å‹çš„åŠŸèƒ½ã€‚</p>
<p>è¿™äº›åŠŸèƒ½å°†å¤šè§†å›¾å›¾åƒè½¬æ¢ä¸º 3D è¾“å‡ºï¼ˆMP4ã€å¯¹è±¡æ–‡ä»¶ç­‰ï¼‰ï¼Œå¯åœ¨å„ç§åº”ç”¨ä¸­è¿›è¡Œè¯„ä¼°å’Œåˆ©ç”¨ã€‚</p>
<ul>
<li>ä»å›¾åƒåºåˆ—åˆ›å»ºè§†é¢‘ï¼š images_to_video å‡½æ•°å°†å›¾åƒåºåˆ—è½¬æ¢ä¸ºè§†é¢‘æ–‡ä»¶ã€‚è¯¥å‡½æ•°ä¼šæ£€æŸ¥å’Œè½¬æ¢å›¾åƒæ•°æ®ï¼Œä»¥ç¡®ä¿å¸§å…·æœ‰æ­£ç¡®çš„æ ¼å¼å’Œå°ºå¯¸ï¼Œç„¶åå°†å®ƒä»¬ç¼–è¯‘æˆè§†é¢‘ã€‚</li>
<li>ç”¨äº 3D æ¸²æŸ“çš„ç›¸æœºå‚æ•°ç”Ÿæˆï¼š get_render_cameras è®¡ç®—å¹¶æä¾›æ¸²æŸ“ 3D æ¨¡å‹æ‰€éœ€çš„ç›¸æœºå‚æ•°ã€‚è¿™äº›å‚æ•°æ˜¯åŸºäºåœ†å½¢é…ç½®æ¨å¯¼å‡ºæ¥çš„ï¼Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªçœŸå®çš„ç›¸æœºè®¾ç½®ï¼Œå¯ä»¥ä»å¤šä¸ªè§’åº¦æ•æ‰å¯¹è±¡ã€‚</li>
<li>3D ç½‘æ ¼ç”Ÿæˆï¼š make_mesh å‡½æ•°ä»æ¨¡å‹æä¾›çš„å¹³é¢æ•°æ®åˆ›å»º 3D ç½‘æ ¼ã€‚è¯¥å‡½æ•°ç”Ÿæˆç½‘æ ¼ï¼Œè¿˜å¯ä»¥é€‰æ‹©æ€§åœ°åº”ç”¨çº¹ç†æ˜ å°„ã€‚</li>
<li>å…¨é¢çš„ 3D æ¨¡å‹å’Œå¯è§†åŒ–ç”Ÿæˆï¼š make3d åŠŸèƒ½ç¼–æ’æ•´ä¸ªå°†å›¾åƒæ•°æ®è½¬æ¢ä¸º 3D ç½‘æ ¼å’Œç›¸åº”è§†é¢‘çš„è¿‡ç¨‹ã€‚å®ƒç®¡ç†ä»å¤„ç†åˆå§‹å›¾åƒã€è®¾ç½®ç›¸æœºå‚æ•°ã€ç”Ÿæˆç½‘æ ¼å¹³é¢ï¼Œæœ€åå°†è¾“å‡ºç¼–è¯‘æˆé™æ€ï¼ˆç½‘æ ¼ï¼‰å’ŒåŠ¨æ€ï¼ˆè§†é¢‘ï¼‰æ ¼å¼çš„å·¥ä½œæµç¨‹ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">images_to_video</span>(<span class="params">images, output_path, fps=<span class="number">30</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Converts a sequence of images into a video file.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    images (Tensor): A tensor of images to convert into video.</span></span><br><span class="line"><span class="string">    output_path (str): The file path where the video will be saved.</span></span><br><span class="line"><span class="string">    fps (int): Frames per second for the output video.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Ensure the directory for the output path exists, create if not.</span></span><br><span class="line">    os.makedirs(os.path.dirname(output_path), exist_ok=<span class="literal">True</span>)</span><br><span class="line">    frames = []</span><br><span class="line">    <span class="comment"># Convert each image tensor to a numpy array, adjust for display, and collect frames.</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(images.shape[<span class="number">0</span>]):</span><br><span class="line">        frame = (images[i].permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>).cpu().numpy() * <span class="number">255</span>).astype(np.uint8).clip(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">        <span class="comment"># Ensure frame dimensions match expected dimensions.</span></span><br><span class="line">        <span class="keyword">assert</span> frame.shape[<span class="number">0</span>] == images.shape[<span class="number">2</span>] <span class="keyword">and</span> frame.shape[<span class="number">1</span>] == images.shape[<span class="number">3</span>], \</span><br><span class="line">            <span class="string">f&quot;Frame shape mismatch: <span class="subst">&#123;frame.shape&#125;</span> vs <span class="subst">&#123;images.shape&#125;</span>&quot;</span></span><br><span class="line">        <span class="comment"># Ensure pixel values are within the valid range.</span></span><br><span class="line">        <span class="keyword">assert</span> frame.<span class="built_in">min</span>() &gt;= <span class="number">0</span> <span class="keyword">and</span> frame.<span class="built_in">max</span>() &lt;= <span class="number">255</span>, \</span><br><span class="line">            <span class="string">f&quot;Frame value out of range: <span class="subst">&#123;frame.<span class="built_in">min</span>()&#125;</span> ~ <span class="subst">&#123;frame.<span class="built_in">max</span>()&#125;</span>&quot;</span></span><br><span class="line">        frames.append(frame)</span><br><span class="line">    <span class="comment"># Write the frames to a video file.</span></span><br><span class="line">    imageio.mimwrite(output_path, np.stack(frames), fps=fps, codec=<span class="string">&#x27;h264&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_render_cameras</span>(<span class="params">batch_size=<span class="number">1</span>, M=<span class="number">120</span>, radius=<span class="number">2.5</span>, elevation=<span class="number">10.0</span>, is_flexicubes=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Generates camera parameters for 3D rendering based on a circular configuration.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    batch_size (int): Number of camera sets to generate.</span></span><br><span class="line"><span class="string">    M (int): Number of camera positions.</span></span><br><span class="line"><span class="string">    radius (float): Radius of the camera circle.</span></span><br><span class="line"><span class="string">    elevation (float): Elevation angle of cameras.</span></span><br><span class="line"><span class="string">    is_flexicubes (bool): Flag to indicate if FlexiCubes geometry is used.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    Tensor: Camera parameters for rendering.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Compute camera positions based on circular parameters.</span></span><br><span class="line">    c2ws = get_circular_camera_poses(M=M, radius=radius, elevation=elevation)</span><br><span class="line">    <span class="comment"># If using FlexiCubes, adjust camera parameters accordingly.</span></span><br><span class="line">    <span class="keyword">if</span> is_flexicubes:</span><br><span class="line">        cameras = torch.linalg.inv(c2ws)</span><br><span class="line">        cameras = cameras.unsqueeze(<span class="number">0</span>).repeat(batch_size, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        extrinsics = c2ws.flatten(-<span class="number">2</span>)</span><br><span class="line">        intrinsics = FOV_to_intrinsics(<span class="number">30.0</span>).unsqueeze(<span class="number">0</span>).repeat(M, <span class="number">1</span>, <span class="number">1</span>).<span class="built_in">float</span>().flatten(-<span class="number">2</span>)</span><br><span class="line">        cameras = torch.cat([extrinsics, intrinsics], dim=-<span class="number">1</span>)</span><br><span class="line">        cameras = cameras.unsqueeze(<span class="number">0</span>).repeat(batch_size, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> cameras</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_mesh</span>(<span class="params">mesh_fpath, planes</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Creates a 3D mesh with optional texture mapping.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    mesh_fpath (str): File path for saving the mesh.</span></span><br><span class="line"><span class="string">    planes (Tensor): Planar data for mesh generation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    str: The file path where the mesh is saved.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Extract base filename and directory from path.</span></span><br><span class="line">    mesh_basename = os.path.basename(mesh_fpath).split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    mesh_dirname = os.path.dirname(mesh_fpath)</span><br><span class="line">    <span class="comment"># Use texture mapping to save a detailed mesh.</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        mesh_out = model.extract_mesh(planes, use_texture_map=<span class="literal">True</span>, **infer_config)</span><br><span class="line">        vertices, faces, uvs, mesh_tex_idx, tex_map = mesh_out</span><br><span class="line">        save_obj_with_mtl(</span><br><span class="line">            vertices.data.cpu().numpy(),</span><br><span class="line">            uvs.data.cpu().numpy(),</span><br><span class="line">            faces.data.cpu().numpy(),</span><br><span class="line">            mesh_tex_idx.data.cpu().numpy(),</span><br><span class="line">            tex_map.permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>).data.cpu().numpy(),</span><br><span class="line">            mesh_fpath,</span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Mesh with texmap saved to <span class="subst">&#123;mesh_fpath&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> mesh_fpath</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make3d</span>(<span class="params">images</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Generates a 3D mesh and a video of the mesh from images.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    images (Tensor or array): Image data used for 3D generation.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    tuple: Paths to the generated video and mesh file.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Convert image data to tensor and normalize.</span></span><br><span class="line">    images = np.asarray(images, dtype=np.float32) / <span class="number">255.0</span></span><br><span class="line">    images = torch.from_numpy(images).permute(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>).contiguous().<span class="built_in">float</span>()</span><br><span class="line">    <span class="comment"># Reorganize images for processing.</span></span><br><span class="line">    images = rearrange(images, <span class="string">&#x27;c (n h) (m w) -&gt; (n m) c h w&#x27;</span>, n=<span class="number">3</span>, m=<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># Obtain camera parameters for input and rendering.</span></span><br><span class="line">    input_cameras = get_zero123plus_input_cameras(batch_size=<span class="number">1</span>, radius=<span class="number">4.0</span>).to(device)</span><br><span class="line">    render_cameras = get_render_cameras(</span><br><span class="line">        batch_size=<span class="number">1</span>, radius=<span class="number">4.5</span>, elevation=<span class="number">20.0</span>, is_flexicubes=IS_FLEXICUBES).to(device)</span><br><span class="line">    <span class="comment"># Resize images and move to GPU.</span></span><br><span class="line">    images = images.unsqueeze(<span class="number">0</span>).to(device)</span><br><span class="line">    images = v2.functional.resize(images, (<span class="number">320</span>, <span class="number">320</span>), interpolation=<span class="number">3</span>, antialias=<span class="literal">True</span>).clamp(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># Prepare directory for temporary storage.</span></span><br><span class="line">    directory = <span class="string">&#x27;tmp&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(directory):</span><br><span class="line">        os.makedirs(directory)</span><br><span class="line">    tempfile.tempdir = directory</span><br><span class="line">    <span class="comment"># Create temporary files for mesh and video.</span></span><br><span class="line">    mesh_fpath = tempfile.NamedTemporaryFile(suffix=<span class="string">&quot;.obj&quot;</span>, delete=<span class="literal">False</span>).name</span><br><span class="line">    mesh_basename = os.path.basename(mesh_fpath).split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    mesh_dirname = os.path.dirname(mesh_fpath)</span><br><span class="line">    video_fpath = os.path.join(mesh_dirname, <span class="string">f&quot;<span class="subst">&#123;mesh_basename&#125;</span>.mp4&quot;</span>)</span><br><span class="line">    <span class="comment"># Generate mesh planes and render frames for video.</span></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        planes = model.forward_planes(images, input_cameras)</span><br><span class="line">        chunk_size = <span class="number">20</span> <span class="keyword">if</span> IS_FLEXICUBES <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        render_size = <span class="number">384</span></span><br><span class="line">        frames = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0</span>, render_cameras.shape[<span class="number">1</span>], chunk_size)):</span><br><span class="line">            <span class="keyword">if</span> IS_FLEXICUBES:</span><br><span class="line">                frame = model.forward_geometry(planes, render_cameras[:, i:i+chunk_size], render_size=render_size)[<span class="string">&#x27;img&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                frame = model.synthesizer(planes, cameras=render_cameras[:, i:i+chunk_size], render_size=render_size)[<span class="string">&#x27;images_rgb&#x27;</span>]</span><br><span class="line">            frames.append(frame)</span><br><span class="line">        frames = torch.cat(frames, dim=<span class="number">1</span>)</span><br><span class="line">        images_to_video(frames[<span class="number">0</span>], video_fpath, fps=<span class="number">30</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Video saved to <span class="subst">&#123;video_fpath&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># Save the mesh and return paths.</span></span><br><span class="line">    mesh_fpath = make_mesh(mesh_fpath, planes)</span><br><span class="line">    <span class="keyword">return</span> video_fpath, mesh_fpath</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Open the multi-view image file previously saved to check the output from the image generation process.</span></span><br><span class="line">mv_images = Image.<span class="built_in">open</span>(<span class="string">&#x27;mv_images.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Pass the opened multi-view images to the &#x27;make3d&#x27; function to generate a 3D model and a video visualization of the model.</span></span><br><span class="line">output_video, output_model_obj = make3d(mv_images)</span><br></pre></td></tr></table></figure>
<p>æ’­æ”¾ç”Ÿæˆçš„è§†é¢‘æ–‡ä»¶</p>
<p><img src="/../asset_singlleimageto3d/02.gif"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://medium.com/@crisvelasquez/3d-reconstructions-from-a-single-image-d53c387261b6">https://medium.com/@crisvelasquez/3d-reconstructions-from-a-single-image-d53c387261b6</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/27/deepQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/27/deepQ/" class="post-title-link" itemprop="url">å¼ºåŒ–å­¦ä¹ ï¼šæ·±åº¦ Q ç½‘ç»œ</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-27 17:29:10" itemprop="dateCreated datePublished" datetime="2024-05-27T17:29:10+08:00">2024-05-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-28 15:35:12" itemprop="dateModified" datetime="2024-05-28T15:35:12+08:00">2024-05-28</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>33 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>åœ¨å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰ä¸­ï¼ŒQ å­¦ä¹ æ˜¯ä¸€ç§åŸºç¡€ç®—æ³•ï¼Œå¸®åŠ©ä»£ç†é€šè¿‡å­¦ä¹ æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±çš„ç­–ç•¥æ¥å¯¼èˆªå…¶ç¯å¢ƒã€‚å®ƒé€šè¿‡æ›´æ–°åŠ¨ä½œå€¼å‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¯¥å‡½æ•°åŸºäºæ¥æ”¶çš„å¥–åŠ±å’Œæœªæ¥çš„å¥–åŠ±æ¥ä¼°è®¡åœ¨ç»™å®šçŠ¶æ€ä¸‹é‡‡å–ç‰¹å®šåŠ¨ä½œçš„é¢„æœŸæ•ˆç”¨ã€‚</p>
<p>ç„¶è€Œï¼Œä¼ ç»Ÿçš„ Q å­¦ä¹ ä¹Ÿå­˜åœ¨æŒ‘æˆ˜ã€‚éšç€çŠ¶æ€ç©ºé—´çš„å¢é•¿ï¼Œå®ƒåœ¨å¯æ‰©å±•æ€§æ–¹é¢é‡åˆ°å›°éš¾ï¼Œå¹¶ä¸”åœ¨å…·æœ‰è¿ç»­çŠ¶æ€å’ŒåŠ¨ä½œç©ºé—´çš„ç¯å¢ƒä¸­æ•ˆæœè¾ƒå·®ã€‚è¿™å°±æ˜¯æ·±åº¦ Q ç½‘ç»œï¼ˆDQNsï¼‰å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚DQNs ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è¿‘ä¼¼ Q å€¼ï¼Œä½¿ä»£ç†èƒ½å¤Ÿæœ‰æ•ˆå¤„ç†æ›´å¤§æ›´å¤æ‚çš„ç¯å¢ƒã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨æ·±åº¦ Q ç½‘ç»œã€‚æˆ‘ä»¬å°†æ¢è®¨ DQN å¦‚ä½•å…‹æœä¼ ç»Ÿ Q å­¦ä¹ çš„å±€é™æ€§ï¼Œå¹¶è®¨è®ºæ„æˆ DQN çš„å…³é”®ç»„ä»¶ã€‚æˆ‘ä»¬è¿˜å°†ä»‹ç»å¦‚ä½•ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ª DQNï¼Œå¹¶å°†å…¶åº”ç”¨äºæ›´å¤æ‚çš„ç¯å¢ƒä¸­ã€‚</p>
<h2 id="ä¼ ç»Ÿçš„-Q-å­¦ä¹ "><a href="#ä¼ ç»Ÿçš„-Q-å­¦ä¹ " class="headerlink" title="ä¼ ç»Ÿçš„ Q å­¦ä¹ "></a>ä¼ ç»Ÿçš„ Q å­¦ä¹ </h2><p>Q-learning æŒ‡å¯¼ä»£ç†æ¥å­¦ä¹ åœ¨ç¯å¢ƒä¸­æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±çš„æœ€ä½³è¡ŒåŠ¨ã€‚åœ¨æ·±åº¦ Q ç½‘ç»œä¹‹å‰ï¼Œå…ˆç®€è¦å›é¡¾å…¶å‰èº« Q-learning èƒŒåçš„æœºåˆ¶ã€‚</p>
<h3 id="çŠ¶æ€å’ŒåŠ¨ä½œ"><a href="#çŠ¶æ€å’ŒåŠ¨ä½œ" class="headerlink" title="çŠ¶æ€å’ŒåŠ¨ä½œ"></a>çŠ¶æ€å’ŒåŠ¨ä½œ</h3><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ˜¯ä¸€ä¸ªåœ¨è¿·å®«ä¸­å¯¼èˆªçš„æœºå™¨äººã€‚è¿·å®«ä¸­ä½ æ‰€å æ®çš„æ¯ä¸ªä½ç½®è¢«ç§°ä¸ºâ€œçŠ¶æ€â€ã€‚ä½ å¯ä»¥é‡‡å–çš„æ¯ä¸ªå¯èƒ½ç§»åŠ¨ï¼Œæ¯”å¦‚å‘å·¦ã€å‘å³ã€å‘ä¸Šæˆ–å‘ä¸‹ï¼Œéƒ½æ˜¯ä¸€ç§â€œåŠ¨ä½œâ€ã€‚ç›®æ ‡æ˜¯æ‰¾å‡ºåœ¨æ¯ä¸ªçŠ¶æ€ä¸‹åº”è¯¥é‡‡å–å“ªç§åŠ¨ä½œï¼Œæœ€ç»ˆæ‰¾åˆ°è¿·å®«ä¸­çš„æœ€ä½³è·¯å¾„ã€‚</p>
<h3 id="Q-å€¼"><a href="#Q-å€¼" class="headerlink" title="Q-å€¼"></a>Q-å€¼</h3><p>Q å­¦ä¹ çš„æ ¸å¿ƒæ˜¯ Q å€¼ï¼Œè¡¨ç¤ºä¸ºğ‘„(ğ‘ , ğ‘)ã€‚è¯¥å€¼ä»£è¡¨åœ¨ç‰¹å®šçŠ¶æ€ s ä¸­é‡‡å–ç‰¹å®šåŠ¨ä½œ a åé¢„æœŸçš„æœªæ¥å¥–åŠ±ï¼Œç„¶åæ²¿ç€æœ€ä½³è·¯å¾„ï¼ˆç­–ç•¥ï¼‰ç»§ç»­ã€‚</p>
<p>å°† Q å€¼è§†ä¸ºæŒ‡å—ä¸­çš„æ¡ç›®ï¼Œè¯„ä¼°æ¯ä¸ªå¯èƒ½ç§»åŠ¨çš„é•¿æœŸæ”¶ç›Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨è¿·å®«ä¸­çš„ç‰¹å®šä½ç½®å¹¶è€ƒè™‘å‘å·¦ç§»åŠ¨ï¼ŒQ å€¼ä¼šå‘Šè¯‰ä½ è¿™ä¸€ç§»åŠ¨åœ¨æœªæ¥å¥–åŠ±æ–¹é¢é¢„è®¡ä¼šæœ‰å¤šå¤§ç›Šå¤„ã€‚è¾ƒé«˜çš„ Q å€¼è¡¨ç¤ºæ›´å¥½çš„ç§»åŠ¨ã€‚</p>
<h3 id="Q-è¡¨"><a href="#Q-è¡¨" class="headerlink" title="Q è¡¨"></a>Q è¡¨</h3><p>Q å­¦ä¹ ä½¿ç”¨ Q è¡¨æ¥è·Ÿè¸ªè¿™äº› Q å€¼ã€‚Q è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§å‹çš„ç”µå­è¡¨æ ¼ï¼Œå…¶ä¸­æ¯ä¸€è¡Œå¯¹åº”ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯ä¸€åˆ—å¯¹åº”ä¸€ä¸ªåŠ¨ä½œï¼Œæ¯ä¸ªå•å…ƒæ ¼åŒ…å«è¯¥çŠ¶æ€-åŠ¨ä½œå¯¹çš„ Q å€¼ã€‚</p>
<p>æƒ³è±¡ Q è¡¨æ ¼å°±åƒä¸€ä¸ªå·¨å¤§çš„ç”µå­è¡¨æ ¼ï¼Œå…¶ä¸­æ¯ä¸ªå•å…ƒæ ¼ä»£è¡¨ä»è¿·å®«ä¸­ç‰¹å®šä½ç½®åšå‡ºç‰¹å®šç§»åŠ¨çš„æ½œåœ¨æœªæ¥å¥–åŠ±ã€‚éšç€å¯¹ç¯å¢ƒçš„äº†è§£è¶Šæ¥è¶Šå¤šï¼Œæ‚¨ä¼šç”¨æ›´å¥½çš„ä¼°è®¡å€¼æ›´æ–°è¿™ä¸ªç”µå­è¡¨æ ¼ä¸­çš„è¿™äº›å¥–åŠ±ã€‚</p>
<h3 id="å­¦ä¹ è¿‡ç¨‹"><a href="#å­¦ä¹ è¿‡ç¨‹" class="headerlink" title="å­¦ä¹ è¿‡ç¨‹"></a>å­¦ä¹ è¿‡ç¨‹</h3><p>Q-Learning ä¸­çš„å­¦ä¹ è¿‡ç¨‹æ˜¯è¿­ä»£çš„ã€‚å®ƒå§‹äºä¸€ä¸ªåˆå§‹çŠ¶æ€ sã€‚ç„¶åï¼Œå†³å®šé‡‡å–ä¸€ä¸ªåŠ¨ä½œ aã€‚è¿™ä¸ªé€‰æ‹©å¯ä»¥åŸºäºï¼š</p>
<ul>
<li>æ¢ç´¢ï¼šå°è¯•æ–°çš„è¡ŒåŠ¨ä»¥å‘ç°å®ƒä»¬çš„æ•ˆæœã€‚</li>
<li>åˆ©ç”¨ï¼šåˆ©ç”¨ç°æœ‰çŸ¥è¯†é€‰æ‹©å…·æœ‰å·²çŸ¥æœ€é«˜ Q å€¼çš„åŠ¨ä½œã€‚</li>
</ul>
<p>æ‰§è¡Œé€‰æ‹©çš„åŠ¨ä½œï¼Œè§‚å¯Ÿå¥–åŠ± rï¼Œå¹¶ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ sâ€²ã€‚ä½¿ç”¨ Q-Learning å…¬å¼æ›´æ–°çŠ¶æ€-åŠ¨ä½œå¯¹ (s, a) çš„ Q å€¼ï¼š</p>
<p><img src="/../asset_deepq/01.png" alt="Q-å€¼æ›´æ–°å…¬å¼"></p>
<p>è¿™é‡Œï¼š</p>
<ul>
<li>Î±æ˜¯å­¦ä¹ ç‡ï¼Œå®ƒå†³å®šäº†æ–°ä¿¡æ¯è¦†ç›–æ—§ä¿¡æ¯çš„ç¨‹åº¦ã€‚</li>
<li>Î³æ˜¯æŠ˜æ‰£å› å­ï¼Œå®ƒæ›´é«˜åœ°é‡è§†å³æ—¶å¥–åŠ±è€Œä¸æ˜¯é¥è¿œæœªæ¥çš„å¥–åŠ±ã€‚</li>
<li>maxaâ€²â€‹Q(sâ€²,aâ€²)ä»£è¡¨äº†åœ¨æ‰€æœ‰å¯èƒ½çš„åŠ¨ä½œ aâ€²ä¸­ï¼Œä¸‹ä¸€ä¸ªçŠ¶æ€ sâ€²çš„æœ€é«˜ Q å€¼ã€‚</li>
</ul>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä¸æ–­æ›´æ–°ä½ çš„æŒ‡å—ã€‚æ¯æ¬¡ç§»åŠ¨åï¼Œä½ ä¼šå¾—åˆ°å…³äºè¿™ä¸ªç§»åŠ¨æ˜¯å¥½æ˜¯åçš„åé¦ˆï¼ˆå¥–åŠ±ï¼‰ã€‚ç„¶åï¼Œä½ ä¼šè°ƒæ•´æŒ‡å—ä¸­çš„è¯„åˆ†ï¼ˆQ å€¼ï¼‰ä»¥åæ˜ è¿™äº›æ–°ä¿¡æ¯ï¼Œä½¿ä½ æœªæ¥çš„å†³ç­–æ›´åŠ æ˜æ™ºã€‚</p>
<p>ç»§ç»­é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ° Q å€¼æ”¶æ•›ï¼Œè¿™æ„å‘³ç€ä»£ç†å·²ç»å­¦ä¼šäº†åœ¨è¿·å®«ä¸­å¯¼èˆªçš„æœ€ä¼˜ç­–ç•¥ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œé€šè¿‡åå¤æ¢ç´¢è¿·å®«å¹¶æ ¹æ®ç»éªŒæ›´æ–°ä½ çš„æŒ‡å—ï¼Œä½ ä¼šåˆ¶å®šå‡ºä¸€å¥—å…¨é¢çš„ç­–ç•¥ï¼Œå‘Šè¯‰ä½ åœ¨ä»»ä½•ç»™å®šä½ç½®åšå‡ºæœ€ä½³ç§»åŠ¨ä»¥æœ€å¤§åŒ–å¥–åŠ±ã€‚</p>
<h2 id="ä»-Q-å­¦ä¹ åˆ°æ·±åº¦-Q-ç½‘ç»œ"><a href="#ä»-Q-å­¦ä¹ åˆ°æ·±åº¦-Q-ç½‘ç»œ" class="headerlink" title="ä» Q å­¦ä¹ åˆ°æ·±åº¦ Q ç½‘ç»œ"></a>ä» Q å­¦ä¹ åˆ°æ·±åº¦ Q ç½‘ç»œ</h2><h3 id="ä¼ ç»Ÿ-Q-å­¦ä¹ çš„å±€é™æ€§"><a href="#ä¼ ç»Ÿ-Q-å­¦ä¹ çš„å±€é™æ€§" class="headerlink" title="ä¼ ç»Ÿ Q å­¦ä¹ çš„å±€é™æ€§"></a>ä¼ ç»Ÿ Q å­¦ä¹ çš„å±€é™æ€§</h3><p>è™½ç„¶ Q å­¦ä¹ æ˜¯ä¸€ç§å¼ºå¤§çš„å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œä½†å®ƒæœ‰ä¸€äº›é™åˆ¶ï¼Œé˜»ç¢äº†å®ƒåœ¨æ›´å¤æ‚ç¯å¢ƒä¸­çš„æœ‰æ•ˆæ€§ï¼š</p>
<ul>
<li><p>å¯æ‰©å±•æ€§é—®é¢˜ï¼šä¼ ç»Ÿçš„ Q å­¦ä¹ ç»´æŠ¤ä¸€ä¸ª Q è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªçŠ¶æ€-åŠ¨ä½œå¯¹éƒ½æ˜ å°„åˆ°ä¸€ä¸ª Q å€¼ã€‚éšç€çŠ¶æ€ç©ºé—´çš„å¢é•¿ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜ç»´åº¦æˆ–è¿ç»­ç¯å¢ƒä¸­ï¼ŒQ è¡¨å˜å¾—è¿‡å¤§ï¼Œå¯¼è‡´å†…å­˜æ•ˆç‡ä½ä¸‹å’Œå­¦ä¹ è¿‡ç¨‹ç¼“æ…¢ã€‚</p>
</li>
<li><p>ç¦»æ•£çŠ¶æ€å’ŒåŠ¨ä½œç©ºé—´ï¼šQ å­¦ä¹ åœ¨çŠ¶æ€å’ŒåŠ¨ä½œæ˜¯ç¦»æ•£å’Œæœ‰é™çš„ç¯å¢ƒä¸­è¡¨ç°è‰¯å¥½ã€‚ç„¶è€Œï¼Œè®¸å¤šç°å®ä¸–ç•Œçš„é—®é¢˜æ¶‰åŠè¿ç»­çš„çŠ¶æ€å’ŒåŠ¨ä½œç©ºé—´ï¼Œä¼ ç»Ÿçš„ Q å­¦ä¹ åœ¨ä¸å¯¹è¿™äº›ç©ºé—´è¿›è¡Œç¦»æ•£åŒ–çš„æƒ…å†µä¸‹æ•ˆç‡ä½ä¸‹ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¿¡æ¯ä¸¢å¤±å’Œæ¬¡ä¼˜ç­–ç•¥ã€‚</p>
</li>
</ul>
<h3 id="ç¥ç»ç½‘ç»œ"><a href="#ç¥ç»ç½‘ç»œ" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h3><p>è®©æˆ‘ä»¬ç°åœ¨ä»‹ç»ç¥ç»ç½‘ç»œï¼Œå®ƒåœ¨æ·±åº¦ç½‘ç»œä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ã€‚å—åˆ°äººç±»å¤§è„‘ç»“æ„å’ŒåŠŸèƒ½çš„å¯å‘ï¼Œç¥ç»ç½‘ç»œæ˜¯å¼ºå¤§çš„å‡½æ•°é€¼è¿‘å™¨ï¼Œèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ å¤æ‚æ¨¡å¼ã€‚å®ƒä»¬ç”±ç›¸äº’è¿æ¥çš„èŠ‚ç‚¹ï¼ˆç¥ç»å…ƒï¼‰å±‚ç»„æˆï¼Œå¤„ç†è¾“å…¥æ•°æ®ï¼Œå¹¶é€šè¿‡æƒé‡å’Œåå·®å°†å…¶è½¬æ¢ä¸ºè¾“å‡ºã€‚</p>
<p>åœ¨å¼ºåŒ–å­¦ä¹ çš„èƒŒæ™¯ä¸‹ï¼Œç¥ç»ç½‘ç»œå¯ä»¥ç”¨æ¥é€¼è¿‘ Q å‡½æ•°ï¼Œå®ƒå°†çŠ¶æ€-åŠ¨ä½œå¯¹æ˜ å°„åˆ° Q å€¼ã€‚è¿™ä½¿å¾—ä»£ç†èƒ½å¤Ÿæ›´å¥½åœ°åœ¨å„ç§çŠ¶æ€å’ŒåŠ¨ä½œä¹‹é—´è¿›è¡Œæ³›åŒ–ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§å‹æˆ–è¿ç»­ç©ºé—´ä¸­ï¼Œç»´æŠ¤ Q è¡¨æ˜¯ä¸å¯è¡Œçš„ã€‚</p>
<p>å› æ­¤ï¼Œæ·±åº¦ Q ç½‘ç»œï¼ˆDQNsï¼‰å°† Q å­¦ä¹ çš„åŸç†ä¸ç¥ç»ç½‘ç»œçš„å‡½æ•°é€¼è¿‘èƒ½åŠ›ç›¸ç»“åˆã€‚é€šè¿‡è¿™æ ·åšï¼Œå®ƒä»¬è§£å†³äº†ä¼ ç»Ÿ Q å­¦ä¹ çš„å…³é”®å±€é™æ€§ã€‚</p>
<p>DQNs ä¸æ˜¯å°† Q å€¼å­˜å‚¨åœ¨è¡¨ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥è¿‘ä¼¼ Q å‡½æ•°ã€‚è¯¥ç½‘ç»œä»¥çŠ¶æ€ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸ºæ‰€æœ‰å¯èƒ½çš„åŠ¨ä½œè¾“å‡º Q å€¼ã€‚é€šè¿‡ä½¿ç”¨æ¥è‡ªç¯å¢ƒçš„ç»éªŒå¯¹ç½‘ç»œè¿›è¡Œè®­ç»ƒï¼Œä»£ç†ç¨‹åºå­¦ä¼šé¢„æµ‹æ¯ä¸ªåŠ¨ä½œçš„é¢„æœŸå¥–åŠ±ï¼Œæœ‰æ•ˆåœ°åœ¨å¤§é‡çŠ¶æ€å’ŒåŠ¨ä½œä¹‹é—´è¿›è¡Œæ³›åŒ–ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å­¦ä¹ ä¸‹æ£‹ã€‚ä¸å…¶è®°ä½æ¯ç§å¯èƒ½çš„æ£‹ç›˜å¸ƒå±€å’Œæ¯ä¸€æ­¥æœ€ä½³èµ°æ³•ï¼ˆè¿™æ˜¯ä¸å¯èƒ½çš„ï¼‰ï¼Œä½ å­¦ä¹ ä¸€èˆ¬æ€§çš„ç­–ç•¥å’ŒåŸåˆ™ï¼ˆæ¯”å¦‚æ§åˆ¶æ£‹ç›˜ä¸­å¿ƒå’Œä¿æŠ¤å›½ç‹ï¼‰ã€‚åŒæ ·ï¼Œä¸€ä¸ª DQN é€šè¿‡ç¥ç»ç½‘ç»œå­¦ä¹ ä¸€èˆ¬æ¨¡å¼å’Œç­–ç•¥ï¼Œä½¿å…¶èƒ½å¤Ÿåšå‡ºæ˜æ™ºçš„å†³ç­–ï¼Œè€Œæ— éœ€è®°ä½æ¯ç§å¯èƒ½çš„çŠ¶æ€ã€‚</p>
<p>ç¥ç»ç½‘ç»œçš„ä½¿ç”¨ä½¿ DQN èƒ½å¤Ÿå¤„ç†å…·æœ‰å¤§å‹æˆ–è¿ç»­çŠ¶æ€ç©ºé—´çš„ç¯å¢ƒã€‚ç½‘ç»œå¯ä»¥å­¦ä¹ çŠ¶æ€ç©ºé—´çš„è¡¨ç¤ºï¼Œæ•æ‰å…³é”®ç‰¹å¾ï¼Œä½¿ä»£ç†èƒ½å¤Ÿåšå‡ºæ˜æ™ºçš„å†³ç­–ï¼Œè€Œæ— éœ€ç¦»æ•£åŒ–ç©ºé—´ã€‚</p>
<p>è€ƒè™‘å°è¯•åœ¨ä¸€ä¸ªå¤§åŸå¸‚ä¸­å¯¼èˆªã€‚ä¸å…¶è®°ä½æ¯æ¡è¡—é“å’Œå»ºç­‘ç‰©çš„å¸ƒå±€ï¼ˆè¿™å°±åƒä¸€ä¸ªå·¨å¤§çš„ Q è¡¨ï¼‰ï¼Œä¸å¦‚å­¦ä¼šè¯†åˆ«åœ°æ ‡å’Œä¸»è¦é“è·¯ï¼Œè¿™æœ‰åŠ©äºæ‚¨æ‰¾åˆ°æ–¹å‘ã€‚DQN ä¸­çš„ç¥ç»ç½‘ç»œå·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œå­¦ä¼šè¯†åˆ«çŠ¶æ€ç©ºé—´çš„é‡è¦ç‰¹å¾ï¼Œå¸®åŠ©ä»£ç†åœ¨å¤æ‚ç¯å¢ƒä¸­å¯¼èˆªã€‚</p>
<p>é€šè¿‡å¯¹å„ç§ç»å†è¿›è¡Œè®­ç»ƒï¼Œæ¨¡å‹å­¦ä¼šä»è¿‡å»çš„ç»å†ä¸­å½’çº³ã€‚è¿™æ„å‘³ç€ä»£ç†å¯ä»¥å°†æ‰€å­¦åº”ç”¨äºæ–°çš„ã€æœªæ›¾è§è¿‡çš„çŠ¶æ€å’Œè¡ŒåŠ¨ï¼Œä½¿å…¶åœ¨ä¸åŒæƒ…å†µä¸‹æ›´å…·é€‚åº”æ€§å’Œæ•ˆç‡ã€‚</p>
<h2 id="æ·±åº¦-Q-ç½‘ç»œçš„è§£å‰–"><a href="#æ·±åº¦-Q-ç½‘ç»œçš„è§£å‰–" class="headerlink" title="æ·±åº¦ Q ç½‘ç»œçš„è§£å‰–"></a>æ·±åº¦ Q ç½‘ç»œçš„è§£å‰–</h2><h3 id="DQN-çš„ç»„æˆéƒ¨åˆ†"><a href="#DQN-çš„ç»„æˆéƒ¨åˆ†" class="headerlink" title="DQN çš„ç»„æˆéƒ¨åˆ†"></a>DQN çš„ç»„æˆéƒ¨åˆ†</h3><p>è¦ç†è§£æ·±åº¦ Q ç½‘ç»œï¼ˆDQNsï¼‰çš„å·¥ä½œåŸç†ï¼Œå¿…é¡»åˆ†è§£å®ƒä»¬çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼š</p>
<h4 id="ç¥ç»ç½‘ç»œ-1"><a href="#ç¥ç»ç½‘ç»œ-1" class="headerlink" title="ç¥ç»ç½‘ç»œ"></a>ç¥ç»ç½‘ç»œ</h4><p><img src="/../asset_deepq/02.png" alt="å‰é¦ˆç¥ç»ç½‘ç»œ "></p>
<p>DQN çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œå®ƒä½œä¸º Q å€¼çš„å‡½æ•°é€¼è¿‘å™¨ã€‚å…¸å‹çš„æ¶æ„é€šå¸¸åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¾“å…¥å±‚ï¼šå°†å…¶æƒ³è±¡ä¸ºä»£ç†çš„â€œçœ¼ç›â€ã€‚å®ƒæ¥æ”¶æ¥è‡ªç¯å¢ƒçš„çŠ¶æ€è¡¨ç¤ºï¼Œç±»ä¼¼äºæ‚¨çš„çœ¼ç›æ¥æ”¶å‘¨å›´çš„è§†è§‰ä¿¡æ¯ã€‚è¿™æ˜¯ä¸Šå›¾å·¦ä¾§çš„ç¬¬ä¸€å±‚ï¼Œæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ã€‚</li>
<li>éšè—å±‚ï¼šå°†è¿™äº›å±‚è§†ä¸ºä»£ç†çš„â€œå¤§è„‘â€ã€‚å®ƒä»¬é€šè¿‡å¤šä¸ªæ€è€ƒé˜¶æ®µå¤„ç†çœ¼ç›æ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼Œè¯†åˆ«å¤æ‚çš„ç‰¹å¾å’Œæ¨¡å¼ï¼Œå°±åƒä½ çš„å¤§è„‘å¤„ç†å’Œç†è§£ä¸–ç•Œä¸€æ ·ã€‚è¿™æ˜¯ä¸Šå›¾ä¸­å…·æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„ä¸­é—´å±‚ã€‚</li>
<li>è¾“å‡ºå±‚ï¼šè¿™å°±åƒä»£ç†äººçš„â€œå†³ç­–â€éƒ¨åˆ†ã€‚å®ƒæ ¹æ®è¾“å…¥çŠ¶æ€äº§ç”Ÿæ‰€æœ‰å¯èƒ½åŠ¨ä½œçš„ Q å€¼ï¼Œç±»ä¼¼äºä½ çš„å¤§è„‘æ ¹æ®æ‰€è§å’Œæ‰€æƒ³å†³å®šæœ€ä½³åŠ¨ä½œã€‚æ¯ä¸ªè¾“å‡ºå¯¹åº”äºé‡‡å–ç‰¹å®šåŠ¨ä½œçš„é¢„æœŸå¥–åŠ±ã€‚è¿™æ˜¯ä¸Šå›¾ä¸­æœ€å³è¾¹çš„æœ€åä¸€å±‚ï¼Œæœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>
<p>ä¸Šé¢çš„å›¾åƒä»£è¡¨äº†ä¸€ä¸ªç®€å•çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œæ˜¯ç¥ç»ç½‘ç»œæœ€åŸºæœ¬çš„å½¢å¼ã€‚è™½ç„¶è¿™ç§ç»“æ„æ˜¯åŸºç¡€çš„ï¼Œä½†å®ƒè¿˜ä¸æ˜¯ä¸€ä¸ªâ€œæ·±åº¦â€ç¥ç»ç½‘ç»œã€‚è¦å°†å…¶è½¬å˜ä¸ºæ·±åº¦ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ›´å¤šéšè—å±‚ï¼Œå¢åŠ ç½‘ç»œçš„æ·±åº¦ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä¸åŒçš„æ¶æ„å’Œé…ç½®æ¥å¼€å‘æ›´é«˜çº§çš„æ¨¡å‹ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªå±‚ä¸­çš„èŠ‚ç‚¹æ•°é‡å¹¶ä¸å›ºå®šï¼›å®ƒå–å†³äºç‰¹å®šçš„è®­ç»ƒæ•°æ®é›†å’Œä»»åŠ¡ã€‚è¿™ç§çµæ´»æ€§ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ ¹æ®ç‰¹å®šéœ€æ±‚æ¥å®šåˆ¶ç½‘ç»œã€‚</p>
<h4 id="ç»å†å›æ”¾"><a href="#ç»å†å›æ”¾" class="headerlink" title="ç»å†å›æ”¾"></a>ç»å†å›æ”¾</h4><p>ç»å†é‡æ”¾, è¿™æ˜¯ä¸€ç§ç”¨äºç¨³å®šå’Œæ”¹è¿› DQN å­¦ä¹ è¿‡ç¨‹çš„æŠ€æœ¯ã€‚å®ƒæ¶‰åŠï¼š</p>
<ul>
<li>å†…å­˜ç¼“å†²åŒºï¼šå°†å…¶æƒ³è±¡ä¸ºä»£ç†çš„â€œæ—¥è®°â€ã€‚å®ƒä¼šéšç€æ—¶é—´è€Œå­˜å‚¨ä»£ç†çš„ç»å†ï¼ˆçŠ¶æ€ã€åŠ¨ä½œã€å¥–åŠ±ã€ä¸‹ä¸€ä¸ªçŠ¶æ€ã€å®Œæˆï¼‰ï¼Œå°±åƒä½ å¯èƒ½ä¼šæ¯å¤©å†™ä¸‹å‘ç”Ÿåœ¨ä½ èº«ä¸Šçš„äº‹æƒ…ä¸€æ ·ã€‚</li>
<li>éšæœºæŠ½æ ·ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä»£ç†äººç¿»é˜…å…¶æ—¥è®°çš„éšæœºé¡µé¢ï¼Œä»¥ä»è¿‡å»çš„ç»å†ä¸­å­¦ä¹ ã€‚è¿™æ‰“ç ´äº†äº‹ä»¶åºåˆ—ï¼Œå¸®åŠ©ä»£ç†äººé€šè¿‡é˜²æ­¢è¿‡åº¦æ‹Ÿåˆåˆ°ç»å†é¡ºåºæ¥æ›´åŠ ç¨³å¥åœ°å­¦ä¹ ã€‚</li>
</ul>
<h4 id="ç›®æ ‡ç½‘ç»œ"><a href="#ç›®æ ‡ç½‘ç»œ" class="headerlink" title="ç›®æ ‡ç½‘ç»œ"></a>ç›®æ ‡ç½‘ç»œ</h4><p>æœ€åï¼Œç›®æ ‡ç½‘ç»œæ˜¯ä¸€ä¸ªå•ç‹¬çš„ç¥ç»ç½‘ç»œï¼Œç”¨äºè®¡ç®—ç›®æ ‡ Q å€¼è¿›è¡Œè®­ç»ƒã€‚å®ƒåœ¨æ¶æ„ä¸Šä¸ä¸»ç½‘ç»œç›¸åŒï¼Œä½†å…·æœ‰å†»ç»“çš„æƒé‡ï¼Œè¿™äº›æƒé‡ä¼šå®šæœŸæ›´æ–°ä»¥åŒ¹é…ä¸»ç½‘ç»œçš„æƒé‡ã€‚å¯ä»¥å°†å…¶è§†ä¸ºä»£ç†çš„â€œç¨³å®šæŒ‡å—â€ã€‚è™½ç„¶ä¸»ç½‘ç»œä¸æ–­å­¦ä¹ å’Œæ›´æ–°ï¼Œä½†ç›®æ ‡ç½‘ç»œä¸ºè®­ç»ƒæä¾›ç¨³å®šçš„ Q å€¼ã€‚è¿™å°±åƒæœ‰ä¸€ä¸ªå¯é çš„ã€å®šæœŸæ›´æ–°çš„æ‰‹å†Œå¯ä¾›å‚è€ƒï¼Œæœ‰åŠ©äºä¿æŒå­¦ä¹ çš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ã€‚</p>
<h3 id="DQN-ç®—æ³•"><a href="#DQN-ç®—æ³•" class="headerlink" title="DQN ç®—æ³•"></a>DQN ç®—æ³•</h3><p>æœ‰äº†è¿™äº›ç»„ä»¶ï¼ŒDQN ç®—æ³•å¯ä»¥åœ¨å‡ ä¸ªå…³é”®æ­¥éª¤ä¸­æ¦‚è¿°ï¼š</p>
<h4 id="å‰å‘ä¼ æ’­"><a href="#å‰å‘ä¼ æ’­" class="headerlink" title="å‰å‘ä¼ æ’­"></a>å‰å‘ä¼ æ’­</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»å‰å‘ä¼ æ’­å¼€å§‹ï¼Œè¿™å¯¹äºé¢„æµ‹ Q å€¼è‡³å…³é‡è¦ã€‚è¿™äº› Q å€¼å­˜å‚¨äº†åœ¨ç»™å®šçŠ¶æ€ä¸‹é‡‡å–æŸäº›è¡ŒåŠ¨çš„é¢„æœŸæœªæ¥å¥–åŠ±ã€‚è¯¥è¿‡ç¨‹å§‹äºçŠ¶æ€è¾“å…¥ã€‚</p>
<ul>
<li><p>çŠ¶æ€è¾“å…¥ï¼š<br>ä»£ç†äººä»ç¯å¢ƒä¸­è§‚å¯Ÿå½“å‰çŠ¶æ€ sã€‚è¿™ä¸ªçŠ¶æ€è¢«è¡¨ç¤ºä¸ºæè¿°ä»£ç†äººå½“å‰æƒ…å†µçš„ç‰¹å¾å‘é‡ã€‚å°†çŠ¶æ€è§†ä¸ºä»£ç†äººå‘¨å›´ä¸–ç•Œçš„å¿«ç…§ï¼Œç±»ä¼¼äºæ‚¨ç¯é¡¾å››å‘¨æ—¶çœ¼ç›æ•æ‰è§†è§‰åœºæ™¯ã€‚è¿™ä¸ªå¿«ç…§åŒ…å«äº†ä»£ç†äººåšå‡ºå†³ç­–æ‰€éœ€çš„æ‰€æœ‰å¿…è¦ç»†èŠ‚ã€‚</p>
</li>
<li><p>Q å€¼é¢„æµ‹ï¼š<br>æ¥ä¸‹æ¥ï¼Œè§‚å¯Ÿåˆ°çš„çŠ¶æ€ s è¢«è¾“å…¥ç¥ç»ç½‘ç»œã€‚ç¥ç»ç½‘ç»œé€šè¿‡å¤šå±‚å¤„ç†è¿™ä¸ªè¾“å…¥ï¼Œå¹¶è¾“å‡ºä¸€ç»„ Q å€¼ Q(s, a; Î¸)ã€‚æ¯ä¸ª Q å€¼å¯¹åº”ä¸€ä¸ªå¯èƒ½çš„åŠ¨ä½œ aï¼Œå‚æ•° Î¸ è¡¨ç¤ºç½‘ç»œçš„æƒé‡å’Œåå·®ã€‚</p>
</li>
</ul>
<p><img src="/../asset_deepq/03.png" alt="Q å€¼é¢„æµ‹å…¬å¼"></p>
<p>æƒ³è±¡ç¥ç»ç½‘ç»œæ˜¯ä»£ç†çš„å¤§è„‘ä¸­çš„ä¸€ä¸ªå¤æ‚å†³ç­–æœºå™¨ã€‚å½“å®ƒæ¥æ”¶åˆ°å¿«ç…§ï¼ˆçŠ¶æ€ï¼‰æ—¶ï¼Œå®ƒé€šè¿‡å‡ ä¸ªé˜¶æ®µï¼ˆå±‚ï¼‰å¤„ç†è¿™äº›ä¿¡æ¯ï¼Œä»¥æ‰¾å‡ºä¸åŒè¡ŒåŠ¨çš„æ½œåœ¨ç»“æœï¼ˆQ å€¼ï¼‰ã€‚å°±åƒä½ çš„å¤§è„‘æ ¹æ®æ‰€è§çš„æƒ…å†µæ€è€ƒä¸åŒå¯èƒ½çš„è¡ŒåŠ¨ä¸€æ ·ã€‚</p>
<ul>
<li>è¡ŒåŠ¨é€‰æ‹©ï¼š<br>ä»£ç†ç„¶åé€‰æ‹©å…·æœ‰æœ€é«˜ Q å€¼çš„åŠ¨ä½œ aâˆ—ä½œä¸ºå…¶ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼Œéµå¾ªè´ªå©ªåŠ¨ä½œé€‰æ‹©ç­–ç•¥ï¼š</li>
</ul>
<p><img src="/../asset_deepq/04.png" alt="è¡ŒåŠ¨é€‰æ‹©å…¬å¼"></p>
<p>è¿™å°±å¥½æ¯”åœ¨æ·±æ€ç†Ÿè™‘æ‰€æœ‰é€‰é¡¹åå†³å®šæœ€ä½³è¡ŒåŠ¨ã€‚ä»£ç†äººé€‰æ‹©å®ƒè®¤ä¸ºä¼šå¸¦æ¥æœ€é«˜å¥–åŠ±çš„è¡ŒåŠ¨ï¼Œå°±åƒä½ æ ¹æ®æ‰€è§å’Œç†è§£é€‰æ‹©ä¼¼ä¹æœ€æœ‰å‰é€”çš„é“è·¯ä¸€æ ·ã€‚</p>
<h4 id="ç»å†é‡æ’­"><a href="#ç»å†é‡æ’­" class="headerlink" title="ç»å†é‡æ’­"></a>ç»å†é‡æ’­</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œç»å†é‡æ¼”ï¼Œè¿™æœ‰åŠ©äºç¨³å®šå’Œæ”¹å–„å­¦ä¹ è¿‡ç¨‹ã€‚</p>
<ul>
<li><p>è®°å½•ç»å†ï¼š<br>ä»£ç†ç¨‹åºæ‰§è¡ŒåŠ¨ä½œ a å¹¶è·å¾—å¥–åŠ± r å’Œæ–°çŠ¶æ€ sâ€² åï¼Œå°†è¿™ä¸€ç»å†å­˜å‚¨ä¸ºä¸€ä¸ªå…ƒç»„(s, a, r, sâ€², done) æ”¾å…¥é‡æ”¾ç¼“å†²åŒºã€‚å˜é‡ done è¡¨ç¤ºè¯¥æƒ…èŠ‚æ˜¯å¦å·²ç»“æŸã€‚å¯ä»¥å°†é‡æ”¾ç¼“å†²åŒºè§†ä¸ºä»£ç†ç¨‹åºè®°å½•ç»å†çš„æ—¥è®°ï¼Œå°±åƒè®°å½•ä¸€å¤©ä¸­å€¼å¾—æ³¨æ„çš„äº‹ä»¶ä¸€æ ·ã€‚</p>
</li>
<li><p>å°æ‰¹é‡å–æ ·:<br>åœ¨è®­ç»ƒæœŸé—´ï¼Œä¸€å°æ‰¹ç»å†ä»é‡æ’­ç¼“å†²åŒºä¸­éšæœºæŠ½å–ã€‚è¿™ä¸€æ‰¹æ•°æ®ç”¨äºé€šè¿‡è®¡ç®—ç›®æ ‡ Q å€¼å’Œæœ€å°åŒ–æŸå¤±æ¥æ›´æ–°ç½‘ç»œã€‚å½“ä»£ç†è¿›è¡Œè®­ç»ƒæ—¶ï¼Œå®ƒä¼šç¿»é˜…å…¶æ—¥è®°çš„éšæœºé¡µé¢ï¼Œä»¥ä»è¿‡å»çš„ç»å†ä¸­å­¦ä¹ ã€‚è¿™ç§éšæœºæŠ½æ ·æœ‰åŠ©äºæ‰“ç ´äº‹ä»¶åºåˆ—ï¼Œå¹¶æä¾›å¤šæ ·åŒ–çš„å­¦ä¹ ç¤ºä¾‹ï¼Œå°±åƒæŸ¥çœ‹æ—¥è®°ä¸­ä¸åŒæ—¥æœŸä»¥è·å¾—æ›´å¹¿æ³›çš„è§†è§’ä¸€æ ·ã€‚</p>
</li>
</ul>
<p><img src="/../asset_deepq/05.png" alt="æ·±åº¦ Q ç½‘ç»œä¸­çš„å°æ‰¹é‡å­¦ä¹ "></p>
<h4 id="åå‘ä¼ æ’­"><a href="#åå‘ä¼ æ’­" class="headerlink" title="åå‘ä¼ æ’­"></a>åå‘ä¼ æ’­</h4><p>æœ€åä¸€æ­¥æ¶‰åŠåå‘ä¼ æ’­ï¼Œå®ƒæ›´æ–°ç½‘ç»œä»¥æ”¹å–„å…¶é¢„æµ‹ã€‚</p>
<ul>
<li>è®¡ç®—ç›®æ ‡ Q å€¼ï¼š<br>å¯¹äºå°æ‰¹é‡ä¸­çš„æ¯ä¸ªç»å†ï¼Œä»£ç†è®¡ç®—ç›®æ ‡ Q å€¼ y_ã€‚å¦‚æœä¸‹ä¸€ä¸ªçŠ¶æ€ sâ€™æ˜¯ç»ˆæ­¢çŠ¶æ€ï¼ˆdoneå³ä¸ºçœŸï¼‰ï¼Œç›®æ ‡ Q å€¼å°±æ˜¯ç®€å•çš„å¥–åŠ± rã€‚å¦åˆ™ï¼Œå®ƒæ˜¯å¥–åŠ±åŠ ä¸Šç”±ç›®æ ‡ç½‘ç»œ Qtarget é¢„æµ‹çš„ä¸‹ä¸€ä¸ªçŠ¶æ€ sâ€™ çš„æœ€å¤§ Q å€¼çš„æŠ˜æ‰£ï¼š</li>
</ul>
<p><img src="/../asset_deepq/06.png" alt=" "></p>
<p>åœ¨è¿™é‡Œï¼ŒÎ³æ˜¯æŠ˜æ‰£å› å­ï¼ˆ0 â‰¤ Î³ &lt; 1ï¼‰ã€‚è¿™ä¸€æ­¥å°±åƒæ˜¯åŸºäºè¿‡å»çš„ç»å†æå‰è§„åˆ’ã€‚å¦‚æœç»å†ç»“æŸäº†ä¸€æ®µæ—…ç¨‹ï¼ˆä¸€ä¸ªå›åˆï¼‰ï¼Œç›®æ ‡å°±æ˜¯æ‰€è·å¾—çš„å¥–åŠ±ã€‚å¦‚æœç»§ç»­ä¸‹å»ï¼Œç›®æ ‡å°±åŒ…æ‹¬äº†é¢„æœŸçš„æœªæ¥å¥–åŠ±ï¼Œç±»ä¼¼äºä½ è€ƒè™‘å³æ—¶å’Œæœªæ¥åˆ©ç›Šæ¥è§„åˆ’è¡ŒåŠ¨çš„æ–¹å¼ã€‚</p>
<ul>
<li>æŸå¤±è®¡ç®—:<br>æ¥ä¸‹æ¥ï¼ŒæŸå¤±è¢«è®¡ç®—ä¸ºä¸»ç½‘ç»œé¢„æµ‹çš„ Q å€¼ Q(s_i, a_i; Î¸)ä¸ç›®æ ‡ Q å€¼ y_i ä¹‹é—´çš„å‡æ–¹è¯¯å·®ï¼š</li>
</ul>
<p><img src="/../asset_deepq/07.png" alt="æŸå¤±å…¬å¼"></p>
<p>è®¡ç®—æŸå¤±å°±åƒè¯„ä¼°ä½ çš„é¢„æµ‹ä¸å®é™…å‘ç”Ÿæƒ…å†µä¹‹é—´çš„å·®è·ã€‚å°±åƒæ£€æŸ¥ä½ çš„çŒœæµ‹ä¸å®é™…ç»“æœç›¸æ¯”æœ‰å¤šå‡†ç¡®ï¼Œå¹¶æ³¨æ„å…¶ä¸­çš„å·®å¼‚ã€‚</p>
<ul>
<li>åå‘ä¼ æ’­å’Œä¼˜åŒ–:<br>æœ€åï¼Œæ‰§è¡Œåå‘ä¼ æ’­ä»¥æœ€å°åŒ–è¿™ç§æŸå¤±ã€‚è®¡ç®—å¾—åˆ°çš„æŸå¤±é€šè¿‡ç½‘ç»œè¿›è¡Œåå‘ä¼ æ’­ï¼Œä½¿ç”¨ä¼˜åŒ–ç®—æ³•ï¼ˆå¦‚éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰æˆ– Adamï¼‰æ¥æ›´æ–°æƒé‡ã€‚è¿™ä¸ªè¿‡ç¨‹è°ƒæ•´ç½‘ç»œå‚æ•°Î¸ ä»¥æœ€å°åŒ–æŸå¤±ï¼š</li>
</ul>
<p><img src="/../asset_deepq/08.png" alt="åå‘ä¼ æ’­å…¬å¼ "></p>
<p>è¿™é‡Œï¼ŒÎ±æ˜¯å­¦ä¹ ç‡ï¼Œâˆ‡Î¸â€‹Loss ä»£è¡¨æŸå¤±å¯¹ç½‘ç»œå‚æ•°çš„æ¢¯åº¦ã€‚åå‘ä¼ æ’­å°±åƒä»é”™è¯¯ä¸­å­¦ä¹ ä¸€æ ·ã€‚å½“ä½ æ„è¯†åˆ°ä½ çš„é¢„æµ‹æœ‰å¤šä¹ˆåç¦»ï¼ˆæŸå¤±ï¼‰æ—¶ï¼Œä½ ä¼šè°ƒæ•´ä½ çš„ç­–ç•¥ï¼ˆç½‘ç»œæƒé‡ï¼‰æ¥æ”¹å–„ä½ æœªæ¥çš„å†³ç­–ã€‚è¿™å°±åƒæ ¹æ®åé¦ˆæ¥å¾®è°ƒä½ çš„æ–¹æ³•ï¼Œä»¥ä¾¿ä¸‹æ¬¡è·å¾—æ›´å¥½çš„ç»“æœã€‚</p>
<p>ä½¿ç”¨è¿™ç§æ¶æ„ï¼Œä»£ç†ç¨‹åºä¼šè¿­ä»£åœ°æ”¹è¿›å…¶ç­–ç•¥ã€‚å®ƒå­¦ä¼šé‡‡å–è¡ŒåŠ¨ï¼Œä»¥æœ€å¤§åŒ–éšæ—¶é—´ç´¯ç§¯çš„å¥–åŠ±ã€‚ç¥ç»ç½‘ç»œã€ç»å†é‡æ”¾å’Œç›®æ ‡ç½‘ç»œçš„ç»“åˆä½¿å¾— DQN èƒ½å¤Ÿåœ¨å¤æ‚çš„é«˜ç»´ç¯å¢ƒä¸­æœ‰æ•ˆå­¦ä¹ ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæŒç»­ä¸‹å»ï¼Œç›´åˆ°ä»£ç†ç¨‹åºèƒ½å¤Ÿç†Ÿç»ƒåœ°åœ¨å…¶ç¯å¢ƒä¸­å¯¼èˆªã€‚</p>
<h2 id="ä»å¤´å¼€å§‹å®ç°æ·±åº¦-Q-ç½‘ç»œ"><a href="#ä»å¤´å¼€å§‹å®ç°æ·±åº¦-Q-ç½‘ç»œ" class="headerlink" title="ä»å¤´å¼€å§‹å®ç°æ·±åº¦ Q ç½‘ç»œ"></a>ä»å¤´å¼€å§‹å®ç°æ·±åº¦ Q ç½‘ç»œ</h2><p>æˆ‘ä»¬ä»0å¼€å§‹å®ç°ä¸€ä¸ªæ·±åº¦ Q ç½‘ç»œï¼ˆDQNï¼‰ã€‚è¿™æ ·å¯ä»¥æ¸…æ¥šåœ°äº†è§£å¦‚ä½•åœ¨ Python ä¸­æ„å»ºå’Œè®­ç»ƒä¸€ä¸ª DQNã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ OpenAI Gym çš„LunarLander ç¯å¢ƒã€‚åœ¨è¿™ä¸ªç¯å¢ƒä¸­ï¼Œç›®æ ‡æ˜¯æ§åˆ¶æœˆçƒç€é™†å™¨å¹¶æˆåŠŸé™è½åœ¨æŒ‡å®šçš„ç€é™†å«ä¸Šã€‚ç€é™†å™¨å¿…é¡»é€šè¿‡ç¯å¢ƒï¼Œä½¿ç”¨æ¨è¿›å™¨æ¥æ§åˆ¶å…¶è¿åŠ¨å’Œæ–¹å‘ã€‚</p>
<h3 id="è®¾ç½®ç¯å¢ƒ"><a href="#è®¾ç½®ç¯å¢ƒ" class="headerlink" title="è®¾ç½®ç¯å¢ƒ"></a>è®¾ç½®ç¯å¢ƒ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gymnasium             0.29.1</span><br><span class="line">matplotlib            3.8.4</span><br><span class="line">numpy                 1.26.4</span><br><span class="line">optuna                3.6.1</span><br><span class="line">torch                 2.1.0+cu121</span><br><span class="line">torchaudio            2.1.0+cu121</span><br><span class="line">torchvision           0.16.0+cu121</span><br><span class="line">swig                  4.2.1</span><br><span class="line">moviepy               1.0.3</span><br></pre></td></tr></table></figure>
<p>å®‰è£…box2Dï¼š  pip install gymnasium[box2d]</p>
<p>åœ¨win10ç³»ç»Ÿä¼šå®‰è£…å¤±è´¥ï¼Œæ˜¾ç¤ºlogå¦‚ä¸‹ã€‚å®‰è£…å¾®è½¯å·¥å…·ï¼Œç„¶åç»§ç»­å®‰è£…box2d ã€‚</p>
<pre><code>Failed to build box2d-py
ERROR: Could not build wheels for box2d-py, which is required to install pyproject.toml-based projects
</code></pre>
<p>ç™»å½•è¯¥ç½‘ç«™<a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/zh-hans/visual-cpp-build-tools/">build-tools</a> ï¼Œç‚¹å‡»ä¸‹è½½ç”Ÿæˆå·¥å…·. å‹¾é€‰ä½¿ç”¨C++çš„æ¡Œé¢å¼€å‘ï¼Œç‚¹å‡»å®‰è£….</p>
<p><img src="/../asset_deepq/11.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">from</span> gymnasium.wrappers.monitoring.video_recorder <span class="keyword">import</span> VideoRecorder</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> optuna</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯¼å…¥å¿…è¦çš„åº“ã€‚ gymç”¨äºç¯å¢ƒï¼Œtorchç”¨äºæ„å»ºå’Œè®­ç»ƒæˆ‘ä»¬çš„ç¥ç»ç½‘ç»œï¼Œcollectionså’Œ randomã€optuna ç”¨äºç»å†é‡æ”¾å’Œè¶…å‚æ•°ä¼˜åŒ–ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">env = gym.make(<span class="string">&#x27;LunarLander-v2&#x27;</span>, render_mode=<span class="string">&quot;rgb_array&quot;</span>)</span><br><span class="line">state_dim = env.observation_space.shape[<span class="number">0</span>]</span><br><span class="line">action_dim = env.action_space.n</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åˆå§‹åŒ– LunarLander ç¯å¢ƒå¹¶è·å–çŠ¶æ€å’ŒåŠ¨ä½œç©ºé—´çš„ç»´åº¦ã€‚state_dimè¡¨ç¤ºçŠ¶æ€ä¸­çš„ç‰¹å¾æ•°é‡ï¼Œaction_dimè¡¨ç¤ºå¯èƒ½åŠ¨ä½œçš„æ•°é‡ã€‚</p>
<h3 id="æ„å»ºæ·±åº¦ç¥ç»ç½‘ç»œ"><a href="#æ„å»ºæ·±åº¦ç¥ç»ç½‘ç»œ" class="headerlink" title="æ„å»ºæ·±åº¦ç¥ç»ç½‘ç»œ"></a>æ„å»ºæ·±åº¦ç¥ç»ç½‘ç»œ</h3><p>å¯¹äºæˆ‘ä»¬çš„æ·±åº¦ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸ºDQNçš„ç±»ã€‚è¿™ä¸ªç±»å®šä¹‰äº†ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå…¨è¿æ¥å±‚çš„ç¥ç»ç½‘ç»œã€‚è¾“å…¥å±‚æ¥æ”¶çŠ¶æ€è¡¨ç¤ºï¼Œéšè—å±‚é€šè¿‡çº¿æ€§å˜æ¢å’Œ ReLU æ¿€æ´»å‡½æ•°å¤„ç†è¿™äº›ä¿¡æ¯ï¼Œè¾“å‡ºå±‚ä¸ºæ¯ä¸ªå¯èƒ½çš„åŠ¨ä½œäº§ç”Ÿ Q å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DQN</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, state_dim, action_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>(DQN, self).__init__()</span><br><span class="line">        self.fc1 = nn.Linear(state_dim, <span class="number">128</span>)</span><br><span class="line">        self.fc2 = nn.Linear(<span class="number">128</span>, <span class="number">128</span>)</span><br><span class="line">        self.fc3 = nn.Linear(<span class="number">128</span>, action_dim)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = torch.relu(self.fc1(x))</span><br><span class="line">        x = torch.relu(self.fc2(x))</span><br><span class="line">        <span class="keyword">return</span> self.fc3(x)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåä¸ºDQNçš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª nn.Moduleï¼Œè¿™æ˜¯ PyTorch ä¸­æ‰€æœ‰ç¥ç»ç½‘ç»œæ¨¡å—çš„åŸºç±»ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨ PyTorch çš„å†…ç½®å‡½æ•°å’Œç‰¹æ€§æ¥æ„å»ºç¥ç»ç½‘ç»œã€‚</p>
<h4 id="ç±»åˆå§‹åŒ–"><a href="#ç±»åˆå§‹åŒ–" class="headerlink" title="ç±»åˆå§‹åŒ–"></a>ç±»åˆå§‹åŒ–</h4><p>__init__æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–å¯¹è±¡çš„å±æ€§ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ï¼Œå®ƒè®¾ç½®äº†ç¥ç»ç½‘ç»œçš„æ¯ä¸€å±‚ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªå…¨è¿æ¥ï¼ˆçº¿æ€§ï¼‰å±‚ï¼š</p>
<ul>
<li>self.fc1 &#x3D; nn.Linear(state_dim, 128) ï¼šç¬¬ä¸€å±‚æ¥å—è¾“å…¥çŠ¶æ€ç»´åº¦ï¼ˆçŠ¶æ€ä¸­çš„ç‰¹å¾æ•°é‡ï¼‰å¹¶å°†å…¶æ˜ å°„åˆ° 128 ä¸ªç¥ç»å…ƒã€‚</li>
<li>self.fc2 &#x3D; nn.Linear(128, 128): ç¬¬äºŒå±‚å°†æ¥è‡ªç¬¬ä¸€å±‚çš„ 128 ä¸ªç¥ç»å…ƒæ˜ å°„åˆ°å¦å¤– 128 ä¸ªç¥ç»å…ƒã€‚</li>
<li>self.fc3 &#x3D; nn.Linear(128, action_dim): ç¬¬ä¸‰å±‚å°†æ¥è‡ªç¬¬äºŒå±‚çš„ 128 ä¸ªç¥ç»å…ƒæ˜ å°„åˆ°åŠ¨ä½œç»´åº¦ï¼ˆå¯èƒ½åŠ¨ä½œæ•°é‡ï¼‰ã€‚</li>
</ul>
<p>æ¯ä¸€å±‚nn.Linearå¯¹è¾“å…¥æ•°æ®æ‰§è¡Œçº¿æ€§å˜æ¢ï¼š</p>
<p><img src="/../asset_deepq/09.png" alt="çº¿æ€§å˜æ¢"></p>
<p>å…¶ä¸­ x æ˜¯è¾“å…¥ï¼ŒW æ˜¯æƒé‡çŸ©é˜µï¼Œb æ˜¯åç½®å‘é‡ã€‚</p>
<h4 id="forwardæ–¹æ³•"><a href="#forwardæ–¹æ³•" class="headerlink" title="forwardæ–¹æ³•"></a>forwardæ–¹æ³•</h4><p>forwardæ–¹æ³•å®šä¹‰äº†æ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸­æµåŠ¨ã€‚å½“æ‚¨é€šè¿‡ç½‘ç»œä¼ é€’æ•°æ®æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚</p>
<p>åœ¨ç¬¬ä¸€å±‚ä¸­ï¼Œè¾“å…¥æ•°æ®xé€šè¿‡ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚self.fc1ä¼ é€’ã€‚ç„¶åä½¿ç”¨ ReLUï¼ˆä¿®æ­£çº¿æ€§å•å…ƒï¼‰æ¿€æ´»å‡½æ•°è¿›è¡Œè½¬æ¢ã€‚</p>
<p>ReLU æ¿€æ´»å‡½æ•°å®šä¹‰ä¸ºï¼š</p>
<p><img src="/../asset_deepq/10.png" alt="ReLU æ¿€æ´»å‡½æ•°å…¬å¼"></p>
<p>å®ƒå°†éçº¿æ€§å¼•å…¥æ¨¡å‹ä¸­ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ æ›´å¤æ‚çš„å‡½æ•°ã€‚</p>
<p>åœ¨ç¬¬äºŒå±‚ä¸­ï¼Œæ¥è‡ªç¬¬ä¸€å±‚çš„è¾“å‡ºé€šè¿‡ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ï¼ˆself.fc2ï¼‰ä¼ é€’ï¼Œå¹¶å†æ¬¡ä½¿ç”¨ ReLU æ¿€æ´»å‡½æ•°è¿›è¡Œè½¬æ¢.</p>
<p>æœ€åï¼Œåœ¨è¾“å‡ºå±‚ï¼Œç¬¬äºŒå±‚çš„è¾“å‡ºé€šè¿‡ç¬¬ä¸‰ä¸ªå…¨è¿æ¥å±‚ï¼ˆself.fc3ï¼‰ä¼ é€’ï¼Œæ²¡æœ‰æ¿€æ´»å‡½æ•°. è¯¥å±‚ä¸ºæ¯ä¸ªåŠ¨ä½œç”Ÿæˆæœ€ç»ˆçš„ Q å€¼ã€‚æ¯ä¸ªå€¼ä»£è¡¨åœ¨ç»™å®šçŠ¶æ€ä¸‹é‡‡å–è¯¥åŠ¨ä½œçš„é¢„æœŸæœªæ¥å¥–åŠ±ã€‚</p>
<h3 id="å®ç°ç»å†å›æ”¾"><a href="#å®ç°ç»å†å›æ”¾" class="headerlink" title="å®ç°ç»å†å›æ”¾"></a>å®ç°ç»å†å›æ”¾</h3><p>è¯¥ReplayBufferç±»æä¾›äº†ä¸€ç§å­˜å‚¨å’Œé‡‡æ ·ç»å†çš„æœºåˆ¶ï¼Œè¿™å¯¹äºç¨³å®šå’Œæ”¹è¿› DQNs ä¸­çš„å­¦ä¹ è¿‡ç¨‹è‡³å…³é‡è¦ã€‚å› æ­¤ï¼Œå®ƒä½¿ä»£ç†èƒ½å¤Ÿä»å„ç§è¿‡å»ç»å†ä¸­å­¦ä¹ ï¼Œå¢å¼ºå…¶æ³›åŒ–èƒ½åŠ›ï¼Œå¹¶åœ¨å¤æ‚ç¯å¢ƒä¸­è¡¨ç°è‰¯å¥½ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ReplayBuffer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, capacity</span>):</span><br><span class="line">        self.buffer = deque(maxlen=capacity)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, state, action, reward, next_state, done</span>):</span><br><span class="line">        self.buffer.append((state, action, reward, next_state, done))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sample</span>(<span class="params">self, batch_size</span>):</span><br><span class="line">        state, action, reward, next_state, done = <span class="built_in">zip</span>(*random.sample(self.buffer, batch_size))</span><br><span class="line">        <span class="keyword">return</span> state, action, reward, next_state, done</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.buffer)</span><br></pre></td></tr></table></figure>

<h4 id="ç±»åˆå§‹åŒ–-1"><a href="#ç±»åˆå§‹åŒ–-1" class="headerlink" title="ç±»åˆå§‹åŒ–"></a>ç±»åˆå§‹åŒ–</h4><p>__init__æ–¹æ³•ä½¿ç”¨å›ºå®šå®¹é‡åˆå§‹åŒ–åŒç«¯é˜Ÿåˆ—ã€‚åŒç«¯é˜Ÿåˆ—å…è®¸æ‚¨é«˜æ•ˆåœ°ä»ä¸¤ç«¯æ·»åŠ å’Œå¼¹å‡ºæ•°æ®ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºå®ç°éœ€è¦å¿«é€Ÿä»ä¸¤ç«¯æ·»åŠ å’Œå¼¹å‡ºæ•°æ®çš„é˜Ÿåˆ—å’Œæ ˆã€‚<br>self.buffer &#x3D; deque(maxlen&#x3D;capacity) å®é™…ä¸Šåˆ›å»ºäº†ä¸€ä¸ª dequeï¼Œå¯ä»¥å®¹çº³capacityä¸ªçš„ç»å†ã€‚å½“ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œæ·»åŠ æ–°ç»å†å°†è‡ªåŠ¨åˆ é™¤æœ€æ—§çš„ç»å†ã€‚</p>
<h4 id="pushæ–¹æ³•"><a href="#pushæ–¹æ³•" class="headerlink" title="pushæ–¹æ³•"></a>pushæ–¹æ³•</h4><p>è¯¥push æ–¹æ³•å‘ç¼“å†²åŒºæ·»åŠ æ–°ç»å†ã€‚æ¯ä¸ªç»å†éƒ½æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…æ‹¬stateï¼Œactionï¼Œrewardï¼Œnext_stateå’Œdoneï¼š</p>
<ul>
<li>state ï¼šå½“å‰çŠ¶æ€ã€‚</li>
<li>action ï¼šä»£ç†äººé‡‡å–çš„è¡ŒåŠ¨ã€‚</li>
<li>reward ï¼šæ‰§è¡ŒåŠ¨ä½œåè·å¾—çš„å¥–åŠ±ã€‚</li>
<li>next_state ï¼šä»£ç†é‡‡å–è¡ŒåŠ¨åå¾—åˆ°çš„çŠ¶æ€ã€‚</li>
<li>done ï¼šä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºè¯¥åœºæ™¯æ˜¯å¦å·²ç»“æŸã€‚</li>
</ul>
<h4 id="é‡‡æ ·æ–¹æ³•"><a href="#é‡‡æ ·æ–¹æ³•" class="headerlink" title="é‡‡æ ·æ–¹æ³•"></a>é‡‡æ ·æ–¹æ³•</h4><p>è¯¥sampleæ–¹æ³•ä»ç¼“å†²åŒºä¸­éšæœºé‡‡æ ·ä¸€æ‰¹ç»å†ã€‚<br>random.sample(self.buffer, batch_size) ä»ç¼“å†²åŒºä¸­éšæœºé€‰æ‹©batch_size ç»å†ã€‚ </p>
<p>zip(*random.sample(self.buffer, batch_size)) å°†ç»å†åˆ—è¡¨è§£å‹æˆå•ç‹¬çš„å…ƒç»„ï¼Œèµ‹å€¼äºstateï¼Œ actionï¼Œ rewardï¼Œ next_stateï¼Œ done</p>
<p>è¯¥æ–¹æ³•è¿”å›è¿™äº›å…ƒç»„ã€‚</p>
<h4 id="lengthæ–¹æ³•"><a href="#lengthæ–¹æ³•" class="headerlink" title="lengthæ–¹æ³•"></a>lengthæ–¹æ³•</h4><p>__len__æ–¹æ³•è¿”å›ç¼“å†²åŒºä¸­å­˜å‚¨çš„å½“å‰ç»å†æ•°é‡ã€‚ </p>
<h3 id="å®ç°ç›®æ ‡ç½‘ç»œ"><a href="#å®ç°ç›®æ ‡ç½‘ç»œ" class="headerlink" title="å®ç°ç›®æ ‡ç½‘ç»œ"></a>å®ç°ç›®æ ‡ç½‘ç»œ</h3><p>ç›®æ ‡ç½‘ç»œï¼Œæˆ‘ä»¬ä¸ºè®­ç»ƒæä¾›äº†ä¸€ç»„ç¨³å®šçš„ Q å€¼ï¼Œè¿™æœ‰åŠ©äºç¨³å®šå­¦ä¹ è¿‡ç¨‹å¹¶æé«˜ä»£ç†åœ¨å¤æ‚ç¯å¢ƒä¸­çš„æ€§èƒ½ã€‚ç›®æ ‡ç½‘ç»œæ›´æ–°é¢‘ç‡ä½äºä¸»ç½‘ç»œï¼Œç¡®ä¿ç”¨äºæ›´æ–°ä¸»ç½‘ç»œæƒé‡çš„ Q å€¼ä¼°è®¡æ›´åŠ ç¨³å®šã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨ä¸€ä¸ªåä¸ºDQNTrainerçš„ç±»ä¸­å®ç°ç›®æ ‡ç½‘ç»œï¼Œè¯¥ç±»ç®¡ç† DQN çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ä¸»ç½‘ç»œã€ç›®æ ‡ç½‘ç»œã€ä¼˜åŒ–å™¨å’Œé‡æ”¾ç¼“å†²åŒºã€‚ </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DQNTrainer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, env, main_network, target_network, optimizer, replay_buffer, model_path=<span class="string">&#x27;model/model.pth&#x27;</span>, gamma=<span class="number">0.99</span>, batch_size=<span class="number">64</span>, target_update_frequency=<span class="number">1000</span></span>):</span><br><span class="line">        self.env = env</span><br><span class="line">        self.main_network = main_network</span><br><span class="line">        self.target_network = target_network</span><br><span class="line">        self.optimizer = optimizer</span><br><span class="line">        self.replay_buffer = replay_buffer</span><br><span class="line">        self.model_path = model_path</span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.target_update_frequency = target_update_frequency</span><br><span class="line">        self.step_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Load the model if it exists</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(os.path.dirname(self.model_path)):</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(self.model_path):</span><br><span class="line">                self.main_network.load_state_dict(torch.load(self.model_path))</span><br><span class="line">                self.target_network.load_state_dict(torch.load(self.model_path))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Loaded model from disk&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            os.makedirs(os.path.dirname(self.model_path))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">train</span>(<span class="params">self, num_episodes, save_model=SAVE_MODEL, save_video=SAVE_VIDEO</span>):</span><br><span class="line">        total_rewards = []</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create a VideoWriter to save the rendering</span></span><br><span class="line">        <span class="keyword">if</span> save_video:</span><br><span class="line">            videoPath = os.path.join(os.path.expanduser(<span class="string">&#x27;~&#x27;</span>), <span class="string">&#x27;deepq/training.mp4&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(videoPath):</span><br><span class="line">                os.remove(videoPath)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.dirname(videoPath)):</span><br><span class="line">                    os.makedirs(os.path.dirname(videoPath))</span><br><span class="line">            self.video = VideoRecorder(env, videoPath, enabled=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> episode <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">            state, _ = self.env.reset()  <span class="comment"># Extract the state from the returned tuple</span></span><br><span class="line">            done = <span class="literal">False</span></span><br><span class="line">            total_reward = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">                self.env.render()  <span class="comment"># Add this line to render the environment</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> save_video:</span><br><span class="line">                    self.video.capture_frame()</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Ensure the state is in the correct shape by adding an extra dimension</span></span><br><span class="line">                action = self.main_network(torch.FloatTensor(state).unsqueeze(<span class="number">0</span>)).argmax(dim=<span class="number">1</span>).item()</span><br><span class="line">                next_state, reward, done, _, _ = self.env.step(action)  <span class="comment"># Extract the next_state from the returned tuple</span></span><br><span class="line">                self.replay_buffer.push(state, action, reward, next_state, done)</span><br><span class="line">                state = next_state</span><br><span class="line">                total_reward += reward</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(self.replay_buffer) &gt;= self.batch_size:</span><br><span class="line">                    self.update_network()</span><br><span class="line"></span><br><span class="line">            total_rewards.append(total_reward)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Episode <span class="subst">&#123;episode&#125;</span>, Total Reward: <span class="subst">&#123;total_reward&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Save the model after training</span></span><br><span class="line">        <span class="keyword">if</span> save_model:</span><br><span class="line">            torch.save(self.main_network.state_dict(), self.model_path)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Saved model to disk&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> save_video:</span><br><span class="line">            self.video.close()</span><br><span class="line"></span><br><span class="line">        self.env.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(total_rewards) / <span class="built_in">len</span>(total_rewards)  <span class="comment"># Return average reward</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_network</span>(<span class="params">self</span>):</span><br><span class="line">        state_batch, action_batch, reward_batch, next_state_batch, done_batch = self.replay_buffer.sample(self.batch_size)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Convert to tensors</span></span><br><span class="line">        state_batch = torch.FloatTensor(state_batch)</span><br><span class="line">        action_batch = torch.LongTensor(action_batch)</span><br><span class="line">        reward_batch = torch.FloatTensor(reward_batch)</span><br><span class="line">        next_state_batch = torch.FloatTensor(next_state_batch)</span><br><span class="line">        done_batch = torch.FloatTensor(done_batch)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Calculate the current Q-values</span></span><br><span class="line">        q_values = self.main_network(state_batch).gather(<span class="number">1</span>, action_batch.unsqueeze(<span class="number">1</span>)).squeeze(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Calculate the target Q-values</span></span><br><span class="line">        next_q_values = self.target_network(next_state_batch).<span class="built_in">max</span>(<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">        expected_q_values = reward_batch + self.gamma * next_q_values * (<span class="number">1</span> - done_batch)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Compute the loss</span></span><br><span class="line">        loss = nn.MSELoss()(q_values, expected_q_values.detach())</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Optimize the model</span></span><br><span class="line">        self.optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        self.optimizer.step()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Periodically update the target network</span></span><br><span class="line">        <span class="keyword">if</span> self.step_count % self.target_update_frequency == <span class="number">0</span>:</span><br><span class="line">            self.target_network.load_state_dict(self.main_network.state_dict())</span><br><span class="line"></span><br><span class="line">        self.step_count += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="ç±»å®šä¹‰"><a href="#ç±»å®šä¹‰" class="headerlink" title="ç±»å®šä¹‰"></a>ç±»å®šä¹‰</h4><p>__init__æ–¹æ³•åˆå§‹åŒ–äº†è®­ç»ƒæ‰€éœ€çš„å„ç§ç»„ä»¶ï¼š </p>
<ul>
<li>env ï¼šä»£ç†ç¨‹åºè¿è¡Œçš„ç¯å¢ƒã€‚</li>
<li>main_network ï¼šæ­£åœ¨è®­ç»ƒçš„ä¸»è¦ç¥ç»ç½‘ç»œã€‚</li>
<li>target_network ï¼šç”¨äºç¨³å®š Q å€¼ä¼°è®¡çš„ç›®æ ‡ç¥ç»ç½‘ç»œã€‚</li>
<li>optimizer ï¼šç”¨äºæ›´æ–°ä¸»ç½‘ç»œæƒé‡çš„ä¼˜åŒ–å™¨ã€‚</li>
<li>replay_buffer ï¼šç”¨äºå­˜å‚¨å’Œé‡‡æ ·ç»å†çš„ç¼“å†²åŒºã€‚</li>
<li>model_path ï¼šä¿å­˜&#x2F;åŠ è½½è®­ç»ƒæ¨¡å‹çš„è·¯å¾„ã€‚</li>
<li>gamma ï¼šæœªæ¥å¥–åŠ±çš„æŠ˜ç°å› å­ã€‚</li>
<li>batch_size ï¼šæ¯ä¸ªè®­ç»ƒæ­¥éª¤ä»replayç¼“å†²åŒºä¸­é‡‡æ ·çš„ç»å†æ•°é‡ã€‚</li>
<li>target_update_frequency ï¼šåŒ¹é…ä¸»ç½‘ç»œæƒé‡çš„ç›®æ ‡ç½‘ç»œæƒé‡æ›´æ–°é¢‘ç‡</li>
<li>step_count ï¼šä¸€ä¸ªç”¨äºè·Ÿè¸ªè®­ç»ƒè¿‡ç¨‹ä¸­æ­¥éª¤æ•°é‡çš„è®¡æ•°å™¨ã€‚</li>
</ul>
<h4 id="æ¨¡å‹åŠ è½½"><a href="#æ¨¡å‹åŠ è½½" class="headerlink" title="æ¨¡å‹åŠ è½½"></a>æ¨¡å‹åŠ è½½</h4><p>æˆ‘ä»¬ç”¨ os.path.exists(os.path.dirname(self.model_path)) æ£€æŸ¥æ¨¡å‹è·¯å¾„çš„ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨å·²ä¿å­˜çš„æ¨¡å‹ï¼Œåˆ™åŠ è½½è¯¥æ¨¡å‹ä»¥ç»§ç»­è®­ç»ƒï¼Œä»ç¦»å¼€çš„åœ°æ–¹ç»§ç»­ ã€‚</p>
<p>torch.load ä½¿ç”¨ load_state_dict å°†ä¿å­˜çš„æ¨¡å‹æƒé‡åŠ è½½åˆ°ä¸»ç½‘ç»œå’Œç›®æ ‡ç½‘ç»œä¸­ã€‚å¦‚æœæ¨¡å‹ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ os.makedirs åˆ›å»ºå®ƒã€‚</p>
<h3 id="è®­ç»ƒæ·±åº¦-Q-ç½‘ç»œ"><a href="#è®­ç»ƒæ·±åº¦-Q-ç½‘ç»œ" class="headerlink" title="è®­ç»ƒæ·±åº¦ Q ç½‘ç»œ"></a>è®­ç»ƒæ·±åº¦ Q ç½‘ç»œ</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ç°è®­ç»ƒå¾ªç¯æ¥è®­ç»ƒæˆ‘ä»¬çš„ DQNã€‚è¿™ä¸ªDQNTraineræ–¹æ³•å‘ç”Ÿåœ¨å†…éƒ¨ã€‚å®ƒè¿è¡Œ DQN çš„è®­ç»ƒå¾ªç¯ï¼Œä»£ç†ä¸ç¯å¢ƒäº¤äº’ï¼Œæ”¶é›†ç»éªŒï¼Œæ›´æ–°ç½‘ç»œï¼Œå¹¶è·Ÿè¸ªæ€§èƒ½ã€‚<br>trainæ–¹æ³•è¿è¡ŒæŒ‡å®šå›åˆæ•°é‡çš„è®­ç»ƒå¾ªç¯ã€‚è¿™ä¸ªå¾ªç¯å¯¹äºä»£ç†è·å–ç»éªŒå¹¶æé«˜å…¶å†³ç­–èƒ½åŠ›è‡³å…³é‡è¦ã€‚</p>
<p>é¦–å…ˆå°†total_rewards åˆå§‹åŒ–ä¸ºç©ºåˆ—è¡¨ã€‚ åœ¨æ¯ä¸ªå›åˆå¼€å§‹æ—¶ï¼Œç¯å¢ƒä¼šè¢«é‡ç½®åˆ°åˆå§‹çŠ¶æ€ã€‚ ä»£ç†æ ¹æ®å½“å‰çŠ¶æ€ä½¿ç”¨ä¸»ç½‘ç»œé€‰æ‹©åŠ¨ä½œã€‚</p>
<p>torch.FloatTensor(state).unsqueeze(0) å°†çŠ¶æ€è½¬æ¢ä¸º PyTorch å¼ é‡ï¼Œå¹¶æ·»åŠ é¢å¤–çš„ç»´åº¦ä»¥åŒ¹é…ç½‘ç»œçš„é¢„æœŸè¾“å…¥å½¢çŠ¶ã€‚</p>
<p>self.main_network(â€¦).argmax(dim&#x3D;1).item() é€‰æ‹©ç”±ä¸»ç½‘ç»œé¢„æµ‹çš„å…·æœ‰æœ€é«˜ Q å€¼çš„åŠ¨ä½œã€‚</p>
<p>ä»£ç†ç¨‹åºæ‰§è¡Œæ‰€é€‰åŠ¨ä½œï¼Œè§‚å¯Ÿå¥–åŠ±å’Œä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶å°†ç»å†å­˜å‚¨åœ¨é‡æ”¾ç¼“å†²åŒºä¸­ã€‚</p>
<p>self.env.step(action) æ‰§è¡ŒåŠ¨ä½œå¹¶è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€ã€å¥–åŠ±ä»¥åŠè¯¥æƒ…èŠ‚æ˜¯å¦å·²ç»“æŸã€‚</p>
<p>self.replay_buffer.push(â€¦) å°†ç»å†å­˜å‚¨åœ¨é‡æ”¾ç¼“å†²åŒºä¸­ã€‚</p>
<p>state &#x3D; next_state å°†å½“å‰çŠ¶æ€æ›´æ–°ä¸ºä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚</p>
<p>total_reward +&#x3D; reward ç´¯ç§¯å½“å‰å›åˆçš„å¥–åŠ±ã€‚</p>
<p>å¦‚æœé‡æ”¾ç¼“å†²åŒºæœ‰è¶³å¤Ÿçš„ç»å†ï¼Œç½‘ç»œå°±ä¼šè¢«æ›´æ–°ã€‚</p>
<p>if len(self.replay_buffer) &gt;&#x3D; self.batch_size æ£€æŸ¥å›æ”¾ç¼“å†²åŒºæ˜¯å¦è‡³å°‘æœ‰batch_sizeç»éªŒã€‚ </p>
<p>self.update_network() ä½¿ç”¨æ¥è‡ªé‡æ”¾ç¼“å†²åŒºçš„ä¸€æ‰¹ç»å†æ›´æ–°ç½‘ç»œã€‚</p>
<p>æ¯ä¸ªå›åˆç»“æŸæ—¶è®°å½•å¹¶æ‰“å°æ€»å¥–åŠ±ã€‚</p>
<p>total_rewards.append(total_reward) å°†å½“å‰å›åˆçš„æ€»å¥–åŠ±æ·»åŠ åˆ°æ€»å¥–åŠ±åˆ—è¡¨ä¸­ã€‚</p>
<p>è®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹è¢«ä¿å­˜åˆ°ç£ç›˜ã€‚</p>
<p>torch.save(self.main_network.state_dict(), self.model_path) å°†ä¸»ç½‘ç»œçš„çŠ¶æ€å­—å…¸ä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>æœ€åï¼Œè¯¥æ–¹æ³•å…³é—­ç¯å¢ƒå¹¶è¿”å›æ‰€æœ‰å‰§é›†çš„å¹³å‡å¥–åŠ±ã€‚</p>
<p>return sum(total_rewards) &#x2F; len(total_rewards) è®¡ç®—å¹¶è¿”å›å¹³å‡å¥–åŠ±ã€‚</p>
<h3 id="è°ƒæ•´æ¨¡å‹"><a href="#è°ƒæ•´æ¨¡å‹" class="headerlink" title="è°ƒæ•´æ¨¡å‹"></a>è°ƒæ•´æ¨¡å‹</h3><p>æœ€åï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•è¯„ä¼°å’Œè°ƒæ•´è®­ç»ƒæ¨¡å‹ã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªOptimizerç±»ï¼Œè´Ÿè´£ä¼˜åŒ–è¶…å‚æ•°ä»¥æé«˜ DQN çš„æ€§èƒ½ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Optimizer</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, env, main_network, target_network, replay_buffer, model_path, params_path=<span class="string">&#x27;params.pkl&#x27;</span></span>):</span><br><span class="line">        self.env = env</span><br><span class="line">        self.main_network = main_network</span><br><span class="line">        self.target_network = target_network</span><br><span class="line">        self.replay_buffer = replay_buffer</span><br><span class="line">        self.model_path = model_path</span><br><span class="line">        self.params_path = params_path</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">objective</span>(<span class="params">self, trial, n_episodes=<span class="number">10</span></span>):</span><br><span class="line">        lr = trial.suggest_loguniform(<span class="string">&#x27;lr&#x27;</span>, <span class="number">1e-5</span>, <span class="number">1e-1</span>)</span><br><span class="line">        gamma = trial.suggest_uniform(<span class="string">&#x27;gamma&#x27;</span>, <span class="number">0.9</span>, <span class="number">0.999</span>)</span><br><span class="line">        batch_size = trial.suggest_categorical(<span class="string">&#x27;batch_size&#x27;</span>, [<span class="number">32</span>, <span class="number">64</span>, <span class="number">128</span>])</span><br><span class="line">        target_update_frequency = trial.suggest_categorical(<span class="string">&#x27;target_update_frequency&#x27;</span>, [<span class="number">500</span>, <span class="number">1000</span>, <span class="number">2000</span>])</span><br><span class="line"></span><br><span class="line">        optimizer = optim.Adam(self.main_network.parameters(), lr=lr)</span><br><span class="line">        trainer = DQNTrainer(self.env, self.main_network, self.target_network, optimizer, self.replay_buffer, self.model_path, gamma=gamma, batch_size=batch_size, target_update_frequency=target_update_frequency)</span><br><span class="line">        reward = trainer.train(n_episodes, save=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> reward</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">optimize</span>(<span class="params">self, n_trials=<span class="number">100</span>, save_params=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> TRAIN <span class="keyword">and</span> os.path.isfile(self.params_path):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(self.params_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                best_params = pickle.load(f)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Loaded parameters from disk&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> FINETUNE:</span><br><span class="line">            best_params = &#123;</span><br><span class="line">                <span class="string">&#x27;lr&#x27;</span>: LEARNING_RATE, </span><br><span class="line">                <span class="string">&#x27;gamma&#x27;</span>: GAMMA, </span><br><span class="line">                <span class="string">&#x27;batch_size&#x27;</span>: BATCH_SIZE, </span><br><span class="line">                <span class="string">&#x27;target_update_frequency&#x27;</span>: TARGET_UPDATE_FREQUENCY</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Using default parameters: <span class="subst">&#123;best_params&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Optimizing hyperparameters&quot;</span>)</span><br><span class="line">            study = optuna.create_study(direction=<span class="string">&#x27;maximize&#x27;</span>)</span><br><span class="line">            study.optimize(self.objective, n_trials=n_trials)</span><br><span class="line">            best_params = study.best_params</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> save_params:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(self.params_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    pickle.dump(best_params, f)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Saved parameters to disk&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> best_params</span><br></pre></td></tr></table></figure>

<h4 id="objectiveæ–¹æ³•å»ºè®®è¶…å‚æ•°çš„å€¼ï¼Œå¹¶ä½¿ç”¨è¿™äº›å€¼è®­ç»ƒæ¨¡å‹"><a href="#objectiveæ–¹æ³•å»ºè®®è¶…å‚æ•°çš„å€¼ï¼Œå¹¶ä½¿ç”¨è¿™äº›å€¼è®­ç»ƒæ¨¡å‹" class="headerlink" title="objectiveæ–¹æ³•å»ºè®®è¶…å‚æ•°çš„å€¼ï¼Œå¹¶ä½¿ç”¨è¿™äº›å€¼è®­ç»ƒæ¨¡å‹"></a>objectiveæ–¹æ³•å»ºè®®è¶…å‚æ•°çš„å€¼ï¼Œå¹¶ä½¿ç”¨è¿™äº›å€¼è®­ç»ƒæ¨¡å‹</h4><ul>
<li>lr &#x3D; trial.suggest_loguniform(â€˜lrâ€™, 1e-5, 1e-1) ï¼šå»ºè®®å­¦ä¹ ç‡åœ¨[1e-5, 1e-1]èŒƒå›´å†…ã€‚</li>
<li>gamma &#x3D; trial.suggest_uniform(â€˜gammaâ€™, 0.9, 0.999) ï¼šå»ºè®®åœ¨èŒƒå›´[0.9, 0.999]å†…é€‰æ‹©æŠ˜æ‰£å› å­ã€‚</li>
<li>batch_size &#x3D; trial.suggest_categorical(â€˜batch_sizeâ€™, [32, 64, 128]) ï¼šå»ºè®®ä»æŒ‡å®šåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæ‰¹æ¬¡å¤§å°ã€‚</li>
<li>target_update_frequency &#x3D; trial.suggest_categorical(â€˜target_update_frequencyâ€™, [500, 1000, 2000]) ï¼šå»ºè®®ä»æŒ‡å®šåˆ—è¡¨ä¸­é€‰æ‹©ç›®æ ‡æ›´æ–°é¢‘ç‡ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨å»ºè®®çš„å­¦ä¹ ç‡è®¾ç½®äº†ä¸€ä¸ª Adam ä¼˜åŒ–å™¨ã€‚Adamï¼ˆè‡ªé€‚åº”çŸ©ä¼°è®¡çš„ç¼©å†™ï¼‰æ˜¯ä¸€ç§å¸¸ç”¨äºè®­ç»ƒç¥ç»ç½‘ç»œçš„ä¼˜åŒ–ç®—æ³•ã€‚</p>
<p>å¯¹äºç¥ç»ç½‘ç»œä¸­çš„æ¯ä¸ªå‚æ•°ï¼ŒAdam è®¡ç®—æŸå¤±å‡½æ•°å¯¹è¯¥å‚æ•°çš„æ¢¯åº¦ã€‚å®ƒè·Ÿè¸ªæ¢¯åº¦çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡å€¼ï¼ˆç¬¬ä¸€æ—¶åˆ»ï¼Œè¡¨ç¤ºä¸º mï¼‰å’Œå¹³æ–¹æ¢¯åº¦ï¼ˆç¬¬äºŒæ—¶åˆ»ï¼Œè¡¨ç¤ºä¸º vï¼‰ã€‚</p>
<p>ä¸ºäº†è€ƒè™‘ç§»åŠ¨å¹³å‡æ•°çš„åˆå§‹åŒ–åå·®ï¼ŒAdam å¯¹ç¬¬ä¸€å’Œç¬¬äºŒæ—¶åˆ»çš„ä¼°è®¡å€¼åº”ç”¨åå·®æ ¡æ­£ã€‚ç„¶åä½¿ç”¨æ ¡æ­£åçš„ç¬¬ä¸€å’Œç¬¬äºŒæ—¶åˆ»æ¥æ›´æ–°å‚æ•°ã€‚æ›´æ–°è§„åˆ™æ—¨åœ¨ç»“åˆå­¦ä¹ ç‡å’Œæ—¶åˆ»ï¼Œä»¥ä¸€ç§è€ƒè™‘æ¢¯åº¦çš„å¤§å°å’Œæ–¹å‘çš„æ–¹å¼è°ƒæ•´å‚æ•°ã€‚</p>
<p>ä½¿ç”¨å»ºè®®çš„è¶…å‚æ•°åˆå§‹åŒ–DQNTrainer å®ä¾‹ã€‚ æœ€åï¼Œä¸ºæ¨¡å‹è®­ç»ƒæŒ‡å®šæ•°é‡çš„å‘¨æœŸï¼Œå¹¶è¿”å›å¹³å‡å¥–åŠ±</p>
<h4 id="Optimizeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿è¡ŒæŒ‡å®šæ¬¡æ•°çš„ä¼˜åŒ–è¿‡ç¨‹"><a href="#Optimizeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿è¡ŒæŒ‡å®šæ¬¡æ•°çš„ä¼˜åŒ–è¿‡ç¨‹" class="headerlink" title="Optimizeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿è¡ŒæŒ‡å®šæ¬¡æ•°çš„ä¼˜åŒ–è¿‡ç¨‹"></a>Optimizeæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿è¡ŒæŒ‡å®šæ¬¡æ•°çš„ä¼˜åŒ–è¿‡ç¨‹</h4><p>æˆ‘ä»¬ä½¿ç”¨ Optunaï¼Œè¿™æ˜¯ä¸€ä¸ª Python åº“ï¼Œå®ƒå°†å¸®åŠ©æˆ‘ä»¬ç³»ç»Ÿåœ°æ¢ç´¢è¶…å‚æ•°ç©ºé—´ï¼Œé«˜æ•ˆåœ°æ‰¾åˆ°æœ€å¤§åŒ–æ¨¡å‹æ€§èƒ½çš„ç»„åˆã€‚</p>
<p>å¦‚æœä¸éœ€è¦è®­ç»ƒ(not TRAIN)å¹¶ä¸”å‚æ•°æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä»ç£ç›˜åŠ è½½å‚æ•°ã€‚</p>
<p>å¦‚æœä¸éœ€è¦å¾®è°ƒï¼ˆnot FINETUNEï¼‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚ </p>
<p>å¦‚æœéœ€è¦è¶…å‚æ•°ä¼˜åŒ–ï¼Œå°†ä½¿ç”¨ Optuna æ¥æ‰¾åˆ°æœ€ä½³å‚æ•°ã€‚</p>
<p>study &#x3D; optuna.create_study(direction&#x3D;â€™maximizeâ€™) åˆ›å»ºä¸€ä¸ª Optuna studyä»¥æœ€å¤§åŒ–objectiveå‡½æ•°ã€‚</p>
<p>study.optimize(self.objective, n_trials&#x3D;n_trials) è¿è¡ŒæŒ‡å®šæ¬¡æ•°çš„ä¼˜åŒ–ã€‚</p>
<p>å¦‚æœsave_paramsæ˜¯Trueï¼Œåˆ™æœ€ä½³å‚æ•°å°†ä¿å­˜åˆ°ç£ç›˜ã€‚</p>
<h3 id="è¿è¡Œæ¨¡å‹"><a href="#è¿è¡Œæ¨¡å‹" class="headerlink" title="è¿è¡Œæ¨¡å‹"></a>è¿è¡Œæ¨¡å‹</h3><h4 id="è®¾ç½®è®­ç»ƒå’Œå¾®è°ƒ"><a href="#è®¾ç½®è®­ç»ƒå’Œå¾®è°ƒ" class="headerlink" title="è®¾ç½®è®­ç»ƒå’Œå¾®è°ƒ"></a>è®¾ç½®è®­ç»ƒå’Œå¾®è°ƒ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">TRAIN = <span class="literal">True</span></span><br><span class="line">FINETUNE = <span class="literal">False</span></span><br><span class="line">SAVE_MODEL = <span class="literal">True</span> <span class="comment"># Save the model after training</span></span><br><span class="line">SAVE_VIDEO = <span class="literal">False</span> <span class="comment"># Save the video of the training process</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Training hyperparameters</span></span><br><span class="line">TRAINING_EPISODES = <span class="number">1000</span> <span class="comment"># valid only if TRAIN is True</span></span><br><span class="line">FINETUNE_TRIALS = <span class="number">100</span> <span class="comment"># valid only if FINETUNE is True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the following hyperparameters if FINETUNE is False</span></span><br><span class="line">GAMMA = <span class="number">0.99</span></span><br><span class="line">BATCH_SIZE = <span class="number">64</span></span><br><span class="line">TARGET_UPDATE_FREQUENCY = <span class="number">1000</span></span><br><span class="line">LEARNING_RATE = <span class="number">1e-3</span></span><br></pre></td></tr></table></figure>

<p>TRAIN &#x3D; True è¡¨ç¤ºæ˜¯å¦è®­ç»ƒæ¨¡å‹ã€‚å¦‚æœè®¾ç½®ä¸ºFalseï¼Œè®­ç»ƒå°†è¢«è·³è¿‡ã€‚ </p>
<p>FINETUNE &#x3D; False è¡¨ç¤ºæ˜¯å¦å¾®è°ƒæ¨¡å‹ã€‚å¦‚æœè®¾ç½®ä¸ºTrueï¼Œå°†ä½¿ç”¨ç°æœ‰å‚æ•°å¹¶è¿›è¡Œå¾®è°ƒã€‚</p>
<p>å¦‚æœFINETUNEæ˜¯Falseï¼Œæˆ‘ä»¬è®¾ç½®ä»¥ä¸‹è¶…å‚æ•°ï¼š </p>
<ul>
<li>GAMMA &#x3D; 0.99 ï¼šæœªæ¥å¥–åŠ±çš„æŠ˜ç°å› å­ã€‚è¿™å†³å®šäº†æœªæ¥å¥–åŠ±ç›¸å¯¹äºå³æ—¶å¥–åŠ±çš„ä»·å€¼æœ‰å¤šå¤§ã€‚</li>
<li>BATCH_SIZE &#x3D; 64 ï¼šæ¯ä¸ªè®­ç»ƒæ­¥éª¤ä»é‡æ’­ç¼“å†²åŒºä¸­é‡‡æ ·çš„ç»å†æ•°é‡ã€‚</li>
<li>TARGET_UPDATE_FREQUENCY &#x3D; 1000 ï¼šåŒ¹é…ä¸»ç½‘ç»œæƒé‡çš„ç›®æ ‡ç½‘ç»œæƒé‡æ›´æ–°çš„é¢‘ç‡ï¼ˆä»¥æ­¥æ•°è®¡ï¼‰ã€‚</li>
<li>LEARNING_RATE &#x3D; 1e-3 ï¼šä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ¨¡å‹åœ¨æ¯æ¬¡æ›´æ–°æ¨¡å‹æƒé‡æ—¶æ ¹æ®ä¼°è®¡è¯¯å·®è¿›è¡Œçš„æ”¹å˜å¤§å°ã€‚</li>
</ul>
<h4 id="åˆå§‹åŒ–ç½‘ç»œå’Œé‡æ”¾ç¼“å†²åŒº"><a href="#åˆå§‹åŒ–ç½‘ç»œå’Œé‡æ”¾ç¼“å†²åŒº" class="headerlink" title="åˆå§‹åŒ–ç½‘ç»œå’Œé‡æ”¾ç¼“å†²åŒº"></a>åˆå§‹åŒ–ç½‘ç»œå’Œé‡æ”¾ç¼“å†²åŒº</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">main_network = DQN(state_dim, action_dim)</span><br><span class="line">target_network = DQN(state_dim, action_dim)</span><br><span class="line">target_network.load_state_dict(main_network.state_dict())</span><br><span class="line">target_network.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">replay_buffer = ReplayBuffer(<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>


<p>main_network &#x3D; DQN(state_dim, action_dim) ä½¿ç”¨æŒ‡å®šçš„çŠ¶æ€å’ŒåŠ¨ä½œç»´åº¦åˆå§‹åŒ–ä¸»ç½‘ç»œã€‚</p>
<p>target_network &#x3D; DQN(state_dim, action_dim) ä½¿ç”¨ä¸ä¸»ç½‘ç»œç›¸åŒçš„æ¶æ„åˆå§‹åŒ–ç›®æ ‡ç½‘ç»œã€‚</p>
<p>target_network.load_state_dict(main_network.state_dict()) å°†æƒé‡ä»ä¸»ç½‘ç»œå¤åˆ¶åˆ°ç›®æ ‡ç½‘ç»œã€‚</p>
<p>target_network.eval() å°†ç›®æ ‡ç½‘ç»œè®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ã€‚è¿™å¯ä»¥ç¡®ä¿åœ¨æ¨æ–­æœŸé—´æŸäº›å±‚ï¼ˆå¦‚ dropout å’Œæ‰¹é‡å½’ä¸€åŒ–ï¼‰çš„è¡Œä¸ºæ˜¯é€‚å½“çš„ã€‚</p>
<p>replay_buffer &#x3D; ReplayBuffer(10000) ä½¿ç”¨å®¹é‡ä¸º 10,000 çš„é‡æ”¾ç¼“å†²åŒºè¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<h4 id="è®¾ç½®æ­¥æ•°"><a href="#è®¾ç½®æ­¥æ•°" class="headerlink" title="è®¾ç½®æ­¥æ•°"></a>è®¾ç½®æ­¥æ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STEP_COUNT = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>STEP_COUNT &#x3D; 0 åˆå§‹åŒ–ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè·Ÿè¸ªè®­ç»ƒè¿‡ç¨‹ä¸­æ‰€é‡‡å–çš„æ­¥éª¤æ•°é‡ã€‚</p>
<h4 id="ä¼˜åŒ–å™¨åˆå§‹åŒ–å’Œè¶…å‚æ•°ä¼˜åŒ–"><a href="#ä¼˜åŒ–å™¨åˆå§‹åŒ–å’Œè¶…å‚æ•°ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–å™¨åˆå§‹åŒ–å’Œè¶…å‚æ•°ä¼˜åŒ–"></a>ä¼˜åŒ–å™¨åˆå§‹åŒ–å’Œè¶…å‚æ•°ä¼˜åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">home_directory = os.path.expanduser(<span class="string">&#x27;~&#x27;</span>)</span><br><span class="line"></span><br><span class="line">optimizer = Optimizer(env, main_network, target_network, replay_buffer, <span class="string">f&#x27;<span class="subst">&#123;home_directory&#125;</span>/model/model.pth&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;home_directory&#125;</span>/model/params.pkl&#x27;</span>)</span><br><span class="line">best_params = optimizer.optimize(n_trials=<span class="number">2</span>, save_params=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>optimizer &#x3D; Optimizer(â€¦) ä½¿ç”¨ç¯å¢ƒã€ç½‘ç»œã€é‡æ”¾ç¼“å†²åŒºã€æ¨¡å‹è·¯å¾„å’Œå‚æ•°è·¯å¾„åˆå§‹åŒ–Optimizer ç±»ã€‚</p>
<p>best_params &#x3D; optimizer.optimize(n_trials&#x3D;2, save_params&#x3D;True) è¿è¡Œä¼˜åŒ–è¿‡ç¨‹ä»¥æ‰¾åˆ°æœ€ä½³è¶…å‚æ•°ã€‚è¿™ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li>è¿è¡ŒæŒ‡å®šæ¬¡æ•°çš„ä¼˜åŒ–ï¼ˆn_trials&#x3D;2ï¼‰ã€‚ </li>
<li>å¦‚æœsave_paramsæ˜¯Trueï¼Œåˆ™å°†æœ€ä½³è¶…å‚æ•°ä¿å­˜åˆ°ç£ç›˜ã€‚</li>
</ul>
<h4 id="åˆ›å»º-PyTorch-ä¼˜åŒ–å™¨å’Œ-DQN-è®­ç»ƒå™¨"><a href="#åˆ›å»º-PyTorch-ä¼˜åŒ–å™¨å’Œ-DQN-è®­ç»ƒå™¨" class="headerlink" title="åˆ›å»º PyTorch ä¼˜åŒ–å™¨å’Œ DQN è®­ç»ƒå™¨"></a>åˆ›å»º PyTorch ä¼˜åŒ–å™¨å’Œ DQN è®­ç»ƒå™¨</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">optimizer = optim.Adam(main_network.parameters(), lr=best_params[<span class="string">&#x27;lr&#x27;</span>])</span><br><span class="line">trainer = DQNTrainer(env, main_network, target_network, optimizer, replay_buffer, <span class="string">f&#x27;<span class="subst">&#123;home_directory&#125;</span>/model/model.pth&#x27;</span>, gamma=best_params[<span class="string">&#x27;gamma&#x27;</span>], batch_size=best_params[<span class="string">&#x27;batch_size&#x27;</span>], target_update_frequency=best_params[<span class="string">&#x27;target_update_frequency&#x27;</span>])</span><br><span class="line">trainer.train(TRAINING_EPISODES, save_model=SAVE_MODEL, save_video=SAVE_VIDEO)</span><br></pre></td></tr></table></figure>

<p>optimizer &#x3D; optim.Adam(main_network.parameters(), lr&#x3D;best_params[â€˜lrâ€™]) ä½¿ç”¨æœ€ä½³è¶…å‚æ•°åˆ›å»ºä¸€ä¸ª Adam ä¼˜åŒ–å™¨ã€‚</p>
<p>trainer &#x3D; DQNTrainer(â€¦) ä½¿ç”¨æœ€ä½³å‚æ•°ä»ç¯å¢ƒã€ç½‘ç»œã€ä¼˜åŒ–å™¨ã€é‡æ”¾ç¼“å†²åŒºã€æ¨¡å‹è·¯å¾„å’Œè¶…å‚æ•°åˆå§‹åŒ–DQNTrainer ç±»ã€‚ </p>
<p>trainer.train(â€¦) ä¸ºæ¨¡å‹è®­ç»ƒäº† TRAINING_EPISODES ä¸ªå‘¨æœŸã€‚</p>
<p>ä»£ç†åœ¨åŸ¹è®­çš„å‰ 10 å›åˆä¸­çš„è¡¨ç°ï¼š</p>
<p><img src="/../asset_deepq/11.gif"></p>
<p>å¯ä»¥çœ‹åˆ°æ¨¡å‹ç¬¨æ‹™ï¼Œåšå‡ºéšæœºä¸”ç»å¸¸æ˜¯æ¬¡ä¼˜çš„å†³ç­–ã€‚è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºä»£ç†ä»åœ¨æ¢ç´¢ç¯å¢ƒå¹¶å­¦ä¹ åŸºç¡€çŸ¥è¯†ã€‚å®ƒè¿˜æ²¡æœ‰åˆ¶å®šå‡ºæœ€å¤§åŒ–å¥–åŠ±çš„å¼ºå¤§ç­–ç•¥ã€‚éšç€æ›´å¤šçš„è®­ç»ƒå‘¨æœŸï¼Œä»£ç†çš„è¡¨ç°åº”è¯¥ä¼šæ˜¾è‘—æé«˜ï¼Œå› ä¸ºå®ƒä¸æ–­å®Œå–„å…¶ç­–ç•¥å¹¶ä»ç»éªŒä¸­å­¦ä¹ ã€‚</p>
<p>æ¨¡å‹è®­ç»ƒäº† 1000 æ¬¡åçš„ 10 ä¸ªè®­ç»ƒé›†</p>
<p><img src="/../asset_deepq/12.gif"></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>é‡‡ç”¨å…ˆè¿›æŠ€æœ¯å¹¶æ¢ç´¢æ–°æ¶æ„ï¼Œä»¥æé«˜æ‚¨çš„ä»£ç†æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°è¯•è®¾ç½®ä¸åŒçš„è¶…å‚æ•°ï¼Œä½¿ç”¨ä¸åŒçš„ä¼˜åŒ–ç®—æ³•ï¼ˆå¦‚ SGD æˆ– Nadamï¼‰ï¼Œä½¿ç”¨ä¸åŒçš„å¾®è°ƒç®—æ³•ç­‰ç­‰ï¼</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/reinforcement-learning-from-scratch-deep-q-networks-0a8d33ce165b">https://towardsdatascience.com/reinforcement-learning-from-scratch-deep-q-networks-0a8d33ce165b</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/20/voice-with-llama3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/20/voice-with-llama3/" class="post-title-link" itemprop="url">ç”¨llama3å®ç°è¯­éŸ³åŠ©æ‰‹</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-20 15:51:55" itemprop="dateCreated datePublished" datetime="2024-05-20T15:51:55+08:00">2024-05-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-27 17:28:26" itemprop="dateModified" datetime="2024-05-27T17:28:26+08:00">2024-05-27</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>24 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h2><p>Whisper: ç”± OpenAI å¼€å‘ï¼ŒWhisper æ“…é•¿å°†å£è¯­è½¬å½•ä¸ºæ–‡æœ¬ã€‚å…¶ç†è§£å’Œå¤„ç†å¤šç§è¯­è¨€çš„èƒ½åŠ›ä½¿å…¶æˆä¸ºä»»ä½•åŸºäºè¯­éŸ³çš„åº”ç”¨ç¨‹åºçš„å¿…ä¸å¯å°‘çš„å·¥å…·ã€‚</p>
<p>LangChain ç”¨äºåè°ƒç»„ä»¶å¤„ç†æ¨¡å‹å’Œæ•°æ®åº“çš„å¤æ‚ç”¨æˆ·äº¤äº’ã€‚</p>
<p>çŸ¢é‡æ•°æ®åº“ï¼ˆQdrantï¼‰ï¼šQdrant æ—¨åœ¨é«˜æ•ˆå¤„ç†é«˜ç»´æ•°æ®ï¼Œä½¿å…¶éå¸¸é€‚ç”¨äºä¾èµ–æœºå™¨å­¦ä¹ å’Œå¤§è§„æ¨¡æ•°æ®æ£€ç´¢çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ï¼šRAG ç»“åˆäº†æ£€ç´¢å’Œç”Ÿæˆæ¨¡å‹çš„ä¼˜ç‚¹ï¼Œä½¿æˆ‘ä»¬çš„è¯­éŸ³åŠ©æ‰‹èƒ½å¤Ÿåˆ©ç”¨å¤§é‡ä¿¡æ¯æ•°æ®åº“ç”Ÿæˆæ˜æ™ºå’Œå…·æœ‰ä¸Šä¸‹æ–‡ç›¸å…³æ€§çš„å›åº”ã€‚</p>
<h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><ul>
<li><p>transformersï¼ˆ4.33.0ï¼‰ï¼šæä¾›äº†å„ç§é¢„æ„å»ºæ¨¡å‹ï¼Œç”¨äºæ–‡æœ¬ç¿»è¯‘å’Œæ‘˜è¦ç­‰è¯­è¨€ä»»åŠ¡ï¼Œä½¿å…¶æˆä¸ºè¯­è¨€é¡¹ç›®çš„å…³é”®å·¥å…·ã€‚</p>
</li>
<li><p>accelerate ï¼ˆ0.22.0ï¼‰ï¼šå¸®åŠ©åœ¨ä¸éœ€è¦æ”¹å˜å¤ªå¤šä»£ç çš„æƒ…å†µä¸‹ï¼Œåœ¨ä¸åŒç±»å‹çš„è®¡ç®—æœºç¡¬ä»¶ä¸Šè¿è¡Œæœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œå¦‚ CPU æˆ– GPUã€‚</p>
</li>
<li><p>einops (0.6.1)ï¼šä½¿å¾—åœ¨æœºå™¨å­¦ä¹ ä¸­ä½¿ç”¨çš„æ•°æ®ç»“æ„æ›´æ˜“äºå¤„ç†å’Œæ”¹å˜å½¢çŠ¶ï¼Œæœ‰åŠ©äºæ„å»ºå¤æ‚æ¨¡å‹ã€‚</p>
</li>
<li><p>langchain (0.0.300)ï¼šç”¨äºå°†ä¸åŒçš„è¯­è¨€æŠ€æœ¯ç»“åˆåˆ°ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤šä¸ªå¤„ç†æ­¥éª¤çš„é¡¹ç›®ã€‚</p>
</li>
<li><p>xformersï¼ˆ0.0.22.post7ï¼‰ï¼šæä¾›æ¨¡å‹çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†åœ¨å­¦ä¹ å’Œä½¿ç”¨é˜¶æ®µéƒ½èƒ½å¤Ÿé«˜æ•ˆå¤„ç†æ•°æ®ã€‚</p>
</li>
<li><p>bitsandbytes-windowsï¼ˆwindowsç‰ˆæœ¬ï¼‰ï¼šæœ‰åŠ©äºæ›´å¿«åœ°è®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¹¶ä¸”å ç”¨æ›´å°‘çš„å†…å­˜ï¼Œéå¸¸é€‚åˆå¤„ç†å¤§å‹æ•°æ®é›†ã€‚</p>
</li>
<li><p>sentence_transformers (2.2.2)ï¼šåŸºäº transformers åº“æ„å»ºè¯¦ç»†ç‰¹å¾ï¼Œå¯¹äºéœ€è¦ç†è§£æ–‡æœ¬ä¹‹é—´ç›¸ä¼¼æ€§çš„ä»»åŠ¡éå¸¸é‡è¦ã€‚</p>
</li>
</ul>
<p>è®©æˆ‘ä»¬é¦–å…ˆå»ºç«‹ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…åº“ã€‚æ‰“å¼€å‘½ä»¤è¡Œç•Œé¢ ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a virtual environment</span></span><br><span class="line">conda create -n llama3-whisper python=3.11</span><br><span class="line">conda activate llama3-whisper</span><br></pre></td></tr></table></figure>

<p>æˆ‘çš„CUDAç‰ˆæœ¬æ˜¯12.1ï¼Œå¦‚æœåœ¨çº¿å®‰è£…torch æŒç»­ä¸­æ–­å¤±è´¥ï¼Œå¯ä»¥å»ä¸‹è½½ <a target="_blank" rel="noopener" href="https://download.pytorch.org/whl/">wheel</a> æ–‡ä»¶ï¼Œç„¶åæœ¬åœ°å®‰è£…ã€‚</p>
<p>åœ¨çº¿å®‰è£…torchï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install torch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0 --index-url https://download.pytorch.org/whl/cu121</span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°å®‰è£…torchï¼Œè¿›å…¥wheelæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install <span class="string">&quot;torch-2.1.0+cu121-cp311-cp311-win_amd64.whl&quot;</span> </span><br><span class="line">pip install <span class="string">&quot;torchaudio-2.1.0+cu121-cp311-cp311-win_amd64.whl&quot;</span></span><br><span class="line">pip install <span class="string">&quot;torchvision-0.16.0+cu121-cp311-cp311-win_amd64.whl&quot;</span></span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œtorchåï¼Œå®‰è£…xformersï¼Œ å› ä¸ºxformerså’Œtorchçš„ç‰ˆæœ¬å¯¹åº”æ²¡æœ‰æ–‡æ¡£ï¼Œæ‰€ä»¥è¦ä¸€èµ·å®‰è£…æ¥çº¦æŸxformersï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install torch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0  xformers  --index-url https://download.pytorch.org/whl/cu121</span><br></pre></td></tr></table></figure>

<p>çº¦æŸåï¼Œå¯ä»¥çœ‹åˆ°å®‰è£…çš„xformersç‰ˆæœ¬ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤ç›´æ¥å®‰è£…xformersã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install xformers==0.0.22.post7 --index-url https://download.pytorch.org/whl/cu121</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Install dependencies</span></span><br><span class="line">pip3 install openai</span><br><span class="line">pip3 install transformers==4.33.0 </span><br><span class="line">pip3 install accelerate==0.22.0 </span><br><span class="line">pip3 install einops==0.6.1 </span><br><span class="line">pip3 install langchain==0.0.300 </span><br><span class="line">pip3 install bitsandbytes-windows</span><br><span class="line">pip3 install sentence_transformers==2.2.2</span><br><span class="line">pip3 install arxiv</span><br><span class="line">pip3 install huggingface_hub</span><br><span class="line">pip3 install optimum</span><br><span class="line">pip3 install <span class="string">&quot;git+https://github.com/PanQiWei/AutoGPTQ.git@v0.7.1&quot;</span> </span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†å‡†å¤‡ä» PDF æ–‡ä»¶ä¸­æå–æ•°æ®ã€æ‰§è¡Œ OCR å¹¶åˆ›å»ºåµŒå…¥ï¼Œä»¥è¿›è¡Œé«˜çº§æ•°æ®å¤„ç†å’Œæ£€ç´¢ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€äº›è½¯ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pip3 install unstructured</span><br><span class="line">pip3 install <span class="string">&quot;unstructured[pdf]&quot;</span></span><br><span class="line">pip3 install poppler-utils</span><br><span class="line">pip3 install pytesseract</span><br><span class="line">pip3 install grpcio-tools==1.60.1</span><br><span class="line">pip3 install qdrant-client==1.7.2</span><br><span class="line">pip3 install WhisperSpeech</span><br><span class="line">pip3 install rich</span><br></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘çš„win10åœ¨çº¿å®‰è£…tesseract-ocrä¸æˆåŠŸï¼Œæ”¹æˆ<a target="_blank" rel="noopener" href="https://github.com/simonflueckiger/tesserocr-windows_build/releases">wheel</a>å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install tesserocr-2.7.0-cp311-cp311-win_amd64.whl</span><br></pre></td></tr></table></figure>

<p>è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œwindowå¦‚ä¸‹å›¾ï¼š<br><img src="/../asset_voicellama3/01.png"></p>
<p>æ³¨å†ŒHugging Faceï¼Œç”Ÿæˆtoken. ç™»å½• Hugging Face Hub, é¢„å…ˆä¸‹è½½æ¨¡å‹ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Loging to Huggingface Hub</span></span><br><span class="line">huggingface-cli login</span><br><span class="line">huggingface-cli download --resume-download astronomer/Llama-3-8B-Instruct-GPTQ-4-Bit</span><br></pre></td></tr></table></figure>

<h2 id="å¯¼å…¥åº“"><a href="#å¯¼å…¥åº“" class="headerlink" title="å¯¼å…¥åº“"></a>å¯¼å…¥åº“</h2><p>å¯¼å…¥å¿…è¦çš„åº“ï¼ŒåŒ…æ‹¬æ¨¡å‹äº¤äº’ã€æ–‡æ¡£å¤„ç†å’ŒåµŒå…¥ç®¡ç†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> HTTPError</span><br><span class="line"><span class="keyword">import</span> arxiv</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> cuda, bfloat16</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> transformers</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer, AutoModelForCausalLM, GPTQConfig</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> HuggingFacePipeline</span><br><span class="line"><span class="keyword">from</span> langchain.document_loaders <span class="keyword">import</span> PyPDFLoader,DirectoryLoader,WebBaseLoader</span><br><span class="line"><span class="keyword">from</span> langchain.text_splitter <span class="keyword">import</span> RecursiveCharacterTextSplitter,CharacterTextSplitter</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> HuggingFaceEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> RetrievalQA</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Qdrant</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> whisperspeech.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"><span class="keyword">from</span> rich.console <span class="keyword">import</span> Console</span><br><span class="line"><span class="keyword">from</span> rich.markdown <span class="keyword">import</span> Markdown</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†è¯­éŸ³åŠ©æ‰‹çš„æ•°æ®"><a href="#å¤„ç†è¯­éŸ³åŠ©æ‰‹çš„æ•°æ®" class="headerlink" title="å¤„ç†è¯­éŸ³åŠ©æ‰‹çš„æ•°æ®"></a>å¤„ç†è¯­éŸ³åŠ©æ‰‹çš„æ•°æ®</h2><p>ä¸º AI åº”ç”¨æ„å»ºæ•°æ®ç®¡é“, æ•°æ®ç®¡é“å¯¹äºé«˜æ•ˆç®¡ç†å’Œå¤„ç†åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®è‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯å¯ç”¨äº†å¸¦ RAG çš„è¯­éŸ³åŠ©æ‰‹ç­‰å¤æ‚åº”ç”¨ç¨‹åºã€‚</p>
<p>è¿™äº›ç®¡é“é€šå¸¸æ¶‰åŠäº”ä¸ªå…³é”®é˜¶æ®µï¼š</p>
<ul>
<li><p>æ”¶é›†ï¼š åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ•°æ®ä»å„ç§æ¥æºæ”¶é›†ï¼ŒåŒ…æ‹¬æ•°æ®å­˜å‚¨ã€æ•°æ®æµå’Œåº”ç”¨ç¨‹åºã€‚å¯¹äºè¯­éŸ³åŠ©æ‰‹æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä»ç”¨æˆ·äº’åŠ¨ã€éŸ³é¢‘è¾“å…¥ä»¥åŠå†…éƒ¨å’Œå¤–éƒ¨æ•°æ®åº“æ”¶é›†æ•°æ®ã€‚æ•°æ®å¯ä»¥æ¥è‡ªè¯­éŸ³åŠ©æ‰‹éœ€è¦äº¤äº’çš„è¿œç¨‹è®¾å¤‡ã€åº”ç”¨ç¨‹åºæˆ–ä¸šåŠ¡ç³»ç»Ÿã€‚å…¸å‹çš„å·¥å…·æœ‰ Apache Nifiã€Apache Flumeã€Talend å’Œè‡ªå®šä¹‰ APIã€‚</p>
</li>
<li><p>æ‘„å–ï¼šåœ¨æ‘„å–è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†çš„æ•°æ®è¢«åŠ è½½åˆ°ç³»ç»Ÿä¸­ï¼Œå¹¶åœ¨äº‹ä»¶é˜Ÿåˆ—ä¸­è¿›è¡Œç»„ç»‡ã€‚å¯¹äºè¯­éŸ³åŠ©æ‰‹ï¼Œè¿™æ¶‰åŠæ•è·éŸ³é¢‘è¾“å…¥ï¼Œå°†å…¶è½¬å½•ä¸ºæ–‡æœ¬ï¼Œå¹¶å°†å…¶æ’é˜Ÿç­‰å¾…è¿›ä¸€æ­¥å¤„ç†ã€‚æ‘„å–è¿‡ç¨‹ç¡®ä¿æ‰€æœ‰ä¼ å…¥æ•°æ®éƒ½å‡†å¤‡å¥½è¿›è¡Œå®æ—¶æˆ–æ‰¹å¤„ç†ã€‚å…¸å‹å·¥å…·åŒ…æ‹¬ Apache Kafkaã€AWS Kinesisã€Google Cloud Pub&#x2F;Subã€Apache Airflowã€‚</p>
</li>
<li><p>å­˜å‚¨ï¼šåœ¨æ‘„å–åï¼Œç»„ç»‡å¥½çš„æ•°æ®å­˜å‚¨åœ¨å„ç§å­˜å‚¨è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¦‚æ•°æ®ä»“åº“ã€æ•°æ®æ¹–å’Œæ•°æ®æ¹–å±‹ã€‚åœ¨è¯­éŸ³åŠ©æ‰‹çš„èƒŒæ™¯ä¸‹ï¼Œè¿™åŒ…æ‹¬å­˜å‚¨è½¬å½•ã€ç”¨æˆ·æŸ¥è¯¢ä»¥åŠä» RAG ç³»ç»Ÿæ£€ç´¢çš„æ–‡æ¡£ã€‚å­˜å‚¨ç³»ç»Ÿç¡®ä¿æ•°æ®å¯ä¾›æœªæ¥å¤„ç†å’Œåˆ†æã€‚å…¸å‹å·¥å…·æœ‰ Amazon S3ã€Google Cloud Storageã€Azure Data Lakeã€Snowflakeã€Apache Hudiã€Delta Lakeã€‚</p>
</li>
<li><p>å¤„ç†ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ•°æ®ç»å†è½¬æ¢ä»»åŠ¡ï¼Œå¦‚èšåˆã€æ¸…æ´—å’Œæ“ä½œï¼Œä»¥ç¡®ä¿å®ƒç¬¦åˆæ‰€éœ€çš„æ ‡å‡†ã€‚å¯¹äºè¯­éŸ³åŠ©æ‰‹ï¼Œè¿™æ„å‘³ç€å°†æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºå‘é‡ï¼Œå‹ç¼©å®ƒï¼Œå¹¶å°†å…¶åˆ†åŒºä»¥å®ç°é«˜æ•ˆæ£€ç´¢ã€‚ä¸ºäº†ç¡®ä¿æ•°æ®å§‹ç»ˆæ˜¯æœ€æ–°å’Œå‡†ç¡®çš„ï¼Œä½¿ç”¨æ‰¹å¤„ç†ï¼ˆä¸€æ¬¡å¤„ç†å¤§å‹æ•°æ®é›†ï¼‰å’Œæµå¤„ç†ï¼ˆå®æ—¶å¤„ç†æ•°æ®ï¼‰æŠ€æœ¯ã€‚å…¸å‹çš„å·¥å…·æœ‰ Apache Sparkã€Apache Flinkã€Databricksã€AWS Glueã€Google Cloud Dataflowã€‚</p>
</li>
<li><p>æ¶ˆè´¹ï¼šæœ€åé˜¶æ®µæ¶‰åŠå°†å¤„ç†åçš„æ•°æ®æä¾›ç»™ç”¨æˆ·ä½¿ç”¨ã€‚åœ¨è¯­éŸ³åŠ©æ‰‹çš„èƒŒæ™¯ä¸‹ï¼Œè¿™æ„å‘³ç€ä½¿ç³»ç»Ÿèƒ½å¤Ÿå‡†ç¡®ç†è§£å’Œå›åº”ç”¨æˆ·çš„æŸ¥è¯¢ã€‚å®ƒè¿˜å¯ä»¥æ”¯æŒå†³ç­–å¼•æ“å’Œé¢å‘ç”¨æˆ·çš„åº”ç”¨ç¨‹åºï¼Œä½¿è¯­éŸ³åŠ©æ‰‹èƒ½å¤Ÿå¯¹ç”¨æˆ·è¯·æ±‚æä¾›ç›¸å…³å’ŒåŠæ—¶çš„å“åº”ã€‚å…¸å‹å·¥å…·æœ‰ Tableauã€Power BIã€Lookerã€Elasticsearchã€Kibanaã€Apache Supersetã€è‡ªå®šä¹‰ä»ªè¡¨æ¿ã€‚</p>
</li>
</ul>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œæœç´¢å¹¶ä¸‹è½½â€œLLMâ€æœç´¢è¯çš„Arxivè®ºæ–‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">dirpath = <span class="string">&quot;arxiv_papers&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(dirpath):</span><br><span class="line">   os.makedirs(dirpath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_papers</span>():</span><br><span class="line">    search = arxiv.Search(</span><br><span class="line">    query = <span class="string">&quot;LLM&quot;</span>, <span class="comment"># your query length is limited by ARXIV_MAX_QUERY_LENGTH which is 300 characters</span></span><br><span class="line">    max_results = <span class="number">10</span>,</span><br><span class="line">    sort_by = arxiv.SortCriterion.LastUpdatedDate, <span class="comment"># you can also use SubmittedDate or Relevance</span></span><br><span class="line">    sort_order = arxiv.SortOrder.Descending</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> result <span class="keyword">in</span> search.results():</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result.download_pdf(dirpath=dirpath)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;-&gt; Paper id <span class="subst">&#123;result.get_short_id()&#125;</span> with title &#x27;<span class="subst">&#123;result.title&#125;</span>&#x27; is downloaded.&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;File not found&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> HTTPError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Forbidden&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> ConnectionResetError <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Connection reset by peer&quot;</span>)</span><br><span class="line">                time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h2 id="RAGç®€è¦æ¦‚è¿°"><a href="#RAGç®€è¦æ¦‚è¿°" class="headerlink" title="RAGç®€è¦æ¦‚è¿°"></a>RAGç®€è¦æ¦‚è¿°</h2><p>RAG å·¥ä½œæµå¸®åŠ©æˆ‘ä»¬ç®¡ç†å’Œåˆ©ç”¨æ¥è‡ªå„ç§æ¥æºçš„æ•°æ®ï¼Œä»¥æä¾›å‡†ç¡®å’Œç›¸å…³çš„ç»“æœã€‚</p>
<p><img src="/../asset_voicellama3/02.png"></p>
<ul>
<li><p>æ•°æ®åŠ è½½ï¼šä»ä¸åŒæ¥æºæ”¶é›†æ•°æ®ï¼Œå¦‚æ–‡æœ¬æ–‡ä»¶ã€PDFã€ç½‘ç«™ã€æ•°æ®åº“æˆ– APIã€‚ä¾‹å¦‚ï¼ŒLlama Hub æä¾›è®¸å¤šè¿æ¥å™¨ï¼Œä½¿è¿™ä¸€æ­¥éª¤æ›´å®¹æ˜“ã€‚</p>
</li>
<li><p>ç´¢å¼•ï¼šåœ¨ç´¢å¼•é˜¶æ®µï¼Œç³»ç»Ÿå°†åŸå§‹æ•°æ®è½¬æ¢ä¸ºå‘é‡åµŒå…¥ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç»„ç»‡ã€‚</p>
<ul>
<li><p>çŸ¢é‡åŒ–ï¼šæ¯ä¸ªæ–‡æ¡£æˆ–æ•°æ®ç‰‡æ®µéƒ½è¢«è½¬æ¢ä¸ºä¸€ä¸ªé«˜ç»´å‘é‡ï¼Œåˆ©ç”¨å¥å­è½¬æ¢å™¨ç­‰æ¨¡å‹æ•æ‰è¯­ä¹‰å«ä¹‰ã€‚</p>
</li>
<li><p>ç»“æ„åŒ–ï¼šè¿™äº›å‘é‡ç„¶åè¢«ç»„ç»‡æˆä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ª n ç»´æ ‘æˆ–å“ˆå¸Œæ˜ å°„ï¼Œä»è€Œå®ç°å¿«é€Ÿçš„ç›¸ä¼¼æ€§æœç´¢ã€‚</p>
</li>
</ul>
</li>
<li><p>å­˜å‚¨ï¼šä¿å­˜ç´¢å¼•æ•°æ®å’Œæ ‡ç­¾ï¼Œè¿™æ ·æ‚¨ä»¥åå°±ä¸å¿…å†æ¬¡æ•´ç†å®ƒã€‚</p>
</li>
<li><p>æŸ¥è¯¢: åœ¨æŸ¥è¯¢é˜¶æ®µï¼Œç³»ç»Ÿæ ¹æ®æŸ¥è¯¢å‘é‡æ£€ç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ã€‚</p>
<ul>
<li>å‘é‡åŒ¹é…ï¼šå°†æŸ¥è¯¢è½¬æ¢ä¸ºå‘é‡ï¼Œå¹¶ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æˆ–å…¶ä»–è·ç¦»åº¦é‡æ ‡å‡†ä¸ç´¢å¼•å‘é‡è¿›è¡Œæ¯”è¾ƒã€‚</li>
<li>æ£€ç´¢ï¼šç³»ç»Ÿæ£€ç´¢ä¸æŸ¥è¯¢å‘é‡æœ€æ¥è¿‘çš„æ–‡æ¡£ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæä¾›çš„å“åº”åœ¨è¯­å¢ƒä¸Šå’Œç”¨æˆ·çš„è¯·æ±‚ç›¸å…³ã€‚</li>
</ul>
</li>
<li><p>è¯„ä¼°: è¯„ä¼°å¯èƒ½ä¼šå› å…¶éšæœºæ€§è€Œå˜å¾—ç›¸å½“å…·æœ‰æŒ‘æˆ˜æ€§ã€‚ç„¶è€Œï¼Œå¯ä»¥ç”¨åº¦é‡æ ‡å‡†å’Œå·¥å…·è¿›è¡Œå®¢è§‚è¯„ä¼°ã€‚</p>
</li>
</ul>
<p>ä¸€äº›ç¤ºä¾‹æŒ‡æ ‡å¯èƒ½åŒ…æ‹¬ï¼šå¿ å®åº¦ã€ç­”æ¡ˆç›¸å…³æ€§ã€ä¸Šä¸‹æ–‡ç²¾åº¦ã€å¬å›ç‡ã€ç›¸å…³æ€§å’Œå®ä½“å¬å›ã€ç­”æ¡ˆè¯­ä¹‰ç›¸ä¼¼åº¦ã€ç­”æ¡ˆæ­£ç¡®æ€§ã€‚</p>
<h2 id="æ–‡æœ¬åˆ†å‰²å™¨"><a href="#æ–‡æœ¬åˆ†å‰²å™¨" class="headerlink" title="æ–‡æœ¬åˆ†å‰²å™¨"></a>æ–‡æœ¬åˆ†å‰²å™¨</h2><p>ä½¿ç”¨ text_splitter æ¥ç®¡ç†å¤§å‹æ–‡æœ¬æ–‡æ¡£ï¼Œå°†å®ƒä»¬åˆ†æˆæ›´å°ã€æ›´æ˜“ç®¡ç†çš„å—ï¼š</p>
<ul>
<li><p>RecursiveCharacterTextSplitter é€’å½’åœ°å°†æ–‡æœ¬åˆ†å‰²æˆæ›´å°çš„ç‰‡æ®µï¼Œé€‚ç”¨äºéå¸¸å¤§çš„æ–‡æœ¬ã€‚å®ƒæœ‰ 2 ä¸ªä¸»è¦å‚æ•°ï¼š</p>
<ul>
<li>chunk_size ï¼šæ¯ä¸ªå—çš„æœ€å¤§å­—ç¬¦æ•°ï¼ˆä¾‹å¦‚ï¼Œ1000 ä¸ªå­—ç¬¦ï¼‰ã€‚</li>
<li>chunk_overlap ï¼šä¿æŒä¸Šä¸‹æ–‡çš„é‡å å—å¤§å°ï¼ˆä¾‹å¦‚ï¼Œ100 ä¸ªå­—ç¬¦ï¼‰ã€‚</li>
</ul>
<p>  è¿™é€šå¸¸æœ€é€‚åˆäºæ²¡æœ‰è‡ªç„¶åˆ†å‰²ç‚¹çš„éå¸¸å¤§çš„æ–‡æœ¬ï¼Œå¹¶é€šè¿‡ä¿æŒå—ä¹‹é—´çš„é‡å æ¥é˜²æ­¢ä¸Šä¸‹æ–‡ä¸¢å¤±ï¼Œç¡®ä¿åç»­å¤„ç†å…·æœ‰è¿ç»­æ€§ã€‚</p>
</li>
<li><p>CharacterTextSplitter æ ¹æ®æŒ‡å®šçš„å­—ç¬¦åˆ†éš”ç¬¦æ‹†åˆ†æ–‡æœ¬ï¼Œéå¸¸é€‚åˆå…·æœ‰è‡ªç„¶åˆ†éš”çš„æ–‡æœ¬ã€‚å®ƒæœ‰ 3 ä¸ªä¸»è¦å‚æ•°</p>
<ul>
<li>separator ï¼šç”¨äºåˆ†éš”çš„å­—ç¬¦ï¼ˆä¾‹å¦‚ï¼Œ \n ç”¨äºæ¢è¡Œï¼‰ã€‚</li>
<li>chunk_size å’Œ chunk_overlap ï¼šç±»ä¼¼äºé€’å½’åˆ†å‰²å™¨ï¼Œå®šä¹‰å—çš„å¤§å°å’Œé‡å ã€‚</li>
</ul>
<p>  é€‚ç”¨äºå…·æœ‰æ˜ç¡®åˆ†ç•Œç‚¹çš„æ–‡æœ¬ï¼Œå¦‚è„šæœ¬æˆ–å…·æœ‰æ˜ç¡®å®šä¹‰éƒ¨åˆ†çš„æ–‡æ¡£ï¼Œé€šè¿‡åœ¨è‡ªç„¶æ–­ç‚¹å¤„åˆ†å‰²æ–‡æœ¬æ¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œæœ‰åŠ©äºä¿æŒæ„ä¹‰å’Œä¸Šä¸‹æ–‡ï¼Œè€Œæ— éœ€é‡å ã€‚</p>
</li>
</ul>
<h2 id="æ–‡æ¡£åŠ è½½å™¨"><a href="#æ–‡æ¡£åŠ è½½å™¨" class="headerlink" title="æ–‡æ¡£åŠ è½½å™¨"></a>æ–‡æ¡£åŠ è½½å™¨</h2><p>æ–‡æ¡£åŠ è½½å™¨åœ¨å¤„ç†è‡ªç„¶è¯­è¨€å¤„ç†å·¥ä½œæµä¸­çš„ä¸åŒæ•°æ®æºæ—¶è‡³å…³é‡è¦ã€‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>DirectoryLoader: ä»æŒ‡å®šç›®å½•åŠ è½½æ‰€æœ‰æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºå¤„ç†å¤šä¸ªæ–‡æœ¬æˆ– PDF æ–‡ä»¶ã€‚</li>
<li>WebBaseLoaderï¼šä»æŒ‡å®šçš„ URL æ£€ç´¢æ–‡æœ¬ï¼Œä»ä¸­æå–ç½‘ç»œå†…å®¹ä»¥è¿›è¡Œå¤„ç†ã€‚</li>
<li>PyPDFLoaderï¼šä¸“æ³¨äºä»å•ä¸ª PDF æ–‡ä»¶ä¸­æå–æ–‡æœ¬ä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚</li>
<li>TextLoaderï¼šä¸“é—¨è®¾è®¡ç”¨äºåŠ è½½çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œç›´æ¥è¯»å–æ–‡æœ¬æ•°æ®ä»¥ä¾›ç«‹å³ä½¿ç”¨ã€‚</li>
</ul>
<p>æ‰€æœ‰çš„åŠ è½½å™¨éƒ½ç”¨äºæ”¶é›†æ•°æ®ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¯èƒ½ç”¨äºç”ŸæˆåµŒå…¥ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ DirectoryLoader å’Œ RecursiveCharacterTextSplitter æ¥é«˜æ•ˆåœ°åˆ†å—å’Œç®¡ç†å¤šä¸ªæ–‡ä»¶ã€‚</p>
<p>åˆ†å‰²å™¨å’Œæ–‡æ¡£åŠ è½½å™¨çš„ç»“åˆä½¿ç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">document_loader_spilter</span>():</span><br><span class="line">    papers = []</span><br><span class="line">    loader = DirectoryLoader(dirpath, glob=<span class="string">&quot;./*.pdf&quot;</span>, loader_cls=PyPDFLoader)</span><br><span class="line">    papers = loader.load()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Total number of pages loaded:&quot;</span>, <span class="built_in">len</span>(papers)) <span class="comment"># Total number of pages loaded: 410</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># This merges all papes from all papers into single text block for chunking</span></span><br><span class="line">    full_text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> paper <span class="keyword">in</span> papers:</span><br><span class="line">        full_text = full_text + paper.page_content</span><br><span class="line">        </span><br><span class="line">    full_text = <span class="string">&quot; &quot;</span>.join(l <span class="keyword">for</span> l <span class="keyword">in</span> full_text.splitlines() <span class="keyword">if</span> l)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(full_text))</span><br><span class="line"></span><br><span class="line">    text_splitter = RecursiveCharacterTextSplitter(</span><br><span class="line">        chunk_size = <span class="number">500</span>,</span><br><span class="line">        chunk_overlap  = <span class="number">50</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    paper_chunks = text_splitter.create_documents([full_text])</span><br><span class="line">    <span class="keyword">return</span> paper_chunks</span><br></pre></td></tr></table></figure>

<h2 id="æ¨¡å‹é…ç½®"><a href="#æ¨¡å‹é…ç½®" class="headerlink" title="æ¨¡å‹é…ç½®"></a>æ¨¡å‹é…ç½®</h2><p>é…ç½®äº†ä¸€ä¸ªç”¨äºè¯­è¨€ç”Ÿæˆä»»åŠ¡çš„ Meta LLaMA 3 æ¨¡å‹,ç”±äºæˆ‘çš„æ˜¾å¡åªæœ‰8GBæ˜¾å­˜ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ 4-bit æ¨¡å‹ã€‚</p>
<p>é…ç½®ï¼š</p>
<ul>
<li>model_id ï¼šæ ‡è¯†å…·æœ‰ 80 äº¿å‚æ•°çš„ç‰¹å®š Meta LLaMA æ¨¡å‹ï¼Œç”¨äºé«˜çº§è¯­è¨€ä»»åŠ¡ã€‚</li>
<li>device ï¼šå°†æ¨¡å‹è®¾ç½®ä¸ºåœ¨ GPUï¼ˆ â€œcudaâ€ ï¼‰ä¸Šè¿è¡Œï¼Œæé«˜å¤„ç†é€Ÿåº¦å’Œæ•ˆç‡ã€‚</li>
<li>dtype ï¼šä½¿ç”¨ torch.float16 æ¥ä¼˜åŒ–å†…å­˜å’Œè®¡ç®—é€Ÿåº¦ã€‚</li>
</ul>
<p>åˆå§‹åŒ–:</p>
<ul>
<li>tokenizer ï¼šä» Hugging Face åŠ è½½ä¸€ä¸ªåˆ†è¯å™¨ï¼Œå°†æ–‡æœ¬é¢„å¤„ç†ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ ‡è®°ã€‚</li>
<li>model ï¼šä½¿ç”¨ AutoModelForCausalLM.from_pretrained é…ç½®åˆå§‹åŒ–æ¨¡å‹ï¼Œç”¨äºå› æœè¯­è¨€å»ºæ¨¡ï¼Œæ¨¡å‹æ ¹æ®å…ˆå‰æ–‡æœ¬é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_llm_model</span>():</span><br><span class="line">    model_id = <span class="string">&quot;astronomer/Llama-3-8B-Instruct-GPTQ-4-Bit&quot;</span></span><br><span class="line">    device = <span class="string">&quot;cuda&quot;</span></span><br><span class="line">    dtype = torch.float16</span><br><span class="line">    </span><br><span class="line">    tokenizer = AutoTokenizer.from_pretrained(model_id)</span><br><span class="line">    model = AutoModelForCausalLM.from_pretrained(model_id, device_map=device, torch_dtype=dtype)</span><br><span class="line">    <span class="keyword">return</span> model, tokenizer</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®æŸ¥è¯¢ç®¡é“å¹¶åˆå§‹åŒ–ç®¡é“"><a href="#è®¾ç½®æŸ¥è¯¢ç®¡é“å¹¶åˆå§‹åŒ–ç®¡é“" class="headerlink" title="è®¾ç½®æŸ¥è¯¢ç®¡é“å¹¶åˆå§‹åŒ–ç®¡é“"></a>è®¾ç½®æŸ¥è¯¢ç®¡é“å¹¶åˆå§‹åŒ–ç®¡é“</h2><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ Hugging Faceçš„ transformers åº“è®¾ç½®ä¸€ä¸ª query_pipeline ï¼Œæ—¨åœ¨ç®€åŒ–é¢„è®­ç»ƒæ¨¡å‹å’Œåˆ†è¯å™¨çš„ä½¿ç”¨ï¼š</p>
<ul>
<li>model ï¼šæŒ‡å®šé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹ã€‚</li>
<li>tokenizer ï¼šå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºæ ‡è®°ã€‚</li>
<li>torch_dtype ï¼šä½¿ç”¨ torch.float16 è¿›è¡Œé«˜æ•ˆè®¡ç®—ã€‚</li>
<li>max_length ï¼šå°†è¾“å‡ºé™åˆ¶åœ¨ 1024 ä¸ªæ ‡è®°ã€‚</li>
<li>device_map ï¼šè‡ªåŠ¨ä¼˜åŒ–æ¨¡å‹å±‚çš„åˆ†é…åˆ°å¯ç”¨ç¡¬ä»¶ã€‚</li>
</ul>
<p>ç„¶åä½¿ç”¨æˆ‘ä»¬é…ç½®çš„ query_pipeline åˆå§‹åŒ–ä¸€ä¸ª HuggingFacePipeline å¯¹è±¡ï¼Œä»¥ä¾¿ç®€åŒ–æ–‡æœ¬ç”Ÿæˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_query_pipeline</span>(<span class="params">model, tokenizer</span>):</span><br><span class="line">    query_pipeline = transformers.pipeline(</span><br><span class="line">            <span class="string">&quot;text-generation&quot;</span>,</span><br><span class="line">            model=model,</span><br><span class="line">            tokenizer=tokenizer,</span><br><span class="line">            torch_dtype=torch.float16,</span><br><span class="line">            max_length=<span class="number">1024</span>,</span><br><span class="line">            device_map=<span class="string">&quot;auto&quot;</span>,)</span><br><span class="line"></span><br><span class="line">    llm = HuggingFacePipeline(pipeline=query_pipeline)</span><br><span class="line">    <span class="keyword">return</span> llm</span><br></pre></td></tr></table></figure>


<h2 id="å¤„ç†æ¨¡å‹åŠ è½½å¹¶å›é€€åˆ°æœ¬åœ°èµ„æº"><a href="#å¤„ç†æ¨¡å‹åŠ è½½å¹¶å›é€€åˆ°æœ¬åœ°èµ„æº" class="headerlink" title="å¤„ç†æ¨¡å‹åŠ è½½å¹¶å›é€€åˆ°æœ¬åœ°èµ„æº"></a>å¤„ç†æ¨¡å‹åŠ è½½å¹¶å›é€€åˆ°æœ¬åœ°èµ„æº</h2><p>æˆ‘ä»¬ç°åœ¨å°†ä» Hugging Face çš„å­˜å‚¨åº“ä¸­åŠ è½½ sentence-transformers&#x2F;all-mpnet-base-v2 åµŒå…¥æ¨¡å‹ï¼Œé…ç½®ä¸ºåœ¨ CUDA è®¾å¤‡ä¸Šè¿è¡Œã€‚</p>
<p>å¦‚æœæ­¤è¿‡ç¨‹é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œæ¯”å¦‚è¿æ¥é—®é¢˜æˆ–è®¿é—®é™åˆ¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ·»åŠ å¼‚å¸¸ä»¥è¿”å›ä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„åµŒå…¥æ¨¡å‹ã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä¸»è¦æ¥æºä¸å¯ç”¨æ—¶ç»§ç»­ä½¿ç”¨å¤‡ç”¨æ¨¡å‹è¿›è¡Œå¤„ç†ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬åœ¨ä¸åŒçš„è¿è¡Œç¯å¢ƒä¸­ä¿æŒç¨³å¥æ€§ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">load_embeddings_model</span>():</span><br><span class="line">    model_name = <span class="string">&quot;sentence-transformers/all-mpnet-base-v2&quot;</span></span><br><span class="line">    model_kwargs = &#123;<span class="string">&quot;device&quot;</span>: <span class="string">&quot;cuda&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># try to access the sentence transformers from HuggingFace: https://huggingface.co/api/models/sentence-transformers/all-mpnet-base-v2</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        embeddings = HuggingFaceEmbeddings(model_name=model_name, model_kwargs=model_kwargs)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Exception: &quot;</span>, ex)</span><br><span class="line">        <span class="comment"># # alternatively, we will access the embeddings models locally</span></span><br><span class="line">        <span class="comment"># local_model_path = &quot;/kaggle/input/sentence-transformers/minilm-l6-v2/all-MiniLM-L6-v2&quot;</span></span><br><span class="line">        <span class="comment"># print(f&quot;Use alternative (local) model: &#123;local_model_path&#125;\n&quot;)</span></span><br><span class="line">        <span class="comment"># embeddings = HuggingFaceEmbeddings(model_name=local_model_path, model_kwargs=model_kwargs)</span></span><br><span class="line">    <span class="keyword">return</span> embeddings</span><br></pre></td></tr></table></figure>

<h2 id="é›†æˆ-Qdrant-ç”¨äºåµŒå…¥å¼å­˜å‚¨å’Œæ£€ç´¢"><a href="#é›†æˆ-Qdrant-ç”¨äºåµŒå…¥å¼å­˜å‚¨å’Œæ£€ç´¢" class="headerlink" title="é›†æˆ Qdrant ç”¨äºåµŒå…¥å¼å­˜å‚¨å’Œæ£€ç´¢"></a>é›†æˆ Qdrant ç”¨äºåµŒå…¥å¼å­˜å‚¨å’Œæ£€ç´¢</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨ Qdrant ä½œä¸ºæˆ‘ä»¬çš„å‘é‡æ•°æ®åº“ï¼Œå› ä¸ºå®ƒåœ¨å¤„ç†å‘é‡ç›¸ä¼¼æ€§æœç´¢ã€å¯æ‰©å±•æ€§å’Œçµæ´»çš„å‘é‡æ•°æ®ç®¡ç†æ–¹é¢å…·æœ‰å‡ºè‰²çš„èƒ½åŠ›ã€‚</p>
<p>æ­¤å¤–ï¼ŒQdrant æ”¯æŒæœ¬åœ°å’Œäº‘å­˜å‚¨é€‰é¡¹ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥é€‚åº”å„ç§æœ¬åœ°å’Œäº‘ç¯å¢ƒã€‚</p>
<p>æˆ‘ä»¬å·²ç»å®‰è£…äº† Qdrantï¼Œå¹¶ä¸”æ­£åœ¨ä» LangChain çš„å‘é‡å­˜å‚¨ä¸­å¯¼å…¥å®ƒ</p>
<p>Qdrant.from_documents æ–¹æ³•é€šè¿‡å°†æ–‡æ¡£åŠå…¶å¯¹åº”çš„åµŒå…¥ä½œä¸ºè¾“å…¥æ¥ç®€åŒ–æµç¨‹ã€‚</p>
<p>ç„¶åå°† vectordb å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªå…·æœ‰ vectordb.as_retriever() çš„æ£€ç´¢å™¨ã€‚è¯¥æ£€ç´¢å™¨è¢«é…ç½®ä¸ºæ ¹æ®å‘é‡ç›¸ä¼¼æ€§æŸ¥è¯¢å‘é‡æ•°æ®åº“ï¼Œä»¥ä¾¿æ£€ç´¢ç›¸å…³æ–‡æ¡£ï¼Œè¿™å¯¹äºæœ‰æ•ˆçš„ä¿¡æ¯æ£€ç´¢è‡³å…³é‡è¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_retriever</span>():</span><br><span class="line">    documents=document_loader_spilter()</span><br><span class="line">    embeddings=load_embeddings_model()</span><br><span class="line"></span><br><span class="line">    vectordb = Qdrant.from_documents(</span><br><span class="line">        documents,</span><br><span class="line">        embeddings,</span><br><span class="line">        path=<span class="string">&quot;Qdrant_Persist&quot;</span>,</span><br><span class="line">        collection_name=<span class="string">&quot;voice_assistant_documents&quot;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    retriever = vectordb.as_retriever()</span><br><span class="line">    <span class="keyword">return</span> retriever</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„å‚æ•°çš„è¯¦ç»†è¯´æ˜ï¼š</p>
<ul>
<li>documents ï¼šç”ŸæˆåµŒå…¥çš„åŸå§‹æ–‡æ¡£ã€‚</li>
<li>embeddings ï¼šä»æ–‡æ¡£ä¸­æå–çš„åµŒå…¥å·²å‡†å¤‡å¥½è¢«ç´¢å¼•å’Œå­˜å‚¨ã€‚</li>
<li>path ï¼šæŒ‡å®šçš„æœ¬åœ°ç›®å½•ï¼ŒQdrant æ•°æ®åº“å°†åœ¨å…¶ä¸­æŒä¹…ä¿å­˜æ•°æ®ï¼Œç¡®ä¿åµŒå…¥æ•°æ®å®‰å…¨å­˜å‚¨å¹¶æ˜“äºå°†æ¥æ£€ç´¢ã€‚</li>
<li>collection_name ï¼šQdrant ä¸­æ•°æ®é›†çš„æ ‡ç­¾ï¼Œæœ‰åŠ©äºç»„ç»‡å’Œæ£€ç´¢ç‰¹å®šç»„çš„åµŒå…¥ã€‚</li>
</ul>
<p>å¦‚æœæƒ³è¦åœ¨ Qdrant å‘é‡æ•°æ®åº“ä¸­é‡ç”¨æŒä¹…åŒ–æ•°æ®, åˆ›å»ºä¸€ä¸ª QdrantClient å®ä¾‹ï¼ŒæŒ‡å‘å­˜å‚¨æˆ‘ä»¬æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ï¼Œä»è€Œå®ç°å¯¹æŒä¹…åŒ–æ•°æ®çš„è®¿é—®ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> qdrant_client <span class="keyword">import</span> QdrantClient</span><br><span class="line"></span><br><span class="line">client = QdrantClient(path = <span class="string">&quot;Qdrant_Persist&quot;</span>)</span><br><span class="line"></span><br><span class="line">vectordb = Qdrant(</span><br><span class="line">    client=client,</span><br><span class="line">    collection_name=<span class="string">&quot;voice_assistant_documents&quot;</span>,</span><br><span class="line">    embeddings=embeddings,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="è®¾ç½®æ£€ç´¢å™¨"><a href="#è®¾ç½®æ£€ç´¢å™¨" class="headerlink" title="è®¾ç½®æ£€ç´¢å™¨"></a>è®¾ç½®æ£€ç´¢å™¨</h2><p>ç”¨æˆ‘ä»¬ Qdrant å‘é‡æ•°æ®åº“ä¸­å­˜å‚¨çš„åµŒå…¥æ¥å»ºç«‹ä¸€ä¸ªæ£€ç´¢å¼é—®ç­”ï¼ˆQAï¼‰ç³»ç»Ÿ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">model, tokenizer=load_llm_model()</span><br><span class="line">llm=load_query_pipeline(model, tokenizer)</span><br><span class="line">retriever=create_retriever()</span><br><span class="line">qa = RetrievalQA.from_chain_type(</span><br><span class="line">    llm=llm,</span><br><span class="line">    chain_type=<span class="string">&quot;stuff&quot;</span>,</span><br><span class="line">    retriever=retriever,</span><br><span class="line">    verbose=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª RetrievalQA å®ä¾‹ï¼Œå®ƒæ˜¯æˆ‘ä»¬ AI é“¾ä¸­çš„ä¸€éƒ¨åˆ†ã€‚è¯¥å®ä¾‹ä½¿ç”¨æ£€ç´¢å™¨æ¥è·å–ä¸æŸ¥è¯¢ç›¸å…³çš„ä¿¡æ¯ã€‚è¿™é‡Œï¼Œ llm ä»£è¡¨æˆ‘ä»¬çš„è¯­è¨€æ¨¡å‹ï¼Œ chain_type è®¾ç½®ä¸ºâ€stuffâ€ï¼Œè¡¨ç¤ºæ­¤é“¾å°†å¤„ç†çš„ä»»åŠ¡æˆ–æ“ä½œç±»å‹ï¼Œ verbose&#x3D;True åœ¨æ“ä½œæœŸé—´å¯ç”¨è¯¦ç»†è¾“å‡ºï¼Œæä¾›æœ‰å…³æ£€ç´¢è¿‡ç¨‹çš„è§è§£ã€‚</p>
<h2 id="æµ‹è¯•å’Œå¯è§†åŒ–-RAG-ç³»ç»Ÿ"><a href="#æµ‹è¯•å’Œå¯è§†åŒ–-RAG-ç³»ç»Ÿ" class="headerlink" title="æµ‹è¯•å’Œå¯è§†åŒ– RAG ç³»ç»Ÿ"></a>æµ‹è¯•å’Œå¯è§†åŒ– RAG ç³»ç»Ÿ</h2><p>æˆ‘ä»¬å®ç°äº†ç”¨äºæµ‹è¯•å’Œå¯è§†åŒ–æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿçš„åŠŸèƒ½ï¼š</p>
<ul>
<li>colorize_text åŠŸèƒ½: ä¸ºâ€œReasoningâ€ã€â€œQuestionâ€ã€â€œAnswerâ€å’Œâ€œTotal timeâ€ç­‰å…³é”®æœ¯è¯­æ·»åŠ é¢œè‰²ï¼Œä»¥è·å¾—æ¸…æ™°ä¸”è§†è§‰ä¸Šå¸å¼•äººçš„è¾“å‡ºã€‚</li>
<li>test_rag åŠŸèƒ½: æ¥å— QA ç³»ç»Ÿ ( qa ) å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²ã€‚å®ƒæµ‹é‡å“åº”æ—¶é—´ï¼Œæ£€ç´¢ç­”æ¡ˆï¼Œå¹¶åœ¨ Markdown ä¸­æ˜¾ç¤ºæ ¼å¼åŒ–ç»“æœï¼Œçªå‡ºå…³é”®å…ƒç´ ä»¥ä¾¿é˜…è¯»ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">colorize_text</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">for</span> word, color <span class="keyword">in</span> <span class="built_in">zip</span>([<span class="string">&quot;Reasoning&quot;</span>, <span class="string">&quot;Question&quot;</span>, <span class="string">&quot;Answer&quot;</span>, <span class="string">&quot;Total time&quot;</span>], [<span class="string">&quot;blue&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;magenta&quot;</span>]):</span><br><span class="line">        text = text.replace(<span class="string">f&quot;<span class="subst">&#123;word&#125;</span>:&quot;</span>, <span class="string">f&quot;\n\n**&lt;font color=&#x27;<span class="subst">&#123;color&#125;</span>&#x27;&gt;<span class="subst">&#123;word&#125;</span>:&lt;/font&gt;**&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_rag</span>(<span class="params">qa, query</span>):</span><br><span class="line">    console = Console()</span><br><span class="line"></span><br><span class="line">    time_start = time()</span><br><span class="line">    response = qa.run(query)</span><br><span class="line">    time_end = time()</span><br><span class="line">    total_time = <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">round</span>(time_end-time_start, <span class="number">3</span>)&#125;</span> sec.&quot;</span></span><br><span class="line"></span><br><span class="line">    full_response =  <span class="string">f&quot;Question: <span class="subst">&#123;query&#125;</span>\nAnswer: <span class="subst">&#123;response&#125;</span>\nTotal time: <span class="subst">&#123;total_time&#125;</span>&quot;</span></span><br><span class="line">    colored_text = colorize_text(full_response)</span><br><span class="line">    console.<span class="built_in">print</span>(Markdown(colored_text))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h2 id="Llama-3-å’Œ-Whisper-çš„æ–‡æœ¬è½¬è¯­éŸ³å¤„ç†"><a href="#Llama-3-å’Œ-Whisper-çš„æ–‡æœ¬è½¬è¯­éŸ³å¤„ç†" class="headerlink" title="Llama 3 å’Œ Whisper çš„æ–‡æœ¬è½¬è¯­éŸ³å¤„ç†"></a>Llama 3 å’Œ Whisper çš„æ–‡æœ¬è½¬è¯­éŸ³å¤„ç†</h2><p><img src="/../asset_voicellama3/03.png"></p>
<ul>
<li>çŸ¥è¯†åº“åˆ°å‘é‡æ•°æ®åº“ï¼šæœ€åˆï¼ŒçŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£é€šè¿‡åµŒå…¥æ¨¡å‹è¿›è¡Œå¤„ç†ã€‚è¯¥æ¨¡å‹å°†æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºæ•°å­—å‘é‡ï¼Œç„¶åå­˜å‚¨åœ¨åƒ Qdrant è¿™æ ·çš„å‘é‡æ•°æ®åº“ä¸­ã€‚è¿™ç§è®¾ç½®é€šè¿‡å°†æ–‡æ¡£çš„è¯­ä¹‰å«ä¹‰è¡¨ç¤ºä¸ºé«˜ç»´ç©ºé—´ä¸­çš„ç‚¹ï¼Œå®ç°äº†é«˜æ•ˆçš„æ£€ç´¢ã€‚</li>
<li>ç”¨æˆ·æŸ¥è¯¢å¤„ç†ï¼šå½“ç”¨æˆ·æäº¤æŸ¥è¯¢æ—¶ï¼Œå®ƒé¦–å…ˆä¸åµŒå…¥æ¨¡å‹äº¤äº’ï¼Œå°†æŸ¥è¯¢è½¬æ¢ä¸ºå…¶å‘é‡è¡¨ç¤ºã€‚</li>
<li>æ£€ç´¢ï¼šç„¶åä½¿ç”¨æŸ¥è¯¢å‘é‡ä»å‘é‡æ•°æ®åº“ä¸­è·å–ä¸ä¹‹æœ€ç›¸ä¼¼çš„å‰ K ä¸ªå‘é‡ï¼ˆä¸Šä¸‹æ–‡ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œæ£€ç´¢â€ï¼Œæœ‰åŠ©äºè¯†åˆ«ä¸ç”¨æˆ·æŸ¥è¯¢ç›¸å…³çš„çŸ¥è¯†åº“ä¸­æœ€ç›¸å…³çš„æ–‡æ¡£æˆ–æ•°æ®ç‰‡æ®µã€‚</li>
<li>é˜…è¯»å’Œå“åº”ç”Ÿæˆï¼šç„¶åå°†æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡è¾“å…¥åˆ° Meta Llama 3 LLMä¸­ï¼Œè¯¥ç³»ç»Ÿä¼šé˜…è¯»å’Œç†è§£è¿™äº›ä¸Šä¸‹æ–‡ä¸­ä¸ç”¨æˆ·æŸ¥è¯¢ç›¸å…³çš„ä¿¡æ¯ã€‚ç„¶åç”Ÿæˆä¸€ä¸ªå“åº”ï¼Œæ—¨åœ¨æä¾›æœ€å‡†ç¡®å’Œç›¸å…³çš„ä¿¡æ¯ã€‚ç„¶å Whisper å°†æ–‡æœ¬è½¬æ¢ä¸ºéŸ³é¢‘å“åº”ã€‚</li>
</ul>
<p>é¦–å…ˆå®šä¹‰â€œWhisperâ€ç®¡é“ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipe = Pipeline(s2a_ref=<span class="string">&#x27;WhisperSpeech/WhisperSpeech:s2a-q4-tiny-en+pl.model&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸ºwindowsç³»ç»Ÿï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†éŸ³é¢‘å¼ é‡è½¬æ¢ä¸ºéŸ³é¢‘æ–‡ä»¶ã€‚</p>
<p>ç„¶åé€šè¿‡æˆ‘ä»¬çš„æŸ¥è¯¢æ¥ä½¿ç”¨ Llama 3 è¿›è¡Œæ–‡æœ¬ç”Ÿæˆï¼Œæ¥ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Whisper è¿›è¡ŒéŸ³é¢‘ç”Ÿæˆã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_audio_for_windows</span>(<span class="params">audio_tensor,wav_file_path</span>):</span><br><span class="line">    <span class="keyword">from</span> pydub <span class="keyword">import</span> AudioSegment</span><br><span class="line">    <span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">    <span class="comment"># generate uses CUDA if available; therefore, it&#x27;s necessary to move to CPU before converting to NumPy array</span></span><br><span class="line">    audio_np = (audio_tensor.cpu().numpy() * <span class="number">32767</span>).astype(np.int16)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(audio_np.shape) == <span class="number">1</span>:</span><br><span class="line">        audio_np = np.expand_dims(audio_np, axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        audio_np = audio_np.T</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Array shape:&quot;</span>, audio_np.shape)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Array dtype:&quot;</span>, audio_np.dtype)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        audio_segment = AudioSegment(</span><br><span class="line">            audio_np.tobytes(), </span><br><span class="line">            frame_rate=<span class="number">24000</span>, </span><br><span class="line">            sample_width=<span class="number">2</span>, </span><br><span class="line">            channels=<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">        audio_segment.export(wav_file_path, <span class="built_in">format</span>=<span class="string">&#x27;wav&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Audio file generated: <span class="subst">&#123;wav_file_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error writing audio file: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">query = <span class="string">&quot;How LLMs can be used to understand and interact with the complex 3D world&quot;</span></span><br><span class="line">aud = test_rag(qa, query)</span><br><span class="line"></span><br><span class="line">audio_tensor = pipe.generate(<span class="string">f&quot;<span class="subst">&#123;aud&#125;</span>&quot;</span>)</span><br><span class="line">generate_audio_for_windows(audio_tensor, <span class="string">f&quot;output.wav&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢å¤„ç†ï¼šæˆ‘ä»¬ä»æŸ¥è¯¢â€œå¦‚ä½•LLMsç”¨äºç†è§£å’Œä¸å¤æ‚çš„ 3D ä¸–ç•Œäº’åŠ¨â€å¼€å§‹ï¼Œé€šè¿‡ä½¿ç”¨æ¨¡å‹ï¼ˆ qa ï¼‰çš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç³»ç»Ÿè¿›è¡Œå¤„ç†ã€‚è¯¥ç³»ç»Ÿçš„å“åº”å·²å‡†å¤‡ç”¨äºè¯­éŸ³åˆæˆã€‚</li>
<li>è¯­éŸ³åˆæˆï¼šä½¿ç”¨ whisper æ¨¡å‹ä¸è¯­éŸ³ï¼Œæˆ‘ä»¬å°†æ–‡æœ¬å“åº”è½¬æ¢ä¸ºéŸ³é¢‘å¹¶ä¿å­˜ä¸º output.wav ã€‚</li>
<li>è¯­éŸ³è½¬æ–‡æœ¬ï¼šå¯ä»¥ä½¿ç”¨ whisper æ¨¡å‹å°†éŸ³é¢‘æ–‡ä»¶è½¬å½•å›æ–‡æœ¬ï¼Œä»¥éªŒè¯è¯­éŸ³åˆæˆçš„å‡†ç¡®æ€§ã€‚</li>
</ul>
<p><img src="/../asset_voicellama3/04.png"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://medium.com/@datadrifters/llama-3-powered-voice-assistant-integrating-local-rag-withdrant-whisper-and-langchain-b4d075b00ac5">https://medium.com/@datadrifters/llama-3-powered-voice-assistant-integrating-local-rag-withdrant-whisper-and-langchain-b4d075b00ac5</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/19/rpa-agent/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/19/rpa-agent/" class="post-title-link" itemprop="url">ä» RPA åˆ°ä¼ä¸š AI ä»£ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-19 16:18:05" itemprop="dateCreated datePublished" datetime="2024-05-19T16:18:05+08:00">2024-05-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-20 10:37:30" itemprop="dateModified" datetime="2024-05-20T10:37:30+08:00">2024-05-20</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>4 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>RPA(æœºå™¨äººæµç¨‹è‡ªåŠ¨åŒ–) åˆç§°è½¯ä»¶æœºå™¨äººï¼Œå®ƒä½¿ç”¨è‡ªåŠ¨åŒ–æŠ€æœ¯æ¨¡æ‹Ÿäººç±»çš„åå°ä»»åŠ¡ï¼Œå¦‚æå–æ•°æ®ã€å¡«å†™è¡¨å•å’Œç§»åŠ¨æ–‡ä»¶ç­‰ç­‰ã€‚ å®ƒç»“åˆäº† API å’Œç”¨æˆ·ç•Œé¢ (UI) äº’åŠ¨ï¼Œæ•´åˆå¹¶æ‰§è¡Œä¼ä¸šä¸ç”Ÿäº§åŠ›åº”ç”¨ä¹‹é—´çš„é‡å¤æ€§ä»»åŠ¡ã€‚ é€šè¿‡éƒ¨ç½²ç”¨äºæ¨¡æ‹Ÿäººå·¥æµç¨‹çš„è„šæœ¬ï¼ŒRPA å·¥å…·å¯ä»¥åœ¨å„ä¸ªä¸ç›¸å…³çš„è½¯ä»¶ç³»ç»Ÿä¸­è‡ªåŠ¨æ‰§è¡Œå„é¡¹æ´»åŠ¨å’Œäº‹åŠ¡ã€‚</p>
<p>AI ä»£ç†æ˜¯ä¸€ç§ç”±LLMså®ç°çš„æ–°è½¯ä»¶èŒƒå¼ã€‚ä»£ç†å¯ä»¥æ¨ç†ã€åä½œå’Œè¡ŒåŠ¨ï¼Œç±»ä¼¼äºäººç±»çš„å·¥ä½œæ–¹å¼ã€‚ä»£ç†ä¸ä»…ä»…æ˜¯è‡ªåŠ¨åŒ–çš„ä¸€ç§é€æ­¥æ”¹è¿›æ–¹å¼ï¼Œè€Œä¸”æ˜¯ä¸€ç§å®Œå…¨æ–°çš„çªç ´æ€§æŠ€æœ¯ï¼Œéœ€è¦æŒæ¡æ–°çš„æŠ€èƒ½å’Œå·¥å…·ã€‚å®ƒä»¬å°†èŒƒå›´ä»æˆ˜æœ¯ä»»åŠ¡çº§è‡ªåŠ¨åŒ–æ‰©å±•åˆ°è‡ªåŠ¨åŒ–å’Œå¢å¼ºå¤æ‚çš„çŸ¥è¯†å·¥ä½œã€‚</p>
<h2 id="RPA-å’Œäººå·¥æ™ºèƒ½"><a href="#RPA-å’Œäººå·¥æ™ºèƒ½" class="headerlink" title="RPA å’Œäººå·¥æ™ºèƒ½"></a>RPA å’Œäººå·¥æ™ºèƒ½</h2><p>æœºå™¨äººæµç¨‹è‡ªåŠ¨åŒ–ç»å¸¸è¢«è¯¯è®¤ä¸ºæ˜¯äººå·¥æ™ºèƒ½ (AI)ï¼Œä½†ä¸¤è€…æˆªç„¶ä¸åŒã€‚ AI ç»“åˆäº†è®¤çŸ¥è‡ªåŠ¨åŒ–ã€æœºå™¨å­¦ä¹  (ML)ã€è‡ªç„¶è¯­è¨€å¤„ç† (NLP) ã€æ¨ç†ã€å‡è®¾ç”Ÿæˆå’Œåˆ†æã€‚</p>
<p>å…³é”®åŒºåˆ«åœ¨äº RPA æ˜¯æµç¨‹é©±åŠ¨çš„ï¼ŒAI åˆ™æ˜¯æ•°æ®é©±åŠ¨çš„ã€‚ RPA æœºå™¨äººåªéµå¾ªæœ€ç»ˆç”¨æˆ·å®šä¹‰çš„æµç¨‹ï¼Œè€Œ AI æœºå™¨äººåˆ™ä½¿ç”¨æœºå™¨å­¦ä¹ æ¥è¯†åˆ«æ•°æ®ä¸­çš„æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯éç»“æ„åŒ–æ•°æ®ï¼Œå¹¶æŒç»­è¿›è¡Œå­¦ä¹ ã€‚ æ¢å¥è¯è¯´ï¼ŒAI æ—¨åœ¨æ¨¡æ‹Ÿäººç±»æ™ºèƒ½ï¼Œè€Œ RPA åˆ™ä»…ç”¨äºå¤åˆ¶äººç±»æŒ‡å¯¼çš„ä»»åŠ¡ã€‚ è™½ç„¶äººå·¥æ™ºèƒ½å’Œ RPA å·¥å…·çš„ä½¿ç”¨èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åœ°å‡å°‘äººå·¥å¹²é¢„ï¼Œä½†å®ƒä»¬å®ç°æµç¨‹è‡ªåŠ¨åŒ–çš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚ </p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒRPA å’Œ AI å½¼æ­¤è¿˜èµ·åˆ°å¾ˆå¥½çš„äº’è¡¥ä½œç”¨ã€‚ AI å¯ä»¥å¸®åŠ© RPA æ›´å…¨é¢åœ°è‡ªåŠ¨å®Œæˆä»»åŠ¡ï¼Œå¹¶å¤„ç†æ›´å¤æ‚çš„ç”¨ä¾‹ã€‚ RPA åˆ™æœ‰åŠ©äºæ›´è¿…é€Ÿåœ°å¯¹ AI æ´å¯Ÿé‡‡å–è¡ŒåŠ¨ï¼Œè€Œä¸æ˜¯ç­‰å¾…äººå·¥å®æ–½ã€‚</p>
<p>å½“ä¼ä¸šéœ€è¦åŠ é€Ÿå°†AIèå…¥åˆ°ä¸€çº¿æ´»åŠ¨å’Œå†³ç­–ä¸­æ—¶ï¼Œè®¸å¤šä¼ä¸šå‘ç°RPAå¯ä»¥ä½œä¸ºAIçš„â€œæœ€åä¸€è‹±é‡Œâ€äº¤ä»˜ç³»ç»Ÿã€‚é…ç½®çš„æœºå™¨äººå¯ä»¥å°†æœºå™¨å­¦ä¹ æ¨¡å‹åº”ç”¨åˆ°è‡ªåŠ¨åŒ–å†³ç­–æµç¨‹å’Œåˆ†æä¸­ï¼Œå°†æœºå™¨æ™ºèƒ½æ·±å…¥åˆ°æ—¥å¸¸æ“ä½œã€‚</p>
<p>ä¼ä¸šè‡ªåŠ¨åŒ–çš„æ¼”å˜:</p>
<ul>
<li>è‡ªåŠ¨åŒ–ä»»åŠ¡ â€” RPA</li>
<li>è‡ªåŠ¨åŒ–æµç¨‹ â€” è‡ªåŠ¨åŒ–å³ä»£ç </li>
<li>è‡ªåŠ¨åŒ–å·¥ä½œ â€” æ™ºèƒ½äººå·¥æ™ºèƒ½ä»£ç†</li>
</ul>
<h2 id="è¶…è¶Š-RPA-å’Œæ™ºèƒ½è‡ªåŠ¨åŒ–"><a href="#è¶…è¶Š-RPA-å’Œæ™ºèƒ½è‡ªåŠ¨åŒ–" class="headerlink" title="è¶…è¶Š RPA å’Œæ™ºèƒ½è‡ªåŠ¨åŒ–"></a>è¶…è¶Š RPA å’Œæ™ºèƒ½è‡ªåŠ¨åŒ–</h2><p>ä¼ä¸šè‡ªåŠ¨åŒ–æ­£åœ¨ç»å†ä¸€åœºæ¼”å˜ã€‚å®ƒå§‹äºæœºå™¨äººæµç¨‹è‡ªåŠ¨åŒ–ï¼ˆRPAï¼‰, RPA çš„å´›èµ·å¾—ç›Šäºå½•åˆ¶å’Œæ’­æ”¾æ–¹å¼çš„ UI è‡ªåŠ¨åŒ–ï¼Œå®ƒæ‰“é€ äº†å›´ç»•ä½ä»£ç ä¸šåŠ¡çš„åº”ç”¨çš„ç¹è£ã€‚</p>
<p>å¦‚ä»Šï¼Œæ¯å®¶å¤§å…¬å¸éƒ½å»ºç«‹äº†å›´ç»•è‡ªåŠ¨åŒ–çš„ä¸­å¿ƒï¼Œå¹¶æ‰©å±•åˆ°é€šå¸¸è¢«ç§°ä¸ºæ™ºèƒ½è‡ªåŠ¨åŒ–ï¼ˆIAï¼‰çš„é¢†åŸŸã€‚</p>
<p>IA å¹¶ä¸æ˜¯ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„æœ¯è¯­ï¼Œé€šå¸¸æ˜¯ä» RPA åˆ° API è‡ªåŠ¨åŒ–ä»¥åŠé€šè¿‡ OCR è¿›è¡Œæ–‡æ¡£å¤„ç†çš„æŠ€æœ¯æ··åˆä½“ã€‚å®ƒæ ‡å¿—ç€è¶…è¶Šç‚¹å¯¹ç‚¹è‡ªåŠ¨åŒ–ï¼Œè½¬å‘ä½¿ç”¨å·¥å…·è¿›è¡Œæµç¨‹è‡ªåŠ¨åŒ–ï¼Œè¿™äº›å·¥å…·é€šå¸¸å°†ç¼–ç ä¸ä½ä»£ç æ··åˆï¼Œå¹¶éœ€è¦ä¸“ä¸šæŠ€èƒ½æ¥éƒ¨ç½²ã€‚ç„¶è€Œï¼ŒåŸºæœ¬åŸåˆ™ä»ç„¶ç›¸åŒ â€” RPA å’Œ IA çº¯ç²¹åŸºäºè§„åˆ™ï¼Œå¹¶é€‚ç”¨äºæ˜ç¡®å®šä¹‰ã€é«˜åº¦ç»“æ„åŒ–çš„æµç¨‹ã€‚</p>
<p>AI ä»£ç†ï¼Œä½¿ç”¨å®Œå…¨ä¸åŒçš„ä»£ç†è§„åˆ’å’Œæ‰§è¡Œå·¥ä½œæµç¨‹ã€‚ä»–ä»¬å¯ä»¥é€šè¿‡çµæ´»çš„æ¨ç†èƒ½åŠ›æ¥å®ç°ç†è§£æœ¬åœ°éç»“æ„åŒ–æ•°æ®å’Œéç»“æ„åŒ–æµç¨‹ã€‚è¿™ä½¿å¾—ä»£ç†ä¸ä»…é€‚ç”¨äºæ— æ³•ç”¨ç®€å•è§„åˆ™æ•æ‰çš„å·¥ä½œï¼Œè€Œä¸”é€‚ç”¨äºç”¨è‡ªç„¶è¯­è¨€æè¿°çš„æ‰‹å†Œå’Œå·¥ä½œæŒ‡å—ã€‚è¿™ä¹Ÿä½¿ä»£ç†æ¯”é¢„å…ˆç¼–ç¨‹çš„æœºå™¨äººæ›´å…·å¼¹æ€§ â€” ä»£ç†å¯ä»¥åœ¨é‡åˆ°é”™è¯¯æ—¶è‡ªè¡Œçº æ­£æˆ–ä¸äººç±»è”ç³»ä»¥è·å¾—åé¦ˆã€‚</p>
<p><img src="/../asset_rpaagent/01.png"></p>
<h2 id="ä»æˆ˜æœ¯è‡ªåŠ¨åŒ–åˆ°æˆ˜ç•¥äººå·¥æ™ºèƒ½ä»£ç†"><a href="#ä»æˆ˜æœ¯è‡ªåŠ¨åŒ–åˆ°æˆ˜ç•¥äººå·¥æ™ºèƒ½ä»£ç†" class="headerlink" title="ä»æˆ˜æœ¯è‡ªåŠ¨åŒ–åˆ°æˆ˜ç•¥äººå·¥æ™ºèƒ½ä»£ç†"></a>ä»æˆ˜æœ¯è‡ªåŠ¨åŒ–åˆ°æˆ˜ç•¥äººå·¥æ™ºèƒ½ä»£ç†</h2><p>å°½ç®¡äººå·¥æ™ºèƒ½ä»£ç†é‡‡å–äº†ä¸€ç§ä¸ä¼ä¸šè‡ªåŠ¨åŒ–éå¸¸ä¸åŒçš„æ–¹æ³•ï¼Œä½†å®ƒä»¬å¹¶ä¸æ ‡å¿—ç€ RPA çš„ç»ˆç»“ã€‚å¦‚æœæ‚¨çš„ä»»åŠ¡éœ€è¦æ¯å¤©å‘ç”Ÿäº§ ERP ç³»ç»Ÿè¾“å…¥ä¸€åƒæ¡è®°å½•ï¼Œæˆ–å°†åä¸‡ä»½ç”µå­å¥åº·è®°å½•è¿ç§»åˆ°æ–°ç³»ç»Ÿï¼Œé‚£ä¹ˆè¯•å›¾ä½¿ç”¨ä»£ç†æ¥è§£å†³é‡å¤çš„ä¾‹è¡Œä»»åŠ¡æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p>
<p>AI ä»£ç†æ‰©å±•äº†ä¼ä¸šè‡ªåŠ¨åŒ–çš„èŒƒå›´ï¼Œè¶…å‡ºäº†ä»¥å‰å¯èƒ½çš„èŒƒå›´ã€‚ç”±äº AI ä»£ç†æ˜¯ä¸€ä¸ªä»åœ¨å½¢æˆä¸­çš„æ–°ç±»åˆ«ï¼Œæƒ³è±¡ä»£ç†ä½¿ç”¨æ¡ˆä¾‹çš„æœ€ç®€å•æ–¹æ³•æ˜¯é€šè¿‡ä»£ç†æ¨ç†æ‰©å±•ç°æœ‰çš„è‡ªåŠ¨åŒ–ä¾‹ç¨‹ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒAI ä»£ç†å°†æ‰©å±•åˆ°ä¼ä¸šæ ¸å¿ƒä¸šåŠ¡å·¥ä½œæµç¨‹ï¼Œè¿™äº›å·¥ä½œæµç¨‹æ˜¯ä¼ä¸šçš„æ ¸å¿ƒã€‚</p>
<p><img src="/../asset_rpaagent/02.png"><br>AI ä»£ç†å’Œä¼ä¸šè‡ªåŠ¨åŒ–ç”¨ä¾‹çš„å±‚æ¬¡ç»“æ„</p>
<p>ä¸Šé¢çš„æ’å›¾æ˜¾ç¤ºäº†ä¸‰ç§ä¸åŒç±»åˆ«çš„è‡ªåŠ¨åŒ–ä½¿ç”¨æ¡ˆä¾‹ã€‚åœ¨åº•éƒ¨ï¼Œæœ‰å¤§é‡ä¸éœ€è¦å¤æ‚å†³ç­–ä½†åœ¨è‡ªå®šä¹‰ç¯å¢ƒä¸‹è¿è¡Œçš„æˆ˜æœ¯æ€§å·¥ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é¡¹å·¥ä½œæ˜¯åœ¨ä¸ä¼ä¸šé«˜åº¦ç›¸å…³çš„æ•°æ®ã€æ–‡ä»¶å’Œç³»ç»Ÿä¸Šè¿è¡Œçš„ã€‚</p>
<p>è¿™æ˜¯ RPA è¿ä½œçš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯å¼€å§‹å®è·µç¬¬ä¸€ä¸ª AI ä»£ç†é¡¹ç›®çš„å¥½åœ°æ–¹ã€‚å¯»æ‰¾åœ¨ RPA ä¾‹è¡Œç¨‹åºä¹‹å‰å’Œä¹‹åå‡ºç°çš„å·¥ä½œæµä¸­çš„æœºä¼šï¼Œå¹¶é€šè¿‡ä»£ç†æ‰©å¤§è‡ªåŠ¨åŒ–èŒƒå›´ã€‚ä½¿ç”¨ AI ä»£ç†æ¥æ‰©å¤§è‡ªåŠ¨åŒ–çš„èŒƒå›´ï¼Œè¶…è¶Šæ ‡å‡† RPA æ‰€èƒ½å®ç°çš„èŒƒå›´ã€‚</p>
<p>å¾€ä¸Šä¸€å±‚ï¼Œæˆ‘ä»¬æœ‰æ¶‰åŠæ ‡å‡†å†³ç­–çš„å·¥ä½œï¼Œè¿™äº›å†³ç­–æ˜¯åœ¨æ ‡å‡†èƒŒæ™¯ä¸‹è¿›è¡Œçš„ã€‚è¿™é€šå¸¸æ˜¯ç”± ServiceNow æˆ– Salesforce ç­‰å¹³å°å’Œè®°å½•ç³»ç»Ÿæ¥åšçš„å·¥ä½œã€‚åœ¨è¿™é‡Œï¼Œæ‚¨æœ€å¥½é€šè¿‡ä»è¿™äº›ä¾›åº”å•†è´­ä¹°äººå·¥æ™ºèƒ½å’Œè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¾èµ–äºä»–ä»¬åˆ›æ–°æ•°æ®å’Œæµç¨‹çš„èƒ½åŠ›æ¥æœåŠ¡ä¼ä¸šã€‚ç°åœ¨æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªååŠ©æœºå™¨äººï¼Œå®ƒå¸®åŠ©ä¼ä¸šè‡ªåŠ¨åŒ–å…¶ä¸šåŠ¡æµç¨‹ã€‚</p>
<p>æœ€åï¼Œåœ¨é‡‘å­—å¡”çš„é¡¶ç«¯ï¼Œæˆ‘ä»¬æœ‰æœ€æˆ˜ç•¥æ€§çš„å·¥ä½œç±»åˆ«ï¼Œè¿™æ˜¯ä¼ä¸šä¸šåŠ¡å’Œè¿è¥çš„æ ¸å¿ƒã€‚è¿™é¡¹å·¥ä½œæ¶‰åŠå¤æ‚çš„å†³ç­–ï¼Œå¹¶ä¸”åœ¨ç‰¹å®šçš„èƒŒæ™¯ä¸‹è¿ä½œã€‚æ²¡æœ‰äººèƒ½å¤Ÿä»å¤–éƒ¨è¿›æ¥æ•™ä½ å¦‚ä½•æ›´å¥½åœ°åšè¿™é¡¹å·¥ä½œï¼Œå› ä¸ºè¿™å°±æ˜¯å…¬å¸å­˜åœ¨çš„åŸå› ã€‚è¿™å°±æ˜¯ä¸“ä¸ºä¼ä¸šå®šåˆ¶çš„äººå·¥æ™ºèƒ½ä»£ç†å°†äº§ç”Ÿæœ€å¤§å½±å“çš„åœ°æ–¹ã€‚</p>
<p>ä»£ç†å¯ä»¥ä¸äººç±»ä¸€èµ·å·¥ä½œï¼Œæˆ–å®Œå…¨å–ä»£ä¸€äº›äººç±»ä»»åŠ¡ï¼Œå¹¶ä½¿äººä»¬ä¸“æ³¨äºæ›´æœ‰ç”Ÿäº§åŠ›çš„å·¥ä½œã€‚ç”±äºæ™ºèƒ½ AI ä»£ç†ä»å¤„äºæ—©æœŸé˜¶æ®µï¼Œæ‰€ä»¥è¦è¾¾åˆ°è¿™é¡¹æœ€æœ‰ä»·å€¼å’Œæˆ˜ç•¥æ€§çš„å·¥ä½œéœ€è¦æ—¶é—´ï¼Œä½†ç°åœ¨æ˜¯å¼€å§‹å»ºç«‹æ‰€éœ€æŠ€èƒ½å’Œå¹³å°çš„æ—¶å€™äº†ã€‚</p>
<h2 id="æ¡ˆä¾‹ï¼š-ERP-ä½ä»£ç å¹³å°-RPA-AI"><a href="#æ¡ˆä¾‹ï¼š-ERP-ä½ä»£ç å¹³å°-RPA-AI" class="headerlink" title="æ¡ˆä¾‹ï¼š ERP+ä½ä»£ç å¹³å°+RPA+AI"></a>æ¡ˆä¾‹ï¼š ERP+ä½ä»£ç å¹³å°+RPA+AI</h2><p><img src="/../asset_rpaagent/03.png"></p>
<p>åœ¨æ­¤æ¶æ„ä¸­ï¼ŒERPç³»ç»Ÿå¯ä»¥ç»§ç»­ä¿æŒä¸å˜ï¼Œä½ä»£ç å¹³å°åˆ™é€šè¿‡æ— ä»£ç æˆ–ä½ä»£ç å¿«é€Ÿå¼€å‘ï¼Œå¿«é€Ÿéƒ¨ç½²ä¸Šçº¿çš„ç‰¹æ€§ï¼Œä»¥å°æ­¥å¿«è·‘ï¼Œå¿«é€Ÿè¿­ä»£çš„æ–¹å¼ï¼Œå®ç°ä¼ä¸šåˆ›æ–°ä¸ç®¡ç†æ”¹å–„ã€‚</p>
<p>æ¯ä¸ªä¼ä¸šçš„é‡‡è´­ç”³è¯·å¯èƒ½å­˜åœ¨æ¯”è¾ƒå¤§çš„å·®å¼‚ï¼Œå› æ­¤å¾ˆå¤šERPç³»ç»Ÿçš„æ ‡å‡†åŠŸèƒ½éƒ½æ— æ³•æ»¡è¶³ä¼ä¸šçš„ä¸ªæ€§éœ€æ±‚,æ¯”å¦‚å®šåˆ¶å®¡æ‰¹æµç¨‹.</p>
<h3 id="è¯†åˆ«éœ€è¦ä¸ERPç³»ç»Ÿäº¤äº’çš„æ•°æ®"><a href="#è¯†åˆ«éœ€è¦ä¸ERPç³»ç»Ÿäº¤äº’çš„æ•°æ®" class="headerlink" title="è¯†åˆ«éœ€è¦ä¸ERPç³»ç»Ÿäº¤äº’çš„æ•°æ®:"></a>è¯†åˆ«éœ€è¦ä¸ERPç³»ç»Ÿäº¤äº’çš„æ•°æ®:</h3><ul>
<li>ä¸€æ˜¯ç‰©æ–™æ•°æ®ä»ERPåŒæ­¥åˆ°ä½ä»£ç å¹³å°ï¼Œä»¥ä¾¿åœ¨ä½ä»£ç å¹³å°å‘èµ·ç”³è¯·æ—¶ç”¨æˆ·å¯ä»¥é€‰æ‹©é‡‡è´­ç‰©æ–™ã€‚</li>
<li>äºŒæ˜¯å°†ä½ä»£ç å¹³å°å®¡æ‰¹é€šè¿‡çš„é‡‡è´­ç”³è¯·è¿”å›ERPç³»ç»Ÿå½¢æˆPOï¼ˆé‡‡è´­è®¢å•ï¼‰</li>
</ul>
<h3 id="æ­£å¸¸æ–¹å¼"><a href="#æ­£å¸¸æ–¹å¼" class="headerlink" title="æ­£å¸¸æ–¹å¼:"></a>æ­£å¸¸æ–¹å¼:</h3><p>é€šè¿‡ä½ä»£ç å¹³å°çš„JDBC Binderåšæ•°æ®åº“å±‚é¢çš„é›†æˆæˆ–è€…é€šè¿‡ERPç³»ç»Ÿçš„Web Serviceæ¥å£å®Œæˆä¸Šè¿°çš„æ•°æ®äº¤äº’</p>
<h3 id="å¦ç±»æ–¹å¼"><a href="#å¦ç±»æ–¹å¼" class="headerlink" title="å¦ç±»æ–¹å¼:"></a>å¦ç±»æ–¹å¼:</h3><p>ç”¨RPAå®Œæˆä½ä»£ç å¹³å°ä¸ERPç³»ç»Ÿçš„æ•°æ®äº¤äº’. </p>
<ul>
<li>è®©RPAå®šæ—¶åœ¨ERPç³»ç»Ÿä¸­æŸ¥è¯¢æ–°å¢çš„ç‰©æ–™å’Œæ›´æ–°çš„ç‰©æ–™ï¼Œç„¶åå°†è¿™äº›å€¼æ›´æ–°åˆ°ä½ä»£ç å¹³å°ä¸­ã€‚</li>
<li>ä½ä»£ç å¹³å°ä¸­é‡‡è´­å®¡æ‰¹é€šè¿‡çš„æ•°æ®ï¼Œé€šè¿‡ä½ä»£ç å¹³å°æµç¨‹å·¥å…·è§¦å‘RPAæœºå™¨äººï¼Œåœ¨SAPç³»ç»Ÿä¸­åˆ›å»ºæ–°çš„POï¼ˆé‡‡è´­è®¢å•ï¼‰ã€‚</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/13/gymnasium-introduce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/13/gymnasium-introduce/" class="post-title-link" itemprop="url">Gymnasium ä»‹ç»</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-13 15:12:51 / ä¿®æ”¹æ—¶é—´ï¼š15:48:36" itemprop="dateCreated datePublished" datetime="2024-05-13T15:12:51+08:00">2024-05-13</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>5.8k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>11 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å‰é¢ä»‹ç»äº†å¼ºåŒ–å­¦ä¹ çš„ä¾‹å­ï¼Œè§‰å¾—æœ‰å¿…è¦ä»‹ç»gymnasiumç¯å¢ƒã€‚ ä½œä¸ºå¼ºåŒ–å­¦ä¹ æœ€å¸¸ç”¨çš„å·¥å…·ï¼Œgymä¸€ç›´åœ¨ä¸åœåœ°å‡çº§å’ŒæŠ˜è…¾ï¼Œæ¯”è¾ƒå¤§çš„å˜åŒ–å°±æ˜¯2021å¹´æ¥å£ä»gymåº“å˜æˆäº†gymnasiumåº“ã€‚</p>
<h3 id="stepå’Œè§‚å¯Ÿç»“æœ"><a href="#stepå’Œè§‚å¯Ÿç»“æœ" class="headerlink" title="stepå’Œè§‚å¯Ÿç»“æœ"></a>stepå’Œè§‚å¯Ÿç»“æœ</h3><p>æ€»ä½“æ¥è¯´ï¼Œå¯¹äºgymnasiumæˆ‘ä»¬åªéœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼šä¸€ä¸ªæ˜¯åˆå§‹åŒ–ç¯å¢ƒï¼Œå¦ä¸€ä¸ªå°±æ˜¯é€šè¿‡stepå‡½æ•°ä¸åœåœ°ç»™ç¯å¢ƒåšè¾“å…¥ï¼Œç„¶åè§‚å¯Ÿå¯¹åº”çš„ç»“æœã€‚</p>
<p>åˆå§‹åŒ–ç¯å¢ƒåˆ†ä¸ºä¸¤æ­¥ã€‚<br>ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºgymnasiumä¸­æ‰€æ”¯æŒçš„ç¯å¢ƒï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ç»å…¸çš„è®©ä¸€ä¸ªæ†å­ä¸å€’çš„CartPoleç¯å¢ƒï¼š</p>
<pre><code>import gymnasium as gym
env = gym.make(&quot;CartPole-v1&quot;)
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡envçš„resetå‡½æ•°æ¥è¿›è¡Œç¯å¢ƒçš„åˆå§‹åŒ–ï¼š</p>
<pre><code>observation, info = env.reset()
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥å°†observationæ‰“å°å‡ºæ¥ï¼Œå®ƒä¸€ä¸ª4å…ƒç»„ï¼Œ4ä¸ªæ•°å€¼åˆ†åˆ«è¡¨ç¤ºï¼š</p>
<ul>
<li>å°è½¦ä½ç½®</li>
<li>å°è½¦é€Ÿåº¦</li>
<li>æ£çš„å€¾æ–œè§’åº¦</li>
<li>æ£çš„è§’é€Ÿåº¦</li>
</ul>
<p>å¦‚æœè§’åº¦å¤§äº12åº¦ï¼Œæˆ–è€…å°è½¦ä½ç½®è¶…å‡ºäº†2.4ï¼Œå°±æ„å‘³ç€å¤±è´¥äº†ï¼Œç›´æ¥ç»“æŸã€‚</p>
<p>å°è½¦çš„è¾“å…¥å°±æ˜¯ä¸€ä¸ªåŠ›ï¼Œè¦ä¹ˆæ˜¯å‘å·¦çš„åŠ›ï¼Œè¦ä¹ˆæ˜¯å‘å³çš„åŠ›ã€‚0æ˜¯å‘å·¦æ¨å°è½¦ï¼Œ1æ˜¯å‘å³æ¨å°è½¦ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬è®©ä»£ç è·‘èµ·æ¥ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡pipæ¥å®‰è£…gymnasiumçš„åŒ…ï¼š</p>
<pre><code>pip install gymnasium
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"></span><br><span class="line">num_eval_episodes = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">env = gym.make(<span class="string">&quot;CartPole-v1&quot;</span>, render_mode=<span class="string">&quot;rgb_array&quot;</span>)  <span class="comment"># replace with your environment</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(env.action_space)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> episode_num <span class="keyword">in</span> <span class="built_in">range</span>(num_eval_episodes):</span><br><span class="line">    obs, info = env.reset()</span><br><span class="line"></span><br><span class="line">    episode_over = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> episode_over:</span><br><span class="line">        action = env.action_space.sample()  <span class="comment"># replace with actual agent</span></span><br><span class="line">        obs, reward, terminated, truncated, info = env.step(action)</span><br><span class="line"></span><br><span class="line">        episode_over = terminated <span class="keyword">or</span> truncated</span><br><span class="line">env.close()</span><br></pre></td></tr></table></figure>

<p>env.action_spaceè¾“å‡ºæ˜¯Discrete(2)ã€‚ä¹Ÿå°±æ˜¯ä¸¤ä¸ªç¦»æ•£çš„å€¼0å’Œ1ã€‚å‰é¢æˆ‘ä»¬ä»‹ç»äº†ï¼Œè¿™åˆ†åˆ«ä»£è¡¨å‘å·¦å’Œå‘å³æ¨åŠ¨å°è½¦ã€‚</p>
<p>obsè¾“å‡ºçš„4å…ƒç»„ï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿè®²è¿‡äº†ï¼Œåƒè¿™æ ·ï¼š<br>[ 0.0273956 -0.00611216 0.03585979 0.0197368 ]</p>
<p>ä¸‹é¢å°±æ˜¯å…³é”®çš„stepä¸€æ­¥ï¼š</p>
<pre><code>action = env.action_space.sample()  # replace with actual agent
obs, reward, terminated, truncated, info = env.step(action)
</code></pre>
<p>CartPoleçš„è¾“å…¥åªæœ‰0å’Œ1ä¸¤ä¸ªå€¼ã€‚æˆ‘ä»¬é‡‡ç”¨sample()å‡½æ•°åªæ˜¯éšæœºé‡‡ç”¨å·¦å³åŠ¨çš„æ–¹å¼æ¥è¯•å›¾è®©å°è½¦ä¸å€’ã€‚</p>
<p>è¿”å›çš„5å…ƒç»„ï¼Œobså°±æ˜¯ä½ç½®4å…ƒç»„ï¼Œrewardæ˜¯ç”¨äºå¼ºåŒ–å­¦ä¹ çš„å¥–åŠ±ï¼Œåœ¨æœ¬ä¾‹ä¸­åªè¦æ˜¯ä¸æ­»å°±æ˜¯1. terminatedå°±æ˜¯æ˜¯å¦æ¸¸æˆç»“æŸäº†ã€‚<br>Truncatedåœ¨å®˜æ–¹å®šä¹‰ä¸­ç”¨äºå¤„ç†æ¯”å¦‚è¶…æ—¶ç­‰ç‰¹æ®Šç»“æŸçš„æƒ…å†µã€‚<br>truncated, infoå¯¹äºCartPoleæ¥è¯´æ²¡æœ‰ç”¨åˆ°ã€‚</p>
<p>æ­å»ºå¥½äº†gymnasiumç¯å¢ƒä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œç­–ç•¥çš„å‡çº§ä¸è¿­ä»£äº†ã€‚<br>æ¯”å¦‚æˆ‘ä»¬å†™æ­»ä¸€ä¸ªç­–ç•¥ï¼Œå¦‚æœä½ç½®å°äº0åˆ™å‘å³æ¨ï¼Œåä¹‹åˆ™å‘å·¦æ¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">action_pos</span>(<span class="params">obs</span>): </span><br><span class="line">    pos, v, ang, va = obs</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> pos &lt;= <span class="number">0</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> </span><br></pre></td></tr></table></figure>
<p>ç”¨ action_pos(obs) æ›¿æ¢ env.action_space.sample() å³å¯ã€‚</p>
<h3 id="ä¸è€gymçš„ä¸»è¦åŒºåˆ«"><a href="#ä¸è€gymçš„ä¸»è¦åŒºåˆ«" class="headerlink" title="ä¸è€gymçš„ä¸»è¦åŒºåˆ«"></a>ä¸è€gymçš„ä¸»è¦åŒºåˆ«</h3><p>ç›®å‰ç‰ˆæœ¬ä¸ä¹‹å‰gymçš„æœ€ä¸»è¦åŒºåˆ«åœ¨äºstepè¿”å›å€¼ä»åŸæ¥çš„4å…ƒç»„å˜æˆäº†5å…ƒç»„ã€‚<br>åŸæ¥æ˜¯observation, reward, done, infoï¼Œè€Œç°åœ¨doneå˜æˆäº† terminatedå¢åŠ äº†truncatedã€‚</p>
<p>è€ç‰ˆæœ¬çš„ï¼š</p>
<pre><code>status, reward, done, info = env.step(0)
</code></pre>
<p>æ–°ç‰ˆçš„ï¼š</p>
<pre><code>observation, reward, terminated, truncated, info = env.step(0)
</code></pre>
<p>å› è€Œï¼ŒåŸæ¥å¤„ç†doneçš„åœ°æ–¹éœ€è¦æ”¹æˆterminatedæˆ–truncated:</p>
<pre><code>if terminated or truncated:
    something()
</code></pre>
<p>å¦å¤–ï¼Œenv.resetå‡½æ•°ç›®å‰è¿”å›çš„æ˜¯ä¸¤ä¸ªå€¼ï¼Œè€Œä¸æ˜¯åŸæ¥çš„ä¸€ä¸ªå€¼ï¼š</p>
<pre><code>obs,info = env.reset()
</code></pre>
<h3 id="gymnasiumä¸å¼ºåŒ–å­¦ä¹ ç®—æ³•åº“çš„ç»“åˆ"><a href="#gymnasiumä¸å¼ºåŒ–å­¦ä¹ ç®—æ³•åº“çš„ç»“åˆ" class="headerlink" title="gymnasiumä¸å¼ºåŒ–å­¦ä¹ ç®—æ³•åº“çš„ç»“åˆ"></a>gymnasiumä¸å¼ºåŒ–å­¦ä¹ ç®—æ³•åº“çš„ç»“åˆ</h3><p>stable-baselines3ç­‰å¼ºåŒ–å­¦ä¹ åº“å·²ç»å¯¹gymnasiumè¿›è¡Œäº†æ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨stable-baselines3ä¸­ç›´æ¥ä½¿ç”¨gymnasiumçš„ç¯å¢ƒã€‚</p>
<p>å…ˆå®‰è£…åº“ï¼š</p>
<pre><code>pip install gymnasium[atari]
pip install gymnasium[accept-rom-license]
pip install stable_baselines3
</code></pre>
<p>æˆ‘ä»¬ç”¨DQNç®—æ³•æ¥è®­ç»ƒä¹’ä¹“çƒæ¸¸æˆï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> stable_baselines3 <span class="keyword">import</span> DQN</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.dqn <span class="keyword">import</span> CnnPolicy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">game = <span class="string">&#x27;ALE/Pong-v5&#x27;</span></span><br><span class="line"></span><br><span class="line">env = gym.make(game,render_mode=<span class="string">&quot;rgb_array&quot;</span>)</span><br><span class="line"></span><br><span class="line">save_file = <span class="string">&#x27;dqn_&#x27;</span>+game;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(env.action_space)</span><br><span class="line">model = DQN(CnnPolicy, env, verbose=<span class="number">1</span>,exploration_final_eps=<span class="number">0.01</span>,exploration_fraction=<span class="number">0.1</span>,gradient_steps=<span class="number">1</span>,learning_rate=<span class="number">0.0001</span>,buffer_size=<span class="number">10000</span>)</span><br><span class="line">model.set_env(env)</span><br><span class="line">model.learn(total_timesteps=<span class="number">1000000</span>, log_interval=<span class="number">10</span>)</span><br><span class="line">model.save(save_file)</span><br><span class="line"></span><br><span class="line">obs,info = env.reset()</span><br><span class="line"></span><br><span class="line">score = <span class="number">0</span></span><br><span class="line">rewards_sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    action, _states = model.predict(obs, deterministic=<span class="literal">True</span>)</span><br><span class="line">    obs, reward, terminated, truncated, info = env.step(action)</span><br><span class="line">    score = score + <span class="number">1</span></span><br><span class="line">    rewards_sum += reward</span><br><span class="line">    <span class="keyword">if</span> reward &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;win!!!&#x27;</span>, reward)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> terminated <span class="keyword">or</span> truncated:</span><br><span class="line">        <span class="comment"># obs = env.reset()</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;finished&#x27;</span>, score)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;reward sum=&#x27;</span>, rewards_sum)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç æˆ‘ä»¬è¿˜å¯ä»¥åšä¸¤å¤„æ”¹è¿›ï¼š</p>
<p>å¦‚æœå­˜åœ¨save_fileï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ è½½æ¨¡å‹ï¼Œåœ¨åŸæœ‰æ¨¡å‹ä¸Šç»§ç»­è®­ç»ƒã€‚<br>æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªæµ‹è¯•æ¨¡å¼ï¼Œè§‚çœ‹è®­ç»ƒåæ¨¡å‹æ‰“æ¸¸æˆçš„çœŸå®æ•ˆæœã€‚</p>
<p>æˆ‘ä»¬è®©PPOç®—æ³•æ¥ç©ä¹’ä¹“çƒæ¸¸æˆäº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> stable_baselines3 <span class="keyword">import</span> PPO</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.dqn <span class="keyword">import</span> MlpPolicy</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.dqn <span class="keyword">import</span> CnnPolicy</span><br><span class="line"></span><br><span class="line">game = <span class="string">&#x27;ALE/Pong-v5&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#eval = True</span></span><br><span class="line"><span class="built_in">eval</span> = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">cont = <span class="literal">True</span></span><br><span class="line"><span class="comment">#cont = False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (time.strftime(<span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, time.localtime()))</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">start_date = datetime.now()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">eval</span>:</span><br><span class="line">    env = gym.make(game,render_mode=<span class="string">&quot;human&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    env = gym.make(game,render_mode=<span class="string">&quot;rgb_array&quot;</span>)</span><br><span class="line"></span><br><span class="line">save_file = <span class="string">&#x27;./dqn_&#x27;</span>+game;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(env.action_space)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">eval</span>:</span><br><span class="line">    model = PPO.load(save_file)</span><br><span class="line">    model.set_env(env) </span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> cont:</span><br><span class="line">        model = PPO.load(save_file)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        model = PPO(<span class="string">&quot;MlpPolicy&quot;</span>, env, verbose=<span class="number">1</span>,learning_rate=<span class="number">2.5e-4</span>,clip_range=<span class="number">0.1</span>,vf_coef=<span class="number">0.5</span>,ent_coef=<span class="number">0.01</span>,n_steps=<span class="number">128</span>)    </span><br><span class="line">    model.set_env(env)</span><br><span class="line">    model.learn(total_timesteps=<span class="number">1000000</span>, log_interval=<span class="number">10</span>)</span><br><span class="line">    model.save(save_file)</span><br><span class="line"></span><br><span class="line">obs,info = env.reset()</span><br><span class="line"></span><br><span class="line">score = <span class="number">0</span></span><br><span class="line">rewards_sum = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    action, _states = model.predict(obs)</span><br><span class="line">    obs, reward, terminated, truncated, info = env.step(action)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">eval</span>:</span><br><span class="line">        env.render()</span><br><span class="line"></span><br><span class="line">    score = score + <span class="number">1</span></span><br><span class="line">    rewards_sum += reward</span><br><span class="line">    <span class="keyword">if</span> reward &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;win!!!&#x27;</span>, reward)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> terminated <span class="keyword">or</span> truncated:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;finished&#x27;</span>, score)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;reward sum=&#x27;</span>, rewards_sum)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">duration = time.time() - start_time</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;duration=&#x27;</span>, duration)</span><br><span class="line"></span><br><span class="line">time_cost = datetime.now() - start_date</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;time cost=&#x27;</span>, time_cost)</span><br></pre></td></tr></table></figure>
<h3 id="è§†é¢‘è¾“å‡º-ä»Monitoråˆ°RecordVideo"><a href="#è§†é¢‘è¾“å‡º-ä»Monitoråˆ°RecordVideo" class="headerlink" title="è§†é¢‘è¾“å‡º - ä»Monitoråˆ°RecordVideo"></a>è§†é¢‘è¾“å‡º - ä»Monitoråˆ°RecordVideo</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›æŠŠæ¸¸æˆçš„è§†é¢‘è¾“å‡ºå‡ºæ¥ï¼Œgymæ›¾ç»ä½¿ç”¨Monitoræ¥å®ç°ã€‚ç°åœ¨gymnasiumåˆ™æ”¹ç”¨RecordVideoæ¥å®ç°ã€‚</p>
<p>ä½¿ç”¨RecordVideoéœ€è¦å…ˆå®‰è£…moviepyåº“ï¼š</p>
<pre><code>pip install moviepy
</code></pre>
<p>ç„¶åä»gymnasium.wrappersåŒ…ä¸­å¼•ç”¨RecordVideoï¼š</p>
<pre><code>from gymnasium.wrappers import RecordVideo
</code></pre>
<p>humanæ¨¡å¼æ˜¯æ²¡æœ‰åŠæ³•è¾“å‡ºè§†é¢‘çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠhumanæ¨¡å¼æ”¹æˆrgb_arrayæ¨¡å¼ã€‚</p>
<pre><code>env = gym.make(&quot;CartPole-v1&quot;, render_mode=&quot;rgb_array&quot;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">from</span> gymnasium.wrappers <span class="keyword">import</span> RecordEpisodeStatistics, RecordVideo</span><br><span class="line"></span><br><span class="line">training_period = <span class="number">250</span>  <span class="comment"># record the agent&#x27;s episode every 250</span></span><br><span class="line">num_training_episodes = <span class="number">10_000</span>  <span class="comment"># total number of training episodes</span></span><br><span class="line"></span><br><span class="line">env = gym.make(<span class="string">&quot;CartPole-v1&quot;</span>, render_mode=<span class="string">&quot;rgb_array&quot;</span>)  <span class="comment"># replace with your environment</span></span><br><span class="line">env = RecordVideo(env, video_folder=<span class="string">&quot;cartpole-agent&quot;</span>, name_prefix=<span class="string">&quot;training&quot;</span>,</span><br><span class="line">                  episode_trigger=<span class="keyword">lambda</span> x: x % training_period == <span class="number">0</span>)</span><br><span class="line">env = RecordEpisodeStatistics(env)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> episode_num <span class="keyword">in</span> <span class="built_in">range</span>(num_training_episodes):</span><br><span class="line">    obs, info = env.reset()</span><br><span class="line"></span><br><span class="line">    episode_over = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> episode_over:</span><br><span class="line">        action = env.action_space.sample()  <span class="comment"># replace with actual agent</span></span><br><span class="line">        obs, reward, terminated, truncated, info = env.step(action)</span><br><span class="line"></span><br><span class="line">        episode_over = terminated <span class="keyword">or</span> truncated</span><br><span class="line"></span><br><span class="line">    logging.info(<span class="string">f&quot;episode-<span class="subst">&#123;episode_num&#125;</span>&quot;</span>, info[<span class="string">&quot;episode&quot;</span>])</span><br><span class="line">env.close()</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="https://gymnasium.farama.org/">https://gymnasium.farama.org/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/05/reinforce-learing-game-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/05/reinforce-learing-game-2/" class="post-title-link" itemprop="url">é€šè¿‡æ¸¸æˆæ·±å…¥äº†è§£å¼ºåŒ–å­¦ä¹  ä¸‹ç¯‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-05 16:22:58 / ä¿®æ”¹æ—¶é—´ï¼š20:33:42" itemprop="dateCreated datePublished" datetime="2024-05-05T16:22:58+08:00">2024-05-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>19 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å›é¡¾ä¸€ä¸‹ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œå¼ºåŒ–å­¦ä¹ ä¸­åŸºäºä»·å€¼å’ŒåŸºäºç­–ç•¥çš„ç®—æ³•ã€‚</p>
<h3 id="åŸºäºä»·å€¼çš„ç®—æ³•"><a href="#åŸºäºä»·å€¼çš„ç®—æ³•" class="headerlink" title="åŸºäºä»·å€¼çš„ç®—æ³•"></a>åŸºäºä»·å€¼çš„ç®—æ³•</h3><p><img src="/../asset_reinforcelearninggame2/01.png"></p>
<p>ä¸“æ³¨äºä¼˜åŒ–ä»·å€¼å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼°è®¡çŠ¶æ€-åŠ¨ä½œå¯¹ï¼ˆQ å€¼ï¼‰çš„æœªæ¥å¥–åŠ±ã€‚è¿™ç§æ–¹æ³•åŒ…æ‹¬ Q å­¦ä¹ ç­‰æ–¹æ³•ï¼Œå…¶ç›®æ ‡æ˜¯é€šè¿‡å­¦ä¹ æ¯ä¸ªçŠ¶æ€ä¸‹æ¯ä¸ªåŠ¨ä½œçš„ä»·å€¼æ¥æœ€å¤§åŒ–é¢„æœŸå›æŠ¥ã€‚</p>
<h3 id="åŸºäºç­–ç•¥çš„ç®—æ³•"><a href="#åŸºäºç­–ç•¥çš„ç®—æ³•" class="headerlink" title="åŸºäºç­–ç•¥çš„ç®—æ³•"></a>åŸºäºç­–ç•¥çš„ç®—æ³•</h3><p><img src="/../asset_reinforcelearninggame2/02.png"></p>
<p>ç›´æ¥å­¦ä¹ å†³å®šä»£ç†è¡Œä¸ºçš„ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ä»·å€¼å‡½æ•°ã€‚ ï¼ˆé€šå¸¸å°† Î¸ å»ºæ¨¡ä¸ºç¥ç»ç½‘ç»œã€‚ï¼‰</p>
<p>è¿™äº›æ–¹æ³•é€šè¿‡è°ƒæ•´å‚æ•°æ¥ä¼˜åŒ–ç­–ç•¥ï¼Œä»¥æœ€å¤§åŒ–é¢„æœŸå›æŠ¥ã€‚ç¤ºä¾‹åŒ…æ‹¬ REINFORCEï¼Œå…¶ä¸­ç­–ç•¥æœç€æé«˜æ€§èƒ½çš„æ–¹å‘æ›´æ–°ã€‚</p>
<h3 id="Advantage-Actor-Critic-A2C"><a href="#Advantage-Actor-Critic-A2C" class="headerlink" title="Advantage Actor Critic (A2C)"></a>Advantage Actor Critic (A2C)</h3><p>è™½ç„¶ REINFORCE æ–¹æ³•å…·æœ‰ç›´æ¥æ›´æ–°ç­–ç•¥è€Œæ— éœ€è®¡ç®—æ‰€æœ‰ Q å€¼çš„ä¼˜ç‚¹ï¼ˆå¦‚åŸºäºå€¼çš„ç®—æ³•æ‰€è¦æ±‚çš„é‚£æ ·ï¼‰ï¼Œä½†å®ƒå¼•å…¥äº†æ–°é—®é¢˜ï¼š</p>
<ul>
<li>æ ·æœ¬æ•ˆç‡ä½ä¸‹</li>
<li>æ¢¯åº¦çš„é«˜æ–¹å·®</li>
</ul>
<p>åœ¨ REINFORCE ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨trajectory çš„è¿”å›å€¼æ¥å¼•å¯¼æˆ‘ä»¬çš„æ¢¯åº¦ã€‚ç„¶è€Œï¼Œåœ¨éšæœºç¯å¢ƒä¸­ï¼Œè¿™äº›è¿”å›å€¼å¯èƒ½å˜å¾—éå¸¸å¤§æˆ–éå¸¸å°ï¼Œå¯¼è‡´æ¢¯åº¦ä¸ç¨³å®šã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/04.webp"></p>
<p>ä¸ºäº†å‡å°‘REINFORCEçš„æ–¹å·®ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯ç”¨ä¼˜åŠ¿å‡½æ•°A(s,a)ä»£æ›¿R(Ï„)ã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/05.webp"></p>
<p>ä¼˜åŠ¿å‡½æ•°æ˜¯é€šè¿‡ä» V å‡½æ•°ä¸­å‡å» Q å‡½æ•°æ¥è®¡ç®—çš„ã€‚å®ƒè¯„ä¼°å¦‚æœæˆ‘ä»¬åœ¨ç»™å®šçŠ¶æ€ä¸‹é‡‡å–ç‰¹å®šè¡ŒåŠ¨ï¼Œä¸è¯¥çŠ¶æ€ä¸‹æ”¶åˆ°çš„å¹³å‡å¥–åŠ±ç›¸æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¤šå°‘é¢å¤–å¥–åŠ±ã€‚</p>
<p>ä½†ç°åœ¨é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•è·å¾—Qå’ŒVçš„å€¼å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ä»¥ TD è¯¯å·®çš„å½¢å¼é‡æ–°è¡¨è¿°è¿™ä¸ªæ–¹ç¨‹ï¼Œå°† Q å‡½æ•°è¡¨ç¤ºä¸ºå³æ—¶å¥–åŠ±ä¸ä¸‹ä¸€ä¸ªçŠ¶æ€å€¼çš„æ€»å’Œã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/06.webp"><br>Rï¼šç«‹å³å¥–åŠ±ï¼ŒVï¼šçŠ¶æ€å€¼</p>
<p>ç°åœ¨ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼ˆcriticï¼‰æ¥é¢„æµ‹ä»·å€¼å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è·å¾—æ‰€é‡‡å–è¡ŒåŠ¨çš„ä¼˜åŠ¿ã€‚</p>
<h3 id="Actor-Critic"><a href="#Actor-Critic" class="headerlink" title="Actor &amp; Critic"></a>Actor &amp; Critic</h3><p><img src="/../asset_reinforcelearninggame2/07.webp"></p>
<p>A2C ç®—æ³•ç”±ä¸¤ä¸ªæ¨¡å‹ç»„æˆï¼šActor å’Œ Criticã€‚ Actor è´Ÿè´£ç¡®å®šåŠ¨ä½œ Ï€(a|s)ï¼Œè€Œ Critic åˆ™è¯„ä¼°çŠ¶æ€å€¼ V(s)ã€‚</p>
<ul>
<li>Criticï¼šé€šè¿‡è¯„ä¼°çŠ¶æ€å€¼æ¥è®¡ç®—ä¼˜åŠ¿ ( &#x3D; Return â€” V(s_t))ã€‚</li>
<li>Actorï¼šåŠŸèƒ½ç±»ä¼¼äºREINFORCEç®—æ³•ä¸­çš„ä»£ç†ï¼Œè´Ÿè´£æ ¹æ®æä¾›çš„çŠ¶æ€é¢„æµ‹åŠ¨ä½œã€‚</li>
</ul>
<p>å°½ç®¡ Actor å’Œ Critic æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¨¡å‹ï¼Œä½†åœ¨å®è·µä¸­ï¼Œå®ƒä»¬é€šå¸¸å…±äº«ç›¸åŒçš„ç½‘ç»œæ¶æ„ï¼Œåªæœ‰æœ€åä¸€å±‚äº§ç”Ÿä¸åŒçš„è¾“å‡º</p>
<h3 id="A2Cä¼˜åŒ–"><a href="#A2Cä¼˜åŒ–" class="headerlink" title="A2Cä¼˜åŒ–"></a>A2Cä¼˜åŒ–</h3><p><img src="/../asset_reinforcelearninggame2/08.webp"></p>
<ul>
<li>Nï¼šæœªæ¥å¥–åŠ±çš„æ­¥æ•°</li>
<li>Rtï¼š&#x3D; rt + Î³<em>rt_1 + â€¦ + Î³^(N-1)</em> rt_N-1 + VÏ‰(s_t+N)</li>
<li>Î¸: actor</li>
<li>Ï‰: critic</li>
</ul>
<p>å¯¹äº Actorï¼šæˆ‘ä»¬æ ¹æ®æŸå¤±å‡½æ•° J &#x3D; logÏ€(a|s) * A(s, a) æ›´æ–°ç½‘ç»œï¼Œå®ç°ä¸ REINFORCE ç›¸åŒã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/09.webp"></p>
<p>å¯¹äº Criticï¼šæˆ‘ä»¬å¯ä»¥åœ¨ Rt å’Œ VÏ‰(St) ä¹‹é—´åº”ç”¨ MSE æ¥æ”¹è¿›æˆ‘ä»¬çš„ Criticã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/10.webp"></p>
<p>å‡½æ•°VÏ‰(s)è¡¨ç¤ºä»çŠ¶æ€så¼€å§‹çš„æœŸæœ›å›æŠ¥ã€‚ç”±äºå›æŠ¥ Rtâ€‹æä¾›äº†å¯¹å¤„äºè¯¥çŠ¶æ€çš„å¥½åç¨‹åº¦çš„ç›´æ¥è¡¡é‡ï¼Œå› æ­¤criticçš„ä»»åŠ¡æ˜¯ä½¿ç”¨ä»·å€¼å‡½æ•° VÏ‰(s) å°½å¯èƒ½æ¥è¿‘åœ°é¢„æµ‹è¿™äº›å›æŠ¥ã€‚</p>
<h3 id="A2Cå®æ–½"><a href="#A2Cå®æ–½" class="headerlink" title="A2Cå®æ–½"></a>A2Cå®æ–½</h3><p>åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ç©è½¦æ†æ¸¸æˆï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¨åœ¨è§£å†³è½¦æ†é—®é¢˜çš„åŸºæœ¬ç¯å¢ƒã€‚æ‚¨è¿˜å¯ä»¥å°è¯•å…¶ä»–ä¸€äº›ç»å…¸çš„æ§åˆ¶ç¯å¢ƒï¼Œä¾‹å¦‚ Pendulum å’Œ Acrobotã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/11.webp"></p>
<p><img src="/../asset_reinforcelearninggame2/12.webp"></p>
<p>åœ¨å¼€å§‹ä¹‹å‰ä¸€å®šè¦å…ˆé€šè¯»<a target="_blank" rel="noopener" href="https://gymnasium.farama.org/environments/classic_control/cart_pole/">æ–‡æ¡£</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ema_pytorch <span class="keyword">import</span> EMA</span><br><span class="line"><span class="keyword">from</span> torch.distributions.categorical <span class="keyword">import</span> Categorical</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">env_id</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapped_env</span>():</span><br><span class="line">        env = gym.make(env_id, render_mode=<span class="string">&#x27;rgb_array&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> env</span><br><span class="line">    <span class="keyword">return</span> wrapped_env</span><br><span class="line"></span><br><span class="line">env_id = <span class="string">&#x27;CartPole-v1&#x27;</span></span><br><span class="line">env = make_env(env_id)()</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_reinforcelearninggame2/13.webp"><br>è½¦æ†çš„åŠ¨ä½œå’Œè§‚å¯Ÿç©ºé—´</p>
<p>åŠ¨ä½œç©ºé—´å¾ˆç®€å•ï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†å°è½¦æ¨åˆ°å·¦è¾¹æˆ–å³è¾¹ã€‚åŒæ—¶ï¼Œè§‚å¯Ÿç©ºé—´åŒ…å«å››ä¸ªè¿ç»­å€¼ï¼Œåˆ†åˆ«ä»£è¡¨å°è½¦ä½ç½®ã€å°è½¦é€Ÿåº¦ã€æè§’å’Œæè§’é€Ÿåº¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Actor</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obs_dim, n_actions</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model = nn.Sequential(</span><br><span class="line">            nn.Linear(obs_dim, <span class="number">64</span>),</span><br><span class="line">            nn.Tanh(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, <span class="number">64</span>),</span><br><span class="line">            nn.Tanh(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, n_actions)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        logits = self.model(x)</span><br><span class="line">        <span class="keyword">return</span> Categorical(logits = logits)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Critic</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obs_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model = nn.Sequential(</span><br><span class="line">            nn.Linear(obs_dim, <span class="number">64</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, <span class="number">64</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, <span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.model(x)</span><br></pre></td></tr></table></figure>
<p>åœ¨A2Cä¸­ï¼Œæˆ‘ä»¬å°†æœ‰ä¸¤ä¸ªæ¨¡å‹ï¼ŒActorå’ŒCriticã€‚ Actor è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒæ¥ç¡®å®šé‡‡å–å“ªä¸ªæ“ä½œï¼Œè€Œ Critic åˆ™æä¾›çŠ¶æ€å€¼ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒActor å’Œ Critic å°†é›†æˆåˆ°ä¸€ä¸ªæ¨¡å‹ä¸­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gamma = <span class="number">0.99</span></span><br><span class="line">episodes = <span class="number">200</span></span><br><span class="line">env = make_env(env_id)()</span><br><span class="line">device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line"></span><br><span class="line">actor = Actor(<span class="number">4</span>, <span class="number">2</span>).to(device)</span><br><span class="line">critic = Critic(obs_shape[<span class="number">0</span>]).to(device)</span><br><span class="line">actor_optim = torch.optim.Adam(actor.parameters(), lr=<span class="number">1e-3</span>)</span><br><span class="line">critic_optim = torch.optim.Adam(critic.parameters(), lr=<span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> episode <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>, episodes + <span class="number">1</span>), desc=<span class="string">&quot;A2C training progress: ~~&quot;</span>):          </span><br><span class="line">    done = <span class="literal">False</span></span><br><span class="line">    obs, _ = env.reset()</span><br><span class="line">    log_probs = []</span><br><span class="line">    values = []</span><br><span class="line">    rewards = []</span><br><span class="line">    frame = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">        obs = torch.tensor(obs).to(device)</span><br><span class="line">        dist = actor(obs)</span><br><span class="line">        value = critic(obs)</span><br><span class="line">        action = dist.sample()</span><br><span class="line">        log_prob = dist.log_prob(action)</span><br><span class="line">        next_obs, reward, done, _, info = env.step(action.detach().cpu().numpy())</span><br><span class="line">      </span><br><span class="line">        log_probs.append(log_prob)</span><br><span class="line">        values.append(value)</span><br><span class="line">        rewards.append(reward)</span><br><span class="line">        obs = next_obs</span><br><span class="line">        </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> frame &gt;= <span class="number">300</span>:</span><br><span class="line">            <span class="comment"># Give some constraints to the length of the episode</span></span><br><span class="line">            <span class="comment"># otherwise, it will become too large.</span></span><br><span class="line">            <span class="keyword">break</span>   </span><br><span class="line">    R = <span class="number">0</span></span><br><span class="line">    returns = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> rewards[::-<span class="number">1</span>]:</span><br><span class="line">        R = r + gamma * R</span><br><span class="line">        returns.insert(<span class="number">0</span>, R)</span><br><span class="line">        </span><br><span class="line">    returns = torch.tensor(returns).to(device)</span><br><span class="line">    values = torch.stack(values).to(device)</span><br><span class="line">    advantage = returns - values</span><br><span class="line">    </span><br><span class="line">    critic_loss = advantage.<span class="built_in">pow</span>(<span class="number">2</span>).mean()</span><br><span class="line">    critic_optim.zero_grad()</span><br><span class="line">    critic_loss.backward()</span><br><span class="line">    critic_optim.step() <span class="comment"># update critic</span></span><br><span class="line">    </span><br><span class="line">    actor_loss = (-torch.stack(log_probs)*advantage.detach()).mean()</span><br><span class="line">    actor_optim.zero_grad()</span><br><span class="line">    actor_loss.backward()</span><br><span class="line">    actor_optim.step() <span class="comment"># update actor</span></span><br></pre></td></tr></table></figure>

<p>è®­ç»ƒè¿‡ç¨‹ä¸REINFORCEç®—æ³•åŸºæœ¬ç›¸åŒï¼›å”¯ä¸€çš„åŒºåˆ«æ˜¯å¯¹æ•°æ¦‚ç‡ç°åœ¨ä¹˜ä»¥ä¼˜åŠ¿è€Œä¸æ˜¯å›æŠ¥ã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/14.webp"></p>
<h3 id="è½¦æ†ç»“æœ"><a href="#è½¦æ†ç»“æœ" class="headerlink" title="è½¦æ†ç»“æœ"></a>è½¦æ†ç»“æœ</h3><p><img src="/../asset_reinforcelearninggame2/14.gif"></p>
<h3 id="åœ¨çº¿ç­–ç•¥-ç¦»çº¿ç­–ç•¥æ¨¡å‹"><a href="#åœ¨çº¿ç­–ç•¥-ç¦»çº¿ç­–ç•¥æ¨¡å‹" class="headerlink" title="åœ¨çº¿ç­–ç•¥ &amp; ç¦»çº¿ç­–ç•¥æ¨¡å‹"></a>åœ¨çº¿ç­–ç•¥ &amp; ç¦»çº¿ç­–ç•¥æ¨¡å‹</h3><p><img src="/../asset_reinforcelearninggame2/15.webp"></p>
<h4 id="åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-REINFORCEï¼ŒAC2ï¼‰"><a href="#åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-REINFORCEï¼ŒAC2ï¼‰" class="headerlink" title="åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ REINFORCEï¼ŒAC2ï¼‰"></a>åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ REINFORCEï¼ŒAC2ï¼‰</h4><ul>
<li>åŸºäºå½“å‰ç­–ç•¥ï¼ŒåŒç­–ç•¥æ¨¡å‹é€šè¿‡ä¸ç¯å¢ƒäº¤äº’æ¥æ”¶é›†æ•°æ®ã€‚æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦ç”±æ›´æ–°çš„ç­–ç•¥ç”Ÿæˆçš„æ–°æ•°æ®ã€‚</li>
<li>æ ¹æ®æ”¶é›†çš„æ•°æ®æ‰§è¡Œæ›´æ–°ã€‚è¯¥æ¨¡å‹ç›´æ¥ä»å…¶è‡ªèº«ç­–ç•¥ç”Ÿæˆçš„æ•°æ®ä¸­å­¦ä¹ ã€‚</li>
</ul>
<h4 id="ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-DQNï¼‰"><a href="#ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-DQNï¼‰" class="headerlink" title="ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ DQNï¼‰"></a>ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ DQNï¼‰</h4><ul>
<li><p>ç¦»çº¿ç­–ç•¥æ¨¡å‹å¯ä»¥ä»ä»»ä½•æ¥æºæ”¶é›†æ•°æ®ï¼ŒåŒ…æ‹¬è¿‡å»çš„ç»éªŒæˆ–ä¸åŒçš„ç­–ç•¥ã€‚</p>
</li>
<li><p>è¿™äº›æ¨¡å‹ä»æ”¶é›†åˆ°çš„æ•°æ®ä¸­å­¦ä¹ ï¼Œæ— è®ºè¿™äº›æ•°æ®æ˜¯ç”±å“ªç§ç­–ç•¥äº§ç”Ÿï¼Œæˆ–è€…æºè‡ªä½•å¤„ã€‚</p>
</li>
</ul>
<h3 id="è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–-PPO"><a href="#è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–-PPO" class="headerlink" title="è¿‘ç«¯ç­–ç•¥ä¼˜åŒ– (PPO)"></a>è¿‘ç«¯ç­–ç•¥ä¼˜åŒ– (PPO)</h3><p>åœ¨A2Céƒ¨åˆ†ï¼Œæˆ‘ä»¬é€šè¿‡ä»Vå‡½æ•°ä¸­å‡å»Qå‡½æ•°æ¥è§£å†³æ¢¯åº¦é«˜æ–¹å·®çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œå¦ä¸€ä¸ªæœ‰å¾…è§£å†³çš„æŒ‘æˆ˜æ˜¯æ ·æœ¬æ•ˆç‡ä½ä¸‹ã€‚</p>
<p>REINFORCE å’Œ AC2 ç­‰åŒç­–ç•¥æ¨¡å‹ä¸­çš„æ ·æœ¬æ•ˆç‡ä½ä¸‹æºäºéœ€è¦æ ¹æ®å½“å‰ç­–ç•¥ Ï€_Î¸ æ”¶é›†æ•°æ®ã€‚æ›´æ–°æ¨¡å‹å‚æ•° Î¸ ä¼šå¯¼è‡´ç­–ç•¥å‘ç”Ÿå˜åŒ–ï¼Œè¿™éœ€è¦æ”¶é›†æ–°çš„trajectoriesã€‚</p>
<p>åœ¨ä¹‹å‰çš„å®éªŒä¸­ï¼Œtrajectoriesçš„æœ€å¤§é•¿åº¦ä¸º300ã€‚è¿™æ„å‘³ç€æ¯æ¬¡æ›´æ–°å‚æ•°æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ©ç”¨300ä¸ªæ•°æ®ç‚¹ï¼Œè¿™ä¸æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ•°æ®ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>PPO ä¿®æ”¹äº†ä¸¥æ ¼çš„åœ¨çº¿ç­–ç•¥è§„å®šï¼Œä»¥å…è®¸åœ¨æŸäº›æ¡ä»¶ä¸‹ä½¿ç”¨ç¦»çº¿ç­–ç•¥æ•°æ®ã€‚é€šè¿‡å°†é‡è¦æ€§é‡‡æ ·åº”ç”¨äºæˆ‘ä»¬çš„ç­–ç•¥æ¢¯åº¦ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä»¥ä¸‹ç»“æœï¼š<br><img src="/../asset_reinforcelearninggame2/16.webp"></p>
<p><img src="/../asset_reinforcelearninggame2/17.webp"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®ä¸å†ä»å½“å‰ç­–ç•¥ Ï€_Î¸ æ”¶é›†ï¼Œè€Œæ˜¯ä»è¡¨ç¤ºä¸º Ï€_bar çš„ä¸åŒç­–ç•¥æ”¶é›†ã€‚è¿™ç§è°ƒæ•´å…è®¸æˆ‘ä»¬åˆ©ç”¨ä»ä¸åŒç­–ç•¥é‡‡æ ·çš„æ•°æ®å¯¹åŸå§‹ç­–ç•¥ Ï€_Î¸ æ‰§è¡Œå¤šæ¬¡æ›´æ–°ã€‚</p>
<h3 id="Clipped-Surrogate-Objective-Function-ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰"><a href="#Clipped-Surrogate-Objective-Function-ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰" class="headerlink" title="Clipped Surrogate Objective Function ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰"></a>Clipped Surrogate Objective Function ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰</h3><p><img src="/../asset_reinforcelearninggame2/18.webp"></p>
<p>å¯¹äºå¤§å¤šæ•°ä¼˜åŒ–æ–¹æ³•æ¥è¯´ï¼Œä½¿ç”¨è¾ƒå°çš„æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹çš„æƒé‡é€šå¸¸ä¼šå¸¦æ¥æ›´å¥½ã€æ›´ç¨³å®šçš„ç»“æœã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨ç­–ç•¥æ¢¯åº¦æ–¹æ³•ä¸­ï¼Œæ¢¯åº¦log(Ï€_Î¸)å¯ä»¥å¾ˆå¤§ä¹Ÿå¯ä»¥å¾ˆå°ï¼›å› æ­¤ï¼Œä¸ºäº†ä½¿è®­ç»ƒæ›´åŠ ç¨³å®šï¼Œå¿…é¡»é™åˆ¶æ¢¯åº¦ã€‚</p>
<p>PPO é€šè¿‡è£å‰ª [1âˆ’Îµ, 1+Îµ] èŒƒå›´ä¹‹å¤–çš„æ¢¯åº¦æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹è¡¨ä¸­è¿›ä¸€æ­¥è®¨è®ºè¿™ä¸ªé—®é¢˜~~</p>
<p><img src="/../asset_reinforcelearninggame2/19.webp"><br><img src="/../asset_reinforcelearninggame2/20.webp"></p>
<h4 id="Case-1-2"><a href="#Case-1-2" class="headerlink" title="Case 1, 2:"></a>Case 1, 2:</h4><p>æ¯”ç‡ pt åœ¨ [1âˆ’Îµ, 1+Îµ] èŒƒå›´å†…ï¼Œå› æ­¤æˆ‘ä»¬å¯¹æ¢¯åº¦ä¸åšä»»ä½•æ“ä½œå¹¶è¿”å› ptâ€‹(Î¸)Atâ€‹ã€‚</p>
<h4 id="Case-3ï¼Œ6"><a href="#Case-3ï¼Œ6" class="headerlink" title="Case 3ï¼Œ6:"></a>Case 3ï¼Œ6:</h4><p>ç”±äº pğ‘¡ &lt; 1âˆ’ğœ–ï¼ˆæƒ…å†µ 3ï¼‰ï¼Œè¿™è¡¨æ˜æ–°ç­–ç•¥ğœ‹ğœƒâ€‹é‡‡å–è¡ŒåŠ¨ğ‘_ğ‘¡çš„æ¦‚ç‡å°äºæ—§ç­–ç•¥ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°ä¼˜åŠ¿æ˜¯æ­£çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å¢åŠ  Ï€Î¸â€‹çš„å€¼ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦å‰ªè£ã€‚</p>
<h4 id="Case-4ï¼Œ5"><a href="#Case-4ï¼Œ5" class="headerlink" title="Case 4ï¼Œ5:"></a>Case 4ï¼Œ5:</h4><p>ä»¥æƒ…å†µ 4 ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¦‚ç‡ Ï€Î¸â€‹ å°äº ğœ‹oldâ€‹ï¼ˆå› ä¸º pğ‘¡&lt;1âˆ’ğœ–ï¼‰ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°ä¼˜åŠ¿ä¸ºè´Ÿï¼Œè¿™å°†å€¾å‘äºè¿›ä¸€æ­¥é™ä½ ğœ‹ğœƒ ï¼Œè¿™å¯èƒ½ä¼šä½¿è®­ç»ƒä¸ç¨³å®šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ¢¯åº¦è®¾ç½®ä¸º 0 ä»¥ç¡®ä¿ç­–ç•¥ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>è¿™å°±æ˜¯PPOçš„å…¨éƒ¨å†…å®¹ã€‚</p>
<h3 id="èµ›è½¦å®æ–½"><a href="#èµ›è½¦å®æ–½" class="headerlink" title="èµ›è½¦å®æ–½"></a>èµ›è½¦å®æ–½</h3><p>å®Œæ•´çš„å®ç°å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a target="_blank" rel="noopener" href="https://github.com/Yukino1010/ReinforcementModels.git">é“¾æ¥</a></p>
<p><img src="/../asset_reinforcelearninggame2/21.webp"></p>
<p>åœ¨æˆ‘ä»¬çš„ç¬¬äºŒä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Box2D ç¯å¢ƒæ¥ç©èµ›è½¦æ¸¸æˆã€‚è§„åˆ™å¾ˆç®€å•ï¼šæ¯æ¬¡è®¿é—®ä¸€ä¸ªè½¨é“å—æˆ‘ä»¬éƒ½ä¼šå¾—åˆ°1000åˆ†ï¼›ç„¶è€Œï¼Œæ¯å¸§æˆ‘ä»¬éƒ½ä¼šæŸå¤± 0.1 åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å®Œæˆäº† 732 å¸§ï¼Œæ‚¨çš„å¥–åŠ±å°†ä¸º 1000â€“0.1*732 &#x3D; 926.8 ç§¯åˆ†ã€‚ ï¼ˆæ›´å¤šè¯¦æƒ…è¯·å‚è€ƒè¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://arc.net/l/quote/jbfidurc">é“¾æ¥</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import ...</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">env_id</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapped_env</span>():</span><br><span class="line">        env = gym.make(env_id, render_mode=<span class="string">&#x27;rgb_array&#x27;</span>, continuous=<span class="literal">False</span>)</span><br><span class="line">        env = MaxAndSkipEnv(env, skip=<span class="number">4</span>)</span><br><span class="line">        env = ResizeObservation(env, <span class="number">84</span>)</span><br><span class="line">        env = GrayScaleObservation(env)</span><br><span class="line">        env = FrameStack(env, <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> env</span><br><span class="line">    <span class="keyword">return</span> wrapped_env</span><br><span class="line"></span><br><span class="line">env_id = <span class="string">&quot;CarRacing-v2&quot;</span></span><br><span class="line">num_envs = <span class="number">4</span> <span class="comment"># use four parallel env to collect data</span></span><br><span class="line">envs = DummyVecEnv([make_env(env_id) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_envs)])</span><br></pre></td></tr></table></figure>

<p>åœ¨èµ›è½¦æ¸¸æˆä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸åŒç±»å‹çš„åŠ¨ä½œç©ºé—´ï¼Œç¦»æ•£çš„æˆ–è¿ç»­çš„ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¦»æ•£åŠ¨ä½œç©ºé—´ï¼Œå…¶ä¸­åŒ…å«äº”ä¸ªä¸åŒçš„åŠ¨ä½œã€‚</p>
<ul>
<li>0ï¼šä»€ä¹ˆä¹Ÿä¸åš</li>
<li>1ï¼šå·¦è½¬</li>
<li>2ï¼šå³è½¬</li>
<li>3ï¼šåŠ æ²¹é—¨</li>
<li>4ï¼šåˆ¹è½¦</li>
</ul>
<p>è§‚å¯Ÿç©ºé—´æ˜¯96x96 RGBå›¾åƒã€‚è¿™æ¬¡ï¼Œæˆ‘å°†ä½¿ç”¨ä¸€äº›<a target="_blank" rel="noopener" href="https://gymnasium.farama.org/api/wrappers/observation_wrappers/">ENV wrappers</a>å°†å…¶è½¬æ¢ä¸º84x84çš„ç°åº¦å›¾åƒï¼Œè¿™æ›´é€‚åˆæ¨¡å‹è®­ç»ƒã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ActorCritic</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_inputs, num_actions</span>):</span><br><span class="line">        <span class="built_in">super</span>(ActorCritic, self).__init__()</span><br><span class="line">        <span class="comment"># Common layers</span></span><br><span class="line">        self.conv1 = nn.Conv2d(num_inputs, <span class="number">32</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">4</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv3 = nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv4 = nn.Conv2d(<span class="number">64</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">128</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">512</span>)</span><br><span class="line">        self.actor_fc = nn.Linear(<span class="number">512</span>, num_actions)</span><br><span class="line">        self.critic_fc = nn.Linear(<span class="number">512</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(self.conv1(x))</span><br><span class="line">        x = F.relu(self.conv2(x))</span><br><span class="line">        x = F.relu(self.conv3(x))</span><br><span class="line">        x = F.relu(self.conv4(x))</span><br><span class="line">        </span><br><span class="line">        x = x.view(-<span class="number">1</span>, <span class="number">128</span> * <span class="number">5</span> * <span class="number">5</span>)  </span><br><span class="line">        x = F.relu(self.fc1(x))</span><br><span class="line">        logits = self.actor_fc(x) <span class="comment"># Actor</span></span><br><span class="line">        state_values = self.critic_fc(x) <span class="comment"># Critic</span></span><br><span class="line">        <span class="keyword">return</span> Categorical(logits=logits), state_values</span><br></pre></td></tr></table></figure>

<p>ç”±äºè§‚å¯Ÿçš„æ˜¯å›¾åƒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºäº CNN çš„æ¶æ„æ¥æ„å»ºæˆ‘ä»¬çš„ä»£ç†ã€‚å®ƒå°†è¾“å‡ºä¸€ä¸ª Categorical å¯¹è±¡å’Œå½“å‰çŠ¶æ€çš„å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gamma = <span class="number">0.99</span></span><br><span class="line">gae_lambda = <span class="number">0.95</span></span><br><span class="line">clip_coef = <span class="number">0.2</span></span><br><span class="line">ent_coef = <span class="number">0.01</span></span><br><span class="line">vf_coef = <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">num_envs = <span class="number">4</span></span><br><span class="line">num_steps = <span class="number">512</span></span><br><span class="line">minibatch_size = <span class="number">32</span></span><br><span class="line">total_steps = <span class="number">500000</span></span><br><span class="line">batch_size = num_envs * num_steps</span><br><span class="line">device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">agent = ActorCritic(<span class="number">4</span>, n_action).to(device) <span class="comment"># n_action = 5</span></span><br><span class="line">ema = EMA(agent, beta = <span class="number">0.995</span>, update_every = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>, num_updates + <span class="number">1</span>), desc=<span class="string">&quot;PPO training progress: ~~&quot;</span>):</span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(num_steps):</span><br><span class="line">        global_step += <span class="number">1</span> * num_envs</span><br><span class="line">        obs[step] = next_obs</span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            dist, value = agent(next_obs)</span><br><span class="line">            values[step] = value.view(-<span class="number">1</span>)</span><br><span class="line">            action = dist.sample()</span><br><span class="line">            logprob = dist.log_prob(action)</span><br><span class="line"></span><br><span class="line">        actions[step] = action</span><br><span class="line">        logprobs[step] = logprob</span><br><span class="line">        next_obs, reward, done, info = envs.step(action.cpu().numpy())</span><br><span class="line">        dones[step] = torch.Tensor(done).to(device)</span><br><span class="line">        rewards[step] = torch.tensor(reward).to(device).view(-<span class="number">1</span>)</span><br><span class="line">        next_obs = torch.Tensor(next_obs).to(device)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        _, next_value = agent(next_obs)</span><br><span class="line">        advantages = torch.zeros_like(rewards).to(device)</span><br><span class="line">        lastgaelam = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(num_steps)):</span><br><span class="line">            <span class="keyword">if</span> t == num_steps - <span class="number">1</span>:</span><br><span class="line">                is_done = <span class="number">1.0</span> - dones[t]</span><br><span class="line">                nextvalues = next_value</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                is_done = <span class="number">1.0</span> - dones[t]</span><br><span class="line">                nextvalues = values[t+<span class="number">1</span>]</span><br><span class="line">            delta = rewards[t] + gamma * nextvalues * is_done - values[t]</span><br><span class="line">            advantages[t] = lastgaelam = delta + gamma * gae_lambda * is_done * lastgaelam</span><br><span class="line">        returns = advantages + values</span><br><span class="line"></span><br><span class="line">    b_obs = obs.view((-<span class="number">1</span>,) + obs_shape)</span><br><span class="line">    b_actions = actions.view((-<span class="number">1</span>,) + action_shape)</span><br><span class="line">    b_logprobs = logprobs.view(-<span class="number">1</span>)</span><br><span class="line">    b_advantages = advantages.view(-<span class="number">1</span>)</span><br><span class="line">    b_returns = returns.view(-<span class="number">1</span>)</span><br><span class="line">    b_inds = np.arange(batch_size)</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        np.random.shuffle(b_inds)</span><br><span class="line">        <span class="keyword">for</span> start <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, batch_size, minibatch_size):</span><br><span class="line">            end = start + minibatch_size</span><br><span class="line">            mb_inds = b_inds[start:end]</span><br><span class="line">            dist, new_value = agent(b_obs[mb_inds])</span><br><span class="line">            newlogprob = dist.log_prob(b_actions.long()[mb_inds])</span><br><span class="line">            entropy = dist.entropy()</span><br><span class="line">            logratio = newlogprob - b_logprobs[mb_inds]</span><br><span class="line">            ratio = logratio.exp()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Policy loss</span></span><br><span class="line">            mb_advantages = b_advantages[mb_inds]</span><br><span class="line">            pg_loss1 = -mb_advantages * ratio</span><br><span class="line">            pg_loss2 = -mb_advantages * torch.clamp(ratio, <span class="number">1</span> - clip_coef, <span class="number">1</span> + clip_coef)</span><br><span class="line">            pg_loss = torch.<span class="built_in">max</span>(pg_loss1, pg_loss2).mean()</span><br><span class="line">            <span class="comment"># Value loss</span></span><br><span class="line">            newvalue = newvalue.view(-<span class="number">1</span>)</span><br><span class="line">            v_loss = v_loss_fn(newvalue, b_returns[mb_inds])</span><br><span class="line">            entropy_loss = entropy.mean()</span><br><span class="line">            loss = pg_loss - ent_coef * entropy_loss + v_loss * vf_coef</span><br><span class="line"></span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            loss.backward()</span><br><span class="line">            nn.utils.clip_grad_norm_(agent.parameters(), <span class="number">0.5</span>)</span><br><span class="line">            optimizer.step()</span><br><span class="line">            ema.update()</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ‰§è¡Œ PPOï¼Œæˆ‘ä»¬é¦–å…ˆä»æ—§ç­–ç•¥ä¸­æ”¶é›†æ•°æ®ï¼ˆb_obsã€b_actionsï¼Œâ€¦ï¼‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ–°æ—§ç­–ç•¥ä¹‹é—´çš„å·®å¼‚ï¼ˆnew_logprob - b_logprobsï¼‰ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è¿­ä»£ä¸åŒçš„æ‰¹æ¬¡å¹¶æ›´æ–° Actor å’Œ Criticã€‚</p>
<p>æˆ‘æ‰€åšçš„å…¶ä»–ä¸€äº›ä¿®æ”¹åŒ…æ‹¬åˆå¹¶ç†µæŸå¤±ä»¥åŠç”¨ GAEï¼ˆé€šç”¨ä¼˜åŠ¿ä¼°è®¡å™¨ï¼‰æ›¿æ¢ä¼˜åŠ¿å‡½æ•°ã€‚</p>
<p>ç†µç”¨äºé¼“åŠ±æ¨¡å‹æ¢ç´¢æ›´å¤šå¯èƒ½çš„åŠ¨ä½œï¼Œä»è€Œæ¢ç´¢æ›´å¤šå¯èƒ½çš„è½¨è¿¹ã€‚åŒæ—¶ï¼ŒGAEæ˜¯ä¼˜åŠ¿å‡½æ•°çš„å˜ä½“ï¼Œæ—¨åœ¨å‡å°‘å¥–åŠ±çš„æ–¹å·®ï¼ˆè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://towardsdatascience.com/generalized-advantage-estimation-in-reinforcement-learning-bf4a957f7975">è¿™é‡Œ</a>æ‰¾åˆ°ï¼‰</p>
<h3 id="èµ›è½¦ç»“æœ"><a href="#èµ›è½¦ç»“æœ" class="headerlink" title="èµ›è½¦ç»“æœ"></a>èµ›è½¦ç»“æœ</h3><p><img src="/../asset_reinforcelearninggame2/22.gif"></p>
<h3 id="ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—"><a href="#ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—" class="headerlink" title="ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—"></a>ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—</h3><p>å…¶å®é™¤äº†æˆ‘ä»¬è‡ªå·±å»ºç«‹æ¨¡å‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå»ºç«‹æ¨¡å‹ã€‚åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ Stable Baselines3 æ¥ç© linyiLYi åˆ›å»ºçš„<a target="_blank" rel="noopener" href="https://github.com/linyiLYi/snake-ai/tree/master">è¿·ä½ è›‡æ¸¸æˆ</a>ã€‚</p>
<p>ç¯å¢ƒè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://github.com/linyiLYi/snake-ai/tree/master">è¿™é‡Œ</a>å’Œ<a target="_blank" rel="noopener" href="https://youtu.be/jTVMxJBtmFs?si=sdXihKfhT77oLvlK">è¿™é‡Œ</a>æ‰¾åˆ°</p>
<p>ç”±äºOpenAIä¸å†æ”¯æŒæ—§çš„gymç¯å¢ƒï¼Œç›´æ¥ä½¿ç”¨snakeç¯å¢ƒä¼šå¯¼è‡´é”™è¯¯ã€‚è§£å†³åŠæ³•æ˜¯é™çº§Stable Baselinesçš„ç‰ˆæœ¬æˆ–è€…å°†snake envè½¬æ¢æˆGymnasiumä½¿ç”¨çš„æ ¼å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> snake_game_custom_wrapper_cnn <span class="keyword">import</span> SnakeEnv</span><br><span class="line"><span class="keyword">from</span> sb3_contrib <span class="keyword">import</span> MaskablePPO</span><br><span class="line"><span class="keyword">from</span> sb3_contrib.common.wrappers <span class="keyword">import</span> ActionMasker</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.common.type_aliases <span class="keyword">import</span> GymEnv</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.common.vec_env <span class="keyword">import</span> VecEnv, DummyVecEnv</span><br><span class="line"></span><br><span class="line"><span class="comment"># From https://github.com/linyiLYi/snake-ai/tree/master</span></span><br><span class="line">EXPECTED_METHOD_NAME = <span class="string">&#x27;get_action_mask&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_action_masks</span>(<span class="params">env: GymEnv</span>) -&gt; np.ndarray:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Checks whether gym env exposes a method returning invalid action masks</span></span><br><span class="line"><span class="string">    :param env: the Gym environment to get masks from</span></span><br><span class="line"><span class="string">    :return: A numpy array of the masks</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(env, VecEnv):</span><br><span class="line">        <span class="keyword">return</span> np.stack(env.env_method(EXPECTED_METHOD_NAME))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getattr</span>(env, EXPECTED_METHOD_NAME)()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linear scheduler</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">linear_schedule</span>(<span class="params">initial_value, final_value=<span class="number">0.0</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(initial_value, <span class="built_in">str</span>):</span><br><span class="line">        initial_value = <span class="built_in">float</span>(initial_value)</span><br><span class="line">        final_value = <span class="built_in">float</span>(final_value)</span><br><span class="line">        <span class="keyword">assert</span> (initial_value &gt; <span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">scheduler</span>(<span class="params">progress</span>):</span><br><span class="line">        <span class="keyword">return</span> final_value + progress * (initial_value - final_value)</span><br><span class="line">    <span class="keyword">return</span> scheduler</span><br><span class="line">lr_schedule = linear_schedule(<span class="number">2.5e-4</span>, <span class="number">2.5e-6</span>)</span><br><span class="line">clip_range_schedule = linear_schedule(<span class="number">0.150</span>, <span class="number">0.025</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">num_envs = <span class="number">16</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">seed=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init</span>():</span><br><span class="line">        env = SnakeEnv()</span><br><span class="line">        env = ActionMasker(env, SnakeEnv.get_action_mask)</span><br><span class="line">        <span class="keyword">return</span> env</span><br><span class="line">    <span class="keyword">return</span> _init</span><br><span class="line">envs = DummyVecEnv([make_env() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_envs)])</span><br><span class="line"></span><br><span class="line">model = MaskablePPO(</span><br><span class="line">    <span class="string">&quot;CnnPolicy&quot;</span>,</span><br><span class="line">    envs,</span><br><span class="line">    device=<span class="string">&quot;cuda&quot;</span>,</span><br><span class="line">    verbose=<span class="number">1</span>,</span><br><span class="line">    n_steps=<span class="number">2048</span>,</span><br><span class="line">    batch_size=<span class="number">512</span>,</span><br><span class="line">    n_epochs=<span class="number">4</span>,</span><br><span class="line">    gamma=<span class="number">0.94</span>,</span><br><span class="line">    learning_rate=lr_schedule,</span><br><span class="line">    clip_range=clip_range_schedule,</span><br><span class="line">)</span><br><span class="line">model.learn(total_timesteps=<span class="built_in">int</span>(<span class="number">5000000</span>))</span><br><span class="line">model.save(<span class="string">&quot;./ppo_snake_final.zip&quot;</span>)</span><br><span class="line">envs.close()</span><br></pre></td></tr></table></figure>

<h3 id="è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ"><a href="#è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ" class="headerlink" title="è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ"></a>è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ</h3><p><img src="/../asset_reinforcelearninggame2/23.gif"></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/mastering-game-worlds-a-deep-dive-into-reinforcement-learning-part-2-574263e11bb1">https://levelup.gitconnected.com/mastering-game-worlds-a-deep-dive-into-reinforcement-learning-part-2-574263e11bb1</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/29/ai-agent-everything/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/29/ai-agent-everything/" class="post-title-link" itemprop="url">AI ä»£ç†æ— å¤„ä¸åœ¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-29 12:31:29 / ä¿®æ”¹æ—¶é—´ï¼š16:15:37" itemprop="dateCreated datePublished" datetime="2024-04-29T12:31:29+08:00">2024-04-29</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>5.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æˆ‘ç°åœ¨è¶Šæ¥è¶Šè§‰å¾—AIä»£ç†æ˜¯éå¸¸é‡è¦çš„æŠ€æœ¯ã€‚ å°±åƒlinuxçš„kernelï¼ŒAIä»£ç†å°±æ˜¯LLM OSçš„è°ƒåº¦æ ¸å¿ƒã€‚</p>
<p>LLMsç°åœ¨å·²ç»å­˜åœ¨äº†å‡ å¹´ï¼Œå®ƒä»¬æ­£è¿…é€Ÿå‘å±•æˆä¸º AI ä»£ç†å’Œä»£ç†å·¥ä½œæµã€‚LLMså¾ˆæ£’ï¼Œä½†å®ƒä»¬ä»ç„¶ä¸æ“…é•¿è‡ªåŠ¨åŒ–å¤„ç†äº‹åŠ¡ã€‚LLMsä¸å…¶ä»–å·¥å…·ç»“åˆèµ·æ¥æ˜¯åˆ©ç”¨LLMsæ‰€æ‹¥æœ‰çš„é€šç”¨æ™ºèƒ½çš„ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼ï¼Œé€šè¿‡æ¶ˆè€—å¤§é‡çš„è¯­è¨€æ•°æ®ã€‚LLMsæœ€å¤§çš„é—®é¢˜åœ¨äºå®ƒä»¬å¶å°”ä¼šè¿·å¤±æ–¹å‘ï¼ˆå¹»è§‰ï¼‰ï¼Œæˆ‘ä»¬æ°¸è¿œä¸çŸ¥é“ä½•æ—¶LLMsæˆ–ä»£ç†å¯èƒ½ä¼šå¤±è´¥ã€‚å›´ç»•è¿™äº›å¤±è´¥å·²ç»æœ‰ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œä½†æˆ‘ä»¬è¿œæœªå……åˆ†åˆ©ç”¨LLMsæ™®é€šæ™ºèƒ½çš„å…¨éƒ¨èƒ½åŠ›ã€‚</p>
<h2 id="ä»-RAG-åˆ°-Agents"><a href="#ä»-RAG-åˆ°-Agents" class="headerlink" title="ä» RAG åˆ° Agents"></a>ä» RAG åˆ° Agents</h2><p>RAG æ˜¯ä¸€ç§åŠå‚æ•°ç±»å‹çš„ç³»ç»Ÿï¼Œå…¶ä¸­å‚æ•°éƒ¨åˆ†æ˜¯å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¯éå‚æ•°éƒ¨åˆ†ã€‚å°†æ‰€æœ‰ä¸åŒéƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·å¾—åˆ°åŠå‚æ•°ç³»ç»Ÿã€‚LLMs å°†æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åœ¨å®ƒä»¬çš„æƒé‡æˆ–å‚æ•°ä¸­ï¼ˆä»¥ç¼–ç å½¢å¼ï¼‰ï¼Œè€Œç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†æ²¡æœ‰å®šä¹‰è¯¥çŸ¥è¯†çš„å‚æ•°ã€‚</p>
<ul>
<li>äº¤æ¢ç´¢å¼•ï¼ˆç‰¹å®šä¿¡æ¯åœ¨LLMsä¸­ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œå®šåˆ¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸ä¼šé­å—è¿‡æ—¶ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ç´¢å¼•ä¸­çš„å†…å®¹ã€‚</li>
<li>ç”¨è¿™äº›ç´¢å¼•æ¥ä½œä¸ºLLMsçš„åŸºç¡€ä¿¡æ¯ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¼šå‡å°‘å¹»è§‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å‘æ¥æºè¿›è¡Œå¼•ç”¨å’Œå½’å› </li>
</ul>
<p>å› æ­¤ï¼ŒåŸåˆ™ä¸Šï¼ŒRAG ä¸ºæˆ‘ä»¬çš„LLMsåˆ›å»ºæ›´å¥½çš„æƒ…å¢ƒåŒ–ã€‚</p>
<p><img src="/../asset_aiagenteverything/01.png"></p>
<p>â€œä»£ç†â€æ˜¯ä¸€ç§è‡ªåŠ¨æ¨ç†å’Œå†³ç­–å¼•æ“ã€‚å®ƒæ¥æ”¶ç”¨æˆ·è¾“å…¥&#x2F;æŸ¥è¯¢ï¼Œå¹¶å¯ä»¥åšå‡ºå†…éƒ¨å†³ç­–æ¥æ‰§è¡Œè¯¥æŸ¥è¯¢ï¼Œä»¥è¿”å›æ­£ç¡®çš„ç»“æœã€‚å…³é”®ä»£ç†ç»„ä»¶å¯ä»¥åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºæ›´å°çš„é—®é¢˜</li>
<li>é€‰æ‹©è¦ä½¿ç”¨çš„å¤–éƒ¨å·¥å…·+ç¡®å®šè°ƒç”¨è¯¥å·¥å…·çš„å‚æ•°</li>
<li>è§„åˆ’ä¸€ç»„ä»»åŠ¡</li>
<li>å°†å…ˆå‰å®Œæˆçš„ä»»åŠ¡å­˜å‚¨åœ¨å†…å­˜æ¨¡å—ä¸­</li>
</ul>
<p><img src="/../asset_aiagenteverything/02.webp"></p>
<p>æˆ‘ä»¬æœ‰ä¸åŒç±»å‹çš„ä»£ç†ï¼Œä»ç®€å•åˆ°æå…¶å¤æ‚çš„ä»£ç†ã€‚æ ¹æ®ä»»åŠ¡çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬è®¾è®¡è¿™äº›ä»£ç†ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªä¸»å†³å®šé€‰æ‹©å¯ç”¨çš„å·¥å…·ã€‚ä¸‹é¢çš„å›¾ç‰‡æ˜¾ç¤ºäº†ä¸åŒç±»å‹çš„ä»£ç†åŠå…¶å¤æ‚ç¨‹åº¦ã€‚</p>
<p><img src="/../asset_aiagenteverything/03.webp"></p>
<h2 id="ä»£ç†ç³»ç»Ÿæ¦‚è¿°"><a href="#ä»£ç†ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ä»£ç†ç³»ç»Ÿæ¦‚è¿°"></a>ä»£ç†ç³»ç»Ÿæ¦‚è¿°</h2><p>åœ¨ä¸€ä¸ªç”±LLMé©±åŠ¨çš„è‡ªä¸»ä»£ç†ç³»ç»Ÿä¸­ï¼ŒLLMå……å½“ä»£ç†çš„å¤§è„‘ï¼Œåˆ©ç”¨ä¸åŒçš„ç»„ä»¶åœ¨æ•°å­—ä¸–ç•Œä¸­æ‰§è¡Œæ“ä½œã€‚</p>
<h3 id="å·¥å…·ä½¿ç”¨"><a href="#å·¥å…·ä½¿ç”¨" class="headerlink" title="å·¥å…·ä½¿ç”¨"></a>å·¥å…·ä½¿ç”¨</h3><p>ä»£ç†ç¨‹åºå­¦ä¼šè°ƒç”¨å¤–éƒ¨ API æˆ–å·¥å…·ï¼Œä»¥è·å–æ¨¡å‹æƒé‡ä¸­å¯èƒ½ç¼ºå¤±çš„é¢å¤–ä¿¡æ¯&#x2F;ä¸Šä¸‹æ–‡æˆ–åŠŸèƒ½ï¼ˆé€šå¸¸åœ¨é¢„è®­ç»ƒåéš¾ä»¥æ›´æ”¹ï¼‰ã€‚è¿™åŒ…æ‹¬å½“å‰ä¿¡æ¯ã€æ•°å­¦å¼•æ“ã€ä»£ç æ‰§è¡Œèƒ½åŠ›ã€è®¿é—®ä¸“æœ‰ä¿¡æ¯æºç­‰ç­‰ã€‚</p>
<h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><ul>
<li>çŸ­æœŸè®°å¿†ï¼šåœ¨ä¸Šä¸‹æ–‡å­¦ä¹ ä¸­ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºåˆ©ç”¨æ¨¡å‹çš„çŸ­æœŸè®°å¿†æ¥å¤„ç†ç»™å®šé—®é¢˜ã€‚ä¸Šä¸‹æ–‡é•¿åº¦çª—å£å¯ä»¥è¢«è§†ä¸ºçŸ­æœŸè®°å¿†ã€‚</li>
<li>é•¿æœŸè®°å¿†ï¼šä¸ºä»£ç†æä¾›åœ¨è¾ƒé•¿æ—¶é—´å†…ä¿ç•™å’Œå¬å›ï¼ˆæ— é™ï¼‰ä¿¡æ¯çš„èƒ½åŠ›ï¼Œé€šå¸¸é€šè¿‡åˆ©ç”¨å¤–éƒ¨å‘é‡å­˜å‚¨å’Œå¿«é€Ÿæ£€ç´¢ã€‚RAG ä¸­çš„æ£€ç´¢éƒ¨åˆ†å¯ä»¥è¢«è§†ä¸ºé•¿æœŸè®°å¿†ã€‚</li>
</ul>
<h3 id="è®¡åˆ’"><a href="#è®¡åˆ’" class="headerlink" title="è®¡åˆ’"></a>è®¡åˆ’</h3><ul>
<li>å­ç›®æ ‡å’Œä»»åŠ¡åˆ†è§£ï¼šä»£ç†å°†è¾ƒå¤§çš„ä»»åŠ¡åˆ†è§£ä¸ºè¾ƒå°ã€å¯ç®¡ç†çš„å­ç›®æ ‡ï¼Œä»è€Œæœ‰æ•ˆå¤„ç†å¤æ‚ä»»åŠ¡ã€‚</li>
<li>åæ€å’Œå®Œå–„ï¼šä»£ç†å¯ä»¥è¿›è¡Œè‡ªæˆ‘æ‰¹è¯„ï¼ˆè™½ç„¶åœ¨æŸäº›æ–¹é¢å­˜ç–‘ï¼‰ï¼Œå¹¶å¯¹è¿‡å»çš„è¡ŒåŠ¨è¿›è¡Œè‡ªæˆ‘åæ€ï¼Œä»é”™è¯¯ä¸­å¸å–æ•™è®­ï¼Œå¹¶ä¸ºæœªæ¥çš„æ­¥éª¤è¿›è¡Œå®Œå–„ï¼Œä»è€Œæ”¹å–„æœ€ç»ˆç»“æœã€‚</li>
</ul>
<p><img src="/../asset_aiagenteverything/04.webp"></p>
<h2 id="äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨"><a href="#äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨" class="headerlink" title="äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨"></a>äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨</h2><p>èƒ½å¤Ÿä½¿ç”¨å·¥å…·æ˜¯äººç±»åœ¨è®¸å¤šæ–¹é¢ä¸å…¶ä»–ç”Ÿç‰©æœ‰æ‰€ä¸åŒçš„åœ°æ–¹ã€‚æˆ‘ä»¬åˆ›é€ ã€ä¿®æ”¹å’Œåˆ©ç”¨å¤–éƒ¨ç‰©ä½“æ¥æ‰©å±•æˆ‘ä»¬çš„èº«ä½“å’Œè®¤çŸ¥èƒ½åŠ›ã€‚åŒæ ·ï¼Œä¸ºLLMsé…å¤‡å¤–éƒ¨å·¥å…·å¯ä»¥æ˜¾è‘—æ‰©å±•å®ƒä»¬çš„èƒ½åŠ›ã€‚</p>
<p>åœ¨ AI ä»£ç†è®¾ç½®ä¸­ï¼Œå·¥å…·å¯¹åº”äºä¸€ç»„å·¥å…·ï¼Œä½¿LLMä»£ç†èƒ½å¤Ÿä¸å¤–éƒ¨ç¯å¢ƒï¼ˆå¦‚ Google æœç´¢ã€ä»£ç è§£é‡Šå™¨ã€æ•°å­¦å¼•æ“ç­‰ï¼‰è¿›è¡Œäº¤äº’ã€‚å·¥å…·ä¹Ÿå¯ä»¥æ˜¯æŸç§å½¢å¼çš„æ•°æ®åº“ã€çŸ¥è¯†åº“å’Œå¤–éƒ¨æ¨¡å‹ã€‚å½“ä»£ç†ä¸å¤–éƒ¨å·¥å…·äº¤äº’æ—¶ï¼Œå®ƒé€šè¿‡å·¥ä½œæµæ‰§è¡Œä»»åŠ¡ï¼Œå¸®åŠ©ä»£ç†è·å–è§‚å¯Ÿç»“æœæˆ–å®Œæˆç»™å®šå­ä»»åŠ¡å’Œæœ€ç»ˆä»»åŠ¡æ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>å·¥å…·å¦‚ä½•ä»¥ä¸åŒæ–¹å¼è¢«LLMsåˆ©ç”¨çš„å‡ ä¸ªç¤ºä¾‹ï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2205.00445">MRKL</a>ï¼ˆModular Reasoning, Knowledge, and Languageï¼‰æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå°†LLMsä¸ä¸“å®¶æ¨¡å—ç»“åˆèµ·æ¥ï¼Œè¿™äº›æ¨¡å—å¯ä»¥æ˜¯LLMsæˆ–ç¬¦å·åŒ–çš„ï¼ˆè®¡ç®—å™¨æˆ–å¤©æ°” APIï¼‰ã€‚</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.17580">HuggingGPT</a> â€” ä¸€ä¸ªç”±LLMé©±åŠ¨çš„ä»£ç†ï¼Œåˆ©ç”¨LLMsä½œä¸ºä»»åŠ¡è§„åˆ’å™¨ï¼Œè¿æ¥å„ç§ç°æœ‰çš„ AI æ¨¡å‹ï¼ˆåŸºäºæè¿°ï¼‰æ¥è§£å†³ AI ä»»åŠ¡ã€‚</p>
</li>
</ul>
<p><img src="/../asset_aiagenteverything/05.webp"></p>
<p>HuggingGPT çš„æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥æ ¹æ®åŸå§‹è®ºæ–‡ä¸­æåˆ°çš„å†…å®¹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p>
<p>ä»»åŠ¡è§„åˆ’ï¼šä½¿ç”¨ ChatGPT åˆ†æç”¨æˆ·çš„è¯·æ±‚ä»¥ç†è§£ä»–ä»¬çš„æ„å›¾ï¼Œå¹¶å°†å…¶æ‹†åˆ†ä¸ºå¯èƒ½å¯è§£å†³çš„ä»»åŠ¡ã€‚</p>
<p>æ¨¡å‹é€‰æ‹©ï¼šä¸ºäº†è§£å†³è®¡åˆ’ä¸­çš„ä»»åŠ¡ï¼ŒChatGPT åŸºäºæ¨¡å‹æè¿°ä» Hugging Face ä¸Šé€‰æ‹©ä¸“å®¶æ¨¡å‹ã€‚</p>
<p>ä»»åŠ¡æ‰§è¡Œï¼šè°ƒç”¨å¹¶æ‰§è¡Œæ¯ä¸ªé€‰æ‹©çš„æ¨¡å‹ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ ChatGPTã€‚</p>
<p>å“åº”ç”Ÿæˆï¼šæœ€åï¼ŒChatGPT è¢«ç”¨äºæ•´åˆæ‰€æœ‰æ¨¡å‹çš„é¢„æµ‹å¹¶ä¸ºç”¨æˆ·ç”Ÿæˆå“åº”ã€‚</p>
<p>HuggingGPT åœ¨ä¸€ä¸ªçœŸå®ç¤ºä¾‹ä¸­æ˜¯å¦‚ä½•è¿ä½œçš„, å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/../asset_aiagenteverything/06.png"></p>
<h2 id="åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜"><a href="#åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜" class="headerlink" title="åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜"></a>åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜</h2><p>å†…å­˜å¯ä»¥è¢«å®šä¹‰ä¸ºç”¨äºè·å–ã€å­˜å‚¨ã€ä¿ç•™å’Œç¨åæ£€ç´¢ä¿¡æ¯çš„èµ„æºæˆ–å­˜å‚¨å™¨ã€‚åœ¨ä»»ä½•è®¡ç®—ç³»ç»Ÿä¸­éƒ½æœ‰å‡ ç§ç±»å‹çš„å†…å­˜ã€‚</p>
<h3 id="ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰"><a href="#ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰" class="headerlink" title="ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰:"></a>ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰:</h3><p>æ­£å¦‚æ„Ÿè§‰è®°å¿†ä½œä¸ºæ„Ÿè§‰ä¿¡æ¯çš„çŸ­æš‚ä¿ç•™ï¼ˆä»»åŠ¡å®Œæˆåç«‹å³æ¶ˆå¤±ï¼‰çš„ä½œç”¨ï¼Œè®¡ç®—æœºç³»ç»Ÿä¸­çš„ç¼“å†²å­˜å‚¨å™¨å¯ä»¥ä¿å­˜ç¬æ€æ•°æ®ï¼Œå¦‚æŒ‡ä»¤é›†ã€‚å¯¹äºLLMsï¼Œè¿™å¯èƒ½æŒ‡çš„æ˜¯ä»¤ç‰Œç¼“å†²åŒºæˆ–è¾“å…¥é˜Ÿåˆ—ã€‚</p>
<h3 id="å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š"><a href="#å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š" class="headerlink" title="å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š"></a>å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š</h3><p>LLMsåœ¨å¤„ç†æ–‡æœ¬æ—¶ï¼Œé‡‡ç”¨ç±»ä¼¼äºäººç±»å·¥ä½œè®°å¿†çš„æœºåˆ¶ã€‚å®ƒä»¬ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶æ¥ä¿æŒå¯¹è¾“å…¥çš„æŸäº›éƒ¨åˆ†çš„â€œå…³æ³¨â€ã€‚åœ¨åŸºäº Transformer çš„æ¨¡å‹ï¼ˆå¦‚ GPTï¼‰ä¸­ï¼Œæ³¨æ„åŠ›æƒé‡èµ·ç€ç±»ä¼¼äº STM çš„ä½œç”¨ï¼ŒåŒæ—¶ä¿æŒå’Œå¤„ç†å¤šä¸ªä¿¡æ¯ç‰‡æ®µã€‚LLMçš„å·¥ä½œè®°å¿†æ˜¯å…¶ä¸Šä¸‹æ–‡é•¿åº¦ã€‚</p>
<h3 id="å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š"><a href="#å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š" class="headerlink" title="å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š"></a>å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š</h3><p>LLMs çš„å‚æ•°ï¼ˆæˆ–æƒé‡ï¼‰å¯ä»¥è¢«è§†ä¸ºä¸€ç§é•¿æœŸè®°å¿†å½¢å¼ã€‚ä¸€æ—¦è®­ç»ƒå®Œæˆï¼Œè¿™äº›å‚æ•°ä¼šç¼–ç ä»è®­ç»ƒæ•°æ®ä¸­è·å–çš„å¤§é‡ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ— é™æœŸåœ°ä¿ç•™ã€‚</p>
<p>åœ¨LLMsä¸­ï¼Œâ€œè®°å¿†â€ä¸æ˜¯ä½œä¸ºç¦»æ•£äº‹ä»¶å­˜å‚¨çš„ï¼Œè€Œæ˜¯ä½œä¸ºæ¨¡å¼ï¼ˆæŠ½è±¡ä¸–ç•Œæ¨¡å‹ï¼Œå°½ç®¡ä¸å®Œå…¨ï¼‰åœ¨ä¸€ä¸ªäº’è¿èŠ‚ç‚¹ç½‘ç»œä¸­è¡¨ç¤ºï¼Œå¹¶ä¸”è¯¥æ¨¡å‹é€šè¿‡æ ¹æ®å…¶è®­ç»ƒçŠ¶æ€åŠ¨æ€ç”Ÿæˆå“åº”æ¥â€œå›å¿†â€ä¿¡æ¯ã€‚</p>
<p>å¤–éƒ¨å­˜å‚¨å™¨å¯ä»¥è§£å†³æœ‰é™æ³¨æ„åŠ›è·¨åº¦çš„é—®é¢˜ã€‚æ ‡å‡†åšæ³•æ˜¯å°†åµŒå…¥å‘é‡ï¼ˆæ–‡æœ¬è½¬æ¢ä¸ºå¯†é›†å‘é‡ï¼‰ä¿å­˜åˆ°ä¸€ä¸ªæ”¯æŒå¿«é€Ÿæœ€å¤§å†…ç§¯æœç´¢ï¼ˆ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Maximum_inner-product_search">MIPS</a>ï¼‰çš„å‘é‡å­˜å‚¨æ•°æ®åº“ä¸­ã€‚ä¸ºäº†ä¼˜åŒ–æ£€ç´¢é€Ÿåº¦ï¼Œå¸¸è§é€‰æ‹©æ˜¯ä½¿ç”¨è¿‘ä¼¼æœ€è¿‘é‚»å±…ï¼ˆANNï¼‰ç®—æ³•ï¼Œä»¥è¿”å›å¤§çº¦å‰ k ä¸ªæœ€è¿‘é‚»å±…ï¼Œä»¥æ¢å–ä¸€ç‚¹ç²¾åº¦æŸå¤±æ¥è·å¾—å·¨å¤§çš„åŠ é€Ÿã€‚</p>
<p>ç”¨äºæ­¤æ£€ç´¢çš„ä¸€äº›ç®—æ³•ï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Locality-sensitive_hashing">LSH</a>ã€<a target="_blank" rel="noopener" href="https://github.com/spotify/annoy">ANNOY</a>ã€<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1603.09320">HNSW</a>ã€<a target="_blank" rel="noopener" href="https://github.com/facebookresearch/faiss">FAISS</a> å’Œ <a target="_blank" rel="noopener" href="https://github.com/google-research/google-research/tree/master/scann">ScaNN</a></p>
<p>æ‰€æœ‰è¿™äº›æ–¹æ³•èƒŒåçš„ä¸€èˆ¬åŸåˆ™â€”â€”LSHã€ANNOYã€HNSWã€FAISS å’Œ ScaNNâ€”â€”æ˜¯åœ¨é«˜ç»´ç©ºé—´ä¸­é«˜æ•ˆåœ°è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ã€‚è¿™äº›æ–¹æ³•æ—¨åœ¨é€šè¿‡ä½¿ç”¨å°†ç›¸ä¼¼æ•°æ®ç‚¹ç»„åˆåœ¨ä¸€èµ·çš„ç­–ç•¥ï¼Œä»¥å…è®¸æ›´å¿«çš„æ£€ç´¢æ¥å…‹æœç²¾ç¡®æœç´¢çš„è®¡ç®—å¼ºåº¦ã€‚</p>
<h2 id="è®¡åˆ’ï¼šå½“å‰-AI-ä»£ç†çš„æœ€å¤§é—®é¢˜"><a href="#è®¡åˆ’ï¼šå½“å‰-AI-ä»£ç†çš„æœ€å¤§é—®é¢˜" class="headerlink" title="è®¡åˆ’ï¼šå½“å‰ AI ä»£ç†çš„æœ€å¤§é—®é¢˜"></a>è®¡åˆ’ï¼šå½“å‰ AI ä»£ç†çš„æœ€å¤§é—®é¢˜</h2><p>æœ‰æ—¶ä»£ç†ä¼šä¸ºäº†å›ç­”ä¸€ä¸ªå•ä¸€&#x2F;ç®€å•çš„é—®é¢˜è€Œå¤§é‡è°ƒç”¨ï¼Œä¸ºæ¯ä¸ªæŸ¥è¯¢ç§¯ç´¯ä»¤ç‰Œç»™LLMã€‚è¿™ä¸ä»…æˆæœ¬é«˜æ˜‚ï¼Œè¿˜ä¼šå¼•å…¥å»¶è¿Ÿã€‚ä»¤ç‰Œç”Ÿæˆä»ç„¶æ˜¯ä¸€ä¸ªç›¸å¯¹ç¼“æ…¢çš„è¿‡ç¨‹ï¼Œå¤§éƒ¨åˆ†ï¼ˆä¸æ˜¯å…¨éƒ¨ï¼‰åŸºäºLLMçš„åº”ç”¨ç¨‹åºä¸­çš„å»¶è¿Ÿæ¥è‡ªç”Ÿæˆè¾“å‡ºä»¤ç‰Œã€‚åå¤è°ƒç”¨LLMå¹¶è¦æ±‚å…¶æä¾›æƒ³æ³•&#x2F;è§‚å¯Ÿï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šç”Ÿæˆå¤§é‡è¾“å‡ºä»¤ç‰Œï¼ˆæˆæœ¬ï¼‰ï¼Œå¯¼è‡´é«˜å»¶è¿Ÿï¼ˆç”¨æˆ·ä½“éªŒä¸‹é™ï¼‰ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä¸ºäº†è¾¾åˆ°æ­£ç¡®ç­”æ¡ˆæˆ–è¡ŒåŠ¨ï¼ŒLLMsç»å¸¸å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œç”±äºä»£ç†å·¥ä½œæµç¨‹çš„å›ºæœ‰ç»“æ„ä»¥æ ‘å½¢æˆ–å›¾å½¢ï¼Œè¿™ä¼šå¼•å…¥è®¸å¤šå»¶è¿Ÿã€‚</p>
<p>æœ‰å¾ˆå¤šç±»ä¼¼çš„è®ºæ–‡ï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2201.11903">æ€ç»´é“¾</a>ï¼Œ<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2305.10601.pdf">æ€ç»´æ ‘</a>ï¼Œ<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2308.10379.pdf">æ€ç»´ç®—æ³•</a>ã€‚</p>
<p><img src="/../asset_aiagenteverything/07.webp"></p>
<p>æœ€æ–°çš„é«˜çº§æç¤ºç­–ç•¥æ˜¯â€æ€ç»´ç®—æ³•â€ï¼šè¿™ç¯‡æ€ç»´ç®—æ³•æ–°è®ºæ–‡çš„ç†å¿µä¸æ€ç»´æ ‘è®ºæ–‡ç›¸åŒï¼Œä½†ä¸»è¦åŒºåˆ«åœ¨äºä¸Šä¸‹æ–‡ä¿å­˜çš„æ–¹å¼ã€‚åœ¨æ€ç»´æ ‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŸºäºæ ‘çš„æ•°æ®ç»“æ„ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŸºäºå›¾çš„ç»“æ„ï¼Œå› æ­¤ç»™æˆ‘ä»¬æä¾›äº†æ¯”ä½¿ç”¨ç®€å•çš„ BFS æˆ– DFS æ›´å¥½çš„æ–¹å¼æ¥æµè§ˆæ‰€æœ‰çš„çŸ¥è¯†å›¾ã€‚</p>
<p>å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯æ€ç»´ç®—æ³•ä½¿ç”¨æ›´å°‘çš„æç¤ºæ¥å®ç°ç±»ä¼¼çš„ç»“æœã€‚è¿™äº›æç¤ºç­–ç•¥èƒŒåçš„æ•´ä¸ªç†å¿µæ˜¯ä»¥æœ€å°‘çš„è°ƒç”¨LLMæ¥è·å¾—æœ€å¤šçš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>AI ä»£ç†çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯LLMsæ˜¯éç¡®å®šæ€§çš„ã€‚è™½ç„¶å¯¹äºåˆ›æ„ç”Ÿæˆæœ‰ç›Šï¼Œä½†åœ¨éœ€è¦å¯é¢„æµ‹æ€§çš„åœºæ™¯ä¸­ï¼Œè¿™å¸¦æ¥äº†ä¸¥é‡æŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªLLMæ”¯æŒçš„èŠå¤©åº”ç”¨ç¨‹åºæ¥è¿›è¡Œ Postgres æŸ¥è¯¢ï¼ˆText2SQLï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰å¾ˆé«˜çš„å¯é¢„æµ‹æ€§ã€‚</p>
<h2 id="è‡ªæˆ‘åé¦ˆ"><a href="#è‡ªæˆ‘åé¦ˆ" class="headerlink" title="è‡ªæˆ‘åé¦ˆ"></a>è‡ªæˆ‘åé¦ˆ</h2><p>ç”±äºè®¡åˆ’æ¨¡å—ä¸æ¶‰åŠä»»ä½•åé¦ˆï¼Œè¿™ä½¿å¾—å®ç°é•¿æœŸè§„åˆ’å˜å¾—éå¸¸å›°éš¾ï¼Œå°¤å…¶æ˜¯è§£å†³å¤æ‚ä»»åŠ¡æ—¶å°¤ä¸ºå¿…è¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿‡ç¨‹ï¼Œæ ¹æ®è¿‡å»çš„è¡ŒåŠ¨å’Œè§‚å¯Ÿï¼Œåå¤åæ€å’Œå®Œå–„æ‰§è¡Œè®¡åˆ’ã€‚ç›®æ ‡æ˜¯çº æ­£å’Œæ”¹è¿›è¿‡å»çš„é”™è¯¯ï¼Œæœ‰åŠ©äºæé«˜æœ€ç»ˆç»“æœçš„è´¨é‡ã€‚è¿™åœ¨å¤æ‚çš„ç°å®ç¯å¢ƒå’Œä»»åŠ¡ä¸­å°¤ä¸ºé‡è¦ï¼Œè¯•é”™æ˜¯å®Œæˆä»»åŠ¡çš„å…³é”®ã€‚</p>
<h3 id="ReAct"><a href="#ReAct" class="headerlink" title="ReAct"></a>ReAct</h3><p><a target="_blank" rel="noopener" href="https://www.promptingguide.ai/techniques/react">ReAct</a> ç»“åˆæ¨ç†å’Œè¡ŒåŠ¨ï¼Œæ—¨åœ¨ä½¿LLMèƒ½å¤Ÿé€šè¿‡äº¤æ›¿æ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤ï¼ˆé‡å¤ N æ¬¡ï¼‰ï¼š Thought ï¼Œ Action å’Œ Observation æ¥è§£å†³å¤æ‚ä»»åŠ¡ã€‚ReAct ä¿ƒä½¿LLMsç”Ÿæˆå£å¤´æ¨ç†ç—•è¿¹å’Œä»»åŠ¡çš„è¡ŒåŠ¨ã€‚è¿™ä½¿ç³»ç»Ÿèƒ½å¤Ÿè¿›è¡ŒåŠ¨æ€æ¨ç†ï¼Œä¸ºè¡ŒåŠ¨åˆ›å»ºã€ç»´æŠ¤å’Œè°ƒæ•´è®¡åˆ’ï¼ŒåŒæ—¶è¿˜èƒ½ä¸å¤–éƒ¨ç¯å¢ƒï¼ˆä¾‹å¦‚ç»´åŸºç™¾ç§‘ï¼‰è¿›è¡Œäº¤äº’ï¼Œå°†é¢å¤–ä¿¡æ¯çº³å…¥æ¨ç†è¿‡ç¨‹ã€‚</p>
<p><img src="/../asset_aiagenteverything/08.webp"></p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº† ReAct çš„ç¤ºä¾‹ä»¥åŠæ‰§è¡Œé—®ç­”æ‰€æ¶‰åŠçš„ä¸åŒæ­¥éª¤ã€‚</p>
<p><img src="/../asset_aiagenteverything/09.webp"></p>
<h3 id="Reflexion"><a href="#Reflexion" class="headerlink" title="Reflexion"></a>Reflexion</h3><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.11366">Reflexion</a>è¿™æ˜¯ä¸€ä¸ªæ—¨åœ¨ä¸ºä»£ç†äººæä¾›åŠ¨æ€è®°å¿†å’Œè‡ªæˆ‘åæ€èƒ½åŠ›ä»¥æé«˜æ¨ç†èƒ½åŠ›çš„æ¡†æ¶ã€‚ Reflexion å…·æœ‰æ ‡å‡†çš„ RL è®¾ç½®ï¼Œå…¶ä¸­å¥–åŠ±æ¨¡å‹æä¾›ç®€å•çš„äºŒè¿›åˆ¶å¥–åŠ±ï¼Œè¡ŒåŠ¨ç©ºé—´éµå¾ª ReAct ä¸­çš„è®¾ç½®ï¼Œå…¶ä¸­ç‰¹å®šäºä»»åŠ¡çš„è¡ŒåŠ¨ç©ºé—´é€šè¿‡è¯­è¨€è¿›è¡Œå¢å¼ºï¼Œä»¥å®ç°å¤æ‚çš„æ¨ç†æ­¥éª¤ã€‚åœ¨æ¯ä¸ªåŠ¨ä½œ ğ‘ğ‘¡ ä¹‹åï¼Œä»£ç†è®¡ç®—å¯å‘å¼ â„ğ‘¡ï¼Œå¹¶æ ¹æ®è‡ªæˆ‘åæ€ç»“æœå†³å®šæ˜¯å¦é‡ç½®ç¯å¢ƒä»¥å¼€å§‹æ–°çš„è¯•éªŒã€‚</p>
<p><img src="/../asset_aiagenteverything/10.webp"></p>
<p>heuristic (å¯å‘å¼)å‡½æ•°ç¡®å®šä½•æ—¶è§„åˆ’ä½æ•ˆæˆ–åŒ…å«å¹»è§‰,éœ€è¦åœæ­¢ã€‚ä½æ•ˆçš„è§„åˆ’æ˜¯æŒ‡èŠ±è´¹å¤ªé•¿æ—¶é—´è€Œæ²¡æœ‰æˆåŠŸã€‚å¹»è§‰è¢«å®šä¹‰ä¸ºé‡åˆ°ä¸€ç³»åˆ—è¿ç»­ç›¸åŒçš„è¡ŒåŠ¨ï¼Œå¯¼è‡´ç¯å¢ƒä¸­å‡ºç°ç›¸åŒçš„è§‚å¯Ÿã€‚</p>
<h3 id="Chain-of-Hindsight-ï¼ˆCoHï¼‰"><a href="#Chain-of-Hindsight-ï¼ˆCoHï¼‰" class="headerlink" title="Chain of Hindsight ï¼ˆCoHï¼‰"></a>Chain of Hindsight ï¼ˆCoHï¼‰</h3><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2302.02676">CoH</a> , åœ¨å›é¡¾é“¾ä¸­ï¼Œæ¨¡å‹è¢«è¦æ±‚é€šè¿‡æŸ¥çœ‹è‡ªå·±çš„è¿‡å»å·¥ä½œæ¥æ”¹è¿›è‡ªå·±ï¼Œè¯„åˆ†ï¼Œå¹¶é™„æœ‰å¦‚ä½•åœ¨ä¸‹æ¬¡åšå¾—æ›´å¥½çš„æ³¨é‡Šã€‚æ¨¡å‹é€šè¿‡å°è¯•äº§ç”Ÿä¸€ä¸ªèƒ½è·å¾—æ›´é«˜è¯„åˆ†çš„æ–°è¾“å‡ºæ¥è¿›è¡Œç»ƒä¹ ï¼Œåˆ©ç”¨è‡ªå·±å°è¯•å’Œåé¦ˆçš„å†å²ã€‚ä¸ºäº†é˜²æ­¢æ¨¡å‹ä»…ä»…è®°ä½ç­”æ¡ˆï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ä¼šéšè—éƒ¨åˆ†å†å²è®°å½•ã€‚</p>
<h3 id="Algorithm-Distillation-AD"><a href="#Algorithm-Distillation-AD" class="headerlink" title="Algorithm Distillation (AD)"></a>Algorithm Distillation (AD)</h3><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2210.14215">AD</a> å°†ç±»ä¼¼çš„æƒ³æ³•åº”ç”¨äºæœºå™¨äººæˆ–ä»£ç†å­¦ä¹ ä»»åŠ¡ï¼ˆå¦‚è§†é¢‘æ¸¸æˆä¸­çš„ RL ä»£ç†ï¼‰ã€‚ä»£ç†äººå›é¡¾äº†è‡ªå·±åœ¨è¿‡å»å‡ æ¬¡å°è¯•ä¸­çš„è¡¨ç°ï¼Œå¹¶è¯•å›¾æ‰¾å‡ºæ”¹è¿›çš„æ¨¡å¼ã€‚ç„¶åï¼Œå®ƒé¢„æµ‹ä¸‹ä¸€æ­¥åº”è¯¥æ¯”ä»¥å‰çš„æ›´å¥½ï¼Œå­¦ä¹ å˜å¾—æ›´å¥½çš„ç­–ç•¥ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‰¹å®šé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>AD ä¸“æ³¨äºä»ä»£ç†äººä¸ç¯å¢ƒäº’åŠ¨çš„å†å²ä¸­å­¦ä¹ çš„ç†å¿µã€‚é€šè¿‡æŸ¥çœ‹è¿‡å»è¡ŒåŠ¨åºåˆ—åŠå…¶ç»“æœï¼Œä»£ç†äººè¯•å›¾å°†æˆåŠŸçš„ç­–ç•¥æç‚¼åˆ°å…¶ç­–ç•¥ä¸­ã€‚</p>
<p>Reflexion åæ€åˆ™èµ‹äºˆä»£ç†äººè®°ä½è¿‡å»è¡ŒåŠ¨å¹¶åæ€å…¶æœ‰æ•ˆæ€§çš„èƒ½åŠ›ï¼Œç‰¹åˆ«å…³æ³¨æ£€æµ‹å’Œé¿å…é‡å¤æˆ–æ— æ•ˆç­–ç•¥ï¼ˆå¦‚å¹»è§‰ï¼‰ã€‚</p>
<h2 id="ä»£ç†ç±»å‹"><a href="#ä»£ç†ç±»å‹" class="headerlink" title="ä»£ç†ç±»å‹"></a>ä»£ç†ç±»å‹</h2><h3 id="è·¯ç”±ä»£ç†"><a href="#è·¯ç”±ä»£ç†" class="headerlink" title="è·¯ç”±ä»£ç†"></a>è·¯ç”±ä»£ç†</h3><p>æœ€ç®€å•çš„ä»£ç†æ¨ç†å½¢å¼ã€‚æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œä¸€ç»„é€‰æ‹©ï¼Œè¾“å‡ºä¸€ä¸ªé€‰æ‹©å­é›†ä»¥è·¯ç”±è¯¥æŸ¥è¯¢ã€‚</p>
<p><img src="/../asset_aiagenteverything/11.webp"></p>
<p>åœ¨ä¸Šè¿°æŸ¥è¯¢ä¸­ï¼Œâ€œä½œè€…åœ¨è‰ºæœ¯å­¦æ ¡æœŸé—´åšäº†ä»€ä¹ˆï¼Ÿâ€è¢«ä¼ é€’ç»™è·¯ç”±å™¨ã€‚è·¯ç”±å™¨çš„å·¥ä½œæ˜¯é€šè¿‡ç³»ç»Ÿç¡®å®šæŸ¥è¯¢çš„æœ€ä½³è·¯å¾„ï¼Œä»¥æ£€ç´¢æœ€ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<p>è·¯ç”±å™¨å¯ä»¥é€‰æ‹©ä¸¤æ¡å¯èƒ½çš„è·¯å¾„ï¼š</p>
<p>çŸ¢é‡æŸ¥è¯¢å¼•æ“ï¼šè¯¥å¼•æ“æ ¹æ®æŸ¥è¯¢å‘é‡ä¸æ–‡æ¡£å‘é‡ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ï¼Œä»æ›´å¤§çš„é›†åˆä¸­æ£€ç´¢å‰ k ä¸ªç›¸å…³æ–‡æ¡£ã€‚å®ƒä½¿ç”¨å‘é‡ç©ºé—´æ¨¡å‹æ¥ç†è§£å’Œæ£€ç´¢ä¸æŸ¥è¯¢åœ¨è¯­ä¹‰ä¸Šæœ€æ¥è¿‘çš„æ–‡æ¡£ã€‚</p>
<p>æ‘˜è¦æŸ¥è¯¢å¼•æ“ï¼šè¯¥å¼•æ“æ£€ç´¢æ‰€æœ‰æ–‡æ¡£å¹¶æä¾›å…¶å†…å®¹çš„æ‘˜è¦ã€‚å®ƒå…è®¸ç³»ç»Ÿå¹¿æ³›äº†è§£ä¸€ä¸ªä¸»é¢˜ï¼Œè€Œæ— éœ€é€ä¸ªæŸ¥çœ‹æ¯ä¸ªæ–‡æ¡£ã€‚</p>
<p>æ ¹æ®è·¯ç”±å™¨çš„å†³å®šï¼Œè¦ä¹ˆè¿”å›æ¥è‡ªçŸ¢é‡æŸ¥è¯¢å¼•æ“çš„ç‰¹å®šæ–‡æ¡£å­é›†ï¼Œè¦ä¹ˆè¿”å›æ¥è‡ªæ‘˜è¦æŸ¥è¯¢å¼•æ“çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£çš„æ‘˜è¦ï¼Œä»¥å›ç­”ç”¨æˆ·çš„æŸ¥è¯¢ã€‚è¿™ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†æœ€ç»ˆè¿”å›çš„è¾“å‡ºç±»å‹ã€‚æœ‰äº›æŸ¥è¯¢å¯èƒ½éœ€è¦è¯¦ç»†ç­”æ¡ˆï¼Œæœ‰äº›å¯èƒ½å¯¹è¾ƒå¹¿æ³›çš„ç­”æ¡ˆæ»¡æ„ã€‚è¿™äº›è·¯ç”±å™¨ä»£ç†å¸®åŠ©æˆ‘ä»¬ä¿®æ”¹LLMsçš„è¡Œä¸ºã€‚</p>
<h3 id="æŸ¥è¯¢è§„åˆ’ä»£ç†"><a href="#æŸ¥è¯¢è§„åˆ’ä»£ç†" class="headerlink" title="æŸ¥è¯¢è§„åˆ’ä»£ç†"></a>æŸ¥è¯¢è§„åˆ’ä»£ç†</h3><p>æŸ¥è¯¢è§„åˆ’ä»£ç†èƒŒåçš„ç†å¿µæ˜¯é¦–å…ˆå°†å¤æ‚æŸ¥è¯¢åˆ†è§£ä¸ºæ¯ä¸ªç›¸å…³æ•°æ®æºçš„å­é—®é¢˜ï¼Œç„¶åæ”¶é›†æ‰€æœ‰ä¸­é—´å“åº”å¹¶ç»¼åˆå‡ºæœ€ç»ˆå“åº”ã€‚</p>
<p><img src="/../asset_aiagenteverything/12.webp"></p>
<p>æŸ¥çœ‹æŸ¥è¯¢è§„åˆ’ä»£ç†å¦‚ä½•é€šè¿‡å­æŸ¥è¯¢è·å¾—æ›´å¥½çš„å“åº”ã€‚</p>
<p><img src="/../asset_aiagenteverything/13.webp"></p>
<h3 id="å·¥å…·ä½¿ç”¨ä»£ç†"><a href="#å·¥å…·ä½¿ç”¨ä»£ç†" class="headerlink" title="å·¥å…·ä½¿ç”¨ä»£ç†"></a>å·¥å…·ä½¿ç”¨ä»£ç†</h3><p>è¿™æ˜¯å¯ä»¥ä½¿ç”¨å·¥å…·æˆ– API çš„ä»£ç†ç±»å‹ï¼Œæ¨æ–­è¿è¡Œè¯¥å·¥å…·æ‰€éœ€çš„å‚æ•°ï¼Œå¹¶å°†å…¶ç»“æœè¿”å›ç»™LLMä¸Šä¸‹æ–‡ï¼Œä»¥è·å¾—æ›´å‡†ç¡®çš„ç­”æ¡ˆã€‚</p>
<p><img src="/../asset_aiagenteverything/14.webp"></p>
<p>ä»£ç†å¦‚ä½•å¤„ç†åºåˆ—åŒ–çš„ä¸€å †é—®é¢˜ï¼Ÿä»£ç†å¦‚ä½•éšæ—¶é—´ä¿æŒçŠ¶æ€ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ›´é«˜çº§ä»£ç†å¦‚ HuggingGPT å’Œ ChemCrow è¿›å…¥ç”»é¢çš„åœ°æ–¹ã€‚åœ¨è¿™äº›å¤šä»£ç†è®¾ç½®ä¸­ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªå·¥å…·ï¼Œå¹¶ä¸”é€šå¸¸è¿˜é›†æˆäº†åŠ¨æ€å†…å­˜ã€‚è¿™äº›ç³»ç»Ÿé€šå¸¸ä½¿ç”¨ ReAct å’Œ Reflexion ç­‰æ–¹æ³•ï¼Œåœ¨ä»£ç†çš„ç¯å¢ƒå’Œè¡ŒåŠ¨ä¸­å…·æœ‰ç»†è‡´è‡ªæ´½çš„æ–¹æ³•ã€‚</p>
<p><img src="/../asset_aiagenteverything/15.webp"></p>
<p>ä»¥ä¸‹æ˜¯ç”¨äºæ„å»º LLM ä»£ç†çš„å·¥å…·å’Œæ¡†æ¶çš„ç¤ºä¾‹ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://python.langchain.com/docs/get_started/introduction">LangChain</a>ï¼šä¸€ä¸ªåŸºäºè¯­è¨€æ¨¡å‹çš„åº”ç”¨ç¨‹åºå’Œä»£ç†å¼€å‘æ¡†æ¶ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Significant-Gravitas/AutoGPT">AutoGPT</a>ï¼šæä¾›æ„å»º AI ä»£ç†çš„å·¥å…·ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://microsoft.github.io/autogen/">AutoGen</a> ï¼šä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªä»£ç†å¼€å‘LLMåº”ç”¨ç¨‹åºï¼Œè¿™äº›ä»£ç†å¯ä»¥ç›¸äº’å¯¹è¯ä»¥è§£å†³ä»»åŠ¡ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.llamaindex.ai/">LlamaIndex</a> - ç”¨äºå°†è‡ªå®šä¹‰æ•°æ®æºè¿æ¥åˆ°å¤§å‹è¯­è¨€æ¨¡å‹çš„æ¡†æ¶ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/gpt-engineer-org/gpt-engineer">GPT Engineer</a> ï¼šè‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆä»¥å®Œæˆå¼€å‘ä»»åŠ¡ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/melih-unsal/DemoGPT">DemoGPT</a> ï¼šè‡ªä¸» AI ä»£ç†ä»¥åˆ›å»ºäº¤äº’å¼ Streamlit åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>LLM ä»£ç†ä»å¤„äºèŒèŠ½é˜¶æ®µï¼Œæ„å»ºå®ƒä»¬ä»å­˜åœ¨è®¸å¤šæŒ‘æˆ˜å’Œé™åˆ¶ï¼Œæ¯”å¦‚åŸºäº LLM çš„ä»£ç†éœ€è¦é€‚åº”è§’è‰²ä»¥æœ‰æ•ˆåœ°å®Œæˆé¢†åŸŸå†…çš„ä»»åŠ¡ï¼Œèƒ½å¤Ÿè¿›è¡Œé•¿æœŸè§„åˆ’ï¼Œæ™®éçš„äººç±»å¯¹é½ï¼Œå¯é æ€§ï¼ŒçŸ¥è¯†é™åˆ¶ï¼Œä»¥åŠè®¸å¤šå…¶ä»–é—®é¢˜ã€‚</p>
<p>åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç ”ç©¶æ›´é«˜çº§çš„æ¦‚å¿µï¼Œå¦‚ KV ç¼“å­˜å’ŒLLMç¼–è¯‘å™¨ä¸æ“ä½œç³»ç»Ÿã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://medium.com/aiguys/ai-agents-are-all-you-need-0b38e8ee5481">https://medium.com/aiguys/ai-agents-are-all-you-need-0b38e8ee5481</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/17/magic-eraser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/17/magic-eraser/" class="post-title-link" itemprop="url">ä½¿ç”¨ PyTorch åˆ›å»ºè¿·ä½ ç¥å¥‡æ©¡çš®æ“¦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-17 20:16:47 / ä¿®æ”¹æ—¶é—´ï¼š21:18:24" itemprop="dateCreated datePublished" datetime="2024-04-17T20:16:47+08:00">2024-04-17</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>27 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å»å¹´ï¼ŒGoogle å‘æ‰€æœ‰æ‹¥æœ‰ Google One çš„ç”¨æˆ·æä¾›äº†â€œç¥å¥‡æ©¡çš®æ“¦â€ã€‚æœ‰äº†ç¥å¥‡æ©¡çš®æ“¦ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä»ç…§ç‰‡ä¸­åˆ é™¤ä¸éœ€è¦çš„éƒ¨åˆ†ã€‚å®ƒåˆ©ç”¨äººå·¥æ™ºèƒ½æ ¹æ®å‘¨å›´ç¯å¢ƒå¡«å……é€‚å½“çš„å¯¹è±¡ï¼Œä½¿æ•´ä½“å›¾ç‰‡çœ‹èµ·æ¥æ›´åŠ è‡ªç„¶ï¼å¾®ä¿¡ä¹Ÿæœ‰è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>è¿™é¡¹æŠ€æœ¯å¯èƒ½çœ‹èµ·æ¥åƒé­”æœ¯ï¼Œè®©æ‚¨å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ›´æ”¹å›¾åƒã€‚æœ‰äº›äººå¯èƒ½è®¤ä¸ºè¿™éœ€è¦å¤§é‡çš„æ•°å­¦çŸ¥è¯†å’Œè®¡ç®—æœºæ€§èƒ½ã€‚ä½†å®é™…ä¸Šï¼Œé­”æœ¯æ©¡çš®æ“¦ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œå›¾åƒä¿®å¤â€ï¼Œå¹¶ä¸å¤ªå¤æ‚ï¼Œå¯ä»¥åœ¨æ‚¨è‡ªå·±çš„è®¡ç®—æœºä¸Šå®Œæˆã€‚</p>
<p>å½“ä»Šæµè¡Œçš„æ–¹æ³•åŒ…æ‹¬åŸºäºæ‰©æ•£ã€GANsï¼ˆç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰å’Œæ³¨æ„åŠ›æœºåˆ¶çš„æ¨¡å‹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»åŸºäº GAN çš„å›¾åƒä¿®å¤æ–¹æ³•ã€‚</p>
<h2 id="æ¡ä»¶å›¾åƒç”Ÿæˆ"><a href="#æ¡ä»¶å›¾åƒç”Ÿæˆ" class="headerlink" title="æ¡ä»¶å›¾åƒç”Ÿæˆ"></a>æ¡ä»¶å›¾åƒç”Ÿæˆ</h2><p>å›¾åƒç”Ÿæˆæœ¬è´¨ä¸Šæ˜¯è®©æˆ‘ä»¬çš„æ¨¡å‹äº§ç”Ÿä¸€ä¸ªè™šå‡çš„æ•°æ®åˆ†å¸ƒ Pmodel(x)ã€‚ç›®æ ‡æ˜¯ä½¿è¿™ä¸ªåˆ†å¸ƒå°½å¯èƒ½æ¥è¿‘çœŸå®åˆ†å¸ƒ Pdata(x)ï¼Œä»è€Œç”Ÿæˆæ–°çš„å›¾åƒã€‚</p>
<p><img src="/../asset_magiceraser/01.webp"></p>
<p>åœ¨å›¾åƒä¿®å¤ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¡«è¡¥å›¾åƒä¸­ç¼ºå¤±çš„éƒ¨åˆ†ã€‚è¿™å¯ä»¥è¢«çœ‹ä½œæ˜¯å‘å›¾åƒå¼•å…¥ä¸€ä¸ªâ€œæ¡ä»¶â€ï¼Œå°†æˆ‘ä»¬æ¨¡å‹çš„æ–¹æ³•ä»ä¸€èˆ¬åˆ†å¸ƒ Pmodel(x) è½¬å˜ä¸ºæ¡ä»¶åˆ†å¸ƒ Pmodel(x | condition)ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºå¸¸è§„å›¾åƒç”Ÿæˆï¼Œä½†å¤šäº†ä¸€ä¸ªå°†æ¡ä»¶çº³å…¥æˆ‘ä»¬æ¨¡å‹çš„é¢å¤–æ­¥éª¤ï¼Œæˆ‘ç¨åä¼šè¯¦ç»†è®¨è®ºã€‚</p>
<h2 id="å›¾åƒä¿®å¤çš„æ­¥éª¤"><a href="#å›¾åƒä¿®å¤çš„æ­¥éª¤" class="headerlink" title="å›¾åƒä¿®å¤çš„æ­¥éª¤"></a>å›¾åƒä¿®å¤çš„æ­¥éª¤</h2><p><img src="/../asset_magiceraser/02.webp"></p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªéšæœºé®ç½©</li>
<li>å°†çœŸå®å›¾åƒä¸é®ç½©ç›¸ç»“åˆï¼ˆé®ç½©å›¾åƒï¼‰</li>
<li>æŠŠé®ç½©å›¾åƒå’Œé®ç½©ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼Œç”Ÿæˆå‡å›¾åƒ</li>
<li>è®¡ç®—çœŸå®å›¾åƒå’Œå‡å›¾åƒä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼ˆæŸå¤±ï¼‰</li>
</ul>
<h2 id="è”åˆè°ƒåˆ¶-GAN"><a href="#è”åˆè°ƒåˆ¶-GAN" class="headerlink" title="è”åˆè°ƒåˆ¶ GAN"></a>è”åˆè°ƒåˆ¶ GAN</h2><p>è”åˆè°ƒåˆ¶ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œæˆ–ç§° CoModGANï¼Œæ˜¯ä¸€ç§ä¸“ä¸ºå›¾åƒè¡¥å…¨è®¾è®¡çš„ç”Ÿæˆæ¨¡å‹ã€‚è¯¥æ¨¡å‹åœ¨å¤„ç†å›¾åƒä¸­å¤§ç‰‡ç¼ºå¤±åŒºåŸŸçš„ä»»åŠ¡ä¸­ç‰¹åˆ«æœ‰æ•ˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ç§ GANï¼ˆç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰æ¨¡å‹ï¼Œè¿™æ„å‘³ç€å®ƒä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç”Ÿæˆå™¨è´Ÿè´£åˆ›å»ºå›¾åƒï¼Œé‰´åˆ«å™¨è¯„ä¼°è¿™äº›å›¾åƒä»¥ç¡®å®šå®ƒä»¬æ˜¯çœŸå®çš„è¿˜æ˜¯è™šå‡çš„ã€‚</p>
<p><img src="/../asset_magiceraser/03.webp"><br>æœ‰æ¡ä»¶å›¾åƒç”Ÿæˆçš„è¿‡ç¨‹</p>
<p>è®©æˆ‘ä»¬å…³æ³¨ CoModGAN çš„å¦ä¸€ä¸ªå…³é”®æ–¹é¢ï¼šâ€™è”åˆè°ƒåˆ¶â€™ã€‚ä¸‹é¢çš„å›¾åƒå±•ç¤ºäº†è°ƒåˆ¶çš„ä¸åŒæ–¹æ³•ï¼šï¼ˆDï¼šè§£ç å™¨ï¼ŒMï¼šæ˜ å°„ç½‘ç»œ, Eï¼šæœ‰æ¡ä»¶ç¼–ç å™¨ï¼‰</p>
<p><img src="/../asset_magiceraser/04.webp"></p>
<ul>
<li>æ¨¡å‹ (a) ä»£è¡¨äº†ä¸€ç§ç”¨äºç”Ÿæˆå›¾åƒçš„æ— æ¡ä»¶æ¨¡å‹ï¼Œæœ€åˆåœ¨ StyleGAN ä¸­å¼•å…¥ã€‚å…¶å…³é”®ç‰¹å¾åŒ…æ‹¬è°ƒåˆ¶å’Œæ˜ å°„ç½‘ç»œã€‚</li>
<li>æ¨¡å‹ (b) å’Œ (c) æ˜¯ç¼–ç å™¨-è§£ç å™¨æ¶æ„çš„å…¸å‹ç¤ºä¾‹ï¼Œå…¶ä¸­ç¼–ç å™¨å°†å›¾åƒè½¬æ¢ä¸ºæ½œåœ¨ç©ºé—´ï¼Œè€Œè§£ç å™¨é‡å»ºåŸå§‹å›¾åƒã€‚(ä¾‹å¦‚ Pix2Pixï¼ŒCycleGANâ€¦)</li>
<li>æ¨¡å‹ (d) åŸºäºæ¨¡å‹ (b) å’Œ (c) çš„ç»“æ„ï¼Œå¹¶ä¸”è¿˜æ•´åˆäº† StyleGAN çš„ (a) æ˜ å°„ç½‘ç»œä»¥è§£å¼€æ½œåœ¨å‘é‡ Zã€‚æ­¤å¤–ï¼Œä¸ºäº†æ›´å¥½åœ°æ§åˆ¶ç”Ÿæˆå›¾åƒçš„é£æ ¼ï¼Œå®ƒå°† E å’Œ M çš„è¾“å‡ºç»„åˆä½œä¸º D çš„é¢å¤–è¾“å…¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºå…±è°ƒåˆ¶ã€‚</li>
</ul>
<h2 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h2><p>æœºå™¨å­¦ä¹ ä¸­çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥æ˜¯æ•°æ®é¢„å¤„ç†é˜¶æ®µã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ CelebA-HQ æ•°æ®é›†å’ŒçŸ©å½¢é®ç½©æ¥è®­ç»ƒæ¨¡å‹ã€‚æ­¤å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªç”±å½¢å¼çš„é®ç½©æˆ–åˆ›å»ºè‡ªå·±çš„é®ç½©</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def rectangle_mask(shape, min_size=32, max_size=96):</span><br><span class="line">    h, w = shape</span><br><span class="line">    mask = np.zeros([h, w])</span><br><span class="line">    hole_size = random.randint(min_size, max_size)</span><br><span class="line">    hole_size = min(int(w*0.8), int(h*0.8), hole_size)</span><br><span class="line">    x = random.randint(0, w-hole_size-1)</span><br><span class="line">    y = random.randint(0, h-hole_size-1)</span><br><span class="line">    mask[x:x+hole_size, y:y+hole_size] = 1</span><br><span class="line">    return mask.reshape([1, h, w]).astype(np.float32)</span><br><span class="line">    </span><br><span class="line">def random_ff_mask(shape):</span><br><span class="line">    h,w = shape</span><br><span class="line">    mask = np.zeros((h,w))</span><br><span class="line">    num_v = 12+np.random.randint(5)</span><br><span class="line">    </span><br><span class="line">    for i in range(num_v):</span><br><span class="line">        start_x = np.random.randint(w)</span><br><span class="line">        start_y = np.random.randint(h)</span><br><span class="line">        for j in range(1+np.random.randint(5)):</span><br><span class="line">            angle = 0.01+np.random.randint(4)</span><br><span class="line">            if i % 2 == 0:</span><br><span class="line">                angle = 2 * 3.1415926 - angle</span><br><span class="line">            length = 10+np.random.randint(30)</span><br><span class="line">            brush_w = 10+np.random.randint(7)</span><br><span class="line">            end_x = (start_x + length * np.sin(angle)).astype(np.int32)</span><br><span class="line">            end_y = (start_y + length * np.cos(angle)).astype(np.int32)</span><br><span class="line"></span><br><span class="line">            cv2.line(mask, (start_y, start_x), (end_y, end_x), 1.0, brush_w)</span><br><span class="line">            start_x, start_y = end_x, end_y</span><br><span class="line">    return mask.reshape((1,) + mask.shape).astype(np.float32)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class InpaintData(torch.utils.data.Dataset):</span><br><span class="line">    def __init__(self, path, img_size=[128, 128]):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.file_list = []</span><br><span class="line">        self.img_size = img_size</span><br><span class="line">        self.transforms = transforms.Compose([</span><br><span class="line">            # can put some augmentation here</span><br><span class="line">            transforms.RandomHorizontalFlip(0.5),</span><br><span class="line">            transforms.ToTensor(),</span><br><span class="line">            transforms.Normalize([0.5, 0.5, 0.5], [0.5, 0.5, 0.5])]</span><br><span class="line">        )</span><br><span class="line">        for file_name in glob(f&#x27;&#123;path&#125;/**/*.jpg&#x27;, recursive=True):</span><br><span class="line">            self.file_list.append(file_name)</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        return len(self.file_list)</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, idx):</span><br><span class="line">        file_name = self.file_list[idx]</span><br><span class="line">        img = Image.open(file_name).convert(&#x27;RGB&#x27;)</span><br><span class="line">        img = transforms.functional.resize(img, self.img_size, Image.BICUBIC)</span><br><span class="line">        img = self.transforms(img)</span><br><span class="line">        mask = rectangle_mask([128, 128])</span><br><span class="line">        return img, mask</span><br><span class="line">      </span><br><span class="line">path = &quot;put your path here!&quot;</span><br><span class="line">dataset = InpaintData(path)</span><br><span class="line">train_data = torch.utils.data.DataLoader(</span><br><span class="line">                    dataset,</span><br><span class="line">                    batch_size=16,</span><br><span class="line">                    shuffle= True,</span><br><span class="line">                    pin_memory=True,</span><br><span class="line">                    drop_last=True)</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_magiceraser/05.webp"></p>
<h2 id="æ¨¡å‹æ¶æ„"><a href="#æ¨¡å‹æ¶æ„" class="headerlink" title="æ¨¡å‹æ¶æ„"></a>æ¨¡å‹æ¶æ„</h2><p><img src="/../asset_magiceraser/06.webp"></p>
<p>ä¸Šé¢çš„å›¾è¡¨æ˜¾ç¤ºäº† CoModGAN ä¸­ç”Ÿæˆå™¨çš„ç»“æ„ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šç¼–ç å™¨ç½‘ç»œå’Œè§£ç å™¨ç½‘ç»œã€‚ç¼–ç å™¨ç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨æ·±åº¦å·ç§¯ç½‘ç»œï¼Œå¦‚ VGGï¼Œæ¥å¯¹è¾“å…¥è¿›è¡Œç¼–ç ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…³æ³¨è§£ç å™¨éƒ¨åˆ†ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè”åˆè°ƒåˆ¶ç»“åˆäº†æ¥è‡ªç¼–ç å™¨å’Œæ˜ å°„ç½‘ç»œçš„ä¸¤ä¸ªä¸åŒæ½œåœ¨å‘é‡ï¼Œå¹¶å°†å®ƒä»¬æ•´åˆåˆ°è§£ç å™¨çš„å„ä¸ªå±‚ä¸­ï¼Œç±»ä¼¼äº StyleGAN ä¸­çš„åˆæˆç½‘ç»œã€‚</p>
<h2 id="æé«˜-StyleGAN-çš„å›¾åƒè´¨é‡"><a href="#æé«˜-StyleGAN-çš„å›¾åƒè´¨é‡" class="headerlink" title="æé«˜ StyleGAN çš„å›¾åƒè´¨é‡"></a>æé«˜ StyleGAN çš„å›¾åƒè´¨é‡</h2><p><img src="/../asset_magiceraser/07.webp"><br>ä¸Šé¢çš„å›¾åƒæ˜¯ç”± StyleGAN ç”Ÿæˆçš„ï¼›æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾åƒçš„è§’è½å­˜åœ¨ä¸€äº›æ°´æ»´ã€‚è¿™ç§ç°è±¡ä»åˆ†è¾¨ç‡ä¸º 64x64 çš„æ‰€æœ‰ç‰¹å¾å›¾ä¸­å¼€å§‹å‡ºç°ï¼Œå¹¶åœ¨æ›´é«˜åˆ†è¾¨ç‡ä¸‹é€æ¸å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚<br><img src="/../asset_magiceraser/08.webp"></p>
<p>ä¸ºäº†è§£å†³æ°´æ»´é—®é¢˜ï¼Œä½œè€…æå‡ºäº† StyleGAN2ï¼ˆC å’Œ Dï¼‰ï¼Œè¿™æ˜¯ StyleGAN çš„ä¿®è®¢ç‰ˆæœ¬ã€‚ ä»–ä»¬è®¤ä¸ºè¿™ä¸ªé—®é¢˜æ˜¯ç”± AdaIN å±‚å¼•èµ·çš„ï¼Œè¯¥å±‚åˆ†åˆ«å¯¹æ¯ä¸ªç‰¹å¾å›¾çš„å‡å€¼å’Œæ–¹å·®è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¯èƒ½ç ´åä¸ç‰¹å¾ç›¸å¯¹å¤§å°ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<p><img src="/../asset_magiceraser/09.webp"></p>
<p>å› æ­¤ï¼Œé€šè¿‡å»é™¤é£æ ¼å‡å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ°´æ»´ä¼ªå½±å®Œå…¨æ¶ˆå¤±äº†ã€‚ï¼ˆé™„ï¼šAdaIN ç°åœ¨ç›´æ¥åœ¨ CNN çš„æƒé‡ï¼ˆw2ï¼Œâ€¦ï¼‰ä¸Šè¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨å›¾åƒ Xi ä¸Šè¿è¡Œï¼‰</p>
<p><img src="/../asset_magiceraser/10.webp"><br>StyleGAN çš„ Demod å±‚</p>
<p>å¦ä¸€ä¸ªä¿®æ”¹æ¶‰åŠå°†å®ä¾‹å½’ä¸€åŒ–ï¼ˆNorm stdï¼‰æ›¿æ¢ä¸º Demod å±‚ã€‚ç”±äºå½’ä¸€åŒ–çš„ç›®çš„æ˜¯å°†å±‚çš„è¾“å‡ºæ¢å¤åˆ°å•ä½æ ‡å‡†å·®ï¼Œè¿™å¯ä»¥é€šè¿‡ç›´æ¥å¯¹å±‚çš„æƒé‡è¿›è¡Œå½’ä¸€åŒ–æ¥æ›´ç›´æ¥åœ°å®ç°ï¼Œè¿™è¢«ç§°ä¸ºâ€œè§£è°ƒâ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">class Conv2DMod(nn.Module):</span><br><span class="line">    def __init__(self, in_channel, out_channel, kernel, demod=True, stride=1):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.kernel = kernel</span><br><span class="line">        self.demod = demod</span><br><span class="line">        self.stride = stride</span><br><span class="line">        self.filters = out_channel</span><br><span class="line">        self.weight = nn.Parameter(torch.randn((out_channel, in_channel, kernel, kernel)))</span><br><span class="line">        nn.init.kaiming_normal_(self.weight, a=0, mode=&#x27;fan_in&#x27;, nonlinearity=&#x27;leaky_relu&#x27;)</span><br><span class="line"></span><br><span class="line">    def _get_same_padding(self, size, kernel, stride, dilation=1):</span><br><span class="line">        return ((size - 1) * (stride - 1) + dilation * (kernel - 1)) // 2</span><br><span class="line"></span><br><span class="line">    def forward(self, x, style):</span><br><span class="line">        &#x27;&#x27;&#x27; </span><br><span class="line">        x: [b, c, h, w]</span><br><span class="line">        style: [b, s_dim]</span><br><span class="line">        </span><br><span class="line">        Style modulation:</span><br><span class="line">        w&#x27; = style * w</span><br><span class="line">        Demodulation: </span><br><span class="line">        w&#x27;&#x27; = w&#x27; / sqrt(x&#x27;**2 + eps) &#x27;&#x27;&#x27;</span><br><span class="line">        </span><br><span class="line">        b, c, h, w = x.shape</span><br><span class="line">        style = style[:, None, :, None, None]</span><br><span class="line">        weight = self.weight[None, :, :, :, :]</span><br><span class="line">        weight = weight * (style + 1)</span><br><span class="line">        </span><br><span class="line">        if self.demod: </span><br><span class="line">            d = torch.rsqrt((weight ** 2).sum(dim=(2, 3, 4), keepdim=True) + 1e-8)</span><br><span class="line">            weight = weight * d</span><br><span class="line">            </span><br><span class="line">        x = x.reshape(1, -1, h, w)</span><br><span class="line">        _, _, *ws = weight.shape</span><br><span class="line">        weight = weight.reshape(b * self.filters, *ws)</span><br><span class="line">        padding = self._get_same_padding(h, self.kernel, self.stride)</span><br><span class="line">        x = F.conv2d(x, weight, padding=padding, groups=b)</span><br><span class="line">        x = x.reshape(-1, self.filters, h, w)</span><br><span class="line">        return x</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå™¨å—"><a href="#ç”Ÿæˆå™¨å—" class="headerlink" title="ç”Ÿæˆå™¨å—"></a>ç”Ÿæˆå™¨å—</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class EqualLinear(nn.Module):</span><br><span class="line">    def __init__(self, in_dim, out_dim, bias = True, bias_init = 0, lr_mul = 1):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.weight = torch.nn.Parameter(torch.randn([out_dim, in_dim]) / lr_mul)</span><br><span class="line">        self.bias = torch.nn.Parameter(torch.full([out_dim], np.float32(bias_init))) if bias else None</span><br><span class="line">        self.weight_gain = lr_mul / np.sqrt(in_dim)</span><br><span class="line">        self.bias_gain = lr_mul</span><br><span class="line">    </span><br><span class="line">    def forward(self, x):</span><br><span class="line">        w = self.weight * self.weight_gain</span><br><span class="line">        layer = F.linear(x, w, bias = None)</span><br><span class="line">        if self.bias is not None:</span><br><span class="line">            layer = F.linear(x, w, bias = self.bias * self.bias_gain)</span><br><span class="line">        return layer</span><br><span class="line"></span><br><span class="line">class ToRGB(nn.Module):</span><br><span class="line">    def __init__(self, latent_dim, inp_dim):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.style = Linear(latent_dim, inp_dim)</span><br><span class="line">        self.conv = Conv2DMod(inp_dim, 3, 1, demod=False)</span><br><span class="line">        self.upsample = Upsample(scale_factor = 2, mode=&#x27;bilinear&#x27;)</span><br><span class="line">        </span><br><span class="line">    def forward(self, inp, style, prev_rgb = None):</span><br><span class="line">        style = self.style(style)</span><br><span class="line">        out = self.conv(inp, style)</span><br><span class="line">        if prev_rgb is not None:</span><br><span class="line">            prev_rgb = self.upsample(prev_rgb)</span><br><span class="line">            out += prev_rgb</span><br><span class="line">        return out</span><br></pre></td></tr></table></figure>

<p>EqualLinear ç”¨äºæ˜ å°„ç½‘ç»œä¸­ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€é‡æ–°è°ƒæ•´å±‚çš„è¾“å‡ºã€‚åœ¨æˆ‘çš„å®éªŒä¸­ï¼Œä¸å¸¸è§„çº¿æ€§å±‚ç›¸æ¯”ï¼Œä½¿ç”¨ EqualLinear åœ¨æ˜ å°„ç½‘ç»œä¸­å¹¶æ²¡æœ‰æ˜¾è‘—å½±å“ç»“æœã€‚æˆ‘å»ºè®®ç›´æ¥ä½¿ç”¨ torch.nn.Linearã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">class G_encode(nn.Module):</span><br><span class="line">    def __init__(self, in_channel, out_channel, downsample=True):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.downsample = downsample</span><br><span class="line">        self.conv_res = Conv2d(in_channel, out_channel, kernel_size=1, padding=0)</span><br><span class="line">        self.encode = nn.Sequential(</span><br><span class="line">            Conv2d(in_channel, out_channel, kernel_size=3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True),</span><br><span class="line">            Conv2d(out_channel, out_channel, kernel_size=3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True)</span><br><span class="line">        )  </span><br><span class="line">    def forward(self, x):</span><br><span class="line">        res = self.conv_res(x)</span><br><span class="line">        x = self.encode(x) + res</span><br><span class="line">        if self.downsample:</span><br><span class="line">            x = AvgPool2d(kernel_size=2, stride=2)(x)</span><br><span class="line">        return x</span><br><span class="line">        </span><br><span class="line">class G_decode(nn.Module):</span><br><span class="line">    def __init__(self, latent_dim, in_channel, out_channel, upsample=True):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.upsample = upsample</span><br><span class="line">        self.style1 = Linear(latent_dim, in_channel)</span><br><span class="line">        self.style2 = Linear(latent_dim, out_channel)</span><br><span class="line">        self.noise1 = Conv2d(1, out_channel, 1, padding=1)</span><br><span class="line">        self.noise2 = Conv2d(1, out_channel, 1, padding=1)</span><br><span class="line">        self.conv1 = Conv2DMod(in_channel, out_channel, 3)</span><br><span class="line">        self.conv2 = Conv2DMod(out_channel, out_channel, 3)</span><br><span class="line">        self.to_rgb = ToRGB(latent_dim, out_channel)</span><br><span class="line">        </span><br><span class="line">    def forward(self, x, style, noise, prev_rgb):</span><br><span class="line">        B, C, H, W = x.shape</span><br><span class="line">        if self.upsample:</span><br><span class="line">            x = Upsample(scale_factor=2, mode=&#x27;bilinear&#x27;, align_corners=False)(x)</span><br><span class="line">        noise1 = self.noise1(noise)[:, :, :x.shape[2], :x.shape[3]]</span><br><span class="line">        noise2 = self.noise2(noise)[:, :, :x.shape[2], :x.shape[3]]</span><br><span class="line">        style1 = self.style1(style)</span><br><span class="line">        style2 = self.style2(style)</span><br><span class="line">        </span><br><span class="line">        x = self.conv1(x, style1)</span><br><span class="line">        x = LeakyReLU(0.2, inplace=True)(x + noise1)</span><br><span class="line">        x = self.conv2(x, style2)</span><br><span class="line">        x = LeakyReLU(0.2, inplace=True)(x + noise2)</span><br><span class="line">        rgb = self.to_rgb(x, style, prev_rgb)</span><br><span class="line">        return x, rgb</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_magiceraser/11.webp"><br>ä¸åŒç±»å‹çš„ GAN æ¶æ„</p>
<p>è¿™é‡Œæœ‰ä¸€äº›ä¸åŒé€‰æ‹©çš„ tRGB å’Œ fRGB æ¶æ„ã€‚åœ¨æˆ‘çš„å®éªŒä¸­ï¼Œæˆ‘ä½¿ç”¨ (b) ä½œä¸ºä¸»è¦ç»“æ„ã€‚</p>
<h2 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h2><p><img src="/../asset_magiceraser/12.webp"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">class Generator(nn.Module):</span><br><span class="line">    def __init__(self, img_size, latent_dim, style_mlp = 8, lr_mul = 0.1, fmap_min = 16, fmap_max = 512):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_layers = int(log2(img_size)-2)</span><br><span class="line">        f_map = [fmap_min * (2 ** i) for i in range(self.num_layers + 1)]</span><br><span class="line">        filters = list(map(lambda x: min(fmap_max, x), f_map))</span><br><span class="line">        init_channel = filters[0]</span><br><span class="line">        self.latent_dim = latent_dim</span><br><span class="line">        self.style_dim = latent_dim + filters[-1]</span><br><span class="line">        self.in_out_channel = zip(filters[:-1], filters[1:])</span><br><span class="line">        self.init_conv = Conv2d(init_channel, init_channel, 3, padding=1)</span><br><span class="line">        </span><br><span class="line">        self.style_mapping =  nn.Sequential()</span><br><span class="line">        self.downs =  nn.ModuleList([])</span><br><span class="line">        self.ups = nn.ModuleList([])</span><br><span class="line">        </span><br><span class="line">        # 4 because image (b, 3, h, w) + mask (b, 1, h, w)</span><br><span class="line">        self.from_rgb = nn.Sequential(</span><br><span class="line">            Conv2d(4, filters[0], 3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True)</span><br><span class="line">        )</span><br><span class="line">        # x_global: latent vector of the input image</span><br><span class="line">        self.x_global = nn.Sequential(</span><br><span class="line">            Linear(filters[-1] * 4 * 4, filters[-1]),</span><br><span class="line">            LeakyReLU(0.2, inplace=True)</span><br><span class="line">        )</span><br><span class="line">        # style mapping network</span><br><span class="line">        for _ in range(style_mlp):</span><br><span class="line">            self.style_mapping.extend([EqualLinear(latent_dim, latent_dim, lr_mul), </span><br><span class="line">                                       LeakyReLU(0.2, inplace=True)])</span><br><span class="line">        # Encoder</span><br><span class="line">        for in_channel, out_channel in self.in_out_channel:</span><br><span class="line">            g_block = G_encode(in_channel,out_channel)               </span><br><span class="line">            self.downs.append(g_block)</span><br><span class="line">            </span><br><span class="line">        # Decoder (styleGAN)</span><br><span class="line">        reversed_filters = list(reversed(filters))</span><br><span class="line">        self.in_out_channel = zip(reversed_filters[:-1], reversed_filters[1:])</span><br><span class="line">        for in_channel, out_channel in self.in_out_channel:</span><br><span class="line">            g_block = G_decode(self.style_dim, in_channel, out_channel)            </span><br><span class="line">            self.ups.append(g_block)</span><br><span class="line">        </span><br><span class="line">    def forward(self, img, mask, latents, noise, return_latent=False):</span><br><span class="line">        b, c, h, w = img.shape</span><br><span class="line">        x = torch.cat([1 - mask - 0.5, img * (1- mask)], 1)</span><br><span class="line">        x = self.from_rgb(x)</span><br><span class="line">        for blocks in self.downs:</span><br><span class="line">            x = blocks(x)</span><br><span class="line">            </span><br><span class="line">        rgb = None</span><br><span class="line">        x = x.view(b, -1)</span><br><span class="line">        x_global = self.x_global(x) </span><br><span class="line">        styles = self.style_mapping(F.normalize(latents, dim=1))</span><br><span class="line">        styles = styles.view([-1, b, self.latent_dim])</span><br><span class="line">        x = x.view(b, -1, 4, 4)</span><br><span class="line">        </span><br><span class="line">        for block, style in zip(self.ups, styles):</span><br><span class="line">            # co-modulation</span><br><span class="line">            co_style = torch.cat([x_global, style.squeeze()], 1)</span><br><span class="line">            x, rgb = block(x, co_style, noise, rgb)</span><br><span class="line">            </span><br><span class="line">        raw_out = rgb</span><br><span class="line">        images_out = rgb * mask + img * (1-mask)</span><br><span class="line">        if return_latent:</span><br><span class="line">            return images_out, raw_out, styles</span><br><span class="line">        return images_out, raw_out</span><br></pre></td></tr></table></figure>

<h2 id="é‰´åˆ«å™¨"><a href="#é‰´åˆ«å™¨" class="headerlink" title="é‰´åˆ«å™¨"></a>é‰´åˆ«å™¨</h2><p><img src="/../asset_magiceraser/13.webp"></p>
<p>åœ¨è®¨è®ºäº†ç”Ÿæˆå™¨ä¹‹åï¼Œç°åœ¨æ˜¯æ—¶å€™è½¬å‘é‰´åˆ«å™¨äº†ã€‚ç”±äºé‰´åˆ«å™¨çš„ä¸»è¦ä½œç”¨æ˜¯åŒºåˆ†å›¾åƒæ˜¯çœŸå®çš„è¿˜æ˜¯è™šå‡çš„ï¼Œä»»ä½•å›¾åƒåˆ†ç±»æ¨¡å‹éƒ½å¯ä»¥ç”¨ä½œé‰´åˆ«å™¨ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œè®©æˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨ç±»ä¼¼ VGG çš„ç»“æ„æ¥å®ç°å®ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">class D_block(nn.Module):</span><br><span class="line">    def __init__(self, in_channel, out_channel, downsample = True):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.downsample = None</span><br><span class="line">        if downsample:</span><br><span class="line">            self.downsample = Conv2d(out_channel, out_channel, 3, padding = 1, stride = 2)</span><br><span class="line">        self.conv_res = Conv2d(in_channel, out_channel, 1, stride = (2 if downsample else 1))</span><br><span class="line">        self.net = nn.Sequential(</span><br><span class="line">            Conv2d(in_channel, out_channel, 3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True),</span><br><span class="line">            Conv2d(out_channel, out_channel, 3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True))</span><br><span class="line">        </span><br><span class="line">    def forward(self, x):</span><br><span class="line">        res = self.conv_res(x)</span><br><span class="line">        x = self.net(x)</span><br><span class="line">        if self.downsample is not None:</span><br><span class="line">            x = self.downsample(x)</span><br><span class="line">        x = (x + res) * (1 / math.sqrt(2))</span><br><span class="line">        return x</span><br><span class="line">      </span><br><span class="line">class Discriminator(nn.Module):</span><br><span class="line">    def __init__(self, img_size, fmap_min = 32, fmap_max = 512):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_layers = int(log2(img_size)-1)</span><br><span class="line">        f_map = [4] + [fmap_min * (2 ** i) for i in range(self.num_layers)]</span><br><span class="line">        filters = list(map(lambda x: min(fmap_max, x), f_map))</span><br><span class="line">        out_channel = filters[-1]</span><br><span class="line">        </span><br><span class="line">        self.in_out_channel = zip(filters[:-1], filters[1:])</span><br><span class="line">        self.blocks = nn.ModuleList([])</span><br><span class="line">        self.final_conv = Conv2d(out_channel, out_channel, 3, padding=1)</span><br><span class="line">        self.logit = Linear(out_channel * 4 * 4, 1)</span><br><span class="line">        for i, (in_channel, out_channel) in enumerate(self.in_out_channel):</span><br><span class="line">            down_sample = i != (self.num_layers - 1)</span><br><span class="line">            d_block = D_block(in_channel, out_channel, down_sample)</span><br><span class="line">            self.blocks.append(d_block)</span><br><span class="line">   </span><br><span class="line">    def forward(self, img, mask):</span><br><span class="line">        batch_size = img.shape[0]</span><br><span class="line">        x = torch.cat([1 - mask - 0.5, img], 1)</span><br><span class="line">        for block in self.blocks:</span><br><span class="line">            x = block(x)</span><br><span class="line">        x = self.final_conv(x)</span><br><span class="line">        x = x.view(batch_size, -1)</span><br><span class="line">        x = self.logit(x)</span><br><span class="line">        return x</span><br></pre></td></tr></table></figure>

<h2 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h2><p><img src="/../asset_magiceraser/14.webp"><br>æ¡ä»¶ GAN çš„æœ€å°-æœ€å¤§æŸå¤±</p>
<ul>
<li>Gï¼šç”Ÿæˆå™¨</li>
<li>Dï¼šåˆ¤åˆ«å™¨ï¼ˆè¾“å‡ºå€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œå‡ï¼š0ï¼ŒçœŸï¼š1ï¼‰</li>
<li>X: è¾“å…¥å›¾åƒï¼Œå½¢çŠ¶ [B, C, H, W]</li>
<li>Y: æ©æ¨¡ï¼Œå½¢çŠ¶ [B, 1, H, W]</li>
<li>Z: æ½œåœ¨å‘é‡ï¼ˆä»é«˜æ–¯åˆ†å¸ƒä¸­éšæœºé‡‡æ ·ï¼‰</li>
</ul>
<p>æŸå¤±å‡½æ•°ä¸ç»å…¸ GAN ç›¸åŒï¼Œä¸ºç”Ÿæˆå™¨å’Œé‰´åˆ«å™¨è®¾å®šä¸åŒçš„ç›®æ ‡ï¼Œä»è€Œåœ¨å®ƒä»¬ä¹‹é—´åˆ›å»ºç«äº‰ã€‚</p>
<p>é‰´åˆ«å™¨è¯•å›¾æ›´å¥½åœ°åŒºåˆ†ç”±ç”Ÿæˆå™¨åˆ¶ä½œçš„å‡å›¾åƒå’ŒçœŸå®å›¾åƒï¼Œè€Œç”Ÿæˆå™¨çš„ç›®æ ‡æ˜¯æ¬ºéª—é‰´åˆ«å™¨ï¼Œä¸é‰´åˆ«å™¨çš„åšæ³•ç›¸åã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def d_loss_fn(real_pred, fake_pred):</span><br><span class="line">    real_loss = F.softplus(-real_pred)</span><br><span class="line">    fake_loss = F.softplus(fake_pred)</span><br><span class="line">    return real_loss.mean() + fake_loss.mean()</span><br><span class="line">    </span><br><span class="line">def g_loss_fn(fake_pred):</span><br><span class="line">    loss = F.softplus(-fake_pred).mean()</span><br><span class="line">    return loss</span><br></pre></td></tr></table></figure>

<h2 id="è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–"><a href="#è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–" class="headerlink" title="è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–"></a>è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–</h2><p>åœ¨ StyleGAN ä¸­ï¼Œä½œè€…é‡‡ç”¨äº†ä¸¤ç§ç±»å‹çš„æ­£åˆ™åŒ–ï¼Œå³é‰´åˆ«å™¨çš„ R1 æ­£åˆ™åŒ–å’Œç”Ÿæˆå™¨çš„è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–ï¼Œç”¨äºå¯¹ä¸¤ä¸ªç»„ä»¶æ–½åŠ çº¦æŸã€‚</p>
<p>å¦å¤–ï¼Œä½œè€…è¿˜å‘ç°å¹¶ä¸éœ€è¦åœ¨æ¯æ¬¡æƒé‡æ›´æ–°æ—¶éƒ½åº”ç”¨æ­£åˆ™åŒ–ã€‚ç›¸åï¼Œå¯¹é‰´åˆ«å™¨çš„æ­£åˆ™åŒ–æ¯ 16 æ¬¡æ›´æ–°åº”ç”¨ä¸€æ¬¡ï¼Œå¯¹ç”Ÿæˆå™¨çš„æ­£åˆ™åŒ–æ¯ 8 æ¬¡æ›´æ–°åº”ç”¨ä¸€æ¬¡ï¼Œè¿™è¢«ç§°ä¸ºâ€œæ‡’æƒ°æ­£åˆ™åŒ–â€ã€‚</p>
<h2 id="R1-æ­£åˆ™åŒ–"><a href="#R1-æ­£åˆ™åŒ–" class="headerlink" title="R1 æ­£åˆ™åŒ–"></a>R1 æ­£åˆ™åŒ–</h2><p><img src="/../asset_magiceraser/15.webp"><br>R1 æ­£åˆ™åŒ–ä»…å¯¹çœŸå®æ•°æ®ä¸Šçš„æ¢¯åº¦è¿›è¡Œæƒ©ç½šï¼Œæ—¨åœ¨é˜²æ­¢é‰´åˆ«å™¨ç”Ÿæˆåç¦»æ•°æ®æµå½¢çš„éé›¶æ¢¯åº¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ç”Ÿæˆå™¨äº§ç”ŸçœŸå®æ•°æ®åˆ†å¸ƒæ—¶ï¼Œé‰´åˆ«å™¨åœ¨æ•°æ®æµå½¢ä¸Šçš„è¾“å‡ºç­‰äº 0ï¼ˆé€šå¸¸æ„å‘³ç€é‰´åˆ«å™¨æ— æ³•åŒºåˆ†çœŸå‡æ•°æ®ï¼‰ï¼Œæ¢¯åº¦æƒ©ç½šç¡®ä¿é‰´åˆ«å™¨æ— æ³•ç”Ÿæˆéé›¶æ¢¯åº¦ï¼Œå¦åˆ™ä¼šå¯¼è‡´æŸå¤±å¢åŠ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def r1_loss_fn(real_pred, real_img):</span><br><span class="line">    grad_real, = autograd.grad(</span><br><span class="line">        outputs=real_pred.sum(), inputs=real_img, create_graph=True</span><br><span class="line">    )</span><br><span class="line">    grad_penalty = grad_real.pow(2).reshape(grad_real.shape[0], -1).sum(1).mean()</span><br><span class="line">    return grad_penalty</span><br></pre></td></tr></table></figure>

<h2 id="è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–"><a href="#è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–" class="headerlink" title="è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–"></a>è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–</h2><p><img src="/../asset_magiceraser/16.webp"></p>
<p>è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–æ—¨åœ¨ç¡®ä¿å½“æ‚¨åœ¨æ½œåœ¨ç©ºé—´â€˜wâ€™ï¼ˆw ~ f(z), f: æ˜ å°„ç½‘ç»œï¼‰ä¸­è¿›è¡Œå›ºå®šå¤§å°çš„æ›´æ”¹æ—¶ï¼Œå›¾åƒä¼šäº§ç”Ÿéé›¶ä¸”å›ºå®šå¹…åº¦çš„å˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬è®¡ç®—ç”Ÿæˆå™¨è¾“å‡ºç›¸å¯¹äºâ€˜wâ€™çš„å¯¼æ•°ï¼Œå¹¶å°†å…¶ä¹˜ä»¥éšæœºå™ªå£°â€˜yâ€™ã€‚åœ¨å¯¹è¿™ä¸ªç»“æœåº”ç”¨ L2 èŒƒæ•°ä¹‹åï¼Œæˆ‘ä»¬å†å‡å»å…¶æŒ‡æ•°ç§»åŠ¨å¹³å‡å€¼â€˜aâ€™ã€‚</p>
<p>è¿™ç§æ­£åˆ™åŒ–å¯ä»¥ç¡®ä¿æ½œåœ¨å‘é‡ Z çš„å˜åŒ–ä¸ä¼šå¯¼è‡´ç”Ÿæˆçš„å›¾åƒå‘ç”Ÿå‰§çƒˆå˜åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def g_path_regularize(fake_img, latents, mean_path_length, decay=0.01):</span><br><span class="line">    noise = torch.randn_like(fake_img) / math.sqrt(</span><br><span class="line">        fake_img.shape[2] * fake_img.shape[3]</span><br><span class="line">    )</span><br><span class="line">    grad, = autograd.grad(</span><br><span class="line">        outputs=(fake_img * noise).sum(), inputs=latents, create_graph=True</span><br><span class="line">    )</span><br><span class="line">    path_lengths = torch.sqrt(grad.pow(2).sum(2).mean(1))</span><br><span class="line">    path_mean = mean_path_length + decay * (path_lengths.mean() - mean_path_length)</span><br><span class="line">    path_penalty = (path_lengths - path_mean).pow(2).mean()</span><br><span class="line">    return path_penalty, path_mean.detach(), path_lengths</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œè¿™é‡Œæ˜¯ CoModGAN çš„è®­ç»ƒå¾ªç¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def make_noise(n, latent_dim, device):</span><br><span class="line">    return torch.randn(n, 1, latent_dim).cuda(device)</span><br><span class="line"></span><br><span class="line">def get_g_input(batch, img_size, n_layers, latent_dim, device):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    ** style mixing **</span><br><span class="line">    tt = int(torch.rand(()).numpy() * n_layers)</span><br><span class="line">    style1 = torch.tile(make_noise(batch, latent_dim, device), [1, tt, 1])</span><br><span class="line">    style2 = torch.tile(make_noise(batch, latent_dim, device), [1, n_layers - tt, 1])</span><br><span class="line">    styles = torch.cat([style1, style2], dim=1)</span><br><span class="line">    &#x27;&#x27;&#x27;   </span><br><span class="line">    styles = torch.tile(make_noise(batch, latent_dim, device), [1, n_layers, 1])</span><br><span class="line">    noise = torch.FloatTensor(batch, 1, img_size, img_size).uniform_(0., 1.).cuda(device)</span><br><span class="line">    return styles, noise</span><br><span class="line"></span><br><span class="line">def requires_grad(model, flag=True):</span><br><span class="line">    for p in model.parameters():</span><br><span class="line">        p.requires_grad = flag</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># CoModGAN training Loop</span><br><span class="line">latent_dim = 128</span><br><span class="line">img_size = 128</span><br><span class="line">epochs = 100</span><br><span class="line">num_layers = int(log2(img_size)-1)</span><br><span class="line">d_lazy_reg = 16</span><br><span class="line">g_lazy_reg = 4</span><br><span class="line">mean_path = 0</span><br><span class="line"></span><br><span class="line">device = &quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;</span><br><span class="line">g_model = Generator(img_size, latent_dim).to(device)</span><br><span class="line">d_model = Discriminator(img_size).to(device)</span><br><span class="line">g_optimizer = torch.optim.Adam(g_model.parameters(), lr=0.0001, betas=(0.5, 0.9))</span><br><span class="line">d_optimizer = torch.optim.Adam(d_model.parameters(), lr=0.0001, betas=(0.5, 0.9))</span><br><span class="line"></span><br><span class="line">for epoch in range(epochs):</span><br><span class="line">    for step, (real_img, mask) in enumerate(train_data):</span><br><span class="line">        B = real_img.size(0)</span><br><span class="line">        real_img = real_img.to(device)</span><br><span class="line">        mask = mask.to(device)</span><br><span class="line">        requires_grad(g_model, False)</span><br><span class="line">        requires_grad(d_model, True)</span><br><span class="line">        </span><br><span class="line">        style, noise = get_g_input(B, img_size, num_layers, latent_dim, device)</span><br><span class="line">        fake_img, _ = g_model(real_img, mask, style, noise)</span><br><span class="line">        fake_pred = d_model(fake_img, mask)</span><br><span class="line">        real_pred = d_model(real_img, mask)</span><br><span class="line">        d_loss = d_loss_fn(real_pred, fake_pred)</span><br><span class="line">        d_model.zero_grad()</span><br><span class="line">        d_loss.backward()</span><br><span class="line">        d_optimizer.step()</span><br><span class="line"></span><br><span class="line">        d_lazy = step % d_lazy_reg == 0</span><br><span class="line">        if d_lazy:</span><br><span class="line">            real_img.requires_grad = True</span><br><span class="line">            real_pred = d_model(real_img, mask)</span><br><span class="line">            r1_loss = r1_loss_fn(real_pred, real_img)</span><br><span class="line"></span><br><span class="line">            d_model.zero_grad()</span><br><span class="line">            (10 / 2 * r1_loss * d_lazy_reg).backward()</span><br><span class="line">            d_optimizer.step()</span><br><span class="line">            </span><br><span class="line">        requires_grad(g_model, True)</span><br><span class="line">        requires_grad(d_model, False)</span><br><span class="line">        style, noise = get_g_input(B, img_size, num_layers, latent_dim, device)</span><br><span class="line">        fake_img, _ = g_model(real_img, mask, style, noise)</span><br><span class="line">        fake_pred = d_model(fake_img, mask)</span><br><span class="line">        g_loss = g_loss_fn(fake_pred)</span><br><span class="line">        g_model.zero_grad()</span><br><span class="line">        g_loss.backward()</span><br><span class="line">        g_optimizer.step()</span><br><span class="line">        g_lazy = step % g_lazy_reg == 0</span><br><span class="line">        </span><br><span class="line">        if g_lazy:</span><br><span class="line">            style, noise = get_g_input(B, img_size, num_layers, latent_dim, device)</span><br><span class="line">            fake_img, _, latent = g_model(real_img, mask, style.requires_grad_(), </span><br><span class="line">                                          noise, return_latent=True)</span><br><span class="line">            path_loss, mean_path_new, path_lengths = g_path_regularize(fake_img, latent, mean_path)</span><br><span class="line">            g_model.zero_grad()</span><br><span class="line">            mean_path = mean_path_new</span><br><span class="line">            pr_loss = 2 * g_lazy_reg * path_loss</span><br><span class="line">            pr_loss.backward()</span><br><span class="line">            g_optimizer.step()</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>é¡¶éƒ¨çš„å›¾åƒæ˜¯ç”± CoModGAN ç”Ÿæˆçš„ï¼Œè€Œåº•éƒ¨çš„å›¾åƒæ˜¯çœŸå®å›¾åƒæ•°æ®ã€‚</p>
<p>å°½ç®¡ç”Ÿæˆçš„ç»“æœä¸çœŸå®æ•°æ®ä¹‹é—´å­˜åœ¨ä¸€äº›å°å·®å¼‚ï¼Œä½†å°±ç”Ÿæˆåˆç†å›¾åƒè€Œè¨€ï¼Œæˆ‘è®¤ä¸º CoModGAN çš„è¡¨ç°å·²ç»å¯ä»¥æ¥å—äº†</p>
<p><img src="/../asset_magiceraser/17.webp"></p>
<p><img src="/../asset_magiceraser/18.webp"></p>
<p><img src="/../asset_magiceraser/19.webp"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/revealing-the-secrets-of-googles-magic-eraser-fb232c83723b">https://levelup.gitconnected.com/revealing-the-secrets-of-googles-magic-eraser-fb232c83723b</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/16/falkordb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/16/falkordb/" class="post-title-link" itemprop="url">FalkorDB çŸ¥è¯†å›¾è°± for RAG</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-16 19:56:22 / ä¿®æ”¹æ—¶é—´ï¼š20:09:09" itemprop="dateCreated datePublished" datetime="2024-04-16T19:56:22+08:00">2024-04-16</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>923</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>2 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>åœ¨é€‰æ‹©é€‚åˆæ‚¨çš„ RAG åº”ç”¨ç¨‹åºçš„æ­£ç¡®çŸ¥è¯†å›¾æ—¶ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šå› ç´ ã€‚å›¾æ•°æ®åº“åº”è¯¥è½»é‡ä¸”å…·æœ‰è¾ƒä½çš„å»¶è¿Ÿï¼Œä»¥å®ç°æ›´é«˜çš„æ€§èƒ½ã€‚æŸ¥è¯¢è¯­è¨€åº”è¯¥è¶³å¤Ÿè¡¨è¾¾æ€§ï¼Œä»¥æ”¯æŒå¤æ‚çš„å›¾éå†è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚å›¾å½¢ç†æƒ³æƒ…å†µä¸‹è¿˜åº”è®¾è®¡ä¸ºå…·æœ‰è¾ƒä½çš„å†…å­˜å ç”¨é‡ â€” è¿™æ ·å¯ä»¥èŠ‚çœé•¿æœŸèµ„æºå¼€é”€ã€‚</p>
<p>è€ƒè™‘åˆ°ä¸Šè¿°å› ç´ ï¼Œæˆ‘å‘ç°çŸ¥è¯†å›¾è°± FalkorDB æ˜¯ä¸€ä¸ªè½»é‡çº§ä¸”é«˜æ€§èƒ½çš„å›¾å½¢æ¡†æ¶ï¼Œé€‚ç”¨äºæ„å»ºäººå·¥æ™ºèƒ½åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯åŸå› ï¼š</p>
<h3 id="ä½å»¶è¿Ÿ"><a href="#ä½å»¶è¿Ÿ" class="headerlink" title="ä½å»¶è¿Ÿ"></a>ä½å»¶è¿Ÿ</h3><p>FalkorDB æ—¨åœ¨ä¸ºå¤æ‚çš„å›¾éå†æä¾›å¿«é€Ÿçš„æŸ¥è¯¢æ‰§è¡Œã€‚å®ƒæ„å»ºåœ¨å…¶å‰èº« RedisGraph ä¹‹ä¸Šï¼Œåˆ©ç”¨å†…å­˜å¤„ç†æŠ€æœ¯åŠ å¿«æŸ¥è¯¢æ‰§è¡Œé€Ÿåº¦ã€‚é€šè¿‡å°†ç›¸å…³æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å‡å°‘ä¸ç£ç›˜ I&#x2F;O æ“ä½œç›¸å…³çš„å»¶è¿Ÿã€‚</p>
<h3 id="é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„"><a href="#é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„" class="headerlink" title="é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„"></a>é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„</h3><p>FalkorDB å…è®¸åˆ›å»º<a target="_blank" rel="noopener" href="https://www.falkordb.com/scale-out/">å¤šä¸ªè¯»å–å‰¯æœ¬</a>ï¼Œå®ç°æ•°æ®é›†å’Œå›¾å½¢åœ¨å„ä¸ªæœåŠ¡å™¨ä¹‹é—´çš„åˆ†å¸ƒã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸ä¸»æ•°æ®åº“åŒæ­¥çš„æ•°æ®åº“å‰¯æœ¬ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†è¯»å–æŸ¥è¯¢ï¼ˆåœ¨å‰¯æœ¬ä¸Šè¿è¡Œï¼‰ä¸å†™å…¥æŸ¥è¯¢ï¼ˆåœ¨ä¸»æ•°æ®åº“ä¸Šè¿è¡Œï¼‰åˆ†å¼€ã€‚</p>
<p>è¿™ç§æ–¹æ³•ä¼˜åŒ–äº†è¯»å†™æ“ä½œè·¯ç”±åˆ°é€‚å½“å‰¯æœ¬çš„è¿‡ç¨‹ï¼Œç¡®ä¿æ“ä½œçš„é«˜ååé‡å’Œè¾ƒä½çš„å»¶è¿Ÿã€‚</p>
<h3 id="å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ"><a href="#å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ" class="headerlink" title="å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ"></a>å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ</h3><p>è¿™å…è®¸å°†æ•°æ®å­˜å‚¨ä¸ºé«˜ç»´åµŒå…¥ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨ç›¸ä¼¼æ€§æœç´¢æ‰¾åˆ°å®ä½“ â€” èŠ‚ç‚¹å’Œè¾¹ã€‚è¿™æ ·ï¼Œç”¨æˆ·çš„å“åº”å¯ä»¥æ‰©å±•åˆ°è¿˜åŒ…æ‹¬ä¸è¾“å…¥æŸ¥è¯¢åœ¨è¯­ä¹‰ä¸Šç›¸ä¼¼çš„æ•°æ®ã€‚</p>
<h3 id="æ”¯æŒ-AI-æ¡†æ¶"><a href="#æ”¯æŒ-AI-æ¡†æ¶" class="headerlink" title="æ”¯æŒ AI æ¡†æ¶"></a>æ”¯æŒ AI æ¡†æ¶</h3><p>FalkorDB æä¾›æ”¯æŒå’Œæ–‡æ¡£ï¼Œç”¨äºå¤„ç† AI æ¡†æ¶ï¼Œå¦‚ LangChain å’Œ LLamaIndexã€‚é€šè¿‡å°†å…¶ä¸LLMè¿æ¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å—æ¥åˆ›å»ºå›¾ç´¢å¼•å’ŒæŸ¥è¯¢å¼•æ“å¯¹è±¡ã€‚è¿™äº›é›†æˆä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå…¨é¢çš„å·¥å…·åŒ…ï¼Œç”¨äºæ„å»ºåƒæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç®¡é“è¿™æ ·çš„é«˜çº§ AI åº”ç”¨ç¨‹åºã€‚</p>
<h3 id="äº¤äº’å¼å›¾æµè§ˆå™¨"><a href="#äº¤äº’å¼å›¾æµè§ˆå™¨" class="headerlink" title="äº¤äº’å¼å›¾æµè§ˆå™¨"></a>äº¤äº’å¼å›¾æµè§ˆå™¨</h3><p>FalkorDB é…å¤‡äº†å›¾æµè§ˆå™¨ï¼Œå…è®¸äº¤äº’å¼æŸ¥çœ‹å’ŒæŸ¥è¯¢å›¾å½¢ã€‚æ‚¨å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://github.com/FalkorDB/falkordb-browser">è¿™é‡Œ</a>æŸ¥çœ‹ FalkorDB å›¾æµè§ˆå™¨ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å•å‡»èŠ‚ç‚¹å’Œè¾¹ï¼Œå±•å¼€æˆ–æŠ˜å å­å›¾ï¼Œå¹¶æ”¾å¤§æˆ–ç¼©å°ä»¥èšç„¦ç‰¹å®šæ„Ÿå…´è¶£çš„åŒºåŸŸæ¥æµè§ˆå›¾å½¢ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>FalkorDB çš„å†…å­˜å¤„ç†æŠ€æœ¯å’Œé«˜æ•ˆçš„å†…å­˜åˆ©ç”¨ç‡ï¼Œç›¸è¾ƒäºé‡‡ç”¨åŸºäºç£ç›˜å­˜å‚¨æ–¹æ³•çš„å›¾å½¢ï¼Œæœ‰åŠ©äºæ›´å¿«åœ°æ‰§è¡ŒæŸ¥è¯¢å¹¶å‡å°‘å»¶è¿Ÿã€‚å¯¹å„ç§äººå·¥æ™ºèƒ½æ¡†æ¶çš„æ”¯æŒå’Œæ–‡æ¡£ä¸ºæ„å»ºäººå·¥æ™ºèƒ½åº”ç”¨ç¨‹åºå¢æ·»äº†å…¶ç¨³å¥æ€§ã€‚<br>è¿™äº›ç‰¹æ€§ä½¿å¾— FalkorDB æˆä¸ºæ„å»ºå¯æ‰©å±•å’Œé«˜æ€§èƒ½ RAG åº”ç”¨ç¨‹åºçš„æä½³é€‰æ‹©ã€‚åŸºäºçŸ¥è¯†å›¾çš„ RAG æ¨¡å‹æœ‰æœ›é€šè¿‡ç”Ÿæˆæ›´å‡†ç¡®ã€ä¿¡æ¯ä¸°å¯Œå’Œè¿è´¯çš„å“åº”æ¥å½»åº•æ”¹å˜è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/12/autogenstudio-mistral/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/12/autogenstudio-mistral/" class="post-title-link" itemprop="url">ç”¨AutoGen Studio ä¸æœ¬åœ° Mistral AI æ¨¡å‹æ¥å®è·µç”Ÿæˆå¼AIä»£ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-12 20:20:13" itemprop="dateCreated datePublished" datetime="2024-04-12T20:20:13+08:00">2024-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-28 19:55:24" itemprop="dateModified" datetime="2024-04-28T19:55:24+08:00">2024-04-28</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>25 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>AutoGen æ˜¯ç”± Microsoft å¼€å‘çš„æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–å¤šä»£ç†åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼–æ’ LLM ä»£ç†æ–¹é¢ã€‚</p>
<p>å¤šæ™ºèƒ½ä½“åº”ç”¨ç¨‹åºæ¶‰åŠå¤šä¸ª LLM æˆ–å¤šæ¨¡å¼æ™ºèƒ½ä½“æˆ–å®ä½“åœ¨æ•´ä¸ªå·¥ä½œæµç¨‹ä¸­ç›¸äº’äº¤äº’ä»¥å®ç°ç‰¹å®šç›®æ ‡æˆ–ä»»åŠ¡çš„ç³»ç»Ÿã€‚è¿™äº›ä»£ç†å¯ä»¥æ˜¯ LLM ä»£ç†ã€æ£€ç´¢ä»£ç†æˆ–å…¶ä»–èƒ½å¤Ÿåšå‡ºç‹¬ç«‹å†³ç­–ã€å‡½æ•°è°ƒç”¨æˆ–æ‰§è¡Œæ“ä½œçš„ä»£ç†ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»AutoGen Studioç›´è§‚çš„æ— ä»£ç å¹³å°ä¸æœ¬åœ°é›†æˆçš„Mistral AIæ¨¡å‹çš„èåˆã€‚è¿™ç§ç»„åˆä¸ä»…ä»…æ˜¯ä¸ºäº†è®©äººå·¥æ™ºèƒ½æ›´å®¹æ˜“åº”ç”¨;å®ƒè¿˜æ¶‰åŠä¿ƒè¿›æˆ‘ä»¬å¦‚ä½•åœ¨è®¸å¤šç°å®ç”Ÿæ´»ä¸­çš„è¡Œä¸šå·¥ä½œæµç¨‹ä¸­ä¸ä¸åŒçš„ç”Ÿæˆå¼ AI ä»£ç†è¿›è¡Œäº¤äº’ã€éƒ¨ç½²å¹¶ä»ä¸­å—ç›Šã€‚</p>
<p><img src="/../asset_autogenmistral/01.png"></p>
<h2 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h2><h3 id="å®‰è£…autogen-studio"><a href="#å®‰è£…autogen-studio" class="headerlink" title="å®‰è£…autogen studio"></a>å®‰è£…autogen studio</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install autogenstudio</span><br></pre></td></tr></table></figure>


<h3 id="å®‰è£…mistral"><a href="#å®‰è£…mistral" class="headerlink" title="å®‰è£…mistral"></a>å®‰è£…mistral</h3><p>å…ˆå®‰è£…ollama</p>
<ul>
<li><p>Ollama æ˜¯ä¸€ä¸ªæä¾›å¯¹å¤§å‹è¯­è¨€æ¨¡å‹çš„è®¿é—®çš„å¹³å°ã€‚å®‰è£… Ollama æ˜¯ç¬¬ä¸€æ­¥ï¼Œå› ä¸ºå®ƒæ˜¯è¿è¡Œ Mistral æ¨¡å‹çš„ç¯å¢ƒã€‚å®ƒå…è®¸æ‚¨è‡ªå®šä¹‰å’Œåˆ›å»ºè‡ªå·±çš„æ¨¡å‹æˆ–è¿è¡Œç°æœ‰æ¨¡å‹ï¼Œå¦‚ Llama 2ã€Code Llama å’Œ Mistralã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½ollamaï¼š <a target="_blank" rel="noopener" href="https://ollama.ai/">https://ollama.ai/</a> ï¼Œ é€‰æ‹©downloadï¼Œé€‰æ‹©linuxç‰ˆæœ¬ï¼Œå› ä¸ºmistral 7Béœ€è¦24GB æ˜¾å¡ï¼Œæˆ‘æ²¡æœ‰ï¼Œåªèƒ½å»äº‘ç«¯çš„linuxæœºå™¨ä¸Šå®‰è£…ollamaã€‚</p>
</li>
<li><p>è¿è¡Œ Ollama Mistralï¼šæŒ‰ç…§ä»¥ä¸‹å‘½ä»¤ä» Ollama å¹³å°å¯åŠ¨ Mistral æ¨¡å‹ï¼Œä½¿å…¶å‡†å¤‡å¥½å¤„ç†è¯·æ±‚ã€‚æ­¤å‘½ä»¤åˆå§‹åŒ–ç”¨äºè®¾ç½®æ¨¡å‹ã€åŠ è½½å¿…è¦æ•°æ®ä»¥åŠå¯åŠ¨å°†å¤„ç†æŸ¥è¯¢å¤„ç†çš„æœåŠ¡çš„è¿›ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run mistral</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¯´æ²¡æœ‰ollama appï¼Œå°±èµ·ä¸€ä¸ªconsoleï¼Œæ‰§è¡Œ ollama serveï¼Œç„¶ååœ¨å¦å¤–ä¸€ä¸ªconsoleæ‰§è¡Œollama run mistralã€‚æ‰§è¡Œå®Œæµ‹è¯•ä¸€ä¸‹mistralï¼Œå°±å¯ä»¥æŠŠä¸¤ä¸ªè¿›ç¨‹éƒ½æ€æ‰äº†ã€‚</p>
</li>
<li><p>å®‰è£… LiteLLMï¼šLiteLLM åº“æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæœ‰åŠ©äºä» http ç«¯ç‚¹è¿è¡Œè¯­è¨€æ¨¡å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install litellm --upgrade</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£… Gunicornï¼šGunicorn æ˜¯ç”¨äº UNIX ç³»ç»Ÿçš„ Python WSGI HTTP æœåŠ¡å™¨ï¼Œç”¨äºè¿è¡Œ Python Web åº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯è¿è¡Œ LiteLLM ä»£ç†çš„å…ˆå†³æ¡ä»¶ï¼Œå®ƒå…è®¸æ‚¨å‘è¯­è¨€æ¨¡å‹å‘å‡ºæœ¬åœ° HTTP è¯·æ±‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gunicorn</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="è¿è¡Œ-Mistral-æ¨¡å‹"><a href="#è¿è¡Œ-Mistral-æ¨¡å‹" class="headerlink" title="è¿è¡Œ Mistral æ¨¡å‹"></a>è¿è¡Œ Mistral æ¨¡å‹</h2><p>ä½¿ç”¨ Ollama&#x2F;Mistral æ¨¡å‹è¿è¡Œ LiteLLMï¼šæ­¤æ­¥éª¤å®é™…ä¸Šåˆå§‹åŒ–æ¨¡å‹å¹¶ä½¿å…¶å‡†å¤‡å¥½è¿è¡Œã€‚æ­¤å‘½ä»¤å‘Šè¯‰ LiteLLM ä½¿ç”¨ Ollama æä¾›çš„ Mistral æ¨¡å‹ã€‚å®ƒä¸ºäº¤äº’å‡†å¤‡æ¨¡å‹ï¼Œå…è®¸æ‚¨å¼€å§‹è¿›è¡ŒæŸ¥è¯¢å’Œæ¥æ”¶å“åº”ã€‚</p>
<p>åœ¨æ­¤è¿‡ç¨‹ç»“æŸæ—¶ï¼Œæœ¬åœ° Mistral æ¨¡å‹ä» 0.0.0.0ï¼š4000 å¼€å§‹ï¼Œæœ‰ 1 ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">litellm --model ollama/mistral</span><br></pre></td></tr></table></figure>


<h2 id="è¿è¡Œ-Autogen-Studio"><a href="#è¿è¡Œ-Autogen-Studio" class="headerlink" title="è¿è¡Œ Autogen Studio"></a>è¿è¡Œ Autogen Studio</h2><p>é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹æ¥è¿è¡Œ Web UIï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autogenstudio ui --port 6006</span><br></pre></td></tr></table></figure>

<p>AutoGen Studio æä¾›äº†ä¸€ä¸ªç®€åŒ–ä¸”ç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œæœ‰åŠ©äºåˆ›å»ºå’Œç®¡ç†å¤šä»£ç† AI åº”ç”¨ç¨‹åºã€‚è¯¥ç•Œé¢åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼ŒåŒ…æ‹¬æŠ€èƒ½ã€æ¨¡å‹ã€ä»£ç†å’Œå·¥ä½œæµï¼Œæ¯ä¸ªéƒ¨åˆ†åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­éƒ½å‘æŒ¥ç€ä¸å¯æˆ–ç¼ºçš„ä½œç”¨ã€‚</p>
<h3 id="æŠ€èƒ½"><a href="#æŠ€èƒ½" class="headerlink" title="æŠ€èƒ½"></a>æŠ€èƒ½</h3><p>åœ¨â€œæŠ€èƒ½â€éƒ¨åˆ†ä¸­ï¼Œç”¨æˆ·å¯ä»¥å¼€å‘å’Œå­˜å‚¨ä»£ç†å°†ç”¨äºè§£å†³ä»»åŠ¡çš„ Python å‡½æ•°ã€‚å®ƒæ˜¯ä¸€ä¸ªç¼–ç¨‹ç¯å¢ƒï¼Œåœ¨å…¶ä¸­å®šä¹‰å’Œä¼˜åŒ–åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚<br><img src="/../asset_autogenmistral/06.png"></p>
<h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>åœ¨æ¨¡å‹éƒ¨åˆ†ï¼Œç”¨æˆ·å¯ä»¥é…ç½®å’Œç®¡ç† AI æ¨¡å‹ï¼ŒåŒ…æ‹¬ GPT-4 å’Œå…¶ä»–æœ¬åœ°æˆ–è‡ªå®šä¹‰æ¨¡å‹ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥è®¾ç½® Mistral AI ç­‰æ¨¡å‹ï¼Œè¡¨æ˜å·¥ä½œå®¤æ”¯æŒæœ¬åœ° AI æ¨¡å‹é›†æˆå’Œç®¡ç†ã€‚è¿™ç§çµæ´»æ€§å…è®¸ä½¿ç”¨å¼ºå¤§çš„æ¨¡å‹ï¼Œå¦‚ OpenAI çš„ GPT-4ï¼Œä»¥åŠä¸ºç‰¹å®šä»»åŠ¡é‡èº«å®šåˆ¶çš„ä¸“æœ‰æˆ–ä¸“ç”¨æ¨¡å‹ã€‚<br><img src="/../asset_autogenmistral/07.png"></p>
<h3 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><p>â€œä»£ç†â€éƒ¨åˆ†è®¾è®¡ç”¨äºé…ç½®å¯é‡ç”¨ä»£ç†ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºå’Œå®šä¹‰å„ç§ä»£ç†çš„è§’è‰²ï¼Œä¾‹å¦‚æœ¬åœ°åŠ©ç†ã€ä¸»è¦ä»£ç†å’Œç”¨æˆ·ä»£ç†ï¼Œåè°ƒå®ƒä»¬åœ¨åº”ç”¨å·¥ä½œæµä¸­çš„äº¤äº’æ–¹å¼ã€‚<br><img src="/../asset_autogenmistral/08.png"></p>
<h3 id="å·¥ä½œæµ"><a href="#å·¥ä½œæµ" class="headerlink" title="å·¥ä½œæµ"></a>å·¥ä½œæµ</h3><p>â€œå·¥ä½œæµâ€éƒ¨åˆ†æ˜¯å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹ã€‚ç”¨æˆ·å¯ä»¥è®¾è®¡å¤æ‚çš„å·¥ä½œæµï¼Œä»¥å®šä¹‰ç³»ç»Ÿå¦‚ä½•å¤„ç†ä»»åŠ¡ã€‚è¿™æ˜¯æ‰€æœ‰ç»„ä»¶èšé›†åœ¨ä¸€èµ·çš„åœ°æ–¹ï¼šæŠ€èƒ½æä¾›é€»è¾‘ï¼Œæ¨¡å‹æä¾› AI çš„æ™ºèƒ½ï¼Œä»£ç†å¯¹ä»»åŠ¡é‡‡å–è¡ŒåŠ¨ï¼Œå·¥ä½œæµå°†æ‰€æœ‰ç»„ä»¶è¿æ¥åˆ°ä¸€ä¸ªè¿è´¯çš„ç³»ç»Ÿä¸­ã€‚<br><img src="/../asset_autogenmistral/09.png"></p>
<h2 id="ä½¿ç”¨-AutoGen-å’Œ-Mistral-AI-è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š"><a href="#ä½¿ç”¨-AutoGen-å’Œ-Mistral-AI-è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š" class="headerlink" title="ä½¿ç”¨ AutoGen å’Œ Mistral AI è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š"></a>ä½¿ç”¨ AutoGen å’Œ Mistral AI è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š</h2><p>åœ¨æˆ‘ä»¬æƒ³è¦ç¼–å†™ä¸€ä¸ª Python è„šæœ¬æ¥ç»˜åˆ¶æ­£å¼¦æ³¢å¹¶å°†å…¶ä¿å­˜ä¸ºâ€œsine_wave.pngâ€æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼ŒAutoGen å’Œ Mistral AI å¯ä»¥ä¸€èµ·ä½¿ç”¨æ¥åˆ›å»ºç®€åŒ–çš„å·¥ä½œæµç¨‹ã€‚AutoGen Studio ç”¨ä½œæ„å»ºå’Œç®¡ç†å¤šæ™ºèƒ½ä½“åº”ç”¨ç¨‹åºçš„æ¥å£ï¼Œè€Œ Mistral AI åˆ™é€šè¿‡å…¶æœ¬åœ°æ¨¡å‹æä¾›å¤„ç†èƒ½åŠ›ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå¹³å°çš„åŠŸèƒ½è¿›è¡Œç¼–æ’çš„å·¥ä½œæ–¹å¼ï¼š</p>
<h3 id="æ¨¡å‹é…ç½®"><a href="#æ¨¡å‹é…ç½®" class="headerlink" title="æ¨¡å‹é…ç½®"></a>æ¨¡å‹é…ç½®</h3><p>åœ¨ AutoGen Studio ä¸­è®¾ç½®äº†ä¸€ä¸ªåä¸ºâ€œmistral local modelâ€çš„æ¨¡å‹ï¼Œç”¨äºä¸ Mistral AI è¿›è¡Œäº¤äº’ã€‚<br>æ¨¡å‹çš„ API ç«¯ç‚¹å°†é…ç½®ä¸ºè¿è¡Œ Mistral AI çš„æœ¬åœ°æœåŠ¡å™¨åœ°å€ï¼ˆä¾‹å¦‚ï¼Œ<a href="http://0.0.0.0:4000ï¼‰ã€‚">http://0.0.0.0:4000ï¼‰ã€‚</a><br>æ­¤è®¾ç½®å…è®¸ AutoGen Studio å°†æ•°æ®å‘é€åˆ° Mistral AI æ¨¡å‹å¹¶æ¥æ”¶å¤„ç†åçš„ç»“æœã€‚</p>
<p><img src="/../asset_autogenmistral/02.png"></p>
<p>å› ä¸ºæˆ‘ä»¬æœ‰ LiteLLM ä»£ç†æœåŠ¡å™¨çš„ URL <a href="http://0.0.0.0:4000ï¼Œå¯ä»¥åœ¨">http://0.0.0.0:4000ï¼Œå¯ä»¥åœ¨</a> AutoGen ä¸­ä½¿ç”¨å®ƒï¼Œå°±åƒä½¿ç”¨ OpenAI æˆ–åŸºäºäº‘çš„ä»£ç†æœåŠ¡å™¨ä¸€æ ·ã€‚</p>
<p>ç”±äºåœ¨æœ¬åœ°è¿è¡Œæ­¤ä»£ç†æœåŠ¡å™¨ï¼Œå› æ­¤ä¸éœ€è¦ API å¯†é’¥ã€‚æ­¤å¤–ï¼Œç”±äºæ¨¡å‹æ˜¯åœ¨è¿è¡Œ LiteLLM å‘½ä»¤æ—¶è®¾ç½®çš„ï¼Œå› æ­¤ä¸éœ€è¦åœ¨ AutoGen ä¸­é…ç½®æ¨¡å‹åç§°ã€‚ä½†æ˜¯ï¼Œmodel typeå’Œapi keyæ˜¯ Aâ€‹â€‹utoGen ä¸­é…ç½®çš„å¿…å¡«å­—æ®µï¼Œå› æ­¤æˆ‘ä»¬åœ¨å…¶ä¸­æ”¾ç½®è™šæ‹Ÿå€¼ NotRequired ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<h3 id="ä»£ç†é…ç½®"><a href="#ä»£ç†é…ç½®" class="headerlink" title="ä»£ç†é…ç½®"></a>ä»£ç†é…ç½®</h3><p>æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªä»£ç†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹primary_assistantçš„Modelï¼Œè®¾å®šåˆ°ä¹‹å‰å®šä¹‰çš„mistral local model<br><img src="/../asset_autogenmistral/03.png"></p>
<h3 id="åˆ›å»ºå·¥ä½œæµ"><a href="#åˆ›å»ºå·¥ä½œæµ" class="headerlink" title="åˆ›å»ºå·¥ä½œæµ"></a>åˆ›å»ºå·¥ä½œæµ</h3><ul>
<li>åœ¨AutoGen Studioä¸­ï¼Œå°†å¯åŠ¨ä¸€ä¸ªæ–°çš„å·¥ä½œæµï¼ŒæŒ‡å®šç”¨äºç”Ÿæˆæ­£å¼¦æ³¢å›¾åƒçš„ç‰¹å®šä»»åŠ¡ã€‚</li>
<li>æˆ‘ä»¬ä½¿ç”¨åç§°é…ç½®å·¥ä½œæµï¼Œä¾‹å¦‚â€œlocal mistral Agent Workflowâ€ã€‚</li>
<li>å·¥ä½œæµè§„èŒƒåŒ…æ‹¬å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä»£ç†ï¼Œå…¶ä¸­â€œuserproxyâ€å¯ä»¥æ˜¯å‘èµ·è¯·æ±‚çš„å‘é€æ–¹ï¼Œâ€œprimary_assistantâ€æ˜¯å¤„ç†è¯·æ±‚å¹¶æä¾›è¾“å‡ºçš„æ¥æ”¶æ–¹ã€‚</li>
<li>userproxyä»£ç†çš„è§’è‰²å°†ä¸ç”¨æˆ·äº¤äº’å¹¶æ‰§è¡Œprimary_assistantç”Ÿæˆçš„ä»£ç ã€‚å¦‚æœä»£ç ä¸­æœ‰ä»»ä½•é”™è¯¯ï¼Œå°†é”™è¯¯å‘é€ç»™primary_assistantä»£ç†ã€‚</li>
<li>primary_assistantä»£ç†ç”±æœ¬åœ° Mistral AI æ¨¡å‹æˆæƒï¼Œå®ƒå°†åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ç”Ÿæˆä»£ç ã€‚å¦‚æœé”™è¯¯ï¼Œæ ¹æ®userproxyä»£ç†å‘é€çš„æ‰§è¡Œé”™è¯¯ä¿¡æ¯é‡æ–°è°ƒæ•´ä»£ç ã€‚</li>
</ul>
<p><img src="/../asset_autogenmistral/04.png"></p>
<h3 id="å»ºç«‹å¹¶è¿è¡Œä¼šè¯"><a href="#å»ºç«‹å¹¶è¿è¡Œä¼šè¯" class="headerlink" title="å»ºç«‹å¹¶è¿è¡Œä¼šè¯"></a>å»ºç«‹å¹¶è¿è¡Œä¼šè¯</h3><p>åœ¨playgroundæ–°å»ºä¸€ä¸ªsessionï¼Œ</p>
<p><img src="/../asset_autogenmistral/05.png"></p>
<ul>
<li>ä¹‹ååœ¨AutoGen Studioçš„â€œPlaygroundâ€ç•Œé¢ä¸­ï¼Œç”¨æˆ·é€šè¿‡é€‰æ‹©â€œLocal mistral Agent Workflowâ€æ¥å¯åŠ¨ä¸€ä¸ªæ–°ä¼šè¯ã€‚</li>
<li>ç”¨æˆ·è¾“å…¥â€œwrite a python script to plot a sine wave and save it to disc as a pngfile sina_wave.pngâ€è¯·æ±‚ã€‚</li>
<li>è¯·æ±‚ç”±userproxyä»£ç†å‘é€åˆ°primary_assistantä»£ç†ï¼Œè¯¥ä»£ç†åˆ©ç”¨ Mistral AI æ¨¡å‹ã€‚å®ƒç”Ÿæˆ Python è„šæœ¬ï¼Œuserproxyä»£ç†æ‰§è¡Œä»£ç ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™å°†å…¶å‘é€å›primary_assistantä»£ç†ã€‚primary_assistantä»£ç†é‡æ–°è°ƒæ•´ä»£ç å¹¶å°†å…¶å‘é€å›userproxyä»£ç†ï¼Œç›´åˆ°ä»£ç æ­£å¸¸å·¥ä½œå¹¶åˆ›å»ºæ­£å¼¦æ³¢å›¾åƒã€‚</li>
</ul>
<p><img src="/../asset_autogenmistral/10.webp"></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>AutoGen Studio ä¸æœ¬åœ° Mistral AI æ¨¡å‹ä¸€èµ·å±•ç¤ºäº†åœ¨ç¼–æ’ GenAI ä»£ç†å·¥ä½œæµç¨‹æ–¹é¢çš„é‡å¤§è¿›å±•ã€‚è¿™ç§æ¶æ„æœ‰åˆ©äº AutoGen Studio çš„ç›´è§‚è®¾è®¡å’Œ Mistral AI çš„å‡ºè‰²æ€§èƒ½ï¼Œæ„å»ºä¸€ä¸ªå¤šæ™ºèƒ½ä½“èƒ½å¤Ÿåšå‡ºè´¡çŒ®çš„ç¯å¢ƒã€‚</p>
<p>å°† AutoGen Studio ä¸æœ¬åœ° Mistral AI æ¨¡å‹ç»“åˆä½¿ç”¨çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ˜“äºé›†æˆï¼šæœ¬åœ° Mistral AI æ¨¡å‹å¯ä»¥è½»æ¾é›†æˆåˆ° AutoGen Studio ä¸­ï¼Œä»è€Œç®€åŒ–äº†å°†ä¸åŒ LLM æ¨¡å‹æ•´åˆåˆ°ä¸€ä¸ªéƒ¨ç½²ä¸­çš„è¿‡ç¨‹ï¼Œä»è€Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ã€‚</li>
<li>å®šåˆ¶å’Œçµæ´»æ€§ï¼šå¼€å‘äººå‘˜å¯ä»¥å®šåˆ¶ AI æ¨¡å‹ä»¥æ»¡è¶³ç‰¹å®šè¦æ±‚ï¼Œæä¾›å®Œå…¨é€‚åˆå•ä¸ªé¡¹ç›®ä¸åŒéœ€æ±‚çš„å®šåˆ¶è§£å†³æ–¹æ¡ˆã€‚</li>
<li>å¢å¼ºçš„æ€§èƒ½ï¼šä½¿ç”¨ AutoGen åœ¨æœ¬åœ°è¿è¡Œ AI æ¨¡å‹å¯å‡å°‘å»¶è¿Ÿå¹¶ç¼©çŸ­å“åº”æ—¶é—´ï¼Œè¿™å¯¹äºå®æ—¶åº”ç”¨ç¨‹åºå’Œæ•æ„Ÿå·¥ä½œæµè‡³å…³é‡è¦ã€‚</li>
<li>æ•°æ®éšç§å’Œå®‰å…¨ï¼šAI æ¨¡å‹çš„æœ¬åœ°æ‰§è¡Œå¯ä»¥å®Œå…¨æ§åˆ¶æ•°æ®ï¼Œè¿™æ˜¯æ— æ³•æš´éœ²ç»™å¤–éƒ¨ç¯å¢ƒçš„æ•æ„Ÿæˆ–ä¸“æœ‰ä¿¡æ¯çš„å…³é”®å› ç´ ã€‚</li>
<li>æˆæœ¬æ•ˆç›Šï¼šé€šè¿‡æœ€å¤§é™åº¦åœ°å‡å°‘å¯¹åŸºäºäº‘çš„ AI æœåŠ¡çš„ä¾èµ–ï¼Œç»„ç»‡å¯ä»¥æ˜¾è‘—é™ä½ä¸æ•°æ®ä¼ è¾“å’Œ LLM API ä½¿ç”¨ç›¸å…³çš„æˆæœ¬ã€‚</li>
<li>ç¦»çº¿åŠŸèƒ½ï¼šæœ¬åœ° Mistral AI æ¨¡å‹ç¡®ä¿ç³»ç»Ÿå³ä½¿åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿æŒè¿è¡Œï¼Œä»è€Œå®ç° AI é©±åŠ¨è§£å†³æ–¹æ¡ˆçš„ç¦»çº¿åŠŸèƒ½ã€‚</li>
<li>ä½¿ç”¨ UI æ„å»ºå¤æ‚çš„ AI å·¥ä½œæµï¼šç”¨æˆ·å¯ä»¥åˆ©ç”¨AutoGen Studioçš„æ— ä»£ç ç•Œé¢æ¥å¯è§†åŒ–å’Œç®¡ç†æ•´ä¸ªè¿‡ç¨‹ï¼Œè½»æ¾åˆ¶ä½œç²¾å¿ƒè®¾è®¡çš„äººå·¥æ™ºèƒ½é©±åŠ¨çš„å·¥ä½œæµç¨‹ã€‚</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/no-code-genai-agents-workflow-orchestration-autogen-studio-with-local-mistral-ai-model-7566546a16d9">https://towardsdatascience.com/no-code-genai-agents-workflow-orchestration-autogen-studio-with-local-mistral-ai-model-7566546a16d9</a></p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç”±äºåœ¨AutoDLåšäº†ä¸€ä¸ªé•œåƒï¼Œè£…äº†mistralï¼Œå°±é¡ºä¾¿æµ‹è¯•ä¸€ä¸‹å¤šæ–‡ä»¶ä»£ç ç”Ÿæˆã€‚</p>
<h3 id="åˆ›å»ºæ–‡ä»¶-multiple-code-generator-py"><a href="#åˆ›å»ºæ–‡ä»¶-multiple-code-generator-py" class="headerlink" title="åˆ›å»ºæ–‡ä»¶ multiple_code_generator.py"></a>åˆ›å»ºæ–‡ä»¶ multiple_code_generator.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">from litellm import completion</span><br><span class="line">import colorama</span><br><span class="line">from colorama import Fore, Style</span><br><span class="line">import re</span><br><span class="line">import os</span><br><span class="line">def generate_context_prompt(user_input):</span><br><span class="line">    return f&quot; Understand just the context \&quot;&#123;user_input&#125;\&quot;.&quot;</span><br><span class="line"></span><br><span class="line">def generate_features_prompt(system):</span><br><span class="line">    return f&quot; Understand just the context \&quot;&#123;system&#125;\&quot;. Now identify features by expanding for the context and list them&quot;</span><br><span class="line"></span><br><span class="line">def generate_user_stories_prompt(features, system):</span><br><span class="line">    return f&quot; For the features \&quot;&#123;features&#125; and &#123;system&#125;\&quot;: identify user stories for each feature and list them&quot;</span><br><span class="line"></span><br><span class="line">def generate_solution_architecture_prompt(user_stories, system):</span><br><span class="line">    return f&quot; For user stories in \&quot;&#123;user_stories&#125; and &#123;system&#125;\&quot;: list the solution architecture&quot;</span><br><span class="line"></span><br><span class="line">def generate_project_structure_prompt(solution_architecture, user_stories, system):</span><br><span class="line">    return f&quot;&quot;&quot;  </span><br><span class="line">     For the context \&quot;&#123;solution_architecture&#125; and &#123;user_stories&#125; and &#123;system&#125;\&quot;:</span><br><span class="line">        Think about the whole solution.</span><br><span class="line">        Think about overall coding structure based on user stories.</span><br><span class="line">        Think about overall testing structure based on user stories.</span><br><span class="line">        Think about what file refers to what other file and make it as a dependency in the project structure.</span><br><span class="line">        Think about external or framework library references.</span><br><span class="line">        Think above all the edge cases that can come while coding and testing.</span><br><span class="line">        Think that each file will be completed without any &quot;todo&quot; comments for future.</span><br><span class="line">        Envisage to allow only 200 lines per file.</span><br><span class="line">        If more than 200 lines needed separate them into multiple files.</span><br><span class="line">        Do not allow duplication of functionality and code.</span><br><span class="line">        Do not allow duplication of test code.</span><br><span class="line">        Make sure all top level files like main, index, app etc are included if needed.</span><br><span class="line">        Make sure to have proper test files are envisaged.</span><br><span class="line">        It is also must to think about each reference file as needed, like an addition definition in one file and </span><br><span class="line">        Its reference in other file where it is being called and also in corresponding test files.</span><br><span class="line">        Now based on these understandings create project structure with its solution file structure tree, solution files&#x27; dependency tree and solution deployment script tree of the project.</span><br><span class="line">        In both project structure and dependency tree, filename are a must, if they are available</span><br><span class="line">        Expectation here is to output file names and their oneliner description.</span><br><span class="line">        Expectation also contains each files dependent filenames for each coding and testing files.</span><br><span class="line">        Make sure that the project tree structure hold all the necessary folder structures and files in each.  </span><br><span class="line">        Make sure that the dependency tree structure hold all the necessary file name that are to be generated with its dependency files in the solution.</span><br><span class="line">        Make sure that there are relevant test file names</span><br><span class="line">        Make sure that there are only files to be generated in both trees.</span><br><span class="line">        Make sure that only filename will have &quot;.&quot; in the text here.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def extract_filenames_prompt(project_structure):</span><br><span class="line">    return f&quot;extract only file names to be generated from: &#123;project_structure&#125;&quot;</span><br><span class="line"></span><br><span class="line">def generate_file_content_prompt(user_stories, project_structure, filenames, taskcount):</span><br><span class="line">    return f&quot;&quot;&quot;</span><br><span class="line">    Understand the context &#x27;&#123;user_stories&#125;&#x27; as a whole.</span><br><span class="line">    Understand the project structure  &#123;project_structure&#125;.</span><br><span class="line">    Then think about no details but just write file content for &#123;filenames[taskcount]&#125;.</span><br><span class="line">    Refer dependency files in the project structure.</span><br><span class="line">    Write bug free well-formatted file.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def generate_installation_scripts_prompt(features, system):</span><br><span class="line">    return f&quot;&quot;&quot;Based on the features \&quot;&#123;features&#125;\&quot; and system \&quot;&#123;system&#125;\&quot;, generate detailed installation scripts. </span><br><span class="line">           Include environment setup, dependency management, and any necessary system configurations.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def generate_deployment_scripts_prompt(solution_architecture, system):</span><br><span class="line">    return f&quot;&quot;&quot;Considering the solution architecture \&quot;&#123;solution_architecture&#125;\&quot; and system \&quot;&#123;system&#125;\&quot;,</span><br><span class="line">           generate deployment scripts. Focus on automating the deployment process, including server configurations,</span><br><span class="line">           application deployment, and post-deployment checks.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def generate_test_files_prompt(user_stories, system):</span><br><span class="line">    return f&quot;&quot;&quot;For each user story in \&quot;&#123;user_stories&#125;\&quot; and the system \&quot;&#123;system&#125;\&quot;,</span><br><span class="line">           generate comprehensive test files. Ensure coverage for unit tests, integration tests, and any relevant</span><br><span class="line">           end-to-end tests. Focus on testing critical functionalities and edge cases.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># Initialize colorama</span><br><span class="line">colorama.init(autoreset=True)</span><br><span class="line"></span><br><span class="line">roles= &quot;&quot;</span><br><span class="line"></span><br><span class="line">def create_directory(directory_path):</span><br><span class="line">    if not os.path.exists(directory_path):</span><br><span class="line">        os.makedirs(directory_path)</span><br><span class="line">        print(f&quot;Directory &#x27;&#123;directory_path&#125;&#x27; created successfully.&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(f&quot;Directory &#x27;&#123;directory_path&#125;&#x27; already exists.&quot;)</span><br><span class="line"></span><br><span class="line">def extract_content_between_backticks(text):</span><br><span class="line">        pattern = r&#x27;```(.*?)```&#x27;</span><br><span class="line">        return re.findall(pattern, text, re.DOTALL)</span><br><span class="line"></span><br><span class="line">def complete(prompt_function, *args):</span><br><span class="line">            prompt = prompt_function(*args)</span><br><span class="line">            response = completion(</span><br><span class="line">                model=&quot;ollama/mistral&quot;, </span><br><span class="line">                messages=[&#123;&quot;content&quot;: prompt, &quot;role&quot;: &quot;user&quot;&#125;], </span><br><span class="line">                api_base=&quot;http://localhost:11434&quot;,</span><br><span class="line">                stream=True</span><br><span class="line">            )</span><br><span class="line">            resp=&quot;&quot;</span><br><span class="line">            for chunk in response:</span><br><span class="line">                if chunk[&#x27;choices&#x27;][0][&#x27;delta&#x27;][&#x27;content&#x27;] is not None:</span><br><span class="line">                    resp = resp + chunk[&#x27;choices&#x27;][0][&#x27;delta&#x27;][&#x27;content&#x27;]</span><br><span class="line">                    print(Fore.GREEN + chunk[&#x27;choices&#x27;][0][&#x27;delta&#x27;][&#x27;content&#x27;], end=&quot;&quot;)</span><br><span class="line">            resp=resp+&#x27;\n&#x27;</span><br><span class="line">            return resp</span><br><span class="line"></span><br><span class="line">pattern = r&#x27;(\b\w+\.\w+\b)&#x27;</span><br><span class="line"></span><br><span class="line">def extract_filenames(title):</span><br><span class="line">    filenames = re.findall(pattern, title)</span><br><span class="line">    return filenames</span><br><span class="line"></span><br><span class="line">def create_code():</span><br><span class="line">    user_input = &quot;&quot;</span><br><span class="line">    resp = &quot;&lt;&lt;done&gt;&gt;&quot;</span><br><span class="line">    taskcount = -1</span><br><span class="line">    filenames = []</span><br><span class="line">    text = []</span><br><span class="line">    output_log = []  # List to collect all output strings</span><br><span class="line"></span><br><span class="line">    while taskcount &lt; len(filenames):</span><br><span class="line">        input_lines = []</span><br><span class="line">        if &quot;&lt;&lt;done&gt;&gt;&quot; in resp.strip().lower():</span><br><span class="line">            prompt = Fore.YELLOW + &quot;Describe the problem for which coding to be done:&quot;</span><br><span class="line">            print(prompt)</span><br><span class="line">            output_log.append(prompt)  # Collect prompt for output log</span><br><span class="line">            while True:</span><br><span class="line">                line = input()</span><br><span class="line">                if line == &quot;exit&quot;:</span><br><span class="line">                    exit_message = Fore.RED + &quot;Exiting chat.&quot;</span><br><span class="line">                    print(exit_message)</span><br><span class="line">                    output_log.append(&quot;Exiting chat.&quot;)  # Collect exit message without color codes</span><br><span class="line">                    return</span><br><span class="line">                if line == &quot;&quot;:</span><br><span class="line">                    break</span><br><span class="line">                input_lines.append(line)</span><br><span class="line">            user_input = &quot;&quot;.join(input_lines)</span><br><span class="line">            taskcount = 0</span><br><span class="line">            system = complete(generate_context_prompt, user_input)</span><br><span class="line">            features = complete(generate_features_prompt, system)</span><br><span class="line">            user_stories = complete(generate_user_stories_prompt, features, system)</span><br><span class="line">            solution_architecture = complete(generate_solution_architecture_prompt, user_stories, system)</span><br><span class="line">            project_structure = complete(generate_project_structure_prompt, solution_architecture, user_stories, system)</span><br><span class="line">            </span><br><span class="line">            # Generate Installation Scripts</span><br><span class="line">            installation_scripts = complete(generate_installation_scripts_prompt, features, system)</span><br><span class="line">            output_log.append(installation_scripts)  # Collect installation scripts</span><br><span class="line"></span><br><span class="line">            # Generate Deployment Scripts</span><br><span class="line">            deployment_scripts = complete(generate_deployment_scripts_prompt, solution_architecture, system)</span><br><span class="line">            output_log.append(deployment_scripts)  # Collect deployment scripts</span><br><span class="line">            </span><br><span class="line">            # Generate Test Files</span><br><span class="line">            test_files = complete(generate_test_files_prompt, user_stories, system)</span><br><span class="line">            output_log.append(test_files)  # Collect test files</span><br><span class="line"></span><br><span class="line">            filenames_response = complete(extract_filenames_prompt, project_structure)</span><br><span class="line">            filenames = extract_filenames(filenames_response)</span><br><span class="line">            output_log.extend([system, features, user_stories, solution_architecture, project_structure, filenames_response])  # Collect all outputs</span><br><span class="line"></span><br><span class="line">        for filename in filenames:</span><br><span class="line">            prompt = f&quot;\n-------------------------------------------------------\n------------------&#123;filename&#125;----------------\n-------------------------------------------------------\n&quot;</span><br><span class="line">            print(prompt)</span><br><span class="line">            output_log.append(prompt)  # Collect file processing prompt</span><br><span class="line">            resp = complete(generate_file_content_prompt, user_stories, project_structure, filenames, taskcount)</span><br><span class="line">            text.append(resp)</span><br><span class="line">            output_log.append(resp)  # Collect file content</span><br><span class="line">            taskcount += 1</span><br><span class="line"></span><br><span class="line">    out_dir = &quot;generated_output&quot;</span><br><span class="line">    create_directory(out_dir)</span><br><span class="line">    for i, filename in enumerate(filenames):</span><br><span class="line">        with open(f&quot;&#123;out_dir&#125;/&#123;filename&#125;&quot;, &quot;w&quot;) as file:</span><br><span class="line">            extracted_content = extract_content_between_backticks(text[i])</span><br><span class="line">            if extracted_content:</span><br><span class="line">                file_content = extracted_content[0]</span><br><span class="line">                file.write(file_content)</span><br><span class="line">            else:</span><br><span class="line">                error_message = f&quot;No content extracted for &#123;filename&#125;&quot;</span><br><span class="line">                print(error_message)</span><br><span class="line">                output_log.append(error_message)  # Collect error message</span><br><span class="line"></span><br><span class="line">    # Write the collected outputs and logs to a README file</span><br><span class="line">    with open(f&quot;&#123;out_dir&#125;/README.md&quot;, &quot;w&quot;) as readme_file:</span><br><span class="line">        readme_file.write(&quot;\n&quot;.join(output_log))</span><br><span class="line"></span><br><span class="line"># Note: Ensure the complete function is defined to work with the new prompt function names and logic.</span><br><span class="line"></span><br><span class="line">create_code()</span><br></pre></td></tr></table></figure>

<p>è¯¥è„šæœ¬æ—¨åœ¨è‡ªåŠ¨åŒ–è½¯ä»¶é¡¹ç›®çš„è„šæ‰‹æ¶æ­å»ºï¼Œåˆ©ç”¨ Ollama è¿›è¡ŒåŠ¨æ€ä»£ç ç”Ÿæˆå’Œ Colorama æ¥å¢å¼ºç»ˆç«¯è¾“å‡ºçš„å¯è§†åŒ–æ•ˆæœã€‚å®ƒç³»ç»Ÿåœ°æ¶µç›–äº†å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µï¼Œä»æ”¶é›†åˆå§‹ä¸Šä¸‹æ–‡åˆ°æ„å»ºæ•´ä¸ªé¡¹ç›®å¹¶ç”Ÿæˆè¯¸å¦‚ä»£ç æ–‡ä»¶ã€å®‰è£…è„šæœ¬ã€éƒ¨ç½²è„šæœ¬å’Œæµ‹è¯•æ–‡ä»¶ç­‰å¿…è¦ç»„ä»¶ã€‚</p>
<ul>
<li><p>åˆå§‹åŒ–ï¼šåœ¨å¼€å§‹æ—¶è°ƒç”¨ colorama.init(autoreset&#x3D;True) ç¡®ä¿ç»ˆç«¯ä¸­çš„æ¯ä¸ªæ‰“å°è¯­å¥åœ¨è§†è§‰ä¸Šéƒ½ç»è¿‡æ ·å¼å¤„ç†ï¼Œè€Œä¸ä¼šå°†æ ·å¼ä¼ é€’ç»™åç»­æ‰“å°ï¼Œä½¿è¾“å‡ºæ¸…æ™°æ˜“è¯»ã€‚</p>
</li>
<li><p>åŠ¨æ€æç¤º: é‡å‘½åå’Œæ›´å…·æè¿°æ€§çš„å®šä¹‰åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œ generate_context_prompt ï¼Œ generate_features_prompt ç­‰ï¼‰ç”¨äºæ„å»ºç‰¹å®šä¸Šä¸‹æ–‡çš„æç¤ºã€‚è¿™äº›æç¤ºè¢«å‘é€åˆ° Ollama ä»£ç ç”Ÿæˆæ¨¡å‹ï¼ŒæŒ‡å¯¼å…¶æ ¹æ®å½“å‰å¼€å‘é˜¶æ®µç”Ÿæˆé¡¹ç›®çš„ç›¸å…³éƒ¨åˆ†ã€‚è¿™ç§åŠ¨æ€æç¤ºæœºåˆ¶å¯¹äºå®šåˆ¶ç”Ÿæˆçš„ä»£ç å’Œæ–‡æ¡£ä»¥æ»¡è¶³é¡¹ç›®ç‰¹å®šéœ€æ±‚å’Œç»“æ„è‡³å…³é‡è¦ã€‚</p>
</li>
<li><p>ç›®å½•å’Œæ–‡ä»¶ç®¡ç†: create_directory å‡½æ•°ç¡®ä¿ä¸ºé¡¹ç›®å»ºç«‹å¿…è¦çš„ç›®å½•ç»“æ„ï¼Œæœ‰æ•ˆåœ°ç»„ç»‡ç”Ÿæˆçš„ä»£ç ã€è„šæœ¬å’Œæ–‡ä»¶ã€‚ extract_filenames å‡½æ•°åœ¨è¯†åˆ«å’Œç®¡ç†ç”Ÿæˆå†…å®¹ä¸­çš„æ–‡ä»¶åæ–¹é¢å‘æŒ¥å…³é”®ä½œç”¨ï¼Œæœ‰åŠ©äºç³»ç»ŸåŒ–ç»„ç»‡é¡¹ç›®çš„ç»„ä»¶ã€‚</p>
</li>
<li><p>complete å‡½æ•°: ä½œä¸ºè„šæœ¬çš„æ ¸å¿ƒï¼Œæ­¤å‡½æ•°é€šè¿‡å‘ Ollama å‘é€åŠ¨æ€æ„å»ºçš„æç¤ºå¹¶å°†æ¨¡å‹çš„å“åº”é›†æˆåˆ°é¡¹ç›®ä¸­æ¥ä¸ Ollama è¿›è¡Œæ¥å£ã€‚é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯¥å‡½æ•°åè°ƒç”Ÿæˆé¡¹ç›®çš„æ¶æ„ï¼ŒåŒ…æ‹¬ä»£ç åº“ã€å®‰è£…è¦æ±‚ã€éƒ¨ç½²ç¨‹åºå’Œæµ‹è¯•æ¡†æ¶ã€‚</p>
</li>
</ul>
<p>python multiple_code_generator.py</p>
<p>è¿è¡Œè„šæœ¬ä¼šå¯åŠ¨ä¸€ä¸ªå¼•å¯¼è¿‡ç¨‹,å¼€å‘äººå‘˜è¢«æç¤ºæè¿°é—®é¢˜</p>
<p>è¾“å…¥äº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>Write a react based chatboat with flask based backend to communicate to LLMs with openai API framework. I want typescript to be used in react and also flask should have python typings.</p>
<p>å®ƒç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Project Structure:</span><br><span class="line">1. frontend/</span><br><span class="line">   - node_modules/</span><br><span class="line">   - public/</span><br><span class="line">      - index.html</span><br><span class="line">   - src/</span><br><span class="line">      - components/</span><br><span class="line">         - ChatInterface.tsx</span><br><span class="line">         - MessageDisplay.tsx</span><br><span class="line">         - UserInput.tsx</span><br><span class="line">      - hooks/</span><br><span class="line">         - useChatBotApi.ts</span><br><span class="line">      - App.tsx</span><br><span class="line">      - index.tsx</span><br><span class="line">      - setupTests.ts</span><br><span class="line">2. backend/</span><br><span class="line">   - app.py</span><br><span class="line">   - venv/</span><br><span class="line">3. .gitignore</span><br><span class="line">4. package.json</span><br><span class="line">5. tsconfig.json</span><br><span class="line">6. README.md</span><br></pre></td></tr></table></figure>

<p>Readme.md æ˜¾ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹çš„log</p>
<p>ä»¥åå¯ä»¥å°†æ­¤è„šæœ¬é›†æˆåˆ°å¼€å‘å·¥ä½œæµç¨‹ä¸­ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚è¿›è¡Œå®šåˆ¶ï¼Œå¹¶è€ƒè™‘æ‰©å±•å…¶åŠŸèƒ½ï¼Œå¦‚ä¸ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæˆ–è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶é›†æˆã€‚</p>
<p>ç»“æŸã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Howard Huang</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">273k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">8:17</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">
    <!--ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨-->
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
