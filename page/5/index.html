<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"szhowardhuang.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="åµŒå…¥å¼è€å…µåšå®¢">
<meta property="og:url" content="https://szhowardhuang.github.io/page/5/index.html">
<meta property="og:site_name" content="åµŒå…¥å¼è€å…µåšå®¢">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Howard Huang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://szhowardhuang.github.io/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>åµŒå…¥å¼è€å…µåšå®¢</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">åµŒå…¥å¼è€å…µåšå®¢</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard Huang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">70</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/05/05/reinforce-learing-game-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/05/reinforce-learing-game-2/" class="post-title-link" itemprop="url">é€šè¿‡æ¸¸æˆæ·±å…¥äº†è§£å¼ºåŒ–å­¦ä¹  ä¸‹ç¯‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-05-05 16:22:58 / ä¿®æ”¹æ—¶é—´ï¼š20:33:42" itemprop="dateCreated datePublished" datetime="2024-05-05T16:22:58+08:00">2024-05-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>19 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å›é¡¾ä¸€ä¸‹ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œå¼ºåŒ–å­¦ä¹ ä¸­åŸºäºä»·å€¼å’ŒåŸºäºç­–ç•¥çš„ç®—æ³•ã€‚</p>
<h3 id="åŸºäºä»·å€¼çš„ç®—æ³•"><a href="#åŸºäºä»·å€¼çš„ç®—æ³•" class="headerlink" title="åŸºäºä»·å€¼çš„ç®—æ³•"></a>åŸºäºä»·å€¼çš„ç®—æ³•</h3><p><img src="/../asset_reinforcelearninggame2/01.png"></p>
<p>ä¸“æ³¨äºä¼˜åŒ–ä»·å€¼å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼°è®¡çŠ¶æ€-åŠ¨ä½œå¯¹ï¼ˆQ å€¼ï¼‰çš„æœªæ¥å¥–åŠ±ã€‚è¿™ç§æ–¹æ³•åŒ…æ‹¬ Q å­¦ä¹ ç­‰æ–¹æ³•ï¼Œå…¶ç›®æ ‡æ˜¯é€šè¿‡å­¦ä¹ æ¯ä¸ªçŠ¶æ€ä¸‹æ¯ä¸ªåŠ¨ä½œçš„ä»·å€¼æ¥æœ€å¤§åŒ–é¢„æœŸå›æŠ¥ã€‚</p>
<h3 id="åŸºäºç­–ç•¥çš„ç®—æ³•"><a href="#åŸºäºç­–ç•¥çš„ç®—æ³•" class="headerlink" title="åŸºäºç­–ç•¥çš„ç®—æ³•"></a>åŸºäºç­–ç•¥çš„ç®—æ³•</h3><p><img src="/../asset_reinforcelearninggame2/02.png"></p>
<p>ç›´æ¥å­¦ä¹ å†³å®šä»£ç†è¡Œä¸ºçš„ç­–ç•¥ï¼Œè€Œä¸éœ€è¦ä»·å€¼å‡½æ•°ã€‚ ï¼ˆé€šå¸¸å°† Î¸ å»ºæ¨¡ä¸ºç¥ç»ç½‘ç»œã€‚ï¼‰</p>
<p>è¿™äº›æ–¹æ³•é€šè¿‡è°ƒæ•´å‚æ•°æ¥ä¼˜åŒ–ç­–ç•¥ï¼Œä»¥æœ€å¤§åŒ–é¢„æœŸå›æŠ¥ã€‚ç¤ºä¾‹åŒ…æ‹¬ REINFORCEï¼Œå…¶ä¸­ç­–ç•¥æœç€æé«˜æ€§èƒ½çš„æ–¹å‘æ›´æ–°ã€‚</p>
<h3 id="Advantage-Actor-Critic-A2C"><a href="#Advantage-Actor-Critic-A2C" class="headerlink" title="Advantage Actor Critic (A2C)"></a>Advantage Actor Critic (A2C)</h3><p>è™½ç„¶ REINFORCE æ–¹æ³•å…·æœ‰ç›´æ¥æ›´æ–°ç­–ç•¥è€Œæ— éœ€è®¡ç®—æ‰€æœ‰ Q å€¼çš„ä¼˜ç‚¹ï¼ˆå¦‚åŸºäºå€¼çš„ç®—æ³•æ‰€è¦æ±‚çš„é‚£æ ·ï¼‰ï¼Œä½†å®ƒå¼•å…¥äº†æ–°é—®é¢˜ï¼š</p>
<ul>
<li>æ ·æœ¬æ•ˆç‡ä½ä¸‹</li>
<li>æ¢¯åº¦çš„é«˜æ–¹å·®</li>
</ul>
<p>åœ¨ REINFORCE ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨trajectory çš„è¿”å›å€¼æ¥å¼•å¯¼æˆ‘ä»¬çš„æ¢¯åº¦ã€‚ç„¶è€Œï¼Œåœ¨éšæœºç¯å¢ƒä¸­ï¼Œè¿™äº›è¿”å›å€¼å¯èƒ½å˜å¾—éå¸¸å¤§æˆ–éå¸¸å°ï¼Œå¯¼è‡´æ¢¯åº¦ä¸ç¨³å®šã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/04.webp"></p>
<p>ä¸ºäº†å‡å°‘REINFORCEçš„æ–¹å·®ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯ç”¨ä¼˜åŠ¿å‡½æ•°A(s,a)ä»£æ›¿R(Ï„)ã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/05.webp"></p>
<p>ä¼˜åŠ¿å‡½æ•°æ˜¯é€šè¿‡ä» V å‡½æ•°ä¸­å‡å» Q å‡½æ•°æ¥è®¡ç®—çš„ã€‚å®ƒè¯„ä¼°å¦‚æœæˆ‘ä»¬åœ¨ç»™å®šçŠ¶æ€ä¸‹é‡‡å–ç‰¹å®šè¡ŒåŠ¨ï¼Œä¸è¯¥çŠ¶æ€ä¸‹æ”¶åˆ°çš„å¹³å‡å¥–åŠ±ç›¸æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å¤šå°‘é¢å¤–å¥–åŠ±ã€‚</p>
<p>ä½†ç°åœ¨é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬å¦‚ä½•è·å¾—Qå’ŒVçš„å€¼å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥ä»¥ TD è¯¯å·®çš„å½¢å¼é‡æ–°è¡¨è¿°è¿™ä¸ªæ–¹ç¨‹ï¼Œå°† Q å‡½æ•°è¡¨ç¤ºä¸ºå³æ—¶å¥–åŠ±ä¸ä¸‹ä¸€ä¸ªçŠ¶æ€å€¼çš„æ€»å’Œã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/06.webp"><br>Rï¼šç«‹å³å¥–åŠ±ï¼ŒVï¼šçŠ¶æ€å€¼</p>
<p>ç°åœ¨ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªæ–°çš„æ¨¡å‹ï¼ˆcriticï¼‰æ¥é¢„æµ‹ä»·å€¼å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è·å¾—æ‰€é‡‡å–è¡ŒåŠ¨çš„ä¼˜åŠ¿ã€‚</p>
<h3 id="Actor-Critic"><a href="#Actor-Critic" class="headerlink" title="Actor &amp; Critic"></a>Actor &amp; Critic</h3><p><img src="/../asset_reinforcelearninggame2/07.webp"></p>
<p>A2C ç®—æ³•ç”±ä¸¤ä¸ªæ¨¡å‹ç»„æˆï¼šActor å’Œ Criticã€‚ Actor è´Ÿè´£ç¡®å®šåŠ¨ä½œ Ï€(a|s)ï¼Œè€Œ Critic åˆ™è¯„ä¼°çŠ¶æ€å€¼ V(s)ã€‚</p>
<ul>
<li>Criticï¼šé€šè¿‡è¯„ä¼°çŠ¶æ€å€¼æ¥è®¡ç®—ä¼˜åŠ¿ ( &#x3D; Return â€” V(s_t))ã€‚</li>
<li>Actorï¼šåŠŸèƒ½ç±»ä¼¼äºREINFORCEç®—æ³•ä¸­çš„ä»£ç†ï¼Œè´Ÿè´£æ ¹æ®æä¾›çš„çŠ¶æ€é¢„æµ‹åŠ¨ä½œã€‚</li>
</ul>
<p>å°½ç®¡ Actor å’Œ Critic æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¨¡å‹ï¼Œä½†åœ¨å®è·µä¸­ï¼Œå®ƒä»¬é€šå¸¸å…±äº«ç›¸åŒçš„ç½‘ç»œæ¶æ„ï¼Œåªæœ‰æœ€åä¸€å±‚äº§ç”Ÿä¸åŒçš„è¾“å‡º</p>
<h3 id="A2Cä¼˜åŒ–"><a href="#A2Cä¼˜åŒ–" class="headerlink" title="A2Cä¼˜åŒ–"></a>A2Cä¼˜åŒ–</h3><p><img src="/../asset_reinforcelearninggame2/08.webp"></p>
<ul>
<li>Nï¼šæœªæ¥å¥–åŠ±çš„æ­¥æ•°</li>
<li>Rtï¼š&#x3D; rt + Î³<em>rt_1 + â€¦ + Î³^(N-1)</em> rt_N-1 + VÏ‰(s_t+N)</li>
<li>Î¸: actor</li>
<li>Ï‰: critic</li>
</ul>
<p>å¯¹äº Actorï¼šæˆ‘ä»¬æ ¹æ®æŸå¤±å‡½æ•° J &#x3D; logÏ€(a|s) * A(s, a) æ›´æ–°ç½‘ç»œï¼Œå®ç°ä¸ REINFORCE ç›¸åŒã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/09.webp"></p>
<p>å¯¹äº Criticï¼šæˆ‘ä»¬å¯ä»¥åœ¨ Rt å’Œ VÏ‰(St) ä¹‹é—´åº”ç”¨ MSE æ¥æ”¹è¿›æˆ‘ä»¬çš„ Criticã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/10.webp"></p>
<p>å‡½æ•°VÏ‰(s)è¡¨ç¤ºä»çŠ¶æ€så¼€å§‹çš„æœŸæœ›å›æŠ¥ã€‚ç”±äºå›æŠ¥ Rtâ€‹æä¾›äº†å¯¹å¤„äºè¯¥çŠ¶æ€çš„å¥½åç¨‹åº¦çš„ç›´æ¥è¡¡é‡ï¼Œå› æ­¤criticçš„ä»»åŠ¡æ˜¯ä½¿ç”¨ä»·å€¼å‡½æ•° VÏ‰(s) å°½å¯èƒ½æ¥è¿‘åœ°é¢„æµ‹è¿™äº›å›æŠ¥ã€‚</p>
<h3 id="A2Cå®æ–½"><a href="#A2Cå®æ–½" class="headerlink" title="A2Cå®æ–½"></a>A2Cå®æ–½</h3><p>åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ç©è½¦æ†æ¸¸æˆï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¨åœ¨è§£å†³è½¦æ†é—®é¢˜çš„åŸºæœ¬ç¯å¢ƒã€‚æ‚¨è¿˜å¯ä»¥å°è¯•å…¶ä»–ä¸€äº›ç»å…¸çš„æ§åˆ¶ç¯å¢ƒï¼Œä¾‹å¦‚ Pendulum å’Œ Acrobotã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/11.webp"></p>
<p><img src="/../asset_reinforcelearninggame2/12.webp"></p>
<p>åœ¨å¼€å§‹ä¹‹å‰ä¸€å®šè¦å…ˆé€šè¯»<a target="_blank" rel="noopener" href="https://gymnasium.farama.org/environments/classic_control/cart_pole/">æ–‡æ¡£</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gymnasium <span class="keyword">as</span> gym</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ema_pytorch <span class="keyword">import</span> EMA</span><br><span class="line"><span class="keyword">from</span> torch.distributions.categorical <span class="keyword">import</span> Categorical</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">env_id</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapped_env</span>():</span><br><span class="line">        env = gym.make(env_id, render_mode=<span class="string">&#x27;rgb_array&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> env</span><br><span class="line">    <span class="keyword">return</span> wrapped_env</span><br><span class="line"></span><br><span class="line">env_id = <span class="string">&#x27;CartPole-v1&#x27;</span></span><br><span class="line">env = make_env(env_id)()</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_reinforcelearninggame2/13.webp"><br>è½¦æ†çš„åŠ¨ä½œå’Œè§‚å¯Ÿç©ºé—´</p>
<p>åŠ¨ä½œç©ºé—´å¾ˆç®€å•ï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å°†å°è½¦æ¨åˆ°å·¦è¾¹æˆ–å³è¾¹ã€‚åŒæ—¶ï¼Œè§‚å¯Ÿç©ºé—´åŒ…å«å››ä¸ªè¿ç»­å€¼ï¼Œåˆ†åˆ«ä»£è¡¨å°è½¦ä½ç½®ã€å°è½¦é€Ÿåº¦ã€æè§’å’Œæè§’é€Ÿåº¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Actor</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obs_dim, n_actions</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model = nn.Sequential(</span><br><span class="line">            nn.Linear(obs_dim, <span class="number">64</span>),</span><br><span class="line">            nn.Tanh(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, <span class="number">64</span>),</span><br><span class="line">            nn.Tanh(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, n_actions)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        logits = self.model(x)</span><br><span class="line">        <span class="keyword">return</span> Categorical(logits = logits)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Critic</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, obs_dim</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model = nn.Sequential(</span><br><span class="line">            nn.Linear(obs_dim, <span class="number">64</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, <span class="number">64</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Linear(<span class="number">64</span>, <span class="number">1</span>)</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.model(x)</span><br></pre></td></tr></table></figure>
<p>åœ¨A2Cä¸­ï¼Œæˆ‘ä»¬å°†æœ‰ä¸¤ä¸ªæ¨¡å‹ï¼ŒActorå’ŒCriticã€‚ Actor è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒæ¥ç¡®å®šé‡‡å–å“ªä¸ªæ“ä½œï¼Œè€Œ Critic åˆ™æä¾›çŠ¶æ€å€¼ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒActor å’Œ Critic å°†é›†æˆåˆ°ä¸€ä¸ªæ¨¡å‹ä¸­</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gamma = <span class="number">0.99</span></span><br><span class="line">episodes = <span class="number">200</span></span><br><span class="line">env = make_env(env_id)()</span><br><span class="line">device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line"></span><br><span class="line">actor = Actor(<span class="number">4</span>, <span class="number">2</span>).to(device)</span><br><span class="line">critic = Critic(obs_shape[<span class="number">0</span>]).to(device)</span><br><span class="line">actor_optim = torch.optim.Adam(actor.parameters(), lr=<span class="number">1e-3</span>)</span><br><span class="line">critic_optim = torch.optim.Adam(critic.parameters(), lr=<span class="number">1e-3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> episode <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>, episodes + <span class="number">1</span>), desc=<span class="string">&quot;A2C training progress: ~~&quot;</span>):          </span><br><span class="line">    done = <span class="literal">False</span></span><br><span class="line">    obs, _ = env.reset()</span><br><span class="line">    log_probs = []</span><br><span class="line">    values = []</span><br><span class="line">    rewards = []</span><br><span class="line">    frame = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">        obs = torch.tensor(obs).to(device)</span><br><span class="line">        dist = actor(obs)</span><br><span class="line">        value = critic(obs)</span><br><span class="line">        action = dist.sample()</span><br><span class="line">        log_prob = dist.log_prob(action)</span><br><span class="line">        next_obs, reward, done, _, info = env.step(action.detach().cpu().numpy())</span><br><span class="line">      </span><br><span class="line">        log_probs.append(log_prob)</span><br><span class="line">        values.append(value)</span><br><span class="line">        rewards.append(reward)</span><br><span class="line">        obs = next_obs</span><br><span class="line">        </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> frame &gt;= <span class="number">300</span>:</span><br><span class="line">            <span class="comment"># Give some constraints to the length of the episode</span></span><br><span class="line">            <span class="comment"># otherwise, it will become too large.</span></span><br><span class="line">            <span class="keyword">break</span>   </span><br><span class="line">    R = <span class="number">0</span></span><br><span class="line">    returns = []</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> rewards[::-<span class="number">1</span>]:</span><br><span class="line">        R = r + gamma * R</span><br><span class="line">        returns.insert(<span class="number">0</span>, R)</span><br><span class="line">        </span><br><span class="line">    returns = torch.tensor(returns).to(device)</span><br><span class="line">    values = torch.stack(values).to(device)</span><br><span class="line">    advantage = returns - values</span><br><span class="line">    </span><br><span class="line">    critic_loss = advantage.<span class="built_in">pow</span>(<span class="number">2</span>).mean()</span><br><span class="line">    critic_optim.zero_grad()</span><br><span class="line">    critic_loss.backward()</span><br><span class="line">    critic_optim.step() <span class="comment"># update critic</span></span><br><span class="line">    </span><br><span class="line">    actor_loss = (-torch.stack(log_probs)*advantage.detach()).mean()</span><br><span class="line">    actor_optim.zero_grad()</span><br><span class="line">    actor_loss.backward()</span><br><span class="line">    actor_optim.step() <span class="comment"># update actor</span></span><br></pre></td></tr></table></figure>

<p>è®­ç»ƒè¿‡ç¨‹ä¸REINFORCEç®—æ³•åŸºæœ¬ç›¸åŒï¼›å”¯ä¸€çš„åŒºåˆ«æ˜¯å¯¹æ•°æ¦‚ç‡ç°åœ¨ä¹˜ä»¥ä¼˜åŠ¿è€Œä¸æ˜¯å›æŠ¥ã€‚</p>
<p><img src="/../asset_reinforcelearninggame2/14.webp"></p>
<h3 id="è½¦æ†ç»“æœ"><a href="#è½¦æ†ç»“æœ" class="headerlink" title="è½¦æ†ç»“æœ"></a>è½¦æ†ç»“æœ</h3><p><img src="/../asset_reinforcelearninggame2/14.gif"></p>
<h3 id="åœ¨çº¿ç­–ç•¥-ç¦»çº¿ç­–ç•¥æ¨¡å‹"><a href="#åœ¨çº¿ç­–ç•¥-ç¦»çº¿ç­–ç•¥æ¨¡å‹" class="headerlink" title="åœ¨çº¿ç­–ç•¥ &amp; ç¦»çº¿ç­–ç•¥æ¨¡å‹"></a>åœ¨çº¿ç­–ç•¥ &amp; ç¦»çº¿ç­–ç•¥æ¨¡å‹</h3><p><img src="/../asset_reinforcelearninggame2/15.webp"></p>
<h4 id="åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-REINFORCEï¼ŒAC2ï¼‰"><a href="#åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-REINFORCEï¼ŒAC2ï¼‰" class="headerlink" title="åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ REINFORCEï¼ŒAC2ï¼‰"></a>åœ¨çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ REINFORCEï¼ŒAC2ï¼‰</h4><ul>
<li>åŸºäºå½“å‰ç­–ç•¥ï¼ŒåŒç­–ç•¥æ¨¡å‹é€šè¿‡ä¸ç¯å¢ƒäº¤äº’æ¥æ”¶é›†æ•°æ®ã€‚æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦ç”±æ›´æ–°çš„ç­–ç•¥ç”Ÿæˆçš„æ–°æ•°æ®ã€‚</li>
<li>æ ¹æ®æ”¶é›†çš„æ•°æ®æ‰§è¡Œæ›´æ–°ã€‚è¯¥æ¨¡å‹ç›´æ¥ä»å…¶è‡ªèº«ç­–ç•¥ç”Ÿæˆçš„æ•°æ®ä¸­å­¦ä¹ ã€‚</li>
</ul>
<h4 id="ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-DQNï¼‰"><a href="#ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚-DQNï¼‰" class="headerlink" title="ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ DQNï¼‰"></a>ç¦»çº¿ç­–ç•¥æ¨¡å‹ï¼šï¼ˆä¾‹å¦‚ DQNï¼‰</h4><ul>
<li><p>ç¦»çº¿ç­–ç•¥æ¨¡å‹å¯ä»¥ä»ä»»ä½•æ¥æºæ”¶é›†æ•°æ®ï¼ŒåŒ…æ‹¬è¿‡å»çš„ç»éªŒæˆ–ä¸åŒçš„ç­–ç•¥ã€‚</p>
</li>
<li><p>è¿™äº›æ¨¡å‹ä»æ”¶é›†åˆ°çš„æ•°æ®ä¸­å­¦ä¹ ï¼Œæ— è®ºè¿™äº›æ•°æ®æ˜¯ç”±å“ªç§ç­–ç•¥äº§ç”Ÿï¼Œæˆ–è€…æºè‡ªä½•å¤„ã€‚</p>
</li>
</ul>
<h3 id="è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–-PPO"><a href="#è¿‘ç«¯ç­–ç•¥ä¼˜åŒ–-PPO" class="headerlink" title="è¿‘ç«¯ç­–ç•¥ä¼˜åŒ– (PPO)"></a>è¿‘ç«¯ç­–ç•¥ä¼˜åŒ– (PPO)</h3><p>åœ¨A2Céƒ¨åˆ†ï¼Œæˆ‘ä»¬é€šè¿‡ä»Vå‡½æ•°ä¸­å‡å»Qå‡½æ•°æ¥è§£å†³æ¢¯åº¦é«˜æ–¹å·®çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œå¦ä¸€ä¸ªæœ‰å¾…è§£å†³çš„æŒ‘æˆ˜æ˜¯æ ·æœ¬æ•ˆç‡ä½ä¸‹ã€‚</p>
<p>REINFORCE å’Œ AC2 ç­‰åŒç­–ç•¥æ¨¡å‹ä¸­çš„æ ·æœ¬æ•ˆç‡ä½ä¸‹æºäºéœ€è¦æ ¹æ®å½“å‰ç­–ç•¥ Ï€_Î¸ æ”¶é›†æ•°æ®ã€‚æ›´æ–°æ¨¡å‹å‚æ•° Î¸ ä¼šå¯¼è‡´ç­–ç•¥å‘ç”Ÿå˜åŒ–ï¼Œè¿™éœ€è¦æ”¶é›†æ–°çš„trajectoriesã€‚</p>
<p>åœ¨ä¹‹å‰çš„å®éªŒä¸­ï¼Œtrajectoriesçš„æœ€å¤§é•¿åº¦ä¸º300ã€‚è¿™æ„å‘³ç€æ¯æ¬¡æ›´æ–°å‚æ•°æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šåˆ©ç”¨300ä¸ªæ•°æ®ç‚¹ï¼Œè¿™ä¸æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ•°æ®ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>PPO ä¿®æ”¹äº†ä¸¥æ ¼çš„åœ¨çº¿ç­–ç•¥è§„å®šï¼Œä»¥å…è®¸åœ¨æŸäº›æ¡ä»¶ä¸‹ä½¿ç”¨ç¦»çº¿ç­–ç•¥æ•°æ®ã€‚é€šè¿‡å°†é‡è¦æ€§é‡‡æ ·åº”ç”¨äºæˆ‘ä»¬çš„ç­–ç•¥æ¢¯åº¦ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä»¥ä¸‹ç»“æœï¼š<br><img src="/../asset_reinforcelearninggame2/16.webp"></p>
<p><img src="/../asset_reinforcelearninggame2/17.webp"></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•°æ®ä¸å†ä»å½“å‰ç­–ç•¥ Ï€_Î¸ æ”¶é›†ï¼Œè€Œæ˜¯ä»è¡¨ç¤ºä¸º Ï€_bar çš„ä¸åŒç­–ç•¥æ”¶é›†ã€‚è¿™ç§è°ƒæ•´å…è®¸æˆ‘ä»¬åˆ©ç”¨ä»ä¸åŒç­–ç•¥é‡‡æ ·çš„æ•°æ®å¯¹åŸå§‹ç­–ç•¥ Ï€_Î¸ æ‰§è¡Œå¤šæ¬¡æ›´æ–°ã€‚</p>
<h3 id="Clipped-Surrogate-Objective-Function-ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰"><a href="#Clipped-Surrogate-Objective-Function-ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰" class="headerlink" title="Clipped Surrogate Objective Function ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰"></a>Clipped Surrogate Objective Function ï¼ˆæˆªæ–­æ›¿ä»£ç›®æ ‡å‡½æ•°ï¼‰</h3><p><img src="/../asset_reinforcelearninggame2/18.webp"></p>
<p>å¯¹äºå¤§å¤šæ•°ä¼˜åŒ–æ–¹æ³•æ¥è¯´ï¼Œä½¿ç”¨è¾ƒå°çš„æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹çš„æƒé‡é€šå¸¸ä¼šå¸¦æ¥æ›´å¥½ã€æ›´ç¨³å®šçš„ç»“æœã€‚</p>
<p>ç„¶è€Œï¼Œåœ¨ç­–ç•¥æ¢¯åº¦æ–¹æ³•ä¸­ï¼Œæ¢¯åº¦log(Ï€_Î¸)å¯ä»¥å¾ˆå¤§ä¹Ÿå¯ä»¥å¾ˆå°ï¼›å› æ­¤ï¼Œä¸ºäº†ä½¿è®­ç»ƒæ›´åŠ ç¨³å®šï¼Œå¿…é¡»é™åˆ¶æ¢¯åº¦ã€‚</p>
<p>PPO é€šè¿‡è£å‰ª [1âˆ’Îµ, 1+Îµ] èŒƒå›´ä¹‹å¤–çš„æ¢¯åº¦æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹è¡¨ä¸­è¿›ä¸€æ­¥è®¨è®ºè¿™ä¸ªé—®é¢˜~~</p>
<p><img src="/../asset_reinforcelearninggame2/19.webp"><br><img src="/../asset_reinforcelearninggame2/20.webp"></p>
<h4 id="Case-1-2"><a href="#Case-1-2" class="headerlink" title="Case 1, 2:"></a>Case 1, 2:</h4><p>æ¯”ç‡ pt åœ¨ [1âˆ’Îµ, 1+Îµ] èŒƒå›´å†…ï¼Œå› æ­¤æˆ‘ä»¬å¯¹æ¢¯åº¦ä¸åšä»»ä½•æ“ä½œå¹¶è¿”å› ptâ€‹(Î¸)Atâ€‹ã€‚</p>
<h4 id="Case-3ï¼Œ6"><a href="#Case-3ï¼Œ6" class="headerlink" title="Case 3ï¼Œ6:"></a>Case 3ï¼Œ6:</h4><p>ç”±äº pğ‘¡ &lt; 1âˆ’ğœ–ï¼ˆæƒ…å†µ 3ï¼‰ï¼Œè¿™è¡¨æ˜æ–°ç­–ç•¥ğœ‹ğœƒâ€‹é‡‡å–è¡ŒåŠ¨ğ‘_ğ‘¡çš„æ¦‚ç‡å°äºæ—§ç­–ç•¥ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°ä¼˜åŠ¿æ˜¯æ­£çš„ï¼Œæˆ‘ä»¬å¸Œæœ›å¢åŠ  Ï€Î¸â€‹çš„å€¼ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¸éœ€è¦å‰ªè£ã€‚</p>
<h4 id="Case-4ï¼Œ5"><a href="#Case-4ï¼Œ5" class="headerlink" title="Case 4ï¼Œ5:"></a>Case 4ï¼Œ5:</h4><p>ä»¥æƒ…å†µ 4 ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¦‚ç‡ Ï€Î¸â€‹ å°äº ğœ‹oldâ€‹ï¼ˆå› ä¸º pğ‘¡&lt;1âˆ’ğœ–ï¼‰ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°ä¼˜åŠ¿ä¸ºè´Ÿï¼Œè¿™å°†å€¾å‘äºè¿›ä¸€æ­¥é™ä½ ğœ‹ğœƒ ï¼Œè¿™å¯èƒ½ä¼šä½¿è®­ç»ƒä¸ç¨³å®šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ¢¯åº¦è®¾ç½®ä¸º 0 ä»¥ç¡®ä¿ç­–ç•¥ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>è¿™å°±æ˜¯PPOçš„å…¨éƒ¨å†…å®¹ã€‚</p>
<h3 id="èµ›è½¦å®æ–½"><a href="#èµ›è½¦å®æ–½" class="headerlink" title="èµ›è½¦å®æ–½"></a>èµ›è½¦å®æ–½</h3><p>å®Œæ•´çš„å®ç°å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a target="_blank" rel="noopener" href="https://github.com/Yukino1010/ReinforcementModels.git">é“¾æ¥</a></p>
<p><img src="/../asset_reinforcelearninggame2/21.webp"></p>
<p>åœ¨æˆ‘ä»¬çš„ç¬¬äºŒä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Box2D ç¯å¢ƒæ¥ç©èµ›è½¦æ¸¸æˆã€‚è§„åˆ™å¾ˆç®€å•ï¼šæ¯æ¬¡è®¿é—®ä¸€ä¸ªè½¨é“å—æˆ‘ä»¬éƒ½ä¼šå¾—åˆ°1000åˆ†ï¼›ç„¶è€Œï¼Œæ¯å¸§æˆ‘ä»¬éƒ½ä¼šæŸå¤± 0.1 åˆ†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å®Œæˆäº† 732 å¸§ï¼Œæ‚¨çš„å¥–åŠ±å°†ä¸º 1000â€“0.1*732 &#x3D; 926.8 ç§¯åˆ†ã€‚ ï¼ˆæ›´å¤šè¯¦æƒ…è¯·å‚è€ƒè¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://arc.net/l/quote/jbfidurc">é“¾æ¥</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import ...</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">env_id</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapped_env</span>():</span><br><span class="line">        env = gym.make(env_id, render_mode=<span class="string">&#x27;rgb_array&#x27;</span>, continuous=<span class="literal">False</span>)</span><br><span class="line">        env = MaxAndSkipEnv(env, skip=<span class="number">4</span>)</span><br><span class="line">        env = ResizeObservation(env, <span class="number">84</span>)</span><br><span class="line">        env = GrayScaleObservation(env)</span><br><span class="line">        env = FrameStack(env, <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> env</span><br><span class="line">    <span class="keyword">return</span> wrapped_env</span><br><span class="line"></span><br><span class="line">env_id = <span class="string">&quot;CarRacing-v2&quot;</span></span><br><span class="line">num_envs = <span class="number">4</span> <span class="comment"># use four parallel env to collect data</span></span><br><span class="line">envs = DummyVecEnv([make_env(env_id) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_envs)])</span><br></pre></td></tr></table></figure>

<p>åœ¨èµ›è½¦æ¸¸æˆä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸åŒç±»å‹çš„åŠ¨ä½œç©ºé—´ï¼Œç¦»æ•£çš„æˆ–è¿ç»­çš„ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¦»æ•£åŠ¨ä½œç©ºé—´ï¼Œå…¶ä¸­åŒ…å«äº”ä¸ªä¸åŒçš„åŠ¨ä½œã€‚</p>
<ul>
<li>0ï¼šä»€ä¹ˆä¹Ÿä¸åš</li>
<li>1ï¼šå·¦è½¬</li>
<li>2ï¼šå³è½¬</li>
<li>3ï¼šåŠ æ²¹é—¨</li>
<li>4ï¼šåˆ¹è½¦</li>
</ul>
<p>è§‚å¯Ÿç©ºé—´æ˜¯96x96 RGBå›¾åƒã€‚è¿™æ¬¡ï¼Œæˆ‘å°†ä½¿ç”¨ä¸€äº›<a target="_blank" rel="noopener" href="https://gymnasium.farama.org/api/wrappers/observation_wrappers/">ENV wrappers</a>å°†å…¶è½¬æ¢ä¸º84x84çš„ç°åº¦å›¾åƒï¼Œè¿™æ›´é€‚åˆæ¨¡å‹è®­ç»ƒã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ActorCritic</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, num_inputs, num_actions</span>):</span><br><span class="line">        <span class="built_in">super</span>(ActorCritic, self).__init__()</span><br><span class="line">        <span class="comment"># Common layers</span></span><br><span class="line">        self.conv1 = nn.Conv2d(num_inputs, <span class="number">32</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">4</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv3 = nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.conv4 = nn.Conv2d(<span class="number">64</span>, <span class="number">128</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        self.fc1 = nn.Linear(<span class="number">128</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">512</span>)</span><br><span class="line">        self.actor_fc = nn.Linear(<span class="number">512</span>, num_actions)</span><br><span class="line">        self.critic_fc = nn.Linear(<span class="number">512</span>, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = F.relu(self.conv1(x))</span><br><span class="line">        x = F.relu(self.conv2(x))</span><br><span class="line">        x = F.relu(self.conv3(x))</span><br><span class="line">        x = F.relu(self.conv4(x))</span><br><span class="line">        </span><br><span class="line">        x = x.view(-<span class="number">1</span>, <span class="number">128</span> * <span class="number">5</span> * <span class="number">5</span>)  </span><br><span class="line">        x = F.relu(self.fc1(x))</span><br><span class="line">        logits = self.actor_fc(x) <span class="comment"># Actor</span></span><br><span class="line">        state_values = self.critic_fc(x) <span class="comment"># Critic</span></span><br><span class="line">        <span class="keyword">return</span> Categorical(logits=logits), state_values</span><br></pre></td></tr></table></figure>

<p>ç”±äºè§‚å¯Ÿçš„æ˜¯å›¾åƒï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºäº CNN çš„æ¶æ„æ¥æ„å»ºæˆ‘ä»¬çš„ä»£ç†ã€‚å®ƒå°†è¾“å‡ºä¸€ä¸ª Categorical å¯¹è±¡å’Œå½“å‰çŠ¶æ€çš„å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">gamma = <span class="number">0.99</span></span><br><span class="line">gae_lambda = <span class="number">0.95</span></span><br><span class="line">clip_coef = <span class="number">0.2</span></span><br><span class="line">ent_coef = <span class="number">0.01</span></span><br><span class="line">vf_coef = <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">num_envs = <span class="number">4</span></span><br><span class="line">num_steps = <span class="number">512</span></span><br><span class="line">minibatch_size = <span class="number">32</span></span><br><span class="line">total_steps = <span class="number">500000</span></span><br><span class="line">batch_size = num_envs * num_steps</span><br><span class="line">device = <span class="string">&quot;cuda&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span></span><br><span class="line">agent = ActorCritic(<span class="number">4</span>, n_action).to(device) <span class="comment"># n_action = 5</span></span><br><span class="line">ema = EMA(agent, beta = <span class="number">0.995</span>, update_every = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>, num_updates + <span class="number">1</span>), desc=<span class="string">&quot;PPO training progress: ~~&quot;</span>):</span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(num_steps):</span><br><span class="line">        global_step += <span class="number">1</span> * num_envs</span><br><span class="line">        obs[step] = next_obs</span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            dist, value = agent(next_obs)</span><br><span class="line">            values[step] = value.view(-<span class="number">1</span>)</span><br><span class="line">            action = dist.sample()</span><br><span class="line">            logprob = dist.log_prob(action)</span><br><span class="line"></span><br><span class="line">        actions[step] = action</span><br><span class="line">        logprobs[step] = logprob</span><br><span class="line">        next_obs, reward, done, info = envs.step(action.cpu().numpy())</span><br><span class="line">        dones[step] = torch.Tensor(done).to(device)</span><br><span class="line">        rewards[step] = torch.tensor(reward).to(device).view(-<span class="number">1</span>)</span><br><span class="line">        next_obs = torch.Tensor(next_obs).to(device)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        _, next_value = agent(next_obs)</span><br><span class="line">        advantages = torch.zeros_like(rewards).to(device)</span><br><span class="line">        lastgaelam = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(num_steps)):</span><br><span class="line">            <span class="keyword">if</span> t == num_steps - <span class="number">1</span>:</span><br><span class="line">                is_done = <span class="number">1.0</span> - dones[t]</span><br><span class="line">                nextvalues = next_value</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                is_done = <span class="number">1.0</span> - dones[t]</span><br><span class="line">                nextvalues = values[t+<span class="number">1</span>]</span><br><span class="line">            delta = rewards[t] + gamma * nextvalues * is_done - values[t]</span><br><span class="line">            advantages[t] = lastgaelam = delta + gamma * gae_lambda * is_done * lastgaelam</span><br><span class="line">        returns = advantages + values</span><br><span class="line"></span><br><span class="line">    b_obs = obs.view((-<span class="number">1</span>,) + obs_shape)</span><br><span class="line">    b_actions = actions.view((-<span class="number">1</span>,) + action_shape)</span><br><span class="line">    b_logprobs = logprobs.view(-<span class="number">1</span>)</span><br><span class="line">    b_advantages = advantages.view(-<span class="number">1</span>)</span><br><span class="line">    b_returns = returns.view(-<span class="number">1</span>)</span><br><span class="line">    b_inds = np.arange(batch_size)</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        np.random.shuffle(b_inds)</span><br><span class="line">        <span class="keyword">for</span> start <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, batch_size, minibatch_size):</span><br><span class="line">            end = start + minibatch_size</span><br><span class="line">            mb_inds = b_inds[start:end]</span><br><span class="line">            dist, new_value = agent(b_obs[mb_inds])</span><br><span class="line">            newlogprob = dist.log_prob(b_actions.long()[mb_inds])</span><br><span class="line">            entropy = dist.entropy()</span><br><span class="line">            logratio = newlogprob - b_logprobs[mb_inds]</span><br><span class="line">            ratio = logratio.exp()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Policy loss</span></span><br><span class="line">            mb_advantages = b_advantages[mb_inds]</span><br><span class="line">            pg_loss1 = -mb_advantages * ratio</span><br><span class="line">            pg_loss2 = -mb_advantages * torch.clamp(ratio, <span class="number">1</span> - clip_coef, <span class="number">1</span> + clip_coef)</span><br><span class="line">            pg_loss = torch.<span class="built_in">max</span>(pg_loss1, pg_loss2).mean()</span><br><span class="line">            <span class="comment"># Value loss</span></span><br><span class="line">            newvalue = newvalue.view(-<span class="number">1</span>)</span><br><span class="line">            v_loss = v_loss_fn(newvalue, b_returns[mb_inds])</span><br><span class="line">            entropy_loss = entropy.mean()</span><br><span class="line">            loss = pg_loss - ent_coef * entropy_loss + v_loss * vf_coef</span><br><span class="line"></span><br><span class="line">            optimizer.zero_grad()</span><br><span class="line">            loss.backward()</span><br><span class="line">            nn.utils.clip_grad_norm_(agent.parameters(), <span class="number">0.5</span>)</span><br><span class="line">            optimizer.step()</span><br><span class="line">            ema.update()</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†æ‰§è¡Œ PPOï¼Œæˆ‘ä»¬é¦–å…ˆä»æ—§ç­–ç•¥ä¸­æ”¶é›†æ•°æ®ï¼ˆb_obsã€b_actionsï¼Œâ€¦ï¼‰ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒæ–°æ—§ç­–ç•¥ä¹‹é—´çš„å·®å¼‚ï¼ˆnew_logprob - b_logprobsï¼‰ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥è¿­ä»£ä¸åŒçš„æ‰¹æ¬¡å¹¶æ›´æ–° Actor å’Œ Criticã€‚</p>
<p>æˆ‘æ‰€åšçš„å…¶ä»–ä¸€äº›ä¿®æ”¹åŒ…æ‹¬åˆå¹¶ç†µæŸå¤±ä»¥åŠç”¨ GAEï¼ˆé€šç”¨ä¼˜åŠ¿ä¼°è®¡å™¨ï¼‰æ›¿æ¢ä¼˜åŠ¿å‡½æ•°ã€‚</p>
<p>ç†µç”¨äºé¼“åŠ±æ¨¡å‹æ¢ç´¢æ›´å¤šå¯èƒ½çš„åŠ¨ä½œï¼Œä»è€Œæ¢ç´¢æ›´å¤šå¯èƒ½çš„è½¨è¿¹ã€‚åŒæ—¶ï¼ŒGAEæ˜¯ä¼˜åŠ¿å‡½æ•°çš„å˜ä½“ï¼Œæ—¨åœ¨å‡å°‘å¥–åŠ±çš„æ–¹å·®ï¼ˆè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://towardsdatascience.com/generalized-advantage-estimation-in-reinforcement-learning-bf4a957f7975">è¿™é‡Œ</a>æ‰¾åˆ°ï¼‰</p>
<h3 id="èµ›è½¦ç»“æœ"><a href="#èµ›è½¦ç»“æœ" class="headerlink" title="èµ›è½¦ç»“æœ"></a>èµ›è½¦ç»“æœ</h3><p><img src="/../asset_reinforcelearninggame2/22.gif"></p>
<h3 id="ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—"><a href="#ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—" class="headerlink" title="ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—"></a>ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—</h3><p>å…¶å®é™¤äº†æˆ‘ä»¬è‡ªå·±å»ºç«‹æ¨¡å‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—æ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå»ºç«‹æ¨¡å‹ã€‚åœ¨æœ€åä¸€èŠ‚ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ Stable Baselines3 æ¥ç© linyiLYi åˆ›å»ºçš„<a target="_blank" rel="noopener" href="https://github.com/linyiLYi/snake-ai/tree/master">è¿·ä½ è›‡æ¸¸æˆ</a>ã€‚</p>
<p>ç¯å¢ƒè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://github.com/linyiLYi/snake-ai/tree/master">è¿™é‡Œ</a>å’Œ<a target="_blank" rel="noopener" href="https://youtu.be/jTVMxJBtmFs?si=sdXihKfhT77oLvlK">è¿™é‡Œ</a>æ‰¾åˆ°</p>
<p>ç”±äºOpenAIä¸å†æ”¯æŒæ—§çš„gymç¯å¢ƒï¼Œç›´æ¥ä½¿ç”¨snakeç¯å¢ƒä¼šå¯¼è‡´é”™è¯¯ã€‚è§£å†³åŠæ³•æ˜¯é™çº§Stable Baselinesçš„ç‰ˆæœ¬æˆ–è€…å°†snake envè½¬æ¢æˆGymnasiumä½¿ç”¨çš„æ ¼å¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> snake_game_custom_wrapper_cnn <span class="keyword">import</span> SnakeEnv</span><br><span class="line"><span class="keyword">from</span> sb3_contrib <span class="keyword">import</span> MaskablePPO</span><br><span class="line"><span class="keyword">from</span> sb3_contrib.common.wrappers <span class="keyword">import</span> ActionMasker</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.common.type_aliases <span class="keyword">import</span> GymEnv</span><br><span class="line"><span class="keyword">from</span> stable_baselines3.common.vec_env <span class="keyword">import</span> VecEnv, DummyVecEnv</span><br><span class="line"></span><br><span class="line"><span class="comment"># From https://github.com/linyiLYi/snake-ai/tree/master</span></span><br><span class="line">EXPECTED_METHOD_NAME = <span class="string">&#x27;get_action_mask&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_action_masks</span>(<span class="params">env: GymEnv</span>) -&gt; np.ndarray:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Checks whether gym env exposes a method returning invalid action masks</span></span><br><span class="line"><span class="string">    :param env: the Gym environment to get masks from</span></span><br><span class="line"><span class="string">    :return: A numpy array of the masks</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(env, VecEnv):</span><br><span class="line">        <span class="keyword">return</span> np.stack(env.env_method(EXPECTED_METHOD_NAME))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getattr</span>(env, EXPECTED_METHOD_NAME)()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linear scheduler</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">linear_schedule</span>(<span class="params">initial_value, final_value=<span class="number">0.0</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(initial_value, <span class="built_in">str</span>):</span><br><span class="line">        initial_value = <span class="built_in">float</span>(initial_value)</span><br><span class="line">        final_value = <span class="built_in">float</span>(final_value)</span><br><span class="line">        <span class="keyword">assert</span> (initial_value &gt; <span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">scheduler</span>(<span class="params">progress</span>):</span><br><span class="line">        <span class="keyword">return</span> final_value + progress * (initial_value - final_value)</span><br><span class="line">    <span class="keyword">return</span> scheduler</span><br><span class="line">lr_schedule = linear_schedule(<span class="number">2.5e-4</span>, <span class="number">2.5e-6</span>)</span><br><span class="line">clip_range_schedule = linear_schedule(<span class="number">0.150</span>, <span class="number">0.025</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">num_envs = <span class="number">16</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_env</span>(<span class="params">seed=<span class="number">0</span></span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init</span>():</span><br><span class="line">        env = SnakeEnv()</span><br><span class="line">        env = ActionMasker(env, SnakeEnv.get_action_mask)</span><br><span class="line">        <span class="keyword">return</span> env</span><br><span class="line">    <span class="keyword">return</span> _init</span><br><span class="line">envs = DummyVecEnv([make_env() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_envs)])</span><br><span class="line"></span><br><span class="line">model = MaskablePPO(</span><br><span class="line">    <span class="string">&quot;CnnPolicy&quot;</span>,</span><br><span class="line">    envs,</span><br><span class="line">    device=<span class="string">&quot;cuda&quot;</span>,</span><br><span class="line">    verbose=<span class="number">1</span>,</span><br><span class="line">    n_steps=<span class="number">2048</span>,</span><br><span class="line">    batch_size=<span class="number">512</span>,</span><br><span class="line">    n_epochs=<span class="number">4</span>,</span><br><span class="line">    gamma=<span class="number">0.94</span>,</span><br><span class="line">    learning_rate=lr_schedule,</span><br><span class="line">    clip_range=clip_range_schedule,</span><br><span class="line">)</span><br><span class="line">model.learn(total_timesteps=<span class="built_in">int</span>(<span class="number">5000000</span>))</span><br><span class="line">model.save(<span class="string">&quot;./ppo_snake_final.zip&quot;</span>)</span><br><span class="line">envs.close()</span><br></pre></td></tr></table></figure>

<h3 id="è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ"><a href="#è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ" class="headerlink" title="è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ"></a>è´ªåƒè›‡æ¸¸æˆçš„ç»“æœ</h3><p><img src="/../asset_reinforcelearninggame2/23.gif"></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/mastering-game-worlds-a-deep-dive-into-reinforcement-learning-part-2-574263e11bb1">https://levelup.gitconnected.com/mastering-game-worlds-a-deep-dive-into-reinforcement-learning-part-2-574263e11bb1</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/29/ai-agent-everything/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/29/ai-agent-everything/" class="post-title-link" itemprop="url">AI ä»£ç†æ— å¤„ä¸åœ¨</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-29 12:31:29 / ä¿®æ”¹æ—¶é—´ï¼š16:15:37" itemprop="dateCreated datePublished" datetime="2024-04-29T12:31:29+08:00">2024-04-29</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>5.1k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æˆ‘ç°åœ¨è¶Šæ¥è¶Šè§‰å¾—AIä»£ç†æ˜¯éå¸¸é‡è¦çš„æŠ€æœ¯ã€‚ å°±åƒlinuxçš„kernelï¼ŒAIä»£ç†å°±æ˜¯LLM OSçš„è°ƒåº¦æ ¸å¿ƒã€‚</p>
<p>LLMsç°åœ¨å·²ç»å­˜åœ¨äº†å‡ å¹´ï¼Œå®ƒä»¬æ­£è¿…é€Ÿå‘å±•æˆä¸º AI ä»£ç†å’Œä»£ç†å·¥ä½œæµã€‚LLMså¾ˆæ£’ï¼Œä½†å®ƒä»¬ä»ç„¶ä¸æ“…é•¿è‡ªåŠ¨åŒ–å¤„ç†äº‹åŠ¡ã€‚LLMsä¸å…¶ä»–å·¥å…·ç»“åˆèµ·æ¥æ˜¯åˆ©ç”¨LLMsæ‰€æ‹¥æœ‰çš„é€šç”¨æ™ºèƒ½çš„ä¸€ç§éå¸¸é«˜æ•ˆçš„æ–¹å¼ï¼Œé€šè¿‡æ¶ˆè€—å¤§é‡çš„è¯­è¨€æ•°æ®ã€‚LLMsæœ€å¤§çš„é—®é¢˜åœ¨äºå®ƒä»¬å¶å°”ä¼šè¿·å¤±æ–¹å‘ï¼ˆå¹»è§‰ï¼‰ï¼Œæˆ‘ä»¬æ°¸è¿œä¸çŸ¥é“ä½•æ—¶LLMsæˆ–ä»£ç†å¯èƒ½ä¼šå¤±è´¥ã€‚å›´ç»•è¿™äº›å¤±è´¥å·²ç»æœ‰ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œä½†æˆ‘ä»¬è¿œæœªå……åˆ†åˆ©ç”¨LLMsæ™®é€šæ™ºèƒ½çš„å…¨éƒ¨èƒ½åŠ›ã€‚</p>
<h2 id="ä»-RAG-åˆ°-Agents"><a href="#ä»-RAG-åˆ°-Agents" class="headerlink" title="ä» RAG åˆ° Agents"></a>ä» RAG åˆ° Agents</h2><p>RAG æ˜¯ä¸€ç§åŠå‚æ•°ç±»å‹çš„ç³»ç»Ÿï¼Œå…¶ä¸­å‚æ•°éƒ¨åˆ†æ˜¯å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œå…¶ä½™éƒ¨åˆ†æ˜¯éå‚æ•°éƒ¨åˆ†ã€‚å°†æ‰€æœ‰ä¸åŒéƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·å¾—åˆ°åŠå‚æ•°ç³»ç»Ÿã€‚LLMs å°†æ‰€æœ‰ä¿¡æ¯å­˜å‚¨åœ¨å®ƒä»¬çš„æƒé‡æˆ–å‚æ•°ä¸­ï¼ˆä»¥ç¼–ç å½¢å¼ï¼‰ï¼Œè€Œç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†æ²¡æœ‰å®šä¹‰è¯¥çŸ¥è¯†çš„å‚æ•°ã€‚</p>
<ul>
<li>äº¤æ¢ç´¢å¼•ï¼ˆç‰¹å®šä¿¡æ¯åœ¨LLMsä¸­ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œå®šåˆ¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸ä¼šé­å—è¿‡æ—¶ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ç´¢å¼•ä¸­çš„å†…å®¹ã€‚</li>
<li>ç”¨è¿™äº›ç´¢å¼•æ¥ä½œä¸ºLLMsçš„åŸºç¡€ä¿¡æ¯ï¼Œæ„å‘³ç€æˆ‘ä»¬ä¼šå‡å°‘å¹»è§‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å‘æ¥æºè¿›è¡Œå¼•ç”¨å’Œå½’å› </li>
</ul>
<p>å› æ­¤ï¼ŒåŸåˆ™ä¸Šï¼ŒRAG ä¸ºæˆ‘ä»¬çš„LLMsåˆ›å»ºæ›´å¥½çš„æƒ…å¢ƒåŒ–ã€‚</p>
<p><img src="/../asset_aiagenteverything/01.png"></p>
<p>â€œä»£ç†â€æ˜¯ä¸€ç§è‡ªåŠ¨æ¨ç†å’Œå†³ç­–å¼•æ“ã€‚å®ƒæ¥æ”¶ç”¨æˆ·è¾“å…¥&#x2F;æŸ¥è¯¢ï¼Œå¹¶å¯ä»¥åšå‡ºå†…éƒ¨å†³ç­–æ¥æ‰§è¡Œè¯¥æŸ¥è¯¢ï¼Œä»¥è¿”å›æ­£ç¡®çš„ç»“æœã€‚å…³é”®ä»£ç†ç»„ä»¶å¯ä»¥åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºæ›´å°çš„é—®é¢˜</li>
<li>é€‰æ‹©è¦ä½¿ç”¨çš„å¤–éƒ¨å·¥å…·+ç¡®å®šè°ƒç”¨è¯¥å·¥å…·çš„å‚æ•°</li>
<li>è§„åˆ’ä¸€ç»„ä»»åŠ¡</li>
<li>å°†å…ˆå‰å®Œæˆçš„ä»»åŠ¡å­˜å‚¨åœ¨å†…å­˜æ¨¡å—ä¸­</li>
</ul>
<p><img src="/../asset_aiagenteverything/02.webp"></p>
<p>æˆ‘ä»¬æœ‰ä¸åŒç±»å‹çš„ä»£ç†ï¼Œä»ç®€å•åˆ°æå…¶å¤æ‚çš„ä»£ç†ã€‚æ ¹æ®ä»»åŠ¡çš„å¤æ‚æ€§ï¼Œæˆ‘ä»¬è®¾è®¡è¿™äº›ä»£ç†ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªä¸»å†³å®šé€‰æ‹©å¯ç”¨çš„å·¥å…·ã€‚ä¸‹é¢çš„å›¾ç‰‡æ˜¾ç¤ºäº†ä¸åŒç±»å‹çš„ä»£ç†åŠå…¶å¤æ‚ç¨‹åº¦ã€‚</p>
<p><img src="/../asset_aiagenteverything/03.webp"></p>
<h2 id="ä»£ç†ç³»ç»Ÿæ¦‚è¿°"><a href="#ä»£ç†ç³»ç»Ÿæ¦‚è¿°" class="headerlink" title="ä»£ç†ç³»ç»Ÿæ¦‚è¿°"></a>ä»£ç†ç³»ç»Ÿæ¦‚è¿°</h2><p>åœ¨ä¸€ä¸ªç”±LLMé©±åŠ¨çš„è‡ªä¸»ä»£ç†ç³»ç»Ÿä¸­ï¼ŒLLMå……å½“ä»£ç†çš„å¤§è„‘ï¼Œåˆ©ç”¨ä¸åŒçš„ç»„ä»¶åœ¨æ•°å­—ä¸–ç•Œä¸­æ‰§è¡Œæ“ä½œã€‚</p>
<h3 id="å·¥å…·ä½¿ç”¨"><a href="#å·¥å…·ä½¿ç”¨" class="headerlink" title="å·¥å…·ä½¿ç”¨"></a>å·¥å…·ä½¿ç”¨</h3><p>ä»£ç†ç¨‹åºå­¦ä¼šè°ƒç”¨å¤–éƒ¨ API æˆ–å·¥å…·ï¼Œä»¥è·å–æ¨¡å‹æƒé‡ä¸­å¯èƒ½ç¼ºå¤±çš„é¢å¤–ä¿¡æ¯&#x2F;ä¸Šä¸‹æ–‡æˆ–åŠŸèƒ½ï¼ˆé€šå¸¸åœ¨é¢„è®­ç»ƒåéš¾ä»¥æ›´æ”¹ï¼‰ã€‚è¿™åŒ…æ‹¬å½“å‰ä¿¡æ¯ã€æ•°å­¦å¼•æ“ã€ä»£ç æ‰§è¡Œèƒ½åŠ›ã€è®¿é—®ä¸“æœ‰ä¿¡æ¯æºç­‰ç­‰ã€‚</p>
<h3 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h3><ul>
<li>çŸ­æœŸè®°å¿†ï¼šåœ¨ä¸Šä¸‹æ–‡å­¦ä¹ ä¸­ï¼Œå¯ä»¥å°†å…¶è§†ä¸ºåˆ©ç”¨æ¨¡å‹çš„çŸ­æœŸè®°å¿†æ¥å¤„ç†ç»™å®šé—®é¢˜ã€‚ä¸Šä¸‹æ–‡é•¿åº¦çª—å£å¯ä»¥è¢«è§†ä¸ºçŸ­æœŸè®°å¿†ã€‚</li>
<li>é•¿æœŸè®°å¿†ï¼šä¸ºä»£ç†æä¾›åœ¨è¾ƒé•¿æ—¶é—´å†…ä¿ç•™å’Œå¬å›ï¼ˆæ— é™ï¼‰ä¿¡æ¯çš„èƒ½åŠ›ï¼Œé€šå¸¸é€šè¿‡åˆ©ç”¨å¤–éƒ¨å‘é‡å­˜å‚¨å’Œå¿«é€Ÿæ£€ç´¢ã€‚RAG ä¸­çš„æ£€ç´¢éƒ¨åˆ†å¯ä»¥è¢«è§†ä¸ºé•¿æœŸè®°å¿†ã€‚</li>
</ul>
<h3 id="è®¡åˆ’"><a href="#è®¡åˆ’" class="headerlink" title="è®¡åˆ’"></a>è®¡åˆ’</h3><ul>
<li>å­ç›®æ ‡å’Œä»»åŠ¡åˆ†è§£ï¼šä»£ç†å°†è¾ƒå¤§çš„ä»»åŠ¡åˆ†è§£ä¸ºè¾ƒå°ã€å¯ç®¡ç†çš„å­ç›®æ ‡ï¼Œä»è€Œæœ‰æ•ˆå¤„ç†å¤æ‚ä»»åŠ¡ã€‚</li>
<li>åæ€å’Œå®Œå–„ï¼šä»£ç†å¯ä»¥è¿›è¡Œè‡ªæˆ‘æ‰¹è¯„ï¼ˆè™½ç„¶åœ¨æŸäº›æ–¹é¢å­˜ç–‘ï¼‰ï¼Œå¹¶å¯¹è¿‡å»çš„è¡ŒåŠ¨è¿›è¡Œè‡ªæˆ‘åæ€ï¼Œä»é”™è¯¯ä¸­å¸å–æ•™è®­ï¼Œå¹¶ä¸ºæœªæ¥çš„æ­¥éª¤è¿›è¡Œå®Œå–„ï¼Œä»è€Œæ”¹å–„æœ€ç»ˆç»“æœã€‚</li>
</ul>
<p><img src="/../asset_aiagenteverything/04.webp"></p>
<h2 id="äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨"><a href="#äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨" class="headerlink" title="äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨"></a>äººå·¥æ™ºèƒ½ä»£ç†çš„å·¥å…·ä½¿ç”¨</h2><p>èƒ½å¤Ÿä½¿ç”¨å·¥å…·æ˜¯äººç±»åœ¨è®¸å¤šæ–¹é¢ä¸å…¶ä»–ç”Ÿç‰©æœ‰æ‰€ä¸åŒçš„åœ°æ–¹ã€‚æˆ‘ä»¬åˆ›é€ ã€ä¿®æ”¹å’Œåˆ©ç”¨å¤–éƒ¨ç‰©ä½“æ¥æ‰©å±•æˆ‘ä»¬çš„èº«ä½“å’Œè®¤çŸ¥èƒ½åŠ›ã€‚åŒæ ·ï¼Œä¸ºLLMsé…å¤‡å¤–éƒ¨å·¥å…·å¯ä»¥æ˜¾è‘—æ‰©å±•å®ƒä»¬çš„èƒ½åŠ›ã€‚</p>
<p>åœ¨ AI ä»£ç†è®¾ç½®ä¸­ï¼Œå·¥å…·å¯¹åº”äºä¸€ç»„å·¥å…·ï¼Œä½¿LLMä»£ç†èƒ½å¤Ÿä¸å¤–éƒ¨ç¯å¢ƒï¼ˆå¦‚ Google æœç´¢ã€ä»£ç è§£é‡Šå™¨ã€æ•°å­¦å¼•æ“ç­‰ï¼‰è¿›è¡Œäº¤äº’ã€‚å·¥å…·ä¹Ÿå¯ä»¥æ˜¯æŸç§å½¢å¼çš„æ•°æ®åº“ã€çŸ¥è¯†åº“å’Œå¤–éƒ¨æ¨¡å‹ã€‚å½“ä»£ç†ä¸å¤–éƒ¨å·¥å…·äº¤äº’æ—¶ï¼Œå®ƒé€šè¿‡å·¥ä½œæµæ‰§è¡Œä»»åŠ¡ï¼Œå¸®åŠ©ä»£ç†è·å–è§‚å¯Ÿç»“æœæˆ–å®Œæˆç»™å®šå­ä»»åŠ¡å’Œæœ€ç»ˆä»»åŠ¡æ‰€éœ€çš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>å·¥å…·å¦‚ä½•ä»¥ä¸åŒæ–¹å¼è¢«LLMsåˆ©ç”¨çš„å‡ ä¸ªç¤ºä¾‹ï¼š</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2205.00445">MRKL</a>ï¼ˆModular Reasoning, Knowledge, and Languageï¼‰æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå°†LLMsä¸ä¸“å®¶æ¨¡å—ç»“åˆèµ·æ¥ï¼Œè¿™äº›æ¨¡å—å¯ä»¥æ˜¯LLMsæˆ–ç¬¦å·åŒ–çš„ï¼ˆè®¡ç®—å™¨æˆ–å¤©æ°” APIï¼‰ã€‚</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.17580">HuggingGPT</a> â€” ä¸€ä¸ªç”±LLMé©±åŠ¨çš„ä»£ç†ï¼Œåˆ©ç”¨LLMsä½œä¸ºä»»åŠ¡è§„åˆ’å™¨ï¼Œè¿æ¥å„ç§ç°æœ‰çš„ AI æ¨¡å‹ï¼ˆåŸºäºæè¿°ï¼‰æ¥è§£å†³ AI ä»»åŠ¡ã€‚</p>
</li>
</ul>
<p><img src="/../asset_aiagenteverything/05.webp"></p>
<p>HuggingGPT çš„æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥æ ¹æ®åŸå§‹è®ºæ–‡ä¸­æåˆ°çš„å†…å®¹åˆ†ä¸ºå››ä¸ªé˜¶æ®µï¼š</p>
<p>ä»»åŠ¡è§„åˆ’ï¼šä½¿ç”¨ ChatGPT åˆ†æç”¨æˆ·çš„è¯·æ±‚ä»¥ç†è§£ä»–ä»¬çš„æ„å›¾ï¼Œå¹¶å°†å…¶æ‹†åˆ†ä¸ºå¯èƒ½å¯è§£å†³çš„ä»»åŠ¡ã€‚</p>
<p>æ¨¡å‹é€‰æ‹©ï¼šä¸ºäº†è§£å†³è®¡åˆ’ä¸­çš„ä»»åŠ¡ï¼ŒChatGPT åŸºäºæ¨¡å‹æè¿°ä» Hugging Face ä¸Šé€‰æ‹©ä¸“å®¶æ¨¡å‹ã€‚</p>
<p>ä»»åŠ¡æ‰§è¡Œï¼šè°ƒç”¨å¹¶æ‰§è¡Œæ¯ä¸ªé€‰æ‹©çš„æ¨¡å‹ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™ ChatGPTã€‚</p>
<p>å“åº”ç”Ÿæˆï¼šæœ€åï¼ŒChatGPT è¢«ç”¨äºæ•´åˆæ‰€æœ‰æ¨¡å‹çš„é¢„æµ‹å¹¶ä¸ºç”¨æˆ·ç”Ÿæˆå“åº”ã€‚</p>
<p>HuggingGPT åœ¨ä¸€ä¸ªçœŸå®ç¤ºä¾‹ä¸­æ˜¯å¦‚ä½•è¿ä½œçš„, å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="/../asset_aiagenteverything/06.png"></p>
<h2 id="åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜"><a href="#åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜" class="headerlink" title="åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜"></a>åœ¨ä»£ç†å·¥ä½œæµç¨‹ä¸­è§£å†³å†…å­˜é—®é¢˜</h2><p>å†…å­˜å¯ä»¥è¢«å®šä¹‰ä¸ºç”¨äºè·å–ã€å­˜å‚¨ã€ä¿ç•™å’Œç¨åæ£€ç´¢ä¿¡æ¯çš„èµ„æºæˆ–å­˜å‚¨å™¨ã€‚åœ¨ä»»ä½•è®¡ç®—ç³»ç»Ÿä¸­éƒ½æœ‰å‡ ç§ç±»å‹çš„å†…å­˜ã€‚</p>
<h3 id="ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰"><a href="#ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰" class="headerlink" title="ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰:"></a>ç¼“å†²å†…å­˜ï¼ˆæ„Ÿè§‰å†…å­˜ï¼‰:</h3><p>æ­£å¦‚æ„Ÿè§‰è®°å¿†ä½œä¸ºæ„Ÿè§‰ä¿¡æ¯çš„çŸ­æš‚ä¿ç•™ï¼ˆä»»åŠ¡å®Œæˆåç«‹å³æ¶ˆå¤±ï¼‰çš„ä½œç”¨ï¼Œè®¡ç®—æœºç³»ç»Ÿä¸­çš„ç¼“å†²å­˜å‚¨å™¨å¯ä»¥ä¿å­˜ç¬æ€æ•°æ®ï¼Œå¦‚æŒ‡ä»¤é›†ã€‚å¯¹äºLLMsï¼Œè¿™å¯èƒ½æŒ‡çš„æ˜¯ä»¤ç‰Œç¼“å†²åŒºæˆ–è¾“å…¥é˜Ÿåˆ—ã€‚</p>
<h3 id="å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š"><a href="#å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š" class="headerlink" title="å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š"></a>å·¥ä½œè®°å¿†ï¼ˆçŸ­æœŸè®°å¿†ï¼ŒSTMï¼‰ï¼š</h3><p>LLMsåœ¨å¤„ç†æ–‡æœ¬æ—¶ï¼Œé‡‡ç”¨ç±»ä¼¼äºäººç±»å·¥ä½œè®°å¿†çš„æœºåˆ¶ã€‚å®ƒä»¬ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶æ¥ä¿æŒå¯¹è¾“å…¥çš„æŸäº›éƒ¨åˆ†çš„â€œå…³æ³¨â€ã€‚åœ¨åŸºäº Transformer çš„æ¨¡å‹ï¼ˆå¦‚ GPTï¼‰ä¸­ï¼Œæ³¨æ„åŠ›æƒé‡èµ·ç€ç±»ä¼¼äº STM çš„ä½œç”¨ï¼ŒåŒæ—¶ä¿æŒå’Œå¤„ç†å¤šä¸ªä¿¡æ¯ç‰‡æ®µã€‚LLMçš„å·¥ä½œè®°å¿†æ˜¯å…¶ä¸Šä¸‹æ–‡é•¿åº¦ã€‚</p>
<h3 id="å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š"><a href="#å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š" class="headerlink" title="å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š"></a>å‚æ•°å†…å­˜ï¼ˆé•¿æœŸè®°å¿†ï¼ŒLTMï¼‰ï¼š</h3><p>LLMs çš„å‚æ•°ï¼ˆæˆ–æƒé‡ï¼‰å¯ä»¥è¢«è§†ä¸ºä¸€ç§é•¿æœŸè®°å¿†å½¢å¼ã€‚ä¸€æ—¦è®­ç»ƒå®Œæˆï¼Œè¿™äº›å‚æ•°ä¼šç¼–ç ä»è®­ç»ƒæ•°æ®ä¸­è·å–çš„å¤§é‡ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ— é™æœŸåœ°ä¿ç•™ã€‚</p>
<p>åœ¨LLMsä¸­ï¼Œâ€œè®°å¿†â€ä¸æ˜¯ä½œä¸ºç¦»æ•£äº‹ä»¶å­˜å‚¨çš„ï¼Œè€Œæ˜¯ä½œä¸ºæ¨¡å¼ï¼ˆæŠ½è±¡ä¸–ç•Œæ¨¡å‹ï¼Œå°½ç®¡ä¸å®Œå…¨ï¼‰åœ¨ä¸€ä¸ªäº’è¿èŠ‚ç‚¹ç½‘ç»œä¸­è¡¨ç¤ºï¼Œå¹¶ä¸”è¯¥æ¨¡å‹é€šè¿‡æ ¹æ®å…¶è®­ç»ƒçŠ¶æ€åŠ¨æ€ç”Ÿæˆå“åº”æ¥â€œå›å¿†â€ä¿¡æ¯ã€‚</p>
<p>å¤–éƒ¨å­˜å‚¨å™¨å¯ä»¥è§£å†³æœ‰é™æ³¨æ„åŠ›è·¨åº¦çš„é—®é¢˜ã€‚æ ‡å‡†åšæ³•æ˜¯å°†åµŒå…¥å‘é‡ï¼ˆæ–‡æœ¬è½¬æ¢ä¸ºå¯†é›†å‘é‡ï¼‰ä¿å­˜åˆ°ä¸€ä¸ªæ”¯æŒå¿«é€Ÿæœ€å¤§å†…ç§¯æœç´¢ï¼ˆ<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Maximum_inner-product_search">MIPS</a>ï¼‰çš„å‘é‡å­˜å‚¨æ•°æ®åº“ä¸­ã€‚ä¸ºäº†ä¼˜åŒ–æ£€ç´¢é€Ÿåº¦ï¼Œå¸¸è§é€‰æ‹©æ˜¯ä½¿ç”¨è¿‘ä¼¼æœ€è¿‘é‚»å±…ï¼ˆANNï¼‰ç®—æ³•ï¼Œä»¥è¿”å›å¤§çº¦å‰ k ä¸ªæœ€è¿‘é‚»å±…ï¼Œä»¥æ¢å–ä¸€ç‚¹ç²¾åº¦æŸå¤±æ¥è·å¾—å·¨å¤§çš„åŠ é€Ÿã€‚</p>
<p>ç”¨äºæ­¤æ£€ç´¢çš„ä¸€äº›ç®—æ³•ï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Locality-sensitive_hashing">LSH</a>ã€<a target="_blank" rel="noopener" href="https://github.com/spotify/annoy">ANNOY</a>ã€<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1603.09320">HNSW</a>ã€<a target="_blank" rel="noopener" href="https://github.com/facebookresearch/faiss">FAISS</a> å’Œ <a target="_blank" rel="noopener" href="https://github.com/google-research/google-research/tree/master/scann">ScaNN</a></p>
<p>æ‰€æœ‰è¿™äº›æ–¹æ³•èƒŒåçš„ä¸€èˆ¬åŸåˆ™â€”â€”LSHã€ANNOYã€HNSWã€FAISS å’Œ ScaNNâ€”â€”æ˜¯åœ¨é«˜ç»´ç©ºé—´ä¸­é«˜æ•ˆåœ°è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ã€‚è¿™äº›æ–¹æ³•æ—¨åœ¨é€šè¿‡ä½¿ç”¨å°†ç›¸ä¼¼æ•°æ®ç‚¹ç»„åˆåœ¨ä¸€èµ·çš„ç­–ç•¥ï¼Œä»¥å…è®¸æ›´å¿«çš„æ£€ç´¢æ¥å…‹æœç²¾ç¡®æœç´¢çš„è®¡ç®—å¼ºåº¦ã€‚</p>
<h2 id="è®¡åˆ’ï¼šå½“å‰-AI-ä»£ç†çš„æœ€å¤§é—®é¢˜"><a href="#è®¡åˆ’ï¼šå½“å‰-AI-ä»£ç†çš„æœ€å¤§é—®é¢˜" class="headerlink" title="è®¡åˆ’ï¼šå½“å‰ AI ä»£ç†çš„æœ€å¤§é—®é¢˜"></a>è®¡åˆ’ï¼šå½“å‰ AI ä»£ç†çš„æœ€å¤§é—®é¢˜</h2><p>æœ‰æ—¶ä»£ç†ä¼šä¸ºäº†å›ç­”ä¸€ä¸ªå•ä¸€&#x2F;ç®€å•çš„é—®é¢˜è€Œå¤§é‡è°ƒç”¨ï¼Œä¸ºæ¯ä¸ªæŸ¥è¯¢ç§¯ç´¯ä»¤ç‰Œç»™LLMã€‚è¿™ä¸ä»…æˆæœ¬é«˜æ˜‚ï¼Œè¿˜ä¼šå¼•å…¥å»¶è¿Ÿã€‚ä»¤ç‰Œç”Ÿæˆä»ç„¶æ˜¯ä¸€ä¸ªç›¸å¯¹ç¼“æ…¢çš„è¿‡ç¨‹ï¼Œå¤§éƒ¨åˆ†ï¼ˆä¸æ˜¯å…¨éƒ¨ï¼‰åŸºäºLLMçš„åº”ç”¨ç¨‹åºä¸­çš„å»¶è¿Ÿæ¥è‡ªç”Ÿæˆè¾“å‡ºä»¤ç‰Œã€‚åå¤è°ƒç”¨LLMå¹¶è¦æ±‚å…¶æä¾›æƒ³æ³•&#x2F;è§‚å¯Ÿï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šç”Ÿæˆå¤§é‡è¾“å‡ºä»¤ç‰Œï¼ˆæˆæœ¬ï¼‰ï¼Œå¯¼è‡´é«˜å»¶è¿Ÿï¼ˆç”¨æˆ·ä½“éªŒä¸‹é™ï¼‰ã€‚</p>
<p>ä¸€ä¸ªä¾‹å­å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ä¸ºäº†è¾¾åˆ°æ­£ç¡®ç­”æ¡ˆæˆ–è¡ŒåŠ¨ï¼ŒLLMsç»å¸¸å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œç”±äºä»£ç†å·¥ä½œæµç¨‹çš„å›ºæœ‰ç»“æ„ä»¥æ ‘å½¢æˆ–å›¾å½¢ï¼Œè¿™ä¼šå¼•å…¥è®¸å¤šå»¶è¿Ÿã€‚</p>
<p>æœ‰å¾ˆå¤šç±»ä¼¼çš„è®ºæ–‡ï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2201.11903">æ€ç»´é“¾</a>ï¼Œ<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2305.10601.pdf">æ€ç»´æ ‘</a>ï¼Œ<a target="_blank" rel="noopener" href="https://arxiv.org/pdf/2308.10379.pdf">æ€ç»´ç®—æ³•</a>ã€‚</p>
<p><img src="/../asset_aiagenteverything/07.webp"></p>
<p>æœ€æ–°çš„é«˜çº§æç¤ºç­–ç•¥æ˜¯â€æ€ç»´ç®—æ³•â€ï¼šè¿™ç¯‡æ€ç»´ç®—æ³•æ–°è®ºæ–‡çš„ç†å¿µä¸æ€ç»´æ ‘è®ºæ–‡ç›¸åŒï¼Œä½†ä¸»è¦åŒºåˆ«åœ¨äºä¸Šä¸‹æ–‡ä¿å­˜çš„æ–¹å¼ã€‚åœ¨æ€ç»´æ ‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŸºäºæ ‘çš„æ•°æ®ç»“æ„ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åŸºäºå›¾çš„ç»“æ„ï¼Œå› æ­¤ç»™æˆ‘ä»¬æä¾›äº†æ¯”ä½¿ç”¨ç®€å•çš„ BFS æˆ– DFS æ›´å¥½çš„æ–¹å¼æ¥æµè§ˆæ‰€æœ‰çš„çŸ¥è¯†å›¾ã€‚</p>
<p>å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯æ€ç»´ç®—æ³•ä½¿ç”¨æ›´å°‘çš„æç¤ºæ¥å®ç°ç±»ä¼¼çš„ç»“æœã€‚è¿™äº›æç¤ºç­–ç•¥èƒŒåçš„æ•´ä¸ªç†å¿µæ˜¯ä»¥æœ€å°‘çš„è°ƒç”¨LLMæ¥è·å¾—æœ€å¤šçš„ä¸Šä¸‹æ–‡ã€‚</p>
<p>AI ä»£ç†çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯LLMsæ˜¯éç¡®å®šæ€§çš„ã€‚è™½ç„¶å¯¹äºåˆ›æ„ç”Ÿæˆæœ‰ç›Šï¼Œä½†åœ¨éœ€è¦å¯é¢„æµ‹æ€§çš„åœºæ™¯ä¸­ï¼Œè¿™å¸¦æ¥äº†ä¸¥é‡æŒ‘æˆ˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ­£åœ¨ç¼–å†™ä¸€ä¸ªLLMæ”¯æŒçš„èŠå¤©åº”ç”¨ç¨‹åºæ¥è¿›è¡Œ Postgres æŸ¥è¯¢ï¼ˆText2SQLï¼‰ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰å¾ˆé«˜çš„å¯é¢„æµ‹æ€§ã€‚</p>
<h2 id="è‡ªæˆ‘åé¦ˆ"><a href="#è‡ªæˆ‘åé¦ˆ" class="headerlink" title="è‡ªæˆ‘åé¦ˆ"></a>è‡ªæˆ‘åé¦ˆ</h2><p>ç”±äºè®¡åˆ’æ¨¡å—ä¸æ¶‰åŠä»»ä½•åé¦ˆï¼Œè¿™ä½¿å¾—å®ç°é•¿æœŸè§„åˆ’å˜å¾—éå¸¸å›°éš¾ï¼Œå°¤å…¶æ˜¯è§£å†³å¤æ‚ä»»åŠ¡æ—¶å°¤ä¸ºå¿…è¦ã€‚ä¸ºäº†è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªè¿‡ç¨‹ï¼Œæ ¹æ®è¿‡å»çš„è¡ŒåŠ¨å’Œè§‚å¯Ÿï¼Œåå¤åæ€å’Œå®Œå–„æ‰§è¡Œè®¡åˆ’ã€‚ç›®æ ‡æ˜¯çº æ­£å’Œæ”¹è¿›è¿‡å»çš„é”™è¯¯ï¼Œæœ‰åŠ©äºæé«˜æœ€ç»ˆç»“æœçš„è´¨é‡ã€‚è¿™åœ¨å¤æ‚çš„ç°å®ç¯å¢ƒå’Œä»»åŠ¡ä¸­å°¤ä¸ºé‡è¦ï¼Œè¯•é”™æ˜¯å®Œæˆä»»åŠ¡çš„å…³é”®ã€‚</p>
<h3 id="ReAct"><a href="#ReAct" class="headerlink" title="ReAct"></a>ReAct</h3><p><a target="_blank" rel="noopener" href="https://www.promptingguide.ai/techniques/react">ReAct</a> ç»“åˆæ¨ç†å’Œè¡ŒåŠ¨ï¼Œæ—¨åœ¨ä½¿LLMèƒ½å¤Ÿé€šè¿‡äº¤æ›¿æ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤ï¼ˆé‡å¤ N æ¬¡ï¼‰ï¼š Thought ï¼Œ Action å’Œ Observation æ¥è§£å†³å¤æ‚ä»»åŠ¡ã€‚ReAct ä¿ƒä½¿LLMsç”Ÿæˆå£å¤´æ¨ç†ç—•è¿¹å’Œä»»åŠ¡çš„è¡ŒåŠ¨ã€‚è¿™ä½¿ç³»ç»Ÿèƒ½å¤Ÿè¿›è¡ŒåŠ¨æ€æ¨ç†ï¼Œä¸ºè¡ŒåŠ¨åˆ›å»ºã€ç»´æŠ¤å’Œè°ƒæ•´è®¡åˆ’ï¼ŒåŒæ—¶è¿˜èƒ½ä¸å¤–éƒ¨ç¯å¢ƒï¼ˆä¾‹å¦‚ç»´åŸºç™¾ç§‘ï¼‰è¿›è¡Œäº¤äº’ï¼Œå°†é¢å¤–ä¿¡æ¯çº³å…¥æ¨ç†è¿‡ç¨‹ã€‚</p>
<p><img src="/../asset_aiagenteverything/08.webp"></p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº† ReAct çš„ç¤ºä¾‹ä»¥åŠæ‰§è¡Œé—®ç­”æ‰€æ¶‰åŠçš„ä¸åŒæ­¥éª¤ã€‚</p>
<p><img src="/../asset_aiagenteverything/09.webp"></p>
<h3 id="Reflexion"><a href="#Reflexion" class="headerlink" title="Reflexion"></a>Reflexion</h3><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.11366">Reflexion</a>è¿™æ˜¯ä¸€ä¸ªæ—¨åœ¨ä¸ºä»£ç†äººæä¾›åŠ¨æ€è®°å¿†å’Œè‡ªæˆ‘åæ€èƒ½åŠ›ä»¥æé«˜æ¨ç†èƒ½åŠ›çš„æ¡†æ¶ã€‚ Reflexion å…·æœ‰æ ‡å‡†çš„ RL è®¾ç½®ï¼Œå…¶ä¸­å¥–åŠ±æ¨¡å‹æä¾›ç®€å•çš„äºŒè¿›åˆ¶å¥–åŠ±ï¼Œè¡ŒåŠ¨ç©ºé—´éµå¾ª ReAct ä¸­çš„è®¾ç½®ï¼Œå…¶ä¸­ç‰¹å®šäºä»»åŠ¡çš„è¡ŒåŠ¨ç©ºé—´é€šè¿‡è¯­è¨€è¿›è¡Œå¢å¼ºï¼Œä»¥å®ç°å¤æ‚çš„æ¨ç†æ­¥éª¤ã€‚åœ¨æ¯ä¸ªåŠ¨ä½œ ğ‘ğ‘¡ ä¹‹åï¼Œä»£ç†è®¡ç®—å¯å‘å¼ â„ğ‘¡ï¼Œå¹¶æ ¹æ®è‡ªæˆ‘åæ€ç»“æœå†³å®šæ˜¯å¦é‡ç½®ç¯å¢ƒä»¥å¼€å§‹æ–°çš„è¯•éªŒã€‚</p>
<p><img src="/../asset_aiagenteverything/10.webp"></p>
<p>heuristic (å¯å‘å¼)å‡½æ•°ç¡®å®šä½•æ—¶è§„åˆ’ä½æ•ˆæˆ–åŒ…å«å¹»è§‰,éœ€è¦åœæ­¢ã€‚ä½æ•ˆçš„è§„åˆ’æ˜¯æŒ‡èŠ±è´¹å¤ªé•¿æ—¶é—´è€Œæ²¡æœ‰æˆåŠŸã€‚å¹»è§‰è¢«å®šä¹‰ä¸ºé‡åˆ°ä¸€ç³»åˆ—è¿ç»­ç›¸åŒçš„è¡ŒåŠ¨ï¼Œå¯¼è‡´ç¯å¢ƒä¸­å‡ºç°ç›¸åŒçš„è§‚å¯Ÿã€‚</p>
<h3 id="Chain-of-Hindsight-ï¼ˆCoHï¼‰"><a href="#Chain-of-Hindsight-ï¼ˆCoHï¼‰" class="headerlink" title="Chain of Hindsight ï¼ˆCoHï¼‰"></a>Chain of Hindsight ï¼ˆCoHï¼‰</h3><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2302.02676">CoH</a> , åœ¨å›é¡¾é“¾ä¸­ï¼Œæ¨¡å‹è¢«è¦æ±‚é€šè¿‡æŸ¥çœ‹è‡ªå·±çš„è¿‡å»å·¥ä½œæ¥æ”¹è¿›è‡ªå·±ï¼Œè¯„åˆ†ï¼Œå¹¶é™„æœ‰å¦‚ä½•åœ¨ä¸‹æ¬¡åšå¾—æ›´å¥½çš„æ³¨é‡Šã€‚æ¨¡å‹é€šè¿‡å°è¯•äº§ç”Ÿä¸€ä¸ªèƒ½è·å¾—æ›´é«˜è¯„åˆ†çš„æ–°è¾“å‡ºæ¥è¿›è¡Œç»ƒä¹ ï¼Œåˆ©ç”¨è‡ªå·±å°è¯•å’Œåé¦ˆçš„å†å²ã€‚ä¸ºäº†é˜²æ­¢æ¨¡å‹ä»…ä»…è®°ä½ç­”æ¡ˆï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ä¼šéšè—éƒ¨åˆ†å†å²è®°å½•ã€‚</p>
<h3 id="Algorithm-Distillation-AD"><a href="#Algorithm-Distillation-AD" class="headerlink" title="Algorithm Distillation (AD)"></a>Algorithm Distillation (AD)</h3><p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2210.14215">AD</a> å°†ç±»ä¼¼çš„æƒ³æ³•åº”ç”¨äºæœºå™¨äººæˆ–ä»£ç†å­¦ä¹ ä»»åŠ¡ï¼ˆå¦‚è§†é¢‘æ¸¸æˆä¸­çš„ RL ä»£ç†ï¼‰ã€‚ä»£ç†äººå›é¡¾äº†è‡ªå·±åœ¨è¿‡å»å‡ æ¬¡å°è¯•ä¸­çš„è¡¨ç°ï¼Œå¹¶è¯•å›¾æ‰¾å‡ºæ”¹è¿›çš„æ¨¡å¼ã€‚ç„¶åï¼Œå®ƒé¢„æµ‹ä¸‹ä¸€æ­¥åº”è¯¥æ¯”ä»¥å‰çš„æ›´å¥½ï¼Œå­¦ä¹ å˜å¾—æ›´å¥½çš„ç­–ç•¥ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‰¹å®šé—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>AD ä¸“æ³¨äºä»ä»£ç†äººä¸ç¯å¢ƒäº’åŠ¨çš„å†å²ä¸­å­¦ä¹ çš„ç†å¿µã€‚é€šè¿‡æŸ¥çœ‹è¿‡å»è¡ŒåŠ¨åºåˆ—åŠå…¶ç»“æœï¼Œä»£ç†äººè¯•å›¾å°†æˆåŠŸçš„ç­–ç•¥æç‚¼åˆ°å…¶ç­–ç•¥ä¸­ã€‚</p>
<p>Reflexion åæ€åˆ™èµ‹äºˆä»£ç†äººè®°ä½è¿‡å»è¡ŒåŠ¨å¹¶åæ€å…¶æœ‰æ•ˆæ€§çš„èƒ½åŠ›ï¼Œç‰¹åˆ«å…³æ³¨æ£€æµ‹å’Œé¿å…é‡å¤æˆ–æ— æ•ˆç­–ç•¥ï¼ˆå¦‚å¹»è§‰ï¼‰ã€‚</p>
<h2 id="ä»£ç†ç±»å‹"><a href="#ä»£ç†ç±»å‹" class="headerlink" title="ä»£ç†ç±»å‹"></a>ä»£ç†ç±»å‹</h2><h3 id="è·¯ç”±ä»£ç†"><a href="#è·¯ç”±ä»£ç†" class="headerlink" title="è·¯ç”±ä»£ç†"></a>è·¯ç”±ä»£ç†</h3><p>æœ€ç®€å•çš„ä»£ç†æ¨ç†å½¢å¼ã€‚æ ¹æ®ç”¨æˆ·æŸ¥è¯¢å’Œä¸€ç»„é€‰æ‹©ï¼Œè¾“å‡ºä¸€ä¸ªé€‰æ‹©å­é›†ä»¥è·¯ç”±è¯¥æŸ¥è¯¢ã€‚</p>
<p><img src="/../asset_aiagenteverything/11.webp"></p>
<p>åœ¨ä¸Šè¿°æŸ¥è¯¢ä¸­ï¼Œâ€œä½œè€…åœ¨è‰ºæœ¯å­¦æ ¡æœŸé—´åšäº†ä»€ä¹ˆï¼Ÿâ€è¢«ä¼ é€’ç»™è·¯ç”±å™¨ã€‚è·¯ç”±å™¨çš„å·¥ä½œæ˜¯é€šè¿‡ç³»ç»Ÿç¡®å®šæŸ¥è¯¢çš„æœ€ä½³è·¯å¾„ï¼Œä»¥æ£€ç´¢æœ€ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<p>è·¯ç”±å™¨å¯ä»¥é€‰æ‹©ä¸¤æ¡å¯èƒ½çš„è·¯å¾„ï¼š</p>
<p>çŸ¢é‡æŸ¥è¯¢å¼•æ“ï¼šè¯¥å¼•æ“æ ¹æ®æŸ¥è¯¢å‘é‡ä¸æ–‡æ¡£å‘é‡ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ï¼Œä»æ›´å¤§çš„é›†åˆä¸­æ£€ç´¢å‰ k ä¸ªç›¸å…³æ–‡æ¡£ã€‚å®ƒä½¿ç”¨å‘é‡ç©ºé—´æ¨¡å‹æ¥ç†è§£å’Œæ£€ç´¢ä¸æŸ¥è¯¢åœ¨è¯­ä¹‰ä¸Šæœ€æ¥è¿‘çš„æ–‡æ¡£ã€‚</p>
<p>æ‘˜è¦æŸ¥è¯¢å¼•æ“ï¼šè¯¥å¼•æ“æ£€ç´¢æ‰€æœ‰æ–‡æ¡£å¹¶æä¾›å…¶å†…å®¹çš„æ‘˜è¦ã€‚å®ƒå…è®¸ç³»ç»Ÿå¹¿æ³›äº†è§£ä¸€ä¸ªä¸»é¢˜ï¼Œè€Œæ— éœ€é€ä¸ªæŸ¥çœ‹æ¯ä¸ªæ–‡æ¡£ã€‚</p>
<p>æ ¹æ®è·¯ç”±å™¨çš„å†³å®šï¼Œè¦ä¹ˆè¿”å›æ¥è‡ªçŸ¢é‡æŸ¥è¯¢å¼•æ“çš„ç‰¹å®šæ–‡æ¡£å­é›†ï¼Œè¦ä¹ˆè¿”å›æ¥è‡ªæ‘˜è¦æŸ¥è¯¢å¼•æ“çš„æ‰€æœ‰ç›¸å…³æ–‡æ¡£çš„æ‘˜è¦ï¼Œä»¥å›ç­”ç”¨æˆ·çš„æŸ¥è¯¢ã€‚è¿™ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†æœ€ç»ˆè¿”å›çš„è¾“å‡ºç±»å‹ã€‚æœ‰äº›æŸ¥è¯¢å¯èƒ½éœ€è¦è¯¦ç»†ç­”æ¡ˆï¼Œæœ‰äº›å¯èƒ½å¯¹è¾ƒå¹¿æ³›çš„ç­”æ¡ˆæ»¡æ„ã€‚è¿™äº›è·¯ç”±å™¨ä»£ç†å¸®åŠ©æˆ‘ä»¬ä¿®æ”¹LLMsçš„è¡Œä¸ºã€‚</p>
<h3 id="æŸ¥è¯¢è§„åˆ’ä»£ç†"><a href="#æŸ¥è¯¢è§„åˆ’ä»£ç†" class="headerlink" title="æŸ¥è¯¢è§„åˆ’ä»£ç†"></a>æŸ¥è¯¢è§„åˆ’ä»£ç†</h3><p>æŸ¥è¯¢è§„åˆ’ä»£ç†èƒŒåçš„ç†å¿µæ˜¯é¦–å…ˆå°†å¤æ‚æŸ¥è¯¢åˆ†è§£ä¸ºæ¯ä¸ªç›¸å…³æ•°æ®æºçš„å­é—®é¢˜ï¼Œç„¶åæ”¶é›†æ‰€æœ‰ä¸­é—´å“åº”å¹¶ç»¼åˆå‡ºæœ€ç»ˆå“åº”ã€‚</p>
<p><img src="/../asset_aiagenteverything/12.webp"></p>
<p>æŸ¥çœ‹æŸ¥è¯¢è§„åˆ’ä»£ç†å¦‚ä½•é€šè¿‡å­æŸ¥è¯¢è·å¾—æ›´å¥½çš„å“åº”ã€‚</p>
<p><img src="/../asset_aiagenteverything/13.webp"></p>
<h3 id="å·¥å…·ä½¿ç”¨ä»£ç†"><a href="#å·¥å…·ä½¿ç”¨ä»£ç†" class="headerlink" title="å·¥å…·ä½¿ç”¨ä»£ç†"></a>å·¥å…·ä½¿ç”¨ä»£ç†</h3><p>è¿™æ˜¯å¯ä»¥ä½¿ç”¨å·¥å…·æˆ– API çš„ä»£ç†ç±»å‹ï¼Œæ¨æ–­è¿è¡Œè¯¥å·¥å…·æ‰€éœ€çš„å‚æ•°ï¼Œå¹¶å°†å…¶ç»“æœè¿”å›ç»™LLMä¸Šä¸‹æ–‡ï¼Œä»¥è·å¾—æ›´å‡†ç¡®çš„ç­”æ¡ˆã€‚</p>
<p><img src="/../asset_aiagenteverything/14.webp"></p>
<p>ä»£ç†å¦‚ä½•å¤„ç†åºåˆ—åŒ–çš„ä¸€å †é—®é¢˜ï¼Ÿä»£ç†å¦‚ä½•éšæ—¶é—´ä¿æŒçŠ¶æ€ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ›´é«˜çº§ä»£ç†å¦‚ HuggingGPT å’Œ ChemCrow è¿›å…¥ç”»é¢çš„åœ°æ–¹ã€‚åœ¨è¿™äº›å¤šä»£ç†è®¾ç½®ä¸­ï¼Œç³»ç»Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªå·¥å…·ï¼Œå¹¶ä¸”é€šå¸¸è¿˜é›†æˆäº†åŠ¨æ€å†…å­˜ã€‚è¿™äº›ç³»ç»Ÿé€šå¸¸ä½¿ç”¨ ReAct å’Œ Reflexion ç­‰æ–¹æ³•ï¼Œåœ¨ä»£ç†çš„ç¯å¢ƒå’Œè¡ŒåŠ¨ä¸­å…·æœ‰ç»†è‡´è‡ªæ´½çš„æ–¹æ³•ã€‚</p>
<p><img src="/../asset_aiagenteverything/15.webp"></p>
<p>ä»¥ä¸‹æ˜¯ç”¨äºæ„å»º LLM ä»£ç†çš„å·¥å…·å’Œæ¡†æ¶çš„ç¤ºä¾‹ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://python.langchain.com/docs/get_started/introduction">LangChain</a>ï¼šä¸€ä¸ªåŸºäºè¯­è¨€æ¨¡å‹çš„åº”ç”¨ç¨‹åºå’Œä»£ç†å¼€å‘æ¡†æ¶ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Significant-Gravitas/AutoGPT">AutoGPT</a>ï¼šæä¾›æ„å»º AI ä»£ç†çš„å·¥å…·ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://microsoft.github.io/autogen/">AutoGen</a> ï¼šä¸€ä¸ªæ¡†æ¶ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªä»£ç†å¼€å‘LLMåº”ç”¨ç¨‹åºï¼Œè¿™äº›ä»£ç†å¯ä»¥ç›¸äº’å¯¹è¯ä»¥è§£å†³ä»»åŠ¡ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://www.llamaindex.ai/">LlamaIndex</a> - ç”¨äºå°†è‡ªå®šä¹‰æ•°æ®æºè¿æ¥åˆ°å¤§å‹è¯­è¨€æ¨¡å‹çš„æ¡†æ¶ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/gpt-engineer-org/gpt-engineer">GPT Engineer</a> ï¼šè‡ªåŠ¨åŒ–ä»£ç ç”Ÿæˆä»¥å®Œæˆå¼€å‘ä»»åŠ¡ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://github.com/melih-unsal/DemoGPT">DemoGPT</a> ï¼šè‡ªä¸» AI ä»£ç†ä»¥åˆ›å»ºäº¤äº’å¼ Streamlit åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>LLM ä»£ç†ä»å¤„äºèŒèŠ½é˜¶æ®µï¼Œæ„å»ºå®ƒä»¬ä»å­˜åœ¨è®¸å¤šæŒ‘æˆ˜å’Œé™åˆ¶ï¼Œæ¯”å¦‚åŸºäº LLM çš„ä»£ç†éœ€è¦é€‚åº”è§’è‰²ä»¥æœ‰æ•ˆåœ°å®Œæˆé¢†åŸŸå†…çš„ä»»åŠ¡ï¼Œèƒ½å¤Ÿè¿›è¡Œé•¿æœŸè§„åˆ’ï¼Œæ™®éçš„äººç±»å¯¹é½ï¼Œå¯é æ€§ï¼ŒçŸ¥è¯†é™åˆ¶ï¼Œä»¥åŠè®¸å¤šå…¶ä»–é—®é¢˜ã€‚</p>
<p>åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç ”ç©¶æ›´é«˜çº§çš„æ¦‚å¿µï¼Œå¦‚ KV ç¼“å­˜å’ŒLLMç¼–è¯‘å™¨ä¸æ“ä½œç³»ç»Ÿã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://medium.com/aiguys/ai-agents-are-all-you-need-0b38e8ee5481">https://medium.com/aiguys/ai-agents-are-all-you-need-0b38e8ee5481</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/17/magic-eraser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/17/magic-eraser/" class="post-title-link" itemprop="url">ä½¿ç”¨ PyTorch åˆ›å»ºè¿·ä½ ç¥å¥‡æ©¡çš®æ“¦</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-17 20:16:47 / ä¿®æ”¹æ—¶é—´ï¼š21:18:24" itemprop="dateCreated datePublished" datetime="2024-04-17T20:16:47+08:00">2024-04-17</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>27 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>å»å¹´ï¼ŒGoogle å‘æ‰€æœ‰æ‹¥æœ‰ Google One çš„ç”¨æˆ·æä¾›äº†â€œç¥å¥‡æ©¡çš®æ“¦â€ã€‚æœ‰äº†ç¥å¥‡æ©¡çš®æ“¦ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä»ç…§ç‰‡ä¸­åˆ é™¤ä¸éœ€è¦çš„éƒ¨åˆ†ã€‚å®ƒåˆ©ç”¨äººå·¥æ™ºèƒ½æ ¹æ®å‘¨å›´ç¯å¢ƒå¡«å……é€‚å½“çš„å¯¹è±¡ï¼Œä½¿æ•´ä½“å›¾ç‰‡çœ‹èµ·æ¥æ›´åŠ è‡ªç„¶ï¼å¾®ä¿¡ä¹Ÿæœ‰è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>è¿™é¡¹æŠ€æœ¯å¯èƒ½çœ‹èµ·æ¥åƒé­”æœ¯ï¼Œè®©æ‚¨å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ›´æ”¹å›¾åƒã€‚æœ‰äº›äººå¯èƒ½è®¤ä¸ºè¿™éœ€è¦å¤§é‡çš„æ•°å­¦çŸ¥è¯†å’Œè®¡ç®—æœºæ€§èƒ½ã€‚ä½†å®é™…ä¸Šï¼Œé­”æœ¯æ©¡çš®æ“¦ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œå›¾åƒä¿®å¤â€ï¼Œå¹¶ä¸å¤ªå¤æ‚ï¼Œå¯ä»¥åœ¨æ‚¨è‡ªå·±çš„è®¡ç®—æœºä¸Šå®Œæˆã€‚</p>
<p>å½“ä»Šæµè¡Œçš„æ–¹æ³•åŒ…æ‹¬åŸºäºæ‰©æ•£ã€GANsï¼ˆç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰å’Œæ³¨æ„åŠ›æœºåˆ¶çš„æ¨¡å‹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»åŸºäº GAN çš„å›¾åƒä¿®å¤æ–¹æ³•ã€‚</p>
<h2 id="æ¡ä»¶å›¾åƒç”Ÿæˆ"><a href="#æ¡ä»¶å›¾åƒç”Ÿæˆ" class="headerlink" title="æ¡ä»¶å›¾åƒç”Ÿæˆ"></a>æ¡ä»¶å›¾åƒç”Ÿæˆ</h2><p>å›¾åƒç”Ÿæˆæœ¬è´¨ä¸Šæ˜¯è®©æˆ‘ä»¬çš„æ¨¡å‹äº§ç”Ÿä¸€ä¸ªè™šå‡çš„æ•°æ®åˆ†å¸ƒ Pmodel(x)ã€‚ç›®æ ‡æ˜¯ä½¿è¿™ä¸ªåˆ†å¸ƒå°½å¯èƒ½æ¥è¿‘çœŸå®åˆ†å¸ƒ Pdata(x)ï¼Œä»è€Œç”Ÿæˆæ–°çš„å›¾åƒã€‚</p>
<p><img src="/../asset_magiceraser/01.webp"></p>
<p>åœ¨å›¾åƒä¿®å¤ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¡«è¡¥å›¾åƒä¸­ç¼ºå¤±çš„éƒ¨åˆ†ã€‚è¿™å¯ä»¥è¢«çœ‹ä½œæ˜¯å‘å›¾åƒå¼•å…¥ä¸€ä¸ªâ€œæ¡ä»¶â€ï¼Œå°†æˆ‘ä»¬æ¨¡å‹çš„æ–¹æ³•ä»ä¸€èˆ¬åˆ†å¸ƒ Pmodel(x) è½¬å˜ä¸ºæ¡ä»¶åˆ†å¸ƒ Pmodel(x | condition)ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºå¸¸è§„å›¾åƒç”Ÿæˆï¼Œä½†å¤šäº†ä¸€ä¸ªå°†æ¡ä»¶çº³å…¥æˆ‘ä»¬æ¨¡å‹çš„é¢å¤–æ­¥éª¤ï¼Œæˆ‘ç¨åä¼šè¯¦ç»†è®¨è®ºã€‚</p>
<h2 id="å›¾åƒä¿®å¤çš„æ­¥éª¤"><a href="#å›¾åƒä¿®å¤çš„æ­¥éª¤" class="headerlink" title="å›¾åƒä¿®å¤çš„æ­¥éª¤"></a>å›¾åƒä¿®å¤çš„æ­¥éª¤</h2><p><img src="/../asset_magiceraser/02.webp"></p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªéšæœºé®ç½©</li>
<li>å°†çœŸå®å›¾åƒä¸é®ç½©ç›¸ç»“åˆï¼ˆé®ç½©å›¾åƒï¼‰</li>
<li>æŠŠé®ç½©å›¾åƒå’Œé®ç½©ä½œä¸ºç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼Œç”Ÿæˆå‡å›¾åƒ</li>
<li>è®¡ç®—çœŸå®å›¾åƒå’Œå‡å›¾åƒä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼ˆæŸå¤±ï¼‰</li>
</ul>
<h2 id="è”åˆè°ƒåˆ¶-GAN"><a href="#è”åˆè°ƒåˆ¶-GAN" class="headerlink" title="è”åˆè°ƒåˆ¶ GAN"></a>è”åˆè°ƒåˆ¶ GAN</h2><p>è”åˆè°ƒåˆ¶ç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼Œæˆ–ç§° CoModGANï¼Œæ˜¯ä¸€ç§ä¸“ä¸ºå›¾åƒè¡¥å…¨è®¾è®¡çš„ç”Ÿæˆæ¨¡å‹ã€‚è¯¥æ¨¡å‹åœ¨å¤„ç†å›¾åƒä¸­å¤§ç‰‡ç¼ºå¤±åŒºåŸŸçš„ä»»åŠ¡ä¸­ç‰¹åˆ«æœ‰æ•ˆã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ç§ GANï¼ˆç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼‰æ¨¡å‹ï¼Œè¿™æ„å‘³ç€å®ƒä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç”Ÿæˆå™¨è´Ÿè´£åˆ›å»ºå›¾åƒï¼Œé‰´åˆ«å™¨è¯„ä¼°è¿™äº›å›¾åƒä»¥ç¡®å®šå®ƒä»¬æ˜¯çœŸå®çš„è¿˜æ˜¯è™šå‡çš„ã€‚</p>
<p><img src="/../asset_magiceraser/03.webp"><br>æœ‰æ¡ä»¶å›¾åƒç”Ÿæˆçš„è¿‡ç¨‹</p>
<p>è®©æˆ‘ä»¬å…³æ³¨ CoModGAN çš„å¦ä¸€ä¸ªå…³é”®æ–¹é¢ï¼šâ€™è”åˆè°ƒåˆ¶â€™ã€‚ä¸‹é¢çš„å›¾åƒå±•ç¤ºäº†è°ƒåˆ¶çš„ä¸åŒæ–¹æ³•ï¼šï¼ˆDï¼šè§£ç å™¨ï¼ŒMï¼šæ˜ å°„ç½‘ç»œ, Eï¼šæœ‰æ¡ä»¶ç¼–ç å™¨ï¼‰</p>
<p><img src="/../asset_magiceraser/04.webp"></p>
<ul>
<li>æ¨¡å‹ (a) ä»£è¡¨äº†ä¸€ç§ç”¨äºç”Ÿæˆå›¾åƒçš„æ— æ¡ä»¶æ¨¡å‹ï¼Œæœ€åˆåœ¨ StyleGAN ä¸­å¼•å…¥ã€‚å…¶å…³é”®ç‰¹å¾åŒ…æ‹¬è°ƒåˆ¶å’Œæ˜ å°„ç½‘ç»œã€‚</li>
<li>æ¨¡å‹ (b) å’Œ (c) æ˜¯ç¼–ç å™¨-è§£ç å™¨æ¶æ„çš„å…¸å‹ç¤ºä¾‹ï¼Œå…¶ä¸­ç¼–ç å™¨å°†å›¾åƒè½¬æ¢ä¸ºæ½œåœ¨ç©ºé—´ï¼Œè€Œè§£ç å™¨é‡å»ºåŸå§‹å›¾åƒã€‚(ä¾‹å¦‚ Pix2Pixï¼ŒCycleGANâ€¦)</li>
<li>æ¨¡å‹ (d) åŸºäºæ¨¡å‹ (b) å’Œ (c) çš„ç»“æ„ï¼Œå¹¶ä¸”è¿˜æ•´åˆäº† StyleGAN çš„ (a) æ˜ å°„ç½‘ç»œä»¥è§£å¼€æ½œåœ¨å‘é‡ Zã€‚æ­¤å¤–ï¼Œä¸ºäº†æ›´å¥½åœ°æ§åˆ¶ç”Ÿæˆå›¾åƒçš„é£æ ¼ï¼Œå®ƒå°† E å’Œ M çš„è¾“å‡ºç»„åˆä½œä¸º D çš„é¢å¤–è¾“å…¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒè¢«ç§°ä¸ºå…±è°ƒåˆ¶ã€‚</li>
</ul>
<h2 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h2><p>æœºå™¨å­¦ä¹ ä¸­çš„ç¬¬ä¸€æ­¥ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„ä¸€æ­¥æ˜¯æ•°æ®é¢„å¤„ç†é˜¶æ®µã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ CelebA-HQ æ•°æ®é›†å’ŒçŸ©å½¢é®ç½©æ¥è®­ç»ƒæ¨¡å‹ã€‚æ­¤å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªç”±å½¢å¼çš„é®ç½©æˆ–åˆ›å»ºè‡ªå·±çš„é®ç½©</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def rectangle_mask(shape, min_size=32, max_size=96):</span><br><span class="line">    h, w = shape</span><br><span class="line">    mask = np.zeros([h, w])</span><br><span class="line">    hole_size = random.randint(min_size, max_size)</span><br><span class="line">    hole_size = min(int(w*0.8), int(h*0.8), hole_size)</span><br><span class="line">    x = random.randint(0, w-hole_size-1)</span><br><span class="line">    y = random.randint(0, h-hole_size-1)</span><br><span class="line">    mask[x:x+hole_size, y:y+hole_size] = 1</span><br><span class="line">    return mask.reshape([1, h, w]).astype(np.float32)</span><br><span class="line">    </span><br><span class="line">def random_ff_mask(shape):</span><br><span class="line">    h,w = shape</span><br><span class="line">    mask = np.zeros((h,w))</span><br><span class="line">    num_v = 12+np.random.randint(5)</span><br><span class="line">    </span><br><span class="line">    for i in range(num_v):</span><br><span class="line">        start_x = np.random.randint(w)</span><br><span class="line">        start_y = np.random.randint(h)</span><br><span class="line">        for j in range(1+np.random.randint(5)):</span><br><span class="line">            angle = 0.01+np.random.randint(4)</span><br><span class="line">            if i % 2 == 0:</span><br><span class="line">                angle = 2 * 3.1415926 - angle</span><br><span class="line">            length = 10+np.random.randint(30)</span><br><span class="line">            brush_w = 10+np.random.randint(7)</span><br><span class="line">            end_x = (start_x + length * np.sin(angle)).astype(np.int32)</span><br><span class="line">            end_y = (start_y + length * np.cos(angle)).astype(np.int32)</span><br><span class="line"></span><br><span class="line">            cv2.line(mask, (start_y, start_x), (end_y, end_x), 1.0, brush_w)</span><br><span class="line">            start_x, start_y = end_x, end_y</span><br><span class="line">    return mask.reshape((1,) + mask.shape).astype(np.float32)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">class InpaintData(torch.utils.data.Dataset):</span><br><span class="line">    def __init__(self, path, img_size=[128, 128]):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.file_list = []</span><br><span class="line">        self.img_size = img_size</span><br><span class="line">        self.transforms = transforms.Compose([</span><br><span class="line">            # can put some augmentation here</span><br><span class="line">            transforms.RandomHorizontalFlip(0.5),</span><br><span class="line">            transforms.ToTensor(),</span><br><span class="line">            transforms.Normalize([0.5, 0.5, 0.5], [0.5, 0.5, 0.5])]</span><br><span class="line">        )</span><br><span class="line">        for file_name in glob(f&#x27;&#123;path&#125;/**/*.jpg&#x27;, recursive=True):</span><br><span class="line">            self.file_list.append(file_name)</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        return len(self.file_list)</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, idx):</span><br><span class="line">        file_name = self.file_list[idx]</span><br><span class="line">        img = Image.open(file_name).convert(&#x27;RGB&#x27;)</span><br><span class="line">        img = transforms.functional.resize(img, self.img_size, Image.BICUBIC)</span><br><span class="line">        img = self.transforms(img)</span><br><span class="line">        mask = rectangle_mask([128, 128])</span><br><span class="line">        return img, mask</span><br><span class="line">      </span><br><span class="line">path = &quot;put your path here!&quot;</span><br><span class="line">dataset = InpaintData(path)</span><br><span class="line">train_data = torch.utils.data.DataLoader(</span><br><span class="line">                    dataset,</span><br><span class="line">                    batch_size=16,</span><br><span class="line">                    shuffle= True,</span><br><span class="line">                    pin_memory=True,</span><br><span class="line">                    drop_last=True)</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_magiceraser/05.webp"></p>
<h2 id="æ¨¡å‹æ¶æ„"><a href="#æ¨¡å‹æ¶æ„" class="headerlink" title="æ¨¡å‹æ¶æ„"></a>æ¨¡å‹æ¶æ„</h2><p><img src="/../asset_magiceraser/06.webp"></p>
<p>ä¸Šé¢çš„å›¾è¡¨æ˜¾ç¤ºäº† CoModGAN ä¸­ç”Ÿæˆå™¨çš„ç»“æ„ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šç¼–ç å™¨ç½‘ç»œå’Œè§£ç å™¨ç½‘ç»œã€‚ç¼–ç å™¨ç›¸å¯¹ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä½¿ç”¨æ·±åº¦å·ç§¯ç½‘ç»œï¼Œå¦‚ VGGï¼Œæ¥å¯¹è¾“å…¥è¿›è¡Œç¼–ç ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…³æ³¨è§£ç å™¨éƒ¨åˆ†ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè”åˆè°ƒåˆ¶ç»“åˆäº†æ¥è‡ªç¼–ç å™¨å’Œæ˜ å°„ç½‘ç»œçš„ä¸¤ä¸ªä¸åŒæ½œåœ¨å‘é‡ï¼Œå¹¶å°†å®ƒä»¬æ•´åˆåˆ°è§£ç å™¨çš„å„ä¸ªå±‚ä¸­ï¼Œç±»ä¼¼äº StyleGAN ä¸­çš„åˆæˆç½‘ç»œã€‚</p>
<h2 id="æé«˜-StyleGAN-çš„å›¾åƒè´¨é‡"><a href="#æé«˜-StyleGAN-çš„å›¾åƒè´¨é‡" class="headerlink" title="æé«˜ StyleGAN çš„å›¾åƒè´¨é‡"></a>æé«˜ StyleGAN çš„å›¾åƒè´¨é‡</h2><p><img src="/../asset_magiceraser/07.webp"><br>ä¸Šé¢çš„å›¾åƒæ˜¯ç”± StyleGAN ç”Ÿæˆçš„ï¼›æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾åƒçš„è§’è½å­˜åœ¨ä¸€äº›æ°´æ»´ã€‚è¿™ç§ç°è±¡ä»åˆ†è¾¨ç‡ä¸º 64x64 çš„æ‰€æœ‰ç‰¹å¾å›¾ä¸­å¼€å§‹å‡ºç°ï¼Œå¹¶åœ¨æ›´é«˜åˆ†è¾¨ç‡ä¸‹é€æ¸å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚<br><img src="/../asset_magiceraser/08.webp"></p>
<p>ä¸ºäº†è§£å†³æ°´æ»´é—®é¢˜ï¼Œä½œè€…æå‡ºäº† StyleGAN2ï¼ˆC å’Œ Dï¼‰ï¼Œè¿™æ˜¯ StyleGAN çš„ä¿®è®¢ç‰ˆæœ¬ã€‚ ä»–ä»¬è®¤ä¸ºè¿™ä¸ªé—®é¢˜æ˜¯ç”± AdaIN å±‚å¼•èµ·çš„ï¼Œè¯¥å±‚åˆ†åˆ«å¯¹æ¯ä¸ªç‰¹å¾å›¾çš„å‡å€¼å’Œæ–¹å·®è¿›è¡Œå½’ä¸€åŒ–ï¼Œå¯èƒ½ç ´åä¸ç‰¹å¾ç›¸å¯¹å¤§å°ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<p><img src="/../asset_magiceraser/09.webp"></p>
<p>å› æ­¤ï¼Œé€šè¿‡å»é™¤é£æ ¼å‡å€¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ°´æ»´ä¼ªå½±å®Œå…¨æ¶ˆå¤±äº†ã€‚ï¼ˆé™„ï¼šAdaIN ç°åœ¨ç›´æ¥åœ¨ CNN çš„æƒé‡ï¼ˆw2ï¼Œâ€¦ï¼‰ä¸Šè¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨å›¾åƒ Xi ä¸Šè¿è¡Œï¼‰</p>
<p><img src="/../asset_magiceraser/10.webp"><br>StyleGAN çš„ Demod å±‚</p>
<p>å¦ä¸€ä¸ªä¿®æ”¹æ¶‰åŠå°†å®ä¾‹å½’ä¸€åŒ–ï¼ˆNorm stdï¼‰æ›¿æ¢ä¸º Demod å±‚ã€‚ç”±äºå½’ä¸€åŒ–çš„ç›®çš„æ˜¯å°†å±‚çš„è¾“å‡ºæ¢å¤åˆ°å•ä½æ ‡å‡†å·®ï¼Œè¿™å¯ä»¥é€šè¿‡ç›´æ¥å¯¹å±‚çš„æƒé‡è¿›è¡Œå½’ä¸€åŒ–æ¥æ›´ç›´æ¥åœ°å®ç°ï¼Œè¿™è¢«ç§°ä¸ºâ€œè§£è°ƒâ€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">class Conv2DMod(nn.Module):</span><br><span class="line">    def __init__(self, in_channel, out_channel, kernel, demod=True, stride=1):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.kernel = kernel</span><br><span class="line">        self.demod = demod</span><br><span class="line">        self.stride = stride</span><br><span class="line">        self.filters = out_channel</span><br><span class="line">        self.weight = nn.Parameter(torch.randn((out_channel, in_channel, kernel, kernel)))</span><br><span class="line">        nn.init.kaiming_normal_(self.weight, a=0, mode=&#x27;fan_in&#x27;, nonlinearity=&#x27;leaky_relu&#x27;)</span><br><span class="line"></span><br><span class="line">    def _get_same_padding(self, size, kernel, stride, dilation=1):</span><br><span class="line">        return ((size - 1) * (stride - 1) + dilation * (kernel - 1)) // 2</span><br><span class="line"></span><br><span class="line">    def forward(self, x, style):</span><br><span class="line">        &#x27;&#x27;&#x27; </span><br><span class="line">        x: [b, c, h, w]</span><br><span class="line">        style: [b, s_dim]</span><br><span class="line">        </span><br><span class="line">        Style modulation:</span><br><span class="line">        w&#x27; = style * w</span><br><span class="line">        Demodulation: </span><br><span class="line">        w&#x27;&#x27; = w&#x27; / sqrt(x&#x27;**2 + eps) &#x27;&#x27;&#x27;</span><br><span class="line">        </span><br><span class="line">        b, c, h, w = x.shape</span><br><span class="line">        style = style[:, None, :, None, None]</span><br><span class="line">        weight = self.weight[None, :, :, :, :]</span><br><span class="line">        weight = weight * (style + 1)</span><br><span class="line">        </span><br><span class="line">        if self.demod: </span><br><span class="line">            d = torch.rsqrt((weight ** 2).sum(dim=(2, 3, 4), keepdim=True) + 1e-8)</span><br><span class="line">            weight = weight * d</span><br><span class="line">            </span><br><span class="line">        x = x.reshape(1, -1, h, w)</span><br><span class="line">        _, _, *ws = weight.shape</span><br><span class="line">        weight = weight.reshape(b * self.filters, *ws)</span><br><span class="line">        padding = self._get_same_padding(h, self.kernel, self.stride)</span><br><span class="line">        x = F.conv2d(x, weight, padding=padding, groups=b)</span><br><span class="line">        x = x.reshape(-1, self.filters, h, w)</span><br><span class="line">        return x</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå™¨å—"><a href="#ç”Ÿæˆå™¨å—" class="headerlink" title="ç”Ÿæˆå™¨å—"></a>ç”Ÿæˆå™¨å—</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class EqualLinear(nn.Module):</span><br><span class="line">    def __init__(self, in_dim, out_dim, bias = True, bias_init = 0, lr_mul = 1):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.weight = torch.nn.Parameter(torch.randn([out_dim, in_dim]) / lr_mul)</span><br><span class="line">        self.bias = torch.nn.Parameter(torch.full([out_dim], np.float32(bias_init))) if bias else None</span><br><span class="line">        self.weight_gain = lr_mul / np.sqrt(in_dim)</span><br><span class="line">        self.bias_gain = lr_mul</span><br><span class="line">    </span><br><span class="line">    def forward(self, x):</span><br><span class="line">        w = self.weight * self.weight_gain</span><br><span class="line">        layer = F.linear(x, w, bias = None)</span><br><span class="line">        if self.bias is not None:</span><br><span class="line">            layer = F.linear(x, w, bias = self.bias * self.bias_gain)</span><br><span class="line">        return layer</span><br><span class="line"></span><br><span class="line">class ToRGB(nn.Module):</span><br><span class="line">    def __init__(self, latent_dim, inp_dim):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.style = Linear(latent_dim, inp_dim)</span><br><span class="line">        self.conv = Conv2DMod(inp_dim, 3, 1, demod=False)</span><br><span class="line">        self.upsample = Upsample(scale_factor = 2, mode=&#x27;bilinear&#x27;)</span><br><span class="line">        </span><br><span class="line">    def forward(self, inp, style, prev_rgb = None):</span><br><span class="line">        style = self.style(style)</span><br><span class="line">        out = self.conv(inp, style)</span><br><span class="line">        if prev_rgb is not None:</span><br><span class="line">            prev_rgb = self.upsample(prev_rgb)</span><br><span class="line">            out += prev_rgb</span><br><span class="line">        return out</span><br></pre></td></tr></table></figure>

<p>EqualLinear ç”¨äºæ˜ å°„ç½‘ç»œä¸­ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åŠ¨æ€é‡æ–°è°ƒæ•´å±‚çš„è¾“å‡ºã€‚åœ¨æˆ‘çš„å®éªŒä¸­ï¼Œä¸å¸¸è§„çº¿æ€§å±‚ç›¸æ¯”ï¼Œä½¿ç”¨ EqualLinear åœ¨æ˜ å°„ç½‘ç»œä¸­å¹¶æ²¡æœ‰æ˜¾è‘—å½±å“ç»“æœã€‚æˆ‘å»ºè®®ç›´æ¥ä½¿ç”¨ torch.nn.Linearã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">class G_encode(nn.Module):</span><br><span class="line">    def __init__(self, in_channel, out_channel, downsample=True):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.downsample = downsample</span><br><span class="line">        self.conv_res = Conv2d(in_channel, out_channel, kernel_size=1, padding=0)</span><br><span class="line">        self.encode = nn.Sequential(</span><br><span class="line">            Conv2d(in_channel, out_channel, kernel_size=3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True),</span><br><span class="line">            Conv2d(out_channel, out_channel, kernel_size=3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True)</span><br><span class="line">        )  </span><br><span class="line">    def forward(self, x):</span><br><span class="line">        res = self.conv_res(x)</span><br><span class="line">        x = self.encode(x) + res</span><br><span class="line">        if self.downsample:</span><br><span class="line">            x = AvgPool2d(kernel_size=2, stride=2)(x)</span><br><span class="line">        return x</span><br><span class="line">        </span><br><span class="line">class G_decode(nn.Module):</span><br><span class="line">    def __init__(self, latent_dim, in_channel, out_channel, upsample=True):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.upsample = upsample</span><br><span class="line">        self.style1 = Linear(latent_dim, in_channel)</span><br><span class="line">        self.style2 = Linear(latent_dim, out_channel)</span><br><span class="line">        self.noise1 = Conv2d(1, out_channel, 1, padding=1)</span><br><span class="line">        self.noise2 = Conv2d(1, out_channel, 1, padding=1)</span><br><span class="line">        self.conv1 = Conv2DMod(in_channel, out_channel, 3)</span><br><span class="line">        self.conv2 = Conv2DMod(out_channel, out_channel, 3)</span><br><span class="line">        self.to_rgb = ToRGB(latent_dim, out_channel)</span><br><span class="line">        </span><br><span class="line">    def forward(self, x, style, noise, prev_rgb):</span><br><span class="line">        B, C, H, W = x.shape</span><br><span class="line">        if self.upsample:</span><br><span class="line">            x = Upsample(scale_factor=2, mode=&#x27;bilinear&#x27;, align_corners=False)(x)</span><br><span class="line">        noise1 = self.noise1(noise)[:, :, :x.shape[2], :x.shape[3]]</span><br><span class="line">        noise2 = self.noise2(noise)[:, :, :x.shape[2], :x.shape[3]]</span><br><span class="line">        style1 = self.style1(style)</span><br><span class="line">        style2 = self.style2(style)</span><br><span class="line">        </span><br><span class="line">        x = self.conv1(x, style1)</span><br><span class="line">        x = LeakyReLU(0.2, inplace=True)(x + noise1)</span><br><span class="line">        x = self.conv2(x, style2)</span><br><span class="line">        x = LeakyReLU(0.2, inplace=True)(x + noise2)</span><br><span class="line">        rgb = self.to_rgb(x, style, prev_rgb)</span><br><span class="line">        return x, rgb</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_magiceraser/11.webp"><br>ä¸åŒç±»å‹çš„ GAN æ¶æ„</p>
<p>è¿™é‡Œæœ‰ä¸€äº›ä¸åŒé€‰æ‹©çš„ tRGB å’Œ fRGB æ¶æ„ã€‚åœ¨æˆ‘çš„å®éªŒä¸­ï¼Œæˆ‘ä½¿ç”¨ (b) ä½œä¸ºä¸»è¦ç»“æ„ã€‚</p>
<h2 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h2><p><img src="/../asset_magiceraser/12.webp"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">class Generator(nn.Module):</span><br><span class="line">    def __init__(self, img_size, latent_dim, style_mlp = 8, lr_mul = 0.1, fmap_min = 16, fmap_max = 512):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_layers = int(log2(img_size)-2)</span><br><span class="line">        f_map = [fmap_min * (2 ** i) for i in range(self.num_layers + 1)]</span><br><span class="line">        filters = list(map(lambda x: min(fmap_max, x), f_map))</span><br><span class="line">        init_channel = filters[0]</span><br><span class="line">        self.latent_dim = latent_dim</span><br><span class="line">        self.style_dim = latent_dim + filters[-1]</span><br><span class="line">        self.in_out_channel = zip(filters[:-1], filters[1:])</span><br><span class="line">        self.init_conv = Conv2d(init_channel, init_channel, 3, padding=1)</span><br><span class="line">        </span><br><span class="line">        self.style_mapping =  nn.Sequential()</span><br><span class="line">        self.downs =  nn.ModuleList([])</span><br><span class="line">        self.ups = nn.ModuleList([])</span><br><span class="line">        </span><br><span class="line">        # 4 because image (b, 3, h, w) + mask (b, 1, h, w)</span><br><span class="line">        self.from_rgb = nn.Sequential(</span><br><span class="line">            Conv2d(4, filters[0], 3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True)</span><br><span class="line">        )</span><br><span class="line">        # x_global: latent vector of the input image</span><br><span class="line">        self.x_global = nn.Sequential(</span><br><span class="line">            Linear(filters[-1] * 4 * 4, filters[-1]),</span><br><span class="line">            LeakyReLU(0.2, inplace=True)</span><br><span class="line">        )</span><br><span class="line">        # style mapping network</span><br><span class="line">        for _ in range(style_mlp):</span><br><span class="line">            self.style_mapping.extend([EqualLinear(latent_dim, latent_dim, lr_mul), </span><br><span class="line">                                       LeakyReLU(0.2, inplace=True)])</span><br><span class="line">        # Encoder</span><br><span class="line">        for in_channel, out_channel in self.in_out_channel:</span><br><span class="line">            g_block = G_encode(in_channel,out_channel)               </span><br><span class="line">            self.downs.append(g_block)</span><br><span class="line">            </span><br><span class="line">        # Decoder (styleGAN)</span><br><span class="line">        reversed_filters = list(reversed(filters))</span><br><span class="line">        self.in_out_channel = zip(reversed_filters[:-1], reversed_filters[1:])</span><br><span class="line">        for in_channel, out_channel in self.in_out_channel:</span><br><span class="line">            g_block = G_decode(self.style_dim, in_channel, out_channel)            </span><br><span class="line">            self.ups.append(g_block)</span><br><span class="line">        </span><br><span class="line">    def forward(self, img, mask, latents, noise, return_latent=False):</span><br><span class="line">        b, c, h, w = img.shape</span><br><span class="line">        x = torch.cat([1 - mask - 0.5, img * (1- mask)], 1)</span><br><span class="line">        x = self.from_rgb(x)</span><br><span class="line">        for blocks in self.downs:</span><br><span class="line">            x = blocks(x)</span><br><span class="line">            </span><br><span class="line">        rgb = None</span><br><span class="line">        x = x.view(b, -1)</span><br><span class="line">        x_global = self.x_global(x) </span><br><span class="line">        styles = self.style_mapping(F.normalize(latents, dim=1))</span><br><span class="line">        styles = styles.view([-1, b, self.latent_dim])</span><br><span class="line">        x = x.view(b, -1, 4, 4)</span><br><span class="line">        </span><br><span class="line">        for block, style in zip(self.ups, styles):</span><br><span class="line">            # co-modulation</span><br><span class="line">            co_style = torch.cat([x_global, style.squeeze()], 1)</span><br><span class="line">            x, rgb = block(x, co_style, noise, rgb)</span><br><span class="line">            </span><br><span class="line">        raw_out = rgb</span><br><span class="line">        images_out = rgb * mask + img * (1-mask)</span><br><span class="line">        if return_latent:</span><br><span class="line">            return images_out, raw_out, styles</span><br><span class="line">        return images_out, raw_out</span><br></pre></td></tr></table></figure>

<h2 id="é‰´åˆ«å™¨"><a href="#é‰´åˆ«å™¨" class="headerlink" title="é‰´åˆ«å™¨"></a>é‰´åˆ«å™¨</h2><p><img src="/../asset_magiceraser/13.webp"></p>
<p>åœ¨è®¨è®ºäº†ç”Ÿæˆå™¨ä¹‹åï¼Œç°åœ¨æ˜¯æ—¶å€™è½¬å‘é‰´åˆ«å™¨äº†ã€‚ç”±äºé‰´åˆ«å™¨çš„ä¸»è¦ä½œç”¨æ˜¯åŒºåˆ†å›¾åƒæ˜¯çœŸå®çš„è¿˜æ˜¯è™šå‡çš„ï¼Œä»»ä½•å›¾åƒåˆ†ç±»æ¨¡å‹éƒ½å¯ä»¥ç”¨ä½œé‰´åˆ«å™¨ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œè®©æˆ‘ä»¬ç®€å•åœ°ä½¿ç”¨ç±»ä¼¼ VGG çš„ç»“æ„æ¥å®ç°å®ƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">class D_block(nn.Module):</span><br><span class="line">    def __init__(self, in_channel, out_channel, downsample = True):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.downsample = None</span><br><span class="line">        if downsample:</span><br><span class="line">            self.downsample = Conv2d(out_channel, out_channel, 3, padding = 1, stride = 2)</span><br><span class="line">        self.conv_res = Conv2d(in_channel, out_channel, 1, stride = (2 if downsample else 1))</span><br><span class="line">        self.net = nn.Sequential(</span><br><span class="line">            Conv2d(in_channel, out_channel, 3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True),</span><br><span class="line">            Conv2d(out_channel, out_channel, 3, padding=1),</span><br><span class="line">            LeakyReLU(0.2, inplace=True))</span><br><span class="line">        </span><br><span class="line">    def forward(self, x):</span><br><span class="line">        res = self.conv_res(x)</span><br><span class="line">        x = self.net(x)</span><br><span class="line">        if self.downsample is not None:</span><br><span class="line">            x = self.downsample(x)</span><br><span class="line">        x = (x + res) * (1 / math.sqrt(2))</span><br><span class="line">        return x</span><br><span class="line">      </span><br><span class="line">class Discriminator(nn.Module):</span><br><span class="line">    def __init__(self, img_size, fmap_min = 32, fmap_max = 512):</span><br><span class="line">        super().__init__()</span><br><span class="line">        self.num_layers = int(log2(img_size)-1)</span><br><span class="line">        f_map = [4] + [fmap_min * (2 ** i) for i in range(self.num_layers)]</span><br><span class="line">        filters = list(map(lambda x: min(fmap_max, x), f_map))</span><br><span class="line">        out_channel = filters[-1]</span><br><span class="line">        </span><br><span class="line">        self.in_out_channel = zip(filters[:-1], filters[1:])</span><br><span class="line">        self.blocks = nn.ModuleList([])</span><br><span class="line">        self.final_conv = Conv2d(out_channel, out_channel, 3, padding=1)</span><br><span class="line">        self.logit = Linear(out_channel * 4 * 4, 1)</span><br><span class="line">        for i, (in_channel, out_channel) in enumerate(self.in_out_channel):</span><br><span class="line">            down_sample = i != (self.num_layers - 1)</span><br><span class="line">            d_block = D_block(in_channel, out_channel, down_sample)</span><br><span class="line">            self.blocks.append(d_block)</span><br><span class="line">   </span><br><span class="line">    def forward(self, img, mask):</span><br><span class="line">        batch_size = img.shape[0]</span><br><span class="line">        x = torch.cat([1 - mask - 0.5, img], 1)</span><br><span class="line">        for block in self.blocks:</span><br><span class="line">            x = block(x)</span><br><span class="line">        x = self.final_conv(x)</span><br><span class="line">        x = x.view(batch_size, -1)</span><br><span class="line">        x = self.logit(x)</span><br><span class="line">        return x</span><br></pre></td></tr></table></figure>

<h2 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h2><p><img src="/../asset_magiceraser/14.webp"><br>æ¡ä»¶ GAN çš„æœ€å°-æœ€å¤§æŸå¤±</p>
<ul>
<li>Gï¼šç”Ÿæˆå™¨</li>
<li>Dï¼šåˆ¤åˆ«å™¨ï¼ˆè¾“å‡ºå€¼ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œå‡ï¼š0ï¼ŒçœŸï¼š1ï¼‰</li>
<li>X: è¾“å…¥å›¾åƒï¼Œå½¢çŠ¶ [B, C, H, W]</li>
<li>Y: æ©æ¨¡ï¼Œå½¢çŠ¶ [B, 1, H, W]</li>
<li>Z: æ½œåœ¨å‘é‡ï¼ˆä»é«˜æ–¯åˆ†å¸ƒä¸­éšæœºé‡‡æ ·ï¼‰</li>
</ul>
<p>æŸå¤±å‡½æ•°ä¸ç»å…¸ GAN ç›¸åŒï¼Œä¸ºç”Ÿæˆå™¨å’Œé‰´åˆ«å™¨è®¾å®šä¸åŒçš„ç›®æ ‡ï¼Œä»è€Œåœ¨å®ƒä»¬ä¹‹é—´åˆ›å»ºç«äº‰ã€‚</p>
<p>é‰´åˆ«å™¨è¯•å›¾æ›´å¥½åœ°åŒºåˆ†ç”±ç”Ÿæˆå™¨åˆ¶ä½œçš„å‡å›¾åƒå’ŒçœŸå®å›¾åƒï¼Œè€Œç”Ÿæˆå™¨çš„ç›®æ ‡æ˜¯æ¬ºéª—é‰´åˆ«å™¨ï¼Œä¸é‰´åˆ«å™¨çš„åšæ³•ç›¸åã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def d_loss_fn(real_pred, fake_pred):</span><br><span class="line">    real_loss = F.softplus(-real_pred)</span><br><span class="line">    fake_loss = F.softplus(fake_pred)</span><br><span class="line">    return real_loss.mean() + fake_loss.mean()</span><br><span class="line">    </span><br><span class="line">def g_loss_fn(fake_pred):</span><br><span class="line">    loss = F.softplus(-fake_pred).mean()</span><br><span class="line">    return loss</span><br></pre></td></tr></table></figure>

<h2 id="è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–"><a href="#è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–" class="headerlink" title="è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–"></a>è®­ç»ƒå¾ªç¯å’Œæ‡’æƒ°æ­£åˆ™åŒ–</h2><p>åœ¨ StyleGAN ä¸­ï¼Œä½œè€…é‡‡ç”¨äº†ä¸¤ç§ç±»å‹çš„æ­£åˆ™åŒ–ï¼Œå³é‰´åˆ«å™¨çš„ R1 æ­£åˆ™åŒ–å’Œç”Ÿæˆå™¨çš„è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–ï¼Œç”¨äºå¯¹ä¸¤ä¸ªç»„ä»¶æ–½åŠ çº¦æŸã€‚</p>
<p>å¦å¤–ï¼Œä½œè€…è¿˜å‘ç°å¹¶ä¸éœ€è¦åœ¨æ¯æ¬¡æƒé‡æ›´æ–°æ—¶éƒ½åº”ç”¨æ­£åˆ™åŒ–ã€‚ç›¸åï¼Œå¯¹é‰´åˆ«å™¨çš„æ­£åˆ™åŒ–æ¯ 16 æ¬¡æ›´æ–°åº”ç”¨ä¸€æ¬¡ï¼Œå¯¹ç”Ÿæˆå™¨çš„æ­£åˆ™åŒ–æ¯ 8 æ¬¡æ›´æ–°åº”ç”¨ä¸€æ¬¡ï¼Œè¿™è¢«ç§°ä¸ºâ€œæ‡’æƒ°æ­£åˆ™åŒ–â€ã€‚</p>
<h2 id="R1-æ­£åˆ™åŒ–"><a href="#R1-æ­£åˆ™åŒ–" class="headerlink" title="R1 æ­£åˆ™åŒ–"></a>R1 æ­£åˆ™åŒ–</h2><p><img src="/../asset_magiceraser/15.webp"><br>R1 æ­£åˆ™åŒ–ä»…å¯¹çœŸå®æ•°æ®ä¸Šçš„æ¢¯åº¦è¿›è¡Œæƒ©ç½šï¼Œæ—¨åœ¨é˜²æ­¢é‰´åˆ«å™¨ç”Ÿæˆåç¦»æ•°æ®æµå½¢çš„éé›¶æ¢¯åº¦ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ç”Ÿæˆå™¨äº§ç”ŸçœŸå®æ•°æ®åˆ†å¸ƒæ—¶ï¼Œé‰´åˆ«å™¨åœ¨æ•°æ®æµå½¢ä¸Šçš„è¾“å‡ºç­‰äº 0ï¼ˆé€šå¸¸æ„å‘³ç€é‰´åˆ«å™¨æ— æ³•åŒºåˆ†çœŸå‡æ•°æ®ï¼‰ï¼Œæ¢¯åº¦æƒ©ç½šç¡®ä¿é‰´åˆ«å™¨æ— æ³•ç”Ÿæˆéé›¶æ¢¯åº¦ï¼Œå¦åˆ™ä¼šå¯¼è‡´æŸå¤±å¢åŠ ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def r1_loss_fn(real_pred, real_img):</span><br><span class="line">    grad_real, = autograd.grad(</span><br><span class="line">        outputs=real_pred.sum(), inputs=real_img, create_graph=True</span><br><span class="line">    )</span><br><span class="line">    grad_penalty = grad_real.pow(2).reshape(grad_real.shape[0], -1).sum(1).mean()</span><br><span class="line">    return grad_penalty</span><br></pre></td></tr></table></figure>

<h2 id="è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–"><a href="#è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–" class="headerlink" title="è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–"></a>è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–</h2><p><img src="/../asset_magiceraser/16.webp"></p>
<p>è·¯å¾„é•¿åº¦æ­£åˆ™åŒ–æ—¨åœ¨ç¡®ä¿å½“æ‚¨åœ¨æ½œåœ¨ç©ºé—´â€˜wâ€™ï¼ˆw ~ f(z), f: æ˜ å°„ç½‘ç»œï¼‰ä¸­è¿›è¡Œå›ºå®šå¤§å°çš„æ›´æ”¹æ—¶ï¼Œå›¾åƒä¼šäº§ç”Ÿéé›¶ä¸”å›ºå®šå¹…åº¦çš„å˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬è®¡ç®—ç”Ÿæˆå™¨è¾“å‡ºç›¸å¯¹äºâ€˜wâ€™çš„å¯¼æ•°ï¼Œå¹¶å°†å…¶ä¹˜ä»¥éšæœºå™ªå£°â€˜yâ€™ã€‚åœ¨å¯¹è¿™ä¸ªç»“æœåº”ç”¨ L2 èŒƒæ•°ä¹‹åï¼Œæˆ‘ä»¬å†å‡å»å…¶æŒ‡æ•°ç§»åŠ¨å¹³å‡å€¼â€˜aâ€™ã€‚</p>
<p>è¿™ç§æ­£åˆ™åŒ–å¯ä»¥ç¡®ä¿æ½œåœ¨å‘é‡ Z çš„å˜åŒ–ä¸ä¼šå¯¼è‡´ç”Ÿæˆçš„å›¾åƒå‘ç”Ÿå‰§çƒˆå˜åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def g_path_regularize(fake_img, latents, mean_path_length, decay=0.01):</span><br><span class="line">    noise = torch.randn_like(fake_img) / math.sqrt(</span><br><span class="line">        fake_img.shape[2] * fake_img.shape[3]</span><br><span class="line">    )</span><br><span class="line">    grad, = autograd.grad(</span><br><span class="line">        outputs=(fake_img * noise).sum(), inputs=latents, create_graph=True</span><br><span class="line">    )</span><br><span class="line">    path_lengths = torch.sqrt(grad.pow(2).sum(2).mean(1))</span><br><span class="line">    path_mean = mean_path_length + decay * (path_lengths.mean() - mean_path_length)</span><br><span class="line">    path_penalty = (path_lengths - path_mean).pow(2).mean()</span><br><span class="line">    return path_penalty, path_mean.detach(), path_lengths</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œè¿™é‡Œæ˜¯ CoModGAN çš„è®­ç»ƒå¾ªç¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def make_noise(n, latent_dim, device):</span><br><span class="line">    return torch.randn(n, 1, latent_dim).cuda(device)</span><br><span class="line"></span><br><span class="line">def get_g_input(batch, img_size, n_layers, latent_dim, device):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    ** style mixing **</span><br><span class="line">    tt = int(torch.rand(()).numpy() * n_layers)</span><br><span class="line">    style1 = torch.tile(make_noise(batch, latent_dim, device), [1, tt, 1])</span><br><span class="line">    style2 = torch.tile(make_noise(batch, latent_dim, device), [1, n_layers - tt, 1])</span><br><span class="line">    styles = torch.cat([style1, style2], dim=1)</span><br><span class="line">    &#x27;&#x27;&#x27;   </span><br><span class="line">    styles = torch.tile(make_noise(batch, latent_dim, device), [1, n_layers, 1])</span><br><span class="line">    noise = torch.FloatTensor(batch, 1, img_size, img_size).uniform_(0., 1.).cuda(device)</span><br><span class="line">    return styles, noise</span><br><span class="line"></span><br><span class="line">def requires_grad(model, flag=True):</span><br><span class="line">    for p in model.parameters():</span><br><span class="line">        p.requires_grad = flag</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"># CoModGAN training Loop</span><br><span class="line">latent_dim = 128</span><br><span class="line">img_size = 128</span><br><span class="line">epochs = 100</span><br><span class="line">num_layers = int(log2(img_size)-1)</span><br><span class="line">d_lazy_reg = 16</span><br><span class="line">g_lazy_reg = 4</span><br><span class="line">mean_path = 0</span><br><span class="line"></span><br><span class="line">device = &quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;</span><br><span class="line">g_model = Generator(img_size, latent_dim).to(device)</span><br><span class="line">d_model = Discriminator(img_size).to(device)</span><br><span class="line">g_optimizer = torch.optim.Adam(g_model.parameters(), lr=0.0001, betas=(0.5, 0.9))</span><br><span class="line">d_optimizer = torch.optim.Adam(d_model.parameters(), lr=0.0001, betas=(0.5, 0.9))</span><br><span class="line"></span><br><span class="line">for epoch in range(epochs):</span><br><span class="line">    for step, (real_img, mask) in enumerate(train_data):</span><br><span class="line">        B = real_img.size(0)</span><br><span class="line">        real_img = real_img.to(device)</span><br><span class="line">        mask = mask.to(device)</span><br><span class="line">        requires_grad(g_model, False)</span><br><span class="line">        requires_grad(d_model, True)</span><br><span class="line">        </span><br><span class="line">        style, noise = get_g_input(B, img_size, num_layers, latent_dim, device)</span><br><span class="line">        fake_img, _ = g_model(real_img, mask, style, noise)</span><br><span class="line">        fake_pred = d_model(fake_img, mask)</span><br><span class="line">        real_pred = d_model(real_img, mask)</span><br><span class="line">        d_loss = d_loss_fn(real_pred, fake_pred)</span><br><span class="line">        d_model.zero_grad()</span><br><span class="line">        d_loss.backward()</span><br><span class="line">        d_optimizer.step()</span><br><span class="line"></span><br><span class="line">        d_lazy = step % d_lazy_reg == 0</span><br><span class="line">        if d_lazy:</span><br><span class="line">            real_img.requires_grad = True</span><br><span class="line">            real_pred = d_model(real_img, mask)</span><br><span class="line">            r1_loss = r1_loss_fn(real_pred, real_img)</span><br><span class="line"></span><br><span class="line">            d_model.zero_grad()</span><br><span class="line">            (10 / 2 * r1_loss * d_lazy_reg).backward()</span><br><span class="line">            d_optimizer.step()</span><br><span class="line">            </span><br><span class="line">        requires_grad(g_model, True)</span><br><span class="line">        requires_grad(d_model, False)</span><br><span class="line">        style, noise = get_g_input(B, img_size, num_layers, latent_dim, device)</span><br><span class="line">        fake_img, _ = g_model(real_img, mask, style, noise)</span><br><span class="line">        fake_pred = d_model(fake_img, mask)</span><br><span class="line">        g_loss = g_loss_fn(fake_pred)</span><br><span class="line">        g_model.zero_grad()</span><br><span class="line">        g_loss.backward()</span><br><span class="line">        g_optimizer.step()</span><br><span class="line">        g_lazy = step % g_lazy_reg == 0</span><br><span class="line">        </span><br><span class="line">        if g_lazy:</span><br><span class="line">            style, noise = get_g_input(B, img_size, num_layers, latent_dim, device)</span><br><span class="line">            fake_img, _, latent = g_model(real_img, mask, style.requires_grad_(), </span><br><span class="line">                                          noise, return_latent=True)</span><br><span class="line">            path_loss, mean_path_new, path_lengths = g_path_regularize(fake_img, latent, mean_path)</span><br><span class="line">            g_model.zero_grad()</span><br><span class="line">            mean_path = mean_path_new</span><br><span class="line">            pr_loss = 2 * g_lazy_reg * path_loss</span><br><span class="line">            pr_loss.backward()</span><br><span class="line">            g_optimizer.step()</span><br></pre></td></tr></table></figure>

<h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>é¡¶éƒ¨çš„å›¾åƒæ˜¯ç”± CoModGAN ç”Ÿæˆçš„ï¼Œè€Œåº•éƒ¨çš„å›¾åƒæ˜¯çœŸå®å›¾åƒæ•°æ®ã€‚</p>
<p>å°½ç®¡ç”Ÿæˆçš„ç»“æœä¸çœŸå®æ•°æ®ä¹‹é—´å­˜åœ¨ä¸€äº›å°å·®å¼‚ï¼Œä½†å°±ç”Ÿæˆåˆç†å›¾åƒè€Œè¨€ï¼Œæˆ‘è®¤ä¸º CoModGAN çš„è¡¨ç°å·²ç»å¯ä»¥æ¥å—äº†</p>
<p><img src="/../asset_magiceraser/17.webp"></p>
<p><img src="/../asset_magiceraser/18.webp"></p>
<p><img src="/../asset_magiceraser/19.webp"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/revealing-the-secrets-of-googles-magic-eraser-fb232c83723b">https://levelup.gitconnected.com/revealing-the-secrets-of-googles-magic-eraser-fb232c83723b</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/16/falkordb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/16/falkordb/" class="post-title-link" itemprop="url">FalkorDB çŸ¥è¯†å›¾è°± for RAG</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-16 19:56:22 / ä¿®æ”¹æ—¶é—´ï¼š20:09:09" itemprop="dateCreated datePublished" datetime="2024-04-16T19:56:22+08:00">2024-04-16</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>923</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>2 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>åœ¨é€‰æ‹©é€‚åˆæ‚¨çš„ RAG åº”ç”¨ç¨‹åºçš„æ­£ç¡®çŸ¥è¯†å›¾æ—¶ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šå› ç´ ã€‚å›¾æ•°æ®åº“åº”è¯¥è½»é‡ä¸”å…·æœ‰è¾ƒä½çš„å»¶è¿Ÿï¼Œä»¥å®ç°æ›´é«˜çš„æ€§èƒ½ã€‚æŸ¥è¯¢è¯­è¨€åº”è¯¥è¶³å¤Ÿè¡¨è¾¾æ€§ï¼Œä»¥æ”¯æŒå¤æ‚çš„å›¾éå†è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚å›¾å½¢ç†æƒ³æƒ…å†µä¸‹è¿˜åº”è®¾è®¡ä¸ºå…·æœ‰è¾ƒä½çš„å†…å­˜å ç”¨é‡ â€” è¿™æ ·å¯ä»¥èŠ‚çœé•¿æœŸèµ„æºå¼€é”€ã€‚</p>
<p>è€ƒè™‘åˆ°ä¸Šè¿°å› ç´ ï¼Œæˆ‘å‘ç°çŸ¥è¯†å›¾è°± FalkorDB æ˜¯ä¸€ä¸ªè½»é‡çº§ä¸”é«˜æ€§èƒ½çš„å›¾å½¢æ¡†æ¶ï¼Œé€‚ç”¨äºæ„å»ºäººå·¥æ™ºèƒ½åº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯åŸå› ï¼š</p>
<h3 id="ä½å»¶è¿Ÿ"><a href="#ä½å»¶è¿Ÿ" class="headerlink" title="ä½å»¶è¿Ÿ"></a>ä½å»¶è¿Ÿ</h3><p>FalkorDB æ—¨åœ¨ä¸ºå¤æ‚çš„å›¾éå†æä¾›å¿«é€Ÿçš„æŸ¥è¯¢æ‰§è¡Œã€‚å®ƒæ„å»ºåœ¨å…¶å‰èº« RedisGraph ä¹‹ä¸Šï¼Œåˆ©ç”¨å†…å­˜å¤„ç†æŠ€æœ¯åŠ å¿«æŸ¥è¯¢æ‰§è¡Œé€Ÿåº¦ã€‚é€šè¿‡å°†ç›¸å…³æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥å‡å°‘ä¸ç£ç›˜ I&#x2F;O æ“ä½œç›¸å…³çš„å»¶è¿Ÿã€‚</p>
<h3 id="é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„"><a href="#é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„" class="headerlink" title="é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„"></a>é«˜æ•ˆå†…å­˜åˆ©ç”¨çš„åˆ†å¸ƒå¼æ¶æ„</h3><p>FalkorDB å…è®¸åˆ›å»º<a target="_blank" rel="noopener" href="https://www.falkordb.com/scale-out/">å¤šä¸ªè¯»å–å‰¯æœ¬</a>ï¼Œå®ç°æ•°æ®é›†å’Œå›¾å½¢åœ¨å„ä¸ªæœåŠ¡å™¨ä¹‹é—´çš„åˆ†å¸ƒã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸ä¸»æ•°æ®åº“åŒæ­¥çš„æ•°æ®åº“å‰¯æœ¬ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†è¯»å–æŸ¥è¯¢ï¼ˆåœ¨å‰¯æœ¬ä¸Šè¿è¡Œï¼‰ä¸å†™å…¥æŸ¥è¯¢ï¼ˆåœ¨ä¸»æ•°æ®åº“ä¸Šè¿è¡Œï¼‰åˆ†å¼€ã€‚</p>
<p>è¿™ç§æ–¹æ³•ä¼˜åŒ–äº†è¯»å†™æ“ä½œè·¯ç”±åˆ°é€‚å½“å‰¯æœ¬çš„è¿‡ç¨‹ï¼Œç¡®ä¿æ“ä½œçš„é«˜ååé‡å’Œè¾ƒä½çš„å»¶è¿Ÿã€‚</p>
<h3 id="å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ"><a href="#å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ" class="headerlink" title="å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ"></a>å¢å¼ºæ£€ç´¢çš„å‘é‡ç´¢å¼•æ”¯æŒ</h3><p>è¿™å…è®¸å°†æ•°æ®å­˜å‚¨ä¸ºé«˜ç»´åµŒå…¥ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨ç›¸ä¼¼æ€§æœç´¢æ‰¾åˆ°å®ä½“ â€” èŠ‚ç‚¹å’Œè¾¹ã€‚è¿™æ ·ï¼Œç”¨æˆ·çš„å“åº”å¯ä»¥æ‰©å±•åˆ°è¿˜åŒ…æ‹¬ä¸è¾“å…¥æŸ¥è¯¢åœ¨è¯­ä¹‰ä¸Šç›¸ä¼¼çš„æ•°æ®ã€‚</p>
<h3 id="æ”¯æŒ-AI-æ¡†æ¶"><a href="#æ”¯æŒ-AI-æ¡†æ¶" class="headerlink" title="æ”¯æŒ AI æ¡†æ¶"></a>æ”¯æŒ AI æ¡†æ¶</h3><p>FalkorDB æä¾›æ”¯æŒå’Œæ–‡æ¡£ï¼Œç”¨äºå¤„ç† AI æ¡†æ¶ï¼Œå¦‚ LangChain å’Œ LLamaIndexã€‚é€šè¿‡å°†å…¶ä¸LLMè¿æ¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ¨¡å—æ¥åˆ›å»ºå›¾ç´¢å¼•å’ŒæŸ¥è¯¢å¼•æ“å¯¹è±¡ã€‚è¿™äº›é›†æˆä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªå…¨é¢çš„å·¥å…·åŒ…ï¼Œç”¨äºæ„å»ºåƒæ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ç®¡é“è¿™æ ·çš„é«˜çº§ AI åº”ç”¨ç¨‹åºã€‚</p>
<h3 id="äº¤äº’å¼å›¾æµè§ˆå™¨"><a href="#äº¤äº’å¼å›¾æµè§ˆå™¨" class="headerlink" title="äº¤äº’å¼å›¾æµè§ˆå™¨"></a>äº¤äº’å¼å›¾æµè§ˆå™¨</h3><p>FalkorDB é…å¤‡äº†å›¾æµè§ˆå™¨ï¼Œå…è®¸äº¤äº’å¼æŸ¥çœ‹å’ŒæŸ¥è¯¢å›¾å½¢ã€‚æ‚¨å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://github.com/FalkorDB/falkordb-browser">è¿™é‡Œ</a>æŸ¥çœ‹ FalkorDB å›¾æµè§ˆå™¨ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å•å‡»èŠ‚ç‚¹å’Œè¾¹ï¼Œå±•å¼€æˆ–æŠ˜å å­å›¾ï¼Œå¹¶æ”¾å¤§æˆ–ç¼©å°ä»¥èšç„¦ç‰¹å®šæ„Ÿå…´è¶£çš„åŒºåŸŸæ¥æµè§ˆå›¾å½¢ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>FalkorDB çš„å†…å­˜å¤„ç†æŠ€æœ¯å’Œé«˜æ•ˆçš„å†…å­˜åˆ©ç”¨ç‡ï¼Œç›¸è¾ƒäºé‡‡ç”¨åŸºäºç£ç›˜å­˜å‚¨æ–¹æ³•çš„å›¾å½¢ï¼Œæœ‰åŠ©äºæ›´å¿«åœ°æ‰§è¡ŒæŸ¥è¯¢å¹¶å‡å°‘å»¶è¿Ÿã€‚å¯¹å„ç§äººå·¥æ™ºèƒ½æ¡†æ¶çš„æ”¯æŒå’Œæ–‡æ¡£ä¸ºæ„å»ºäººå·¥æ™ºèƒ½åº”ç”¨ç¨‹åºå¢æ·»äº†å…¶ç¨³å¥æ€§ã€‚<br>è¿™äº›ç‰¹æ€§ä½¿å¾— FalkorDB æˆä¸ºæ„å»ºå¯æ‰©å±•å’Œé«˜æ€§èƒ½ RAG åº”ç”¨ç¨‹åºçš„æä½³é€‰æ‹©ã€‚åŸºäºçŸ¥è¯†å›¾çš„ RAG æ¨¡å‹æœ‰æœ›é€šè¿‡ç”Ÿæˆæ›´å‡†ç¡®ã€ä¿¡æ¯ä¸°å¯Œå’Œè¿è´¯çš„å“åº”æ¥å½»åº•æ”¹å˜è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/12/autogenstudio-mistral/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/12/autogenstudio-mistral/" class="post-title-link" itemprop="url">ç”¨AutoGen Studio ä¸æœ¬åœ° Mistral AI æ¨¡å‹æ¥å®è·µç”Ÿæˆå¼AIä»£ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-12 20:20:13" itemprop="dateCreated datePublished" datetime="2024-04-12T20:20:13+08:00">2024-04-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-28 19:55:24" itemprop="dateModified" datetime="2024-04-28T19:55:24+08:00">2024-04-28</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>25 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>AutoGen æ˜¯ç”± Microsoft å¼€å‘çš„æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–å¤šä»£ç†åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼–æ’ LLM ä»£ç†æ–¹é¢ã€‚</p>
<p>å¤šæ™ºèƒ½ä½“åº”ç”¨ç¨‹åºæ¶‰åŠå¤šä¸ª LLM æˆ–å¤šæ¨¡å¼æ™ºèƒ½ä½“æˆ–å®ä½“åœ¨æ•´ä¸ªå·¥ä½œæµç¨‹ä¸­ç›¸äº’äº¤äº’ä»¥å®ç°ç‰¹å®šç›®æ ‡æˆ–ä»»åŠ¡çš„ç³»ç»Ÿã€‚è¿™äº›ä»£ç†å¯ä»¥æ˜¯ LLM ä»£ç†ã€æ£€ç´¢ä»£ç†æˆ–å…¶ä»–èƒ½å¤Ÿåšå‡ºç‹¬ç«‹å†³ç­–ã€å‡½æ•°è°ƒç”¨æˆ–æ‰§è¡Œæ“ä½œçš„ä»£ç†ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»AutoGen Studioç›´è§‚çš„æ— ä»£ç å¹³å°ä¸æœ¬åœ°é›†æˆçš„Mistral AIæ¨¡å‹çš„èåˆã€‚è¿™ç§ç»„åˆä¸ä»…ä»…æ˜¯ä¸ºäº†è®©äººå·¥æ™ºèƒ½æ›´å®¹æ˜“åº”ç”¨;å®ƒè¿˜æ¶‰åŠä¿ƒè¿›æˆ‘ä»¬å¦‚ä½•åœ¨è®¸å¤šç°å®ç”Ÿæ´»ä¸­çš„è¡Œä¸šå·¥ä½œæµç¨‹ä¸­ä¸ä¸åŒçš„ç”Ÿæˆå¼ AI ä»£ç†è¿›è¡Œäº¤äº’ã€éƒ¨ç½²å¹¶ä»ä¸­å—ç›Šã€‚</p>
<p><img src="/../asset_autogenmistral/01.png"></p>
<h2 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a>ç¯å¢ƒå®‰è£…</h2><h3 id="å®‰è£…autogen-studio"><a href="#å®‰è£…autogen-studio" class="headerlink" title="å®‰è£…autogen studio"></a>å®‰è£…autogen studio</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install autogenstudio</span><br></pre></td></tr></table></figure>


<h3 id="å®‰è£…mistral"><a href="#å®‰è£…mistral" class="headerlink" title="å®‰è£…mistral"></a>å®‰è£…mistral</h3><p>å…ˆå®‰è£…ollama</p>
<ul>
<li><p>Ollama æ˜¯ä¸€ä¸ªæä¾›å¯¹å¤§å‹è¯­è¨€æ¨¡å‹çš„è®¿é—®çš„å¹³å°ã€‚å®‰è£… Ollama æ˜¯ç¬¬ä¸€æ­¥ï¼Œå› ä¸ºå®ƒæ˜¯è¿è¡Œ Mistral æ¨¡å‹çš„ç¯å¢ƒã€‚å®ƒå…è®¸æ‚¨è‡ªå®šä¹‰å’Œåˆ›å»ºè‡ªå·±çš„æ¨¡å‹æˆ–è¿è¡Œç°æœ‰æ¨¡å‹ï¼Œå¦‚ Llama 2ã€Code Llama å’Œ Mistralã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½ollamaï¼š <a target="_blank" rel="noopener" href="https://ollama.ai/">https://ollama.ai/</a> ï¼Œ é€‰æ‹©downloadï¼Œé€‰æ‹©linuxç‰ˆæœ¬ï¼Œå› ä¸ºmistral 7Béœ€è¦24GB æ˜¾å¡ï¼Œæˆ‘æ²¡æœ‰ï¼Œåªèƒ½å»äº‘ç«¯çš„linuxæœºå™¨ä¸Šå®‰è£…ollamaã€‚</p>
</li>
<li><p>è¿è¡Œ Ollama Mistralï¼šæŒ‰ç…§ä»¥ä¸‹å‘½ä»¤ä» Ollama å¹³å°å¯åŠ¨ Mistral æ¨¡å‹ï¼Œä½¿å…¶å‡†å¤‡å¥½å¤„ç†è¯·æ±‚ã€‚æ­¤å‘½ä»¤åˆå§‹åŒ–ç”¨äºè®¾ç½®æ¨¡å‹ã€åŠ è½½å¿…è¦æ•°æ®ä»¥åŠå¯åŠ¨å°†å¤„ç†æŸ¥è¯¢å¤„ç†çš„æœåŠ¡çš„è¿›ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ollama run mistral</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¯´æ²¡æœ‰ollama appï¼Œå°±èµ·ä¸€ä¸ªconsoleï¼Œæ‰§è¡Œ ollama serveï¼Œç„¶ååœ¨å¦å¤–ä¸€ä¸ªconsoleæ‰§è¡Œollama run mistralã€‚æ‰§è¡Œå®Œæµ‹è¯•ä¸€ä¸‹mistralï¼Œå°±å¯ä»¥æŠŠä¸¤ä¸ªè¿›ç¨‹éƒ½æ€æ‰äº†ã€‚</p>
</li>
<li><p>å®‰è£… LiteLLMï¼šLiteLLM åº“æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæœ‰åŠ©äºä» http ç«¯ç‚¹è¿è¡Œè¯­è¨€æ¨¡å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install litellm --upgrade</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£… Gunicornï¼šGunicorn æ˜¯ç”¨äº UNIX ç³»ç»Ÿçš„ Python WSGI HTTP æœåŠ¡å™¨ï¼Œç”¨äºè¿è¡Œ Python Web åº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯è¿è¡Œ LiteLLM ä»£ç†çš„å…ˆå†³æ¡ä»¶ï¼Œå®ƒå…è®¸æ‚¨å‘è¯­è¨€æ¨¡å‹å‘å‡ºæœ¬åœ° HTTP è¯·æ±‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install gunicorn</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="è¿è¡Œ-Mistral-æ¨¡å‹"><a href="#è¿è¡Œ-Mistral-æ¨¡å‹" class="headerlink" title="è¿è¡Œ Mistral æ¨¡å‹"></a>è¿è¡Œ Mistral æ¨¡å‹</h2><p>ä½¿ç”¨ Ollama&#x2F;Mistral æ¨¡å‹è¿è¡Œ LiteLLMï¼šæ­¤æ­¥éª¤å®é™…ä¸Šåˆå§‹åŒ–æ¨¡å‹å¹¶ä½¿å…¶å‡†å¤‡å¥½è¿è¡Œã€‚æ­¤å‘½ä»¤å‘Šè¯‰ LiteLLM ä½¿ç”¨ Ollama æä¾›çš„ Mistral æ¨¡å‹ã€‚å®ƒä¸ºäº¤äº’å‡†å¤‡æ¨¡å‹ï¼Œå…è®¸æ‚¨å¼€å§‹è¿›è¡ŒæŸ¥è¯¢å’Œæ¥æ”¶å“åº”ã€‚</p>
<p>åœ¨æ­¤è¿‡ç¨‹ç»“æŸæ—¶ï¼Œæœ¬åœ° Mistral æ¨¡å‹ä» 0.0.0.0ï¼š4000 å¼€å§‹ï¼Œæœ‰ 1 ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">litellm --model ollama/mistral</span><br></pre></td></tr></table></figure>


<h2 id="è¿è¡Œ-Autogen-Studio"><a href="#è¿è¡Œ-Autogen-Studio" class="headerlink" title="è¿è¡Œ Autogen Studio"></a>è¿è¡Œ Autogen Studio</h2><p>é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹æ¥è¿è¡Œ Web UIï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autogenstudio ui --port 6006</span><br></pre></td></tr></table></figure>

<p>AutoGen Studio æä¾›äº†ä¸€ä¸ªç®€åŒ–ä¸”ç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œæœ‰åŠ©äºåˆ›å»ºå’Œç®¡ç†å¤šä»£ç† AI åº”ç”¨ç¨‹åºã€‚è¯¥ç•Œé¢åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼ŒåŒ…æ‹¬æŠ€èƒ½ã€æ¨¡å‹ã€ä»£ç†å’Œå·¥ä½œæµï¼Œæ¯ä¸ªéƒ¨åˆ†åœ¨åº”ç”¨ç¨‹åºå¼€å‘ä¸­éƒ½å‘æŒ¥ç€ä¸å¯æˆ–ç¼ºçš„ä½œç”¨ã€‚</p>
<h3 id="æŠ€èƒ½"><a href="#æŠ€èƒ½" class="headerlink" title="æŠ€èƒ½"></a>æŠ€èƒ½</h3><p>åœ¨â€œæŠ€èƒ½â€éƒ¨åˆ†ä¸­ï¼Œç”¨æˆ·å¯ä»¥å¼€å‘å’Œå­˜å‚¨ä»£ç†å°†ç”¨äºè§£å†³ä»»åŠ¡çš„ Python å‡½æ•°ã€‚å®ƒæ˜¯ä¸€ä¸ªç¼–ç¨‹ç¯å¢ƒï¼Œåœ¨å…¶ä¸­å®šä¹‰å’Œä¼˜åŒ–åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚<br><img src="/../asset_autogenmistral/06.png"></p>
<h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>åœ¨æ¨¡å‹éƒ¨åˆ†ï¼Œç”¨æˆ·å¯ä»¥é…ç½®å’Œç®¡ç† AI æ¨¡å‹ï¼ŒåŒ…æ‹¬ GPT-4 å’Œå…¶ä»–æœ¬åœ°æˆ–è‡ªå®šä¹‰æ¨¡å‹ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥è®¾ç½® Mistral AI ç­‰æ¨¡å‹ï¼Œè¡¨æ˜å·¥ä½œå®¤æ”¯æŒæœ¬åœ° AI æ¨¡å‹é›†æˆå’Œç®¡ç†ã€‚è¿™ç§çµæ´»æ€§å…è®¸ä½¿ç”¨å¼ºå¤§çš„æ¨¡å‹ï¼Œå¦‚ OpenAI çš„ GPT-4ï¼Œä»¥åŠä¸ºç‰¹å®šä»»åŠ¡é‡èº«å®šåˆ¶çš„ä¸“æœ‰æˆ–ä¸“ç”¨æ¨¡å‹ã€‚<br><img src="/../asset_autogenmistral/07.png"></p>
<h3 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h3><p>â€œä»£ç†â€éƒ¨åˆ†è®¾è®¡ç”¨äºé…ç½®å¯é‡ç”¨ä»£ç†ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºå’Œå®šä¹‰å„ç§ä»£ç†çš„è§’è‰²ï¼Œä¾‹å¦‚æœ¬åœ°åŠ©ç†ã€ä¸»è¦ä»£ç†å’Œç”¨æˆ·ä»£ç†ï¼Œåè°ƒå®ƒä»¬åœ¨åº”ç”¨å·¥ä½œæµä¸­çš„äº¤äº’æ–¹å¼ã€‚<br><img src="/../asset_autogenmistral/08.png"></p>
<h3 id="å·¥ä½œæµ"><a href="#å·¥ä½œæµ" class="headerlink" title="å·¥ä½œæµ"></a>å·¥ä½œæµ</h3><p>â€œå·¥ä½œæµâ€éƒ¨åˆ†æ˜¯å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹ã€‚ç”¨æˆ·å¯ä»¥è®¾è®¡å¤æ‚çš„å·¥ä½œæµï¼Œä»¥å®šä¹‰ç³»ç»Ÿå¦‚ä½•å¤„ç†ä»»åŠ¡ã€‚è¿™æ˜¯æ‰€æœ‰ç»„ä»¶èšé›†åœ¨ä¸€èµ·çš„åœ°æ–¹ï¼šæŠ€èƒ½æä¾›é€»è¾‘ï¼Œæ¨¡å‹æä¾› AI çš„æ™ºèƒ½ï¼Œä»£ç†å¯¹ä»»åŠ¡é‡‡å–è¡ŒåŠ¨ï¼Œå·¥ä½œæµå°†æ‰€æœ‰ç»„ä»¶è¿æ¥åˆ°ä¸€ä¸ªè¿è´¯çš„ç³»ç»Ÿä¸­ã€‚<br><img src="/../asset_autogenmistral/09.png"></p>
<h2 id="ä½¿ç”¨-AutoGen-å’Œ-Mistral-AI-è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š"><a href="#ä½¿ç”¨-AutoGen-å’Œ-Mistral-AI-è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š" class="headerlink" title="ä½¿ç”¨ AutoGen å’Œ Mistral AI è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š"></a>ä½¿ç”¨ AutoGen å’Œ Mistral AI è¿›è¡Œå·¥ä½œæµç¼–æ’ï¼š</h2><p>åœ¨æˆ‘ä»¬æƒ³è¦ç¼–å†™ä¸€ä¸ª Python è„šæœ¬æ¥ç»˜åˆ¶æ­£å¼¦æ³¢å¹¶å°†å…¶ä¿å­˜ä¸ºâ€œsine_wave.pngâ€æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼ŒAutoGen å’Œ Mistral AI å¯ä»¥ä¸€èµ·ä½¿ç”¨æ¥åˆ›å»ºç®€åŒ–çš„å·¥ä½œæµç¨‹ã€‚AutoGen Studio ç”¨ä½œæ„å»ºå’Œç®¡ç†å¤šæ™ºèƒ½ä½“åº”ç”¨ç¨‹åºçš„æ¥å£ï¼Œè€Œ Mistral AI åˆ™é€šè¿‡å…¶æœ¬åœ°æ¨¡å‹æä¾›å¤„ç†èƒ½åŠ›ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå¹³å°çš„åŠŸèƒ½è¿›è¡Œç¼–æ’çš„å·¥ä½œæ–¹å¼ï¼š</p>
<h3 id="æ¨¡å‹é…ç½®"><a href="#æ¨¡å‹é…ç½®" class="headerlink" title="æ¨¡å‹é…ç½®"></a>æ¨¡å‹é…ç½®</h3><p>åœ¨ AutoGen Studio ä¸­è®¾ç½®äº†ä¸€ä¸ªåä¸ºâ€œmistral local modelâ€çš„æ¨¡å‹ï¼Œç”¨äºä¸ Mistral AI è¿›è¡Œäº¤äº’ã€‚<br>æ¨¡å‹çš„ API ç«¯ç‚¹å°†é…ç½®ä¸ºè¿è¡Œ Mistral AI çš„æœ¬åœ°æœåŠ¡å™¨åœ°å€ï¼ˆä¾‹å¦‚ï¼Œ<a href="http://0.0.0.0:4000ï¼‰ã€‚">http://0.0.0.0:4000ï¼‰ã€‚</a><br>æ­¤è®¾ç½®å…è®¸ AutoGen Studio å°†æ•°æ®å‘é€åˆ° Mistral AI æ¨¡å‹å¹¶æ¥æ”¶å¤„ç†åçš„ç»“æœã€‚</p>
<p><img src="/../asset_autogenmistral/02.png"></p>
<p>å› ä¸ºæˆ‘ä»¬æœ‰ LiteLLM ä»£ç†æœåŠ¡å™¨çš„ URL <a href="http://0.0.0.0:4000ï¼Œå¯ä»¥åœ¨">http://0.0.0.0:4000ï¼Œå¯ä»¥åœ¨</a> AutoGen ä¸­ä½¿ç”¨å®ƒï¼Œå°±åƒä½¿ç”¨ OpenAI æˆ–åŸºäºäº‘çš„ä»£ç†æœåŠ¡å™¨ä¸€æ ·ã€‚</p>
<p>ç”±äºåœ¨æœ¬åœ°è¿è¡Œæ­¤ä»£ç†æœåŠ¡å™¨ï¼Œå› æ­¤ä¸éœ€è¦ API å¯†é’¥ã€‚æ­¤å¤–ï¼Œç”±äºæ¨¡å‹æ˜¯åœ¨è¿è¡Œ LiteLLM å‘½ä»¤æ—¶è®¾ç½®çš„ï¼Œå› æ­¤ä¸éœ€è¦åœ¨ AutoGen ä¸­é…ç½®æ¨¡å‹åç§°ã€‚ä½†æ˜¯ï¼Œmodel typeå’Œapi keyæ˜¯ Aâ€‹â€‹utoGen ä¸­é…ç½®çš„å¿…å¡«å­—æ®µï¼Œå› æ­¤æˆ‘ä»¬åœ¨å…¶ä¸­æ”¾ç½®è™šæ‹Ÿå€¼ NotRequired ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<h3 id="ä»£ç†é…ç½®"><a href="#ä»£ç†é…ç½®" class="headerlink" title="ä»£ç†é…ç½®"></a>ä»£ç†é…ç½®</h3><p>æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªä»£ç†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹primary_assistantçš„Modelï¼Œè®¾å®šåˆ°ä¹‹å‰å®šä¹‰çš„mistral local model<br><img src="/../asset_autogenmistral/03.png"></p>
<h3 id="åˆ›å»ºå·¥ä½œæµ"><a href="#åˆ›å»ºå·¥ä½œæµ" class="headerlink" title="åˆ›å»ºå·¥ä½œæµ"></a>åˆ›å»ºå·¥ä½œæµ</h3><ul>
<li>åœ¨AutoGen Studioä¸­ï¼Œå°†å¯åŠ¨ä¸€ä¸ªæ–°çš„å·¥ä½œæµï¼ŒæŒ‡å®šç”¨äºç”Ÿæˆæ­£å¼¦æ³¢å›¾åƒçš„ç‰¹å®šä»»åŠ¡ã€‚</li>
<li>æˆ‘ä»¬ä½¿ç”¨åç§°é…ç½®å·¥ä½œæµï¼Œä¾‹å¦‚â€œlocal mistral Agent Workflowâ€ã€‚</li>
<li>å·¥ä½œæµè§„èŒƒåŒ…æ‹¬å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä»£ç†ï¼Œå…¶ä¸­â€œuserproxyâ€å¯ä»¥æ˜¯å‘èµ·è¯·æ±‚çš„å‘é€æ–¹ï¼Œâ€œprimary_assistantâ€æ˜¯å¤„ç†è¯·æ±‚å¹¶æä¾›è¾“å‡ºçš„æ¥æ”¶æ–¹ã€‚</li>
<li>userproxyä»£ç†çš„è§’è‰²å°†ä¸ç”¨æˆ·äº¤äº’å¹¶æ‰§è¡Œprimary_assistantç”Ÿæˆçš„ä»£ç ã€‚å¦‚æœä»£ç ä¸­æœ‰ä»»ä½•é”™è¯¯ï¼Œå°†é”™è¯¯å‘é€ç»™primary_assistantä»£ç†ã€‚</li>
<li>primary_assistantä»£ç†ç”±æœ¬åœ° Mistral AI æ¨¡å‹æˆæƒï¼Œå®ƒå°†åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ç”Ÿæˆä»£ç ã€‚å¦‚æœé”™è¯¯ï¼Œæ ¹æ®userproxyä»£ç†å‘é€çš„æ‰§è¡Œé”™è¯¯ä¿¡æ¯é‡æ–°è°ƒæ•´ä»£ç ã€‚</li>
</ul>
<p><img src="/../asset_autogenmistral/04.png"></p>
<h3 id="å»ºç«‹å¹¶è¿è¡Œä¼šè¯"><a href="#å»ºç«‹å¹¶è¿è¡Œä¼šè¯" class="headerlink" title="å»ºç«‹å¹¶è¿è¡Œä¼šè¯"></a>å»ºç«‹å¹¶è¿è¡Œä¼šè¯</h3><p>åœ¨playgroundæ–°å»ºä¸€ä¸ªsessionï¼Œ</p>
<p><img src="/../asset_autogenmistral/05.png"></p>
<ul>
<li>ä¹‹ååœ¨AutoGen Studioçš„â€œPlaygroundâ€ç•Œé¢ä¸­ï¼Œç”¨æˆ·é€šè¿‡é€‰æ‹©â€œLocal mistral Agent Workflowâ€æ¥å¯åŠ¨ä¸€ä¸ªæ–°ä¼šè¯ã€‚</li>
<li>ç”¨æˆ·è¾“å…¥â€œwrite a python script to plot a sine wave and save it to disc as a pngfile sina_wave.pngâ€è¯·æ±‚ã€‚</li>
<li>è¯·æ±‚ç”±userproxyä»£ç†å‘é€åˆ°primary_assistantä»£ç†ï¼Œè¯¥ä»£ç†åˆ©ç”¨ Mistral AI æ¨¡å‹ã€‚å®ƒç”Ÿæˆ Python è„šæœ¬ï¼Œuserproxyä»£ç†æ‰§è¡Œä»£ç ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™å°†å…¶å‘é€å›primary_assistantä»£ç†ã€‚primary_assistantä»£ç†é‡æ–°è°ƒæ•´ä»£ç å¹¶å°†å…¶å‘é€å›userproxyä»£ç†ï¼Œç›´åˆ°ä»£ç æ­£å¸¸å·¥ä½œå¹¶åˆ›å»ºæ­£å¼¦æ³¢å›¾åƒã€‚</li>
</ul>
<p><img src="/../asset_autogenmistral/10.webp"></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>AutoGen Studio ä¸æœ¬åœ° Mistral AI æ¨¡å‹ä¸€èµ·å±•ç¤ºäº†åœ¨ç¼–æ’ GenAI ä»£ç†å·¥ä½œæµç¨‹æ–¹é¢çš„é‡å¤§è¿›å±•ã€‚è¿™ç§æ¶æ„æœ‰åˆ©äº AutoGen Studio çš„ç›´è§‚è®¾è®¡å’Œ Mistral AI çš„å‡ºè‰²æ€§èƒ½ï¼Œæ„å»ºä¸€ä¸ªå¤šæ™ºèƒ½ä½“èƒ½å¤Ÿåšå‡ºè´¡çŒ®çš„ç¯å¢ƒã€‚</p>
<p>å°† AutoGen Studio ä¸æœ¬åœ° Mistral AI æ¨¡å‹ç»“åˆä½¿ç”¨çš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>æ˜“äºé›†æˆï¼šæœ¬åœ° Mistral AI æ¨¡å‹å¯ä»¥è½»æ¾é›†æˆåˆ° AutoGen Studio ä¸­ï¼Œä»è€Œç®€åŒ–äº†å°†ä¸åŒ LLM æ¨¡å‹æ•´åˆåˆ°ä¸€ä¸ªéƒ¨ç½²ä¸­çš„è¿‡ç¨‹ï¼Œä»è€Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ã€‚</li>
<li>å®šåˆ¶å’Œçµæ´»æ€§ï¼šå¼€å‘äººå‘˜å¯ä»¥å®šåˆ¶ AI æ¨¡å‹ä»¥æ»¡è¶³ç‰¹å®šè¦æ±‚ï¼Œæä¾›å®Œå…¨é€‚åˆå•ä¸ªé¡¹ç›®ä¸åŒéœ€æ±‚çš„å®šåˆ¶è§£å†³æ–¹æ¡ˆã€‚</li>
<li>å¢å¼ºçš„æ€§èƒ½ï¼šä½¿ç”¨ AutoGen åœ¨æœ¬åœ°è¿è¡Œ AI æ¨¡å‹å¯å‡å°‘å»¶è¿Ÿå¹¶ç¼©çŸ­å“åº”æ—¶é—´ï¼Œè¿™å¯¹äºå®æ—¶åº”ç”¨ç¨‹åºå’Œæ•æ„Ÿå·¥ä½œæµè‡³å…³é‡è¦ã€‚</li>
<li>æ•°æ®éšç§å’Œå®‰å…¨ï¼šAI æ¨¡å‹çš„æœ¬åœ°æ‰§è¡Œå¯ä»¥å®Œå…¨æ§åˆ¶æ•°æ®ï¼Œè¿™æ˜¯æ— æ³•æš´éœ²ç»™å¤–éƒ¨ç¯å¢ƒçš„æ•æ„Ÿæˆ–ä¸“æœ‰ä¿¡æ¯çš„å…³é”®å› ç´ ã€‚</li>
<li>æˆæœ¬æ•ˆç›Šï¼šé€šè¿‡æœ€å¤§é™åº¦åœ°å‡å°‘å¯¹åŸºäºäº‘çš„ AI æœåŠ¡çš„ä¾èµ–ï¼Œç»„ç»‡å¯ä»¥æ˜¾è‘—é™ä½ä¸æ•°æ®ä¼ è¾“å’Œ LLM API ä½¿ç”¨ç›¸å…³çš„æˆæœ¬ã€‚</li>
<li>ç¦»çº¿åŠŸèƒ½ï¼šæœ¬åœ° Mistral AI æ¨¡å‹ç¡®ä¿ç³»ç»Ÿå³ä½¿åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„æƒ…å†µä¸‹ä¹Ÿèƒ½ä¿æŒè¿è¡Œï¼Œä»è€Œå®ç° AI é©±åŠ¨è§£å†³æ–¹æ¡ˆçš„ç¦»çº¿åŠŸèƒ½ã€‚</li>
<li>ä½¿ç”¨ UI æ„å»ºå¤æ‚çš„ AI å·¥ä½œæµï¼šç”¨æˆ·å¯ä»¥åˆ©ç”¨AutoGen Studioçš„æ— ä»£ç ç•Œé¢æ¥å¯è§†åŒ–å’Œç®¡ç†æ•´ä¸ªè¿‡ç¨‹ï¼Œè½»æ¾åˆ¶ä½œç²¾å¿ƒè®¾è®¡çš„äººå·¥æ™ºèƒ½é©±åŠ¨çš„å·¥ä½œæµç¨‹ã€‚</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/no-code-genai-agents-workflow-orchestration-autogen-studio-with-local-mistral-ai-model-7566546a16d9">https://towardsdatascience.com/no-code-genai-agents-workflow-orchestration-autogen-studio-with-local-mistral-ai-model-7566546a16d9</a></p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>ç”±äºåœ¨AutoDLåšäº†ä¸€ä¸ªé•œåƒï¼Œè£…äº†mistralï¼Œå°±é¡ºä¾¿æµ‹è¯•ä¸€ä¸‹å¤šæ–‡ä»¶ä»£ç ç”Ÿæˆã€‚</p>
<h3 id="åˆ›å»ºæ–‡ä»¶-multiple-code-generator-py"><a href="#åˆ›å»ºæ–‡ä»¶-multiple-code-generator-py" class="headerlink" title="åˆ›å»ºæ–‡ä»¶ multiple_code_generator.py"></a>åˆ›å»ºæ–‡ä»¶ multiple_code_generator.py</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">from litellm import completion</span><br><span class="line">import colorama</span><br><span class="line">from colorama import Fore, Style</span><br><span class="line">import re</span><br><span class="line">import os</span><br><span class="line">def generate_context_prompt(user_input):</span><br><span class="line">    return f&quot; Understand just the context \&quot;&#123;user_input&#125;\&quot;.&quot;</span><br><span class="line"></span><br><span class="line">def generate_features_prompt(system):</span><br><span class="line">    return f&quot; Understand just the context \&quot;&#123;system&#125;\&quot;. Now identify features by expanding for the context and list them&quot;</span><br><span class="line"></span><br><span class="line">def generate_user_stories_prompt(features, system):</span><br><span class="line">    return f&quot; For the features \&quot;&#123;features&#125; and &#123;system&#125;\&quot;: identify user stories for each feature and list them&quot;</span><br><span class="line"></span><br><span class="line">def generate_solution_architecture_prompt(user_stories, system):</span><br><span class="line">    return f&quot; For user stories in \&quot;&#123;user_stories&#125; and &#123;system&#125;\&quot;: list the solution architecture&quot;</span><br><span class="line"></span><br><span class="line">def generate_project_structure_prompt(solution_architecture, user_stories, system):</span><br><span class="line">    return f&quot;&quot;&quot;  </span><br><span class="line">     For the context \&quot;&#123;solution_architecture&#125; and &#123;user_stories&#125; and &#123;system&#125;\&quot;:</span><br><span class="line">        Think about the whole solution.</span><br><span class="line">        Think about overall coding structure based on user stories.</span><br><span class="line">        Think about overall testing structure based on user stories.</span><br><span class="line">        Think about what file refers to what other file and make it as a dependency in the project structure.</span><br><span class="line">        Think about external or framework library references.</span><br><span class="line">        Think above all the edge cases that can come while coding and testing.</span><br><span class="line">        Think that each file will be completed without any &quot;todo&quot; comments for future.</span><br><span class="line">        Envisage to allow only 200 lines per file.</span><br><span class="line">        If more than 200 lines needed separate them into multiple files.</span><br><span class="line">        Do not allow duplication of functionality and code.</span><br><span class="line">        Do not allow duplication of test code.</span><br><span class="line">        Make sure all top level files like main, index, app etc are included if needed.</span><br><span class="line">        Make sure to have proper test files are envisaged.</span><br><span class="line">        It is also must to think about each reference file as needed, like an addition definition in one file and </span><br><span class="line">        Its reference in other file where it is being called and also in corresponding test files.</span><br><span class="line">        Now based on these understandings create project structure with its solution file structure tree, solution files&#x27; dependency tree and solution deployment script tree of the project.</span><br><span class="line">        In both project structure and dependency tree, filename are a must, if they are available</span><br><span class="line">        Expectation here is to output file names and their oneliner description.</span><br><span class="line">        Expectation also contains each files dependent filenames for each coding and testing files.</span><br><span class="line">        Make sure that the project tree structure hold all the necessary folder structures and files in each.  </span><br><span class="line">        Make sure that the dependency tree structure hold all the necessary file name that are to be generated with its dependency files in the solution.</span><br><span class="line">        Make sure that there are relevant test file names</span><br><span class="line">        Make sure that there are only files to be generated in both trees.</span><br><span class="line">        Make sure that only filename will have &quot;.&quot; in the text here.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def extract_filenames_prompt(project_structure):</span><br><span class="line">    return f&quot;extract only file names to be generated from: &#123;project_structure&#125;&quot;</span><br><span class="line"></span><br><span class="line">def generate_file_content_prompt(user_stories, project_structure, filenames, taskcount):</span><br><span class="line">    return f&quot;&quot;&quot;</span><br><span class="line">    Understand the context &#x27;&#123;user_stories&#125;&#x27; as a whole.</span><br><span class="line">    Understand the project structure  &#123;project_structure&#125;.</span><br><span class="line">    Then think about no details but just write file content for &#123;filenames[taskcount]&#125;.</span><br><span class="line">    Refer dependency files in the project structure.</span><br><span class="line">    Write bug free well-formatted file.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def generate_installation_scripts_prompt(features, system):</span><br><span class="line">    return f&quot;&quot;&quot;Based on the features \&quot;&#123;features&#125;\&quot; and system \&quot;&#123;system&#125;\&quot;, generate detailed installation scripts. </span><br><span class="line">           Include environment setup, dependency management, and any necessary system configurations.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def generate_deployment_scripts_prompt(solution_architecture, system):</span><br><span class="line">    return f&quot;&quot;&quot;Considering the solution architecture \&quot;&#123;solution_architecture&#125;\&quot; and system \&quot;&#123;system&#125;\&quot;,</span><br><span class="line">           generate deployment scripts. Focus on automating the deployment process, including server configurations,</span><br><span class="line">           application deployment, and post-deployment checks.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">def generate_test_files_prompt(user_stories, system):</span><br><span class="line">    return f&quot;&quot;&quot;For each user story in \&quot;&#123;user_stories&#125;\&quot; and the system \&quot;&#123;system&#125;\&quot;,</span><br><span class="line">           generate comprehensive test files. Ensure coverage for unit tests, integration tests, and any relevant</span><br><span class="line">           end-to-end tests. Focus on testing critical functionalities and edge cases.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># Initialize colorama</span><br><span class="line">colorama.init(autoreset=True)</span><br><span class="line"></span><br><span class="line">roles= &quot;&quot;</span><br><span class="line"></span><br><span class="line">def create_directory(directory_path):</span><br><span class="line">    if not os.path.exists(directory_path):</span><br><span class="line">        os.makedirs(directory_path)</span><br><span class="line">        print(f&quot;Directory &#x27;&#123;directory_path&#125;&#x27; created successfully.&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(f&quot;Directory &#x27;&#123;directory_path&#125;&#x27; already exists.&quot;)</span><br><span class="line"></span><br><span class="line">def extract_content_between_backticks(text):</span><br><span class="line">        pattern = r&#x27;```(.*?)```&#x27;</span><br><span class="line">        return re.findall(pattern, text, re.DOTALL)</span><br><span class="line"></span><br><span class="line">def complete(prompt_function, *args):</span><br><span class="line">            prompt = prompt_function(*args)</span><br><span class="line">            response = completion(</span><br><span class="line">                model=&quot;ollama/mistral&quot;, </span><br><span class="line">                messages=[&#123;&quot;content&quot;: prompt, &quot;role&quot;: &quot;user&quot;&#125;], </span><br><span class="line">                api_base=&quot;http://localhost:11434&quot;,</span><br><span class="line">                stream=True</span><br><span class="line">            )</span><br><span class="line">            resp=&quot;&quot;</span><br><span class="line">            for chunk in response:</span><br><span class="line">                if chunk[&#x27;choices&#x27;][0][&#x27;delta&#x27;][&#x27;content&#x27;] is not None:</span><br><span class="line">                    resp = resp + chunk[&#x27;choices&#x27;][0][&#x27;delta&#x27;][&#x27;content&#x27;]</span><br><span class="line">                    print(Fore.GREEN + chunk[&#x27;choices&#x27;][0][&#x27;delta&#x27;][&#x27;content&#x27;], end=&quot;&quot;)</span><br><span class="line">            resp=resp+&#x27;\n&#x27;</span><br><span class="line">            return resp</span><br><span class="line"></span><br><span class="line">pattern = r&#x27;(\b\w+\.\w+\b)&#x27;</span><br><span class="line"></span><br><span class="line">def extract_filenames(title):</span><br><span class="line">    filenames = re.findall(pattern, title)</span><br><span class="line">    return filenames</span><br><span class="line"></span><br><span class="line">def create_code():</span><br><span class="line">    user_input = &quot;&quot;</span><br><span class="line">    resp = &quot;&lt;&lt;done&gt;&gt;&quot;</span><br><span class="line">    taskcount = -1</span><br><span class="line">    filenames = []</span><br><span class="line">    text = []</span><br><span class="line">    output_log = []  # List to collect all output strings</span><br><span class="line"></span><br><span class="line">    while taskcount &lt; len(filenames):</span><br><span class="line">        input_lines = []</span><br><span class="line">        if &quot;&lt;&lt;done&gt;&gt;&quot; in resp.strip().lower():</span><br><span class="line">            prompt = Fore.YELLOW + &quot;Describe the problem for which coding to be done:&quot;</span><br><span class="line">            print(prompt)</span><br><span class="line">            output_log.append(prompt)  # Collect prompt for output log</span><br><span class="line">            while True:</span><br><span class="line">                line = input()</span><br><span class="line">                if line == &quot;exit&quot;:</span><br><span class="line">                    exit_message = Fore.RED + &quot;Exiting chat.&quot;</span><br><span class="line">                    print(exit_message)</span><br><span class="line">                    output_log.append(&quot;Exiting chat.&quot;)  # Collect exit message without color codes</span><br><span class="line">                    return</span><br><span class="line">                if line == &quot;&quot;:</span><br><span class="line">                    break</span><br><span class="line">                input_lines.append(line)</span><br><span class="line">            user_input = &quot;&quot;.join(input_lines)</span><br><span class="line">            taskcount = 0</span><br><span class="line">            system = complete(generate_context_prompt, user_input)</span><br><span class="line">            features = complete(generate_features_prompt, system)</span><br><span class="line">            user_stories = complete(generate_user_stories_prompt, features, system)</span><br><span class="line">            solution_architecture = complete(generate_solution_architecture_prompt, user_stories, system)</span><br><span class="line">            project_structure = complete(generate_project_structure_prompt, solution_architecture, user_stories, system)</span><br><span class="line">            </span><br><span class="line">            # Generate Installation Scripts</span><br><span class="line">            installation_scripts = complete(generate_installation_scripts_prompt, features, system)</span><br><span class="line">            output_log.append(installation_scripts)  # Collect installation scripts</span><br><span class="line"></span><br><span class="line">            # Generate Deployment Scripts</span><br><span class="line">            deployment_scripts = complete(generate_deployment_scripts_prompt, solution_architecture, system)</span><br><span class="line">            output_log.append(deployment_scripts)  # Collect deployment scripts</span><br><span class="line">            </span><br><span class="line">            # Generate Test Files</span><br><span class="line">            test_files = complete(generate_test_files_prompt, user_stories, system)</span><br><span class="line">            output_log.append(test_files)  # Collect test files</span><br><span class="line"></span><br><span class="line">            filenames_response = complete(extract_filenames_prompt, project_structure)</span><br><span class="line">            filenames = extract_filenames(filenames_response)</span><br><span class="line">            output_log.extend([system, features, user_stories, solution_architecture, project_structure, filenames_response])  # Collect all outputs</span><br><span class="line"></span><br><span class="line">        for filename in filenames:</span><br><span class="line">            prompt = f&quot;\n-------------------------------------------------------\n------------------&#123;filename&#125;----------------\n-------------------------------------------------------\n&quot;</span><br><span class="line">            print(prompt)</span><br><span class="line">            output_log.append(prompt)  # Collect file processing prompt</span><br><span class="line">            resp = complete(generate_file_content_prompt, user_stories, project_structure, filenames, taskcount)</span><br><span class="line">            text.append(resp)</span><br><span class="line">            output_log.append(resp)  # Collect file content</span><br><span class="line">            taskcount += 1</span><br><span class="line"></span><br><span class="line">    out_dir = &quot;generated_output&quot;</span><br><span class="line">    create_directory(out_dir)</span><br><span class="line">    for i, filename in enumerate(filenames):</span><br><span class="line">        with open(f&quot;&#123;out_dir&#125;/&#123;filename&#125;&quot;, &quot;w&quot;) as file:</span><br><span class="line">            extracted_content = extract_content_between_backticks(text[i])</span><br><span class="line">            if extracted_content:</span><br><span class="line">                file_content = extracted_content[0]</span><br><span class="line">                file.write(file_content)</span><br><span class="line">            else:</span><br><span class="line">                error_message = f&quot;No content extracted for &#123;filename&#125;&quot;</span><br><span class="line">                print(error_message)</span><br><span class="line">                output_log.append(error_message)  # Collect error message</span><br><span class="line"></span><br><span class="line">    # Write the collected outputs and logs to a README file</span><br><span class="line">    with open(f&quot;&#123;out_dir&#125;/README.md&quot;, &quot;w&quot;) as readme_file:</span><br><span class="line">        readme_file.write(&quot;\n&quot;.join(output_log))</span><br><span class="line"></span><br><span class="line"># Note: Ensure the complete function is defined to work with the new prompt function names and logic.</span><br><span class="line"></span><br><span class="line">create_code()</span><br></pre></td></tr></table></figure>

<p>è¯¥è„šæœ¬æ—¨åœ¨è‡ªåŠ¨åŒ–è½¯ä»¶é¡¹ç›®çš„è„šæ‰‹æ¶æ­å»ºï¼Œåˆ©ç”¨ Ollama è¿›è¡ŒåŠ¨æ€ä»£ç ç”Ÿæˆå’Œ Colorama æ¥å¢å¼ºç»ˆç«¯è¾“å‡ºçš„å¯è§†åŒ–æ•ˆæœã€‚å®ƒç³»ç»Ÿåœ°æ¶µç›–äº†å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªé˜¶æ®µï¼Œä»æ”¶é›†åˆå§‹ä¸Šä¸‹æ–‡åˆ°æ„å»ºæ•´ä¸ªé¡¹ç›®å¹¶ç”Ÿæˆè¯¸å¦‚ä»£ç æ–‡ä»¶ã€å®‰è£…è„šæœ¬ã€éƒ¨ç½²è„šæœ¬å’Œæµ‹è¯•æ–‡ä»¶ç­‰å¿…è¦ç»„ä»¶ã€‚</p>
<ul>
<li><p>åˆå§‹åŒ–ï¼šåœ¨å¼€å§‹æ—¶è°ƒç”¨ colorama.init(autoreset&#x3D;True) ç¡®ä¿ç»ˆç«¯ä¸­çš„æ¯ä¸ªæ‰“å°è¯­å¥åœ¨è§†è§‰ä¸Šéƒ½ç»è¿‡æ ·å¼å¤„ç†ï¼Œè€Œä¸ä¼šå°†æ ·å¼ä¼ é€’ç»™åç»­æ‰“å°ï¼Œä½¿è¾“å‡ºæ¸…æ™°æ˜“è¯»ã€‚</p>
</li>
<li><p>åŠ¨æ€æç¤º: é‡å‘½åå’Œæ›´å…·æè¿°æ€§çš„å®šä¹‰åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œ generate_context_prompt ï¼Œ generate_features_prompt ç­‰ï¼‰ç”¨äºæ„å»ºç‰¹å®šä¸Šä¸‹æ–‡çš„æç¤ºã€‚è¿™äº›æç¤ºè¢«å‘é€åˆ° Ollama ä»£ç ç”Ÿæˆæ¨¡å‹ï¼ŒæŒ‡å¯¼å…¶æ ¹æ®å½“å‰å¼€å‘é˜¶æ®µç”Ÿæˆé¡¹ç›®çš„ç›¸å…³éƒ¨åˆ†ã€‚è¿™ç§åŠ¨æ€æç¤ºæœºåˆ¶å¯¹äºå®šåˆ¶ç”Ÿæˆçš„ä»£ç å’Œæ–‡æ¡£ä»¥æ»¡è¶³é¡¹ç›®ç‰¹å®šéœ€æ±‚å’Œç»“æ„è‡³å…³é‡è¦ã€‚</p>
</li>
<li><p>ç›®å½•å’Œæ–‡ä»¶ç®¡ç†: create_directory å‡½æ•°ç¡®ä¿ä¸ºé¡¹ç›®å»ºç«‹å¿…è¦çš„ç›®å½•ç»“æ„ï¼Œæœ‰æ•ˆåœ°ç»„ç»‡ç”Ÿæˆçš„ä»£ç ã€è„šæœ¬å’Œæ–‡ä»¶ã€‚ extract_filenames å‡½æ•°åœ¨è¯†åˆ«å’Œç®¡ç†ç”Ÿæˆå†…å®¹ä¸­çš„æ–‡ä»¶åæ–¹é¢å‘æŒ¥å…³é”®ä½œç”¨ï¼Œæœ‰åŠ©äºç³»ç»ŸåŒ–ç»„ç»‡é¡¹ç›®çš„ç»„ä»¶ã€‚</p>
</li>
<li><p>complete å‡½æ•°: ä½œä¸ºè„šæœ¬çš„æ ¸å¿ƒï¼Œæ­¤å‡½æ•°é€šè¿‡å‘ Ollama å‘é€åŠ¨æ€æ„å»ºçš„æç¤ºå¹¶å°†æ¨¡å‹çš„å“åº”é›†æˆåˆ°é¡¹ç›®ä¸­æ¥ä¸ Ollama è¿›è¡Œæ¥å£ã€‚é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯¥å‡½æ•°åè°ƒç”Ÿæˆé¡¹ç›®çš„æ¶æ„ï¼ŒåŒ…æ‹¬ä»£ç åº“ã€å®‰è£…è¦æ±‚ã€éƒ¨ç½²ç¨‹åºå’Œæµ‹è¯•æ¡†æ¶ã€‚</p>
</li>
</ul>
<p>python multiple_code_generator.py</p>
<p>è¿è¡Œè„šæœ¬ä¼šå¯åŠ¨ä¸€ä¸ªå¼•å¯¼è¿‡ç¨‹,å¼€å‘äººå‘˜è¢«æç¤ºæè¿°é—®é¢˜</p>
<p>è¾“å…¥äº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>Write a react based chatboat with flask based backend to communicate to LLMs with openai API framework. I want typescript to be used in react and also flask should have python typings.</p>
<p>å®ƒç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Project Structure:</span><br><span class="line">1. frontend/</span><br><span class="line">   - node_modules/</span><br><span class="line">   - public/</span><br><span class="line">      - index.html</span><br><span class="line">   - src/</span><br><span class="line">      - components/</span><br><span class="line">         - ChatInterface.tsx</span><br><span class="line">         - MessageDisplay.tsx</span><br><span class="line">         - UserInput.tsx</span><br><span class="line">      - hooks/</span><br><span class="line">         - useChatBotApi.ts</span><br><span class="line">      - App.tsx</span><br><span class="line">      - index.tsx</span><br><span class="line">      - setupTests.ts</span><br><span class="line">2. backend/</span><br><span class="line">   - app.py</span><br><span class="line">   - venv/</span><br><span class="line">3. .gitignore</span><br><span class="line">4. package.json</span><br><span class="line">5. tsconfig.json</span><br><span class="line">6. README.md</span><br></pre></td></tr></table></figure>

<p>Readme.md æ˜¾ç¤ºæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹çš„log</p>
<p>ä»¥åå¯ä»¥å°†æ­¤è„šæœ¬é›†æˆåˆ°å¼€å‘å·¥ä½œæµç¨‹ä¸­ï¼Œæ ¹æ®é¡¹ç›®éœ€æ±‚è¿›è¡Œå®šåˆ¶ï¼Œå¹¶è€ƒè™‘æ‰©å±•å…¶åŠŸèƒ½ï¼Œå¦‚ä¸ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæˆ–è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶é›†æˆã€‚</p>
<p>ç»“æŸã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/11/pytorch-file-info/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/11/pytorch-file-info/" class="post-title-link" itemprop="url">Pytorchæ ¼å¼ .pt .pth .bin .onnx è§£é‡Š</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-11 14:11:27 / ä¿®æ”¹æ—¶é—´ï¼š18:58:05" itemprop="dateCreated datePublished" datetime="2024-04-11T14:11:27+08:00">2024-04-11</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>5k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Pytorchæ˜¯æ·±åº¦å­¦ä¹ é¢†åŸŸä¸­éå¸¸æµè¡Œçš„æ¡†æ¶ä¹‹ä¸€ï¼Œæ”¯æŒçš„æ¨¡å‹ä¿å­˜æ ¼å¼åŒ…æ‹¬.ptå’Œ.pth .bin .onnxã€‚è¿™å‡ ç§æ ¼å¼çš„æ–‡ä»¶éƒ½å¯ä»¥ä¿å­˜Pytorchè®­ç»ƒå‡ºçš„æ¨¡å‹ï¼Œä½†æ˜¯å®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<h3 id="æ ¼å¼æ±‡æ€»"><a href="#æ ¼å¼æ±‡æ€»" class="headerlink" title="æ ¼å¼æ±‡æ€»"></a>æ ¼å¼æ±‡æ€»</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ•´ç†äº† .ptã€.pthã€.binã€ONNX å’Œ TorchScript ç­‰ PyTorch æ¨¡å‹æ–‡ä»¶æ ¼å¼çš„è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th>æ ¼å¼</th>
<th>è§£é‡Š</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>å¯å¯¹åº”çš„åç¼€</th>
</tr>
</thead>
<tbody><tr>
<td>.pt æˆ– .pth</td>
<td>PyTorch çš„é»˜è®¤æ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼Œç”¨äºä¿å­˜å’ŒåŠ è½½å®Œæ•´çš„ PyTorch æ¨¡å‹ï¼ŒåŒ…å«æ¨¡å‹çš„ç»“æ„å’Œå‚æ•°ç­‰ä¿¡æ¯ã€‚</td>
<td>éœ€è¦ä¿å­˜å’ŒåŠ è½½å®Œæ•´çš„ PyTorch æ¨¡å‹çš„åœºæ™¯ï¼Œä¾‹å¦‚åœ¨è®­ç»ƒä¸­ä¿å­˜æœ€ä½³çš„æ¨¡å‹æˆ–åœ¨éƒ¨ç½²ä¸­åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹ã€‚</td>
<td>.pt æˆ– .pth</td>
</tr>
<tr>
<td>.bin</td>
<td>ä¸€ç§é€šç”¨çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥ç”¨äºä¿å­˜å’ŒåŠ è½½å„ç§ç±»å‹çš„æ¨¡å‹å’Œæ•°æ®ã€‚</td>
<td>éœ€è¦å°† PyTorch æ¨¡å‹è½¬æ¢ä¸ºé€šç”¨çš„äºŒè¿›åˆ¶æ ¼å¼çš„åœºæ™¯ã€‚</td>
<td>.bin</td>
</tr>
<tr>
<td>ONNX</td>
<td>ä¸€ç§é€šç”¨çš„æ¨¡å‹äº¤æ¢æ ¼å¼ï¼Œå¯ä»¥ç”¨äºå°†æ¨¡å‹ä»ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶è½¬æ¢åˆ°å¦ä¸€ä¸ªæ·±åº¦å­¦ä¹ æ¡†æ¶æˆ–ç¡¬ä»¶å¹³å°ã€‚åœ¨ PyTorch ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ torch.onnx.export å‡½æ•°å°† PyTorch æ¨¡å‹è½¬æ¢ä¸º ONNX æ ¼å¼ã€‚</td>
<td>éœ€è¦å°† PyTorch æ¨¡å‹è½¬æ¢ä¸ºå…¶ä»–æ·±åº¦å­¦ä¹ æ¡†æ¶æˆ–ç¡¬ä»¶å¹³å°å¯ç”¨çš„æ ¼å¼çš„åœºæ™¯ã€‚</td>
<td>.onnx</td>
</tr>
<tr>
<td>TorchScript</td>
<td>PyTorch æä¾›çš„ä¸€ç§åºåˆ—åŒ–å’Œä¼˜åŒ–æ¨¡å‹çš„æ–¹æ³•ï¼Œå¯ä»¥å°† PyTorch æ¨¡å‹è½¬æ¢ä¸ºä¸€ä¸ªåºåˆ—åŒ–çš„ç¨‹åºï¼Œå¹¶ä½¿ç”¨ JIT ç¼–è¯‘å™¨å¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ã€‚åœ¨ PyTorch ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ torch.jit.trace æˆ– torch.jit.script å‡½æ•°å°† PyTorch æ¨¡å‹è½¬æ¢ä¸º TorchScript æ ¼å¼ã€‚</td>
<td>éœ€è¦å°† PyTorch æ¨¡å‹åºåˆ—åŒ–å’Œä¼˜åŒ–ï¼Œå¹¶åœ¨æ²¡æœ‰ Python ç¯å¢ƒçš„æƒ…å†µä¸‹è¿è¡Œæ¨¡å‹çš„åœºæ™¯ã€‚</td>
<td>.pt æˆ– .pth</td>
</tr>
</tbody></table>
<p>ä¸åŒçš„åç¼€åªæ˜¯ç”¨äºæç¤ºæˆ‘ä»¬æ–‡ä»¶å¯èƒ½åŒ…å«çš„å†…å®¹ï¼Œä½†æ˜¯å…·ä½“çš„å†…å®¹éœ€è¦çœ‹æ¨¡å‹æä¾›è€…ç¼–å†™çš„README.mdæ‰çŸ¥é“ã€‚è€Œåœ¨ä½¿ç”¨torch.load()æ–¹æ³•åŠ è½½æ¨¡å‹ä¿¡æ¯çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯æ ¹æ®æ–‡ä»¶çš„åç¼€è¿›è¡Œçš„è¯»å–ï¼Œè€Œæ˜¯æ ¹æ®æ–‡ä»¶çš„å®é™…å†…å®¹è‡ªåŠ¨è¯†åˆ«çš„ï¼Œå› æ­¤å¯¹äºtorch.load()æ–¹æ³•è€Œè¨€ï¼Œä¸ç®¡ä½ æŠŠåç¼€æ”¹æˆæ˜¯ä»€ä¹ˆï¼Œåªè¦æ–‡ä»¶æ˜¯å¯¹çš„éƒ½å¯ä»¥è¯»å–ã€‚</p>
<h3 id="æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ"><a href="#æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ"></a>æ¨¡å‹çš„ä¿å­˜ä¸åŠ è½½åˆ°åº•åœ¨åšä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨pytorchæ„å»ºæ¨¡å‹å¹¶ä¸”è®­ç»ƒå®Œæˆåï¼Œä¸‹ä¸€æ­¥è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªæ¨¡å‹æ”¾åˆ°å®é™…åœºæ™¯ä¸­åº”ç”¨ï¼Œæˆ–è€…æ˜¯åˆ†äº«ç»™å…¶ä»–äººå­¦ä¹ ã€ç ”ç©¶ã€ä½¿ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæä¾›å“ªäº›æ¨¡å‹ä¿¡æ¯ï¼Œèƒ½å¤Ÿè®©å¯¹æ–¹èƒ½å¤Ÿå®Œå…¨å¤ç°æˆ‘ä»¬çš„æ¨¡å‹ï¼Ÿ</p>
<p>æ¨¡å‹ä»£ç ï¼š</p>
<ul>
<li>åŒ…å«äº†æˆ‘ä»¬å¦‚ä½•å®šä¹‰æ¨¡å‹çš„ç»“æ„ï¼ŒåŒ…æ‹¬æ¨¡å‹æœ‰å¤šå°‘å±‚&#x2F;æ¯å±‚æœ‰å¤šå°‘ç¥ç»å…ƒç­‰ç­‰ä¿¡æ¯ï¼›</li>
<li>åŒ…å«äº†æˆ‘ä»¬å¦‚ä½•å®šä¹‰çš„è®­ç»ƒè¿‡ç¨‹ï¼ŒåŒ…æ‹¬epoch batch_sizeç­‰å‚æ•°ï¼›</li>
<li>åŒ…å«äº†æˆ‘ä»¬å¦‚ä½•åŠ è½½æ•°æ®å’Œä½¿ç”¨ï¼›</li>
<li>åŒ…å«äº†æˆ‘ä»¬å¦‚ä½•æµ‹è¯•è¯„ä¼°æ¨¡å‹ã€‚</li>
</ul>
<p>æ¨¡å‹å‚æ•°ï¼šæä¾›äº†æ¨¡å‹ä»£ç ä¹‹åï¼Œå¯¹æ–¹ç¡®å®èƒ½å¤Ÿå¤ç°æ¨¡å‹ï¼Œä½†æ˜¯è¿è¡Œçš„å‚æ•°éœ€è¦é‡æ–°è®­ç»ƒæ‰èƒ½å¾—åˆ°ï¼Œè€Œæ²¡æœ‰åŠæ³•åœ¨æˆ‘ä»¬çš„æ¨¡å‹å‚æ•°åŸºç¡€ä¸Šç»§ç»­è®­ç»ƒï¼Œå› æ­¤å¯¹æ–¹è¿˜å¸Œæœ›æˆ‘ä»¬èƒ½å¤ŸæŠŠæ¨¡å‹çš„å‚æ•°ä¹Ÿä¿å­˜ä¸‹æ¥ç»™å¯¹æ–¹ã€‚</p>
<ul>
<li>åŒ…å«model.state_dict()ï¼Œè¿™æ˜¯æ¨¡å‹æ¯ä¸€å±‚å¯å­¦ä¹ çš„èŠ‚ç‚¹çš„å‚æ•°ï¼Œæ¯”å¦‚weight&#x2F;biasï¼›</li>
<li>åŒ…å«optimizer.state_dict()ï¼Œè¿™æ˜¯æ¨¡å‹çš„ä¼˜åŒ–å™¨ä¸­çš„å‚æ•°ï¼›</li>
<li>åŒ…å«æˆ‘ä»¬å…¶ä»–å‚æ•°ä¿¡æ¯ï¼Œå¦‚epoch&#x2F;batch_size&#x2F;lossç­‰ã€‚</li>
</ul>
<p>æ•°æ®é›†ï¼š</p>
<ul>
<li>åŒ…å«äº†æˆ‘ä»¬è®­ç»ƒæ¨¡å‹ä½¿ç”¨çš„æ‰€æœ‰æ•°æ®ï¼›</li>
<li>å¯ä»¥æç¤ºå¯¹æ–¹å¦‚ä½•å»å‡†å¤‡åŒæ ·æ ¼å¼çš„æ•°æ®æ¥è®­ç»ƒæ¨¡å‹ã€‚</li>
</ul>
<p>ä½¿ç”¨æ–‡æ¡£ï¼š</p>
<ul>
<li>æ ¹æ®ä½¿ç”¨æ–‡æ¡£çš„æ­¥éª¤ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥é‡ç°æ¨¡å‹ï¼›</li>
<li>åŒ…å«äº†æ¨¡å‹çš„ä½¿ç”¨ç»†èŠ‚å’Œæˆ‘ä»¬ç›¸å…³å‚æ•°çš„è®¾ç½®ä¾æ®ç­‰ä¿¡æ¯ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æ®æˆ‘ä»¬æä¾›çš„æ¨¡å‹ä»£ç &#x2F;æ¨¡å‹å‚æ•°&#x2F;æ•°æ®é›†&#x2F;ä½¿ç”¨æ–‡æ¡£ï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ‰ç†ç”±ç›¸ä¿¡å¯¹æ–¹æ˜¯æœ‰æ‰‹å°±ä¼šäº†ï¼Œé‚£ä¹ˆç›®çš„å°±è¾¾åˆ°äº†ã€‚</p>
<h3 id="pt-pthæ ¼å¼"><a href="#pt-pthæ ¼å¼" class="headerlink" title=".pt .pthæ ¼å¼"></a>.pt .pthæ ¼å¼</h3><p>ä¸€ä¸ªå®Œæ•´çš„Pytorchæ¨¡å‹æ–‡ä»¶ï¼ŒåŒ…å«äº†å¦‚ä¸‹å‚æ•°ï¼š</p>
<ul>
<li>model_state_dictï¼šæ¨¡å‹å‚æ•°</li>
<li>optimizer_state_dictï¼šä¼˜åŒ–å™¨çš„çŠ¶æ€</li>
<li>epochï¼šå½“å‰çš„è®­ç»ƒè½®æ•°</li>
<li>lossï¼šå½“å‰çš„æŸå¤±å€¼</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª.ptæ–‡ä»¶çš„ä¿å­˜å’ŒåŠ è½½ç¤ºä¾‹ï¼ˆæ³¨æ„ï¼Œåç¼€ä¹Ÿå¯ä»¥æ˜¯ .pth ï¼‰ï¼š</p>
<ul>
<li>.state_dict()ï¼šåŒ…å«æ‰€æœ‰çš„å‚æ•°å’ŒæŒä¹…åŒ–ç¼“å­˜çš„å­—å…¸ï¼Œmodelå’Œoptimizeréƒ½æœ‰è¿™ä¸ªæ–¹æ³•</li>
<li>torch.save()ï¼šå°†æ‰€æœ‰çš„ç»„ä»¶ä¿å­˜åˆ°æ–‡ä»¶ä¸­</li>
</ul>
<h4 id="æ¨¡å‹ä¿å­˜"><a href="#æ¨¡å‹ä¿å­˜" class="headerlink" title="æ¨¡å‹ä¿å­˜"></a>æ¨¡å‹ä¿å­˜</h4><pre><code>import torch
import torch.nn as nn

# å®šä¹‰ä¸€ä¸ªç®€å•çš„æ¨¡å‹
class Net(nn.Module):
    def __init__(self):
        super(Net, self).__init__()
        self.fc1 = nn.Linear(10, 5)
        self.fc2 = nn.Linear(5, 1)

    def forward(self, x):
        x = self.fc1(x)
        x = self.fc2(x)
        return x

model = Net()

# ä¿å­˜æ¨¡å‹
torch.save(&#123;
            &#39;epoch&#39;: 10,
            &#39;model_state_dict&#39;: model.state_dict(),
            &#39;optimizer_state_dict&#39;: optimizer.state_dict(),
            &#39;loss&#39;: loss,
            &#125;, PATH)
</code></pre>
<h4 id="æ¨¡å‹åŠ è½½"><a href="#æ¨¡å‹åŠ è½½" class="headerlink" title="æ¨¡å‹åŠ è½½"></a>æ¨¡å‹åŠ è½½</h4><pre><code>import torch
import torch.nn as nn

# å®šä¹‰åŒæ ·çš„æ¨¡å‹ç»“æ„
class Net(nn.Module):
    def __init__(self):
        super(Net, self).__init__()
        self.fc1 = nn.Linear(10, 5)
        self.fc2 = nn.Linear(5, 1)

    def forward(self, x):
        x = self.fc1(x)
        x = self.fc2(x)
        return x

# åŠ è½½æ¨¡å‹
model = Net()
optimizer = optim.SGD(model.parameters(), lr=0.001, momentum=0.9)
checkpoint = torch.load(PATH)
model.load_state_dict(checkpoint[&#39;model_state_dict&#39;])
optimizer.load_state_dict(checkpoint[&#39;optimizer_state_dict&#39;])
epoch = checkpoint[&#39;epoch&#39;]
loss = checkpoint[&#39;loss&#39;]
model.eval()
</code></pre>
<h3 id="binæ ¼å¼"><a href="#binæ ¼å¼" class="headerlink" title=".binæ ¼å¼"></a>.binæ ¼å¼</h3><p>.binæ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ä¿å­˜Pytorchæ¨¡å‹çš„å‚æ•°å’ŒæŒä¹…åŒ–ç¼“å­˜ã€‚.binæ–‡ä»¶çš„å¤§å°è¾ƒå°ï¼ŒåŠ è½½é€Ÿåº¦è¾ƒå¿«ï¼Œå› æ­¤åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¾ƒå¤šã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª.binæ–‡ä»¶çš„ä¿å­˜å’ŒåŠ è½½ç¤ºä¾‹ï¼ˆæ³¨æ„ï¼šä¹Ÿå¯ä»¥ä½¿ç”¨ .pt .pth åç¼€ï¼‰ï¼š</p>
<h4 id="ä¿å­˜æ¨¡å‹"><a href="#ä¿å­˜æ¨¡å‹" class="headerlink" title="ä¿å­˜æ¨¡å‹"></a>ä¿å­˜æ¨¡å‹</h4><pre><code>import torch
import torch.nn as nn

# å®šä¹‰ä¸€ä¸ªç®€å•çš„æ¨¡å‹
class Net(nn.Module):
    def __init__(self):
        super(Net, self).__init__()
        self.fc1 = nn.Linear(10, 5)
        self.fc2 = nn.Linear(5, 1)

    def forward(self, x):
        x = self.fc1(x)
        x = self.fc2(x)
        return x

model = Net()
# ä¿å­˜å‚æ•°åˆ°.binæ–‡ä»¶
torch.save(model.state_dict(), PATH)
</code></pre>
<h4 id="åŠ è½½æ¨¡å‹"><a href="#åŠ è½½æ¨¡å‹" class="headerlink" title="åŠ è½½æ¨¡å‹"></a>åŠ è½½æ¨¡å‹</h4><pre><code>import torch
import torch.nn as nn

# å®šä¹‰ç›¸åŒçš„æ¨¡å‹ç»“æ„
class Net(nn.Module):
    def __init__(self):
        super(Net, self).__init__()
        self.fc1 = nn.Linear(10, 5)
        self.fc2 = nn.Linear(5, 1)

    def forward(self, x):
        x = self.fc1(x)
        x = self.fc2(x)
        return x

# åŠ è½½.binæ–‡ä»¶
model = Net()
model.load_state_dict(torch.load(PATH))
model.eval()
</code></pre>
<h3 id="onnxæ ¼å¼"><a href="#onnxæ ¼å¼" class="headerlink" title=".onnxæ ¼å¼"></a>.onnxæ ¼å¼</h3><p>ä¸Šè¿°ä¿å­˜çš„æ–‡ä»¶å¯ä»¥é€šè¿‡PyTorchæä¾›çš„torch.onnx.exportå‡½æ•°è½¬åŒ–ä¸ºONNXæ ¼å¼ï¼Œè¿™æ ·å¯ä»¥åœ¨å…¶ä»–æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ä½¿ç”¨PyTorchè®­ç»ƒçš„æ¨¡å‹ã€‚è½¬åŒ–æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>import torch
import torch.onnx

# å°†æ¨¡å‹ä¿å­˜ä¸º.binæ–‡ä»¶
model = torch.nn.Linear(3, 1)
torch.save(model.state_dict(), &quot;model.bin&quot;)
# torch.save(model.state_dict(), &quot;model.pt&quot;)
# torch.save(model.state_dict(), &quot;model.pth&quot;)

# å°†.binæ–‡ä»¶è½¬åŒ–ä¸ºONNXæ ¼å¼
model = torch.nn.Linear(3, 1)
model.load_state_dict(torch.load(&quot;model.bin&quot;))
# model.load_state_dict(torch.load(&quot;model.pt&quot;))
# model.load_state_dict(torch.load(&quot;model.pth&quot;))
example_input = torch.randn(1, 3)
torch.onnx.export(model, example_input, &quot;model.onnx&quot;, input_names=[&quot;input&quot;], output_names=[&quot;output&quot;])
</code></pre>
<p>åŠ è½½ONNXæ ¼å¼çš„ä»£ç å¯ä»¥å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code>import onnx
import onnxruntime

# åŠ è½½ONNXæ–‡ä»¶
onnx_model = onnx.load(&quot;model.onnx&quot;)

# å°†ONNXæ–‡ä»¶è½¬åŒ–ä¸ºORTæ ¼å¼
ort_session = onnxruntime.InferenceSession(&quot;model.onnx&quot;)

# è¾“å…¥æ•°æ®
input_data = np.random.random(size=(1, 3)).astype(np.float32)

# è¿è¡Œæ¨¡å‹
outputs = ort_session.run(None, &#123;&quot;input&quot;: input_data&#125;)

# è¾“å‡ºç»“æœ
print(outputs)
</code></pre>
<p>æ³¨æ„ï¼Œéœ€è¦å®‰è£…onnxå’Œonnxruntimeä¸¤ä¸ªPythonåŒ…ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦ä½¿ç”¨numpyç­‰å…¶ä»–å¸¸ç”¨çš„ç§‘å­¦è®¡ç®—åº“ã€‚</p>
<h3 id="ç›´æ¥ä¿å­˜å®Œæ•´æ¨¡å‹"><a href="#ç›´æ¥ä¿å­˜å®Œæ•´æ¨¡å‹" class="headerlink" title="ç›´æ¥ä¿å­˜å®Œæ•´æ¨¡å‹"></a>ç›´æ¥ä¿å­˜å®Œæ•´æ¨¡å‹</h3><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ä¿å­˜æ–¹å¼ä¸­ï¼Œéƒ½æ˜¯ä¿å­˜äº†.state_dict()ï¼Œä½†æ˜¯æ²¡æœ‰ä¿å­˜æ¨¡å‹çš„ç»“æ„ï¼Œåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨çš„æ—¶å€™ï¼Œå¿…é¡»å…ˆé‡æ–°å®šä¹‰ç›¸åŒç»“æ„çš„æ¨¡å‹ï¼ˆæˆ–å…¼å®¹æ¨¡å‹ï¼‰ï¼Œæ‰èƒ½å¤ŸåŠ è½½æ¨¡å‹å‚æ•°è¿›è¡Œä½¿ç”¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥æŠŠæ•´ä¸ªæ¨¡å‹éƒ½ä¿å­˜ä¸‹æ¥ï¼Œé¿å…é‡æ–°å®šä¹‰æ¨¡å‹ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ“ä½œï¼š</p>
<h4 id="ä¿å­˜æ¨¡å‹-1"><a href="#ä¿å­˜æ¨¡å‹-1" class="headerlink" title="ä¿å­˜æ¨¡å‹"></a>ä¿å­˜æ¨¡å‹</h4><pre><code>PATH = &quot;entire_model.pt&quot;
# PATH = &quot;entire_model.pth&quot;
# PATH = &quot;entire_model.bin&quot;
model = Net()
torch.save(model, PATH)
</code></pre>
<h4 id="åŠ è½½æ¨¡å‹-1"><a href="#åŠ è½½æ¨¡å‹-1" class="headerlink" title="åŠ è½½æ¨¡å‹"></a>åŠ è½½æ¨¡å‹</h4><pre><code>model = torch.load(&quot;entire_model.pt&quot;)
model.eval()
</code></pre>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>æœ¬æ–‡ä»‹ç»äº†pytorchå¯ä»¥å¯¼å‡ºçš„æ¨¡å‹çš„å‡ ç§åç¼€æ ¼å¼ï¼Œä½†æ˜¯æ¨¡å‹å¯¼å‡ºçš„å…³é”®å¹¶ä¸æ˜¯åç¼€ï¼Œè€Œæ˜¯åˆ°å¤„æ—¶å€™æä¾›çš„ä¿¡æ¯åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œåªè¦çŸ¥é“äº†æ¨¡å‹çš„model.state_dict()å’Œoptimizer.state_dict()ï¼Œä»¥åŠç›¸åº”çš„epoch batch_size lossç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿé‡å»ºå‡ºæ¨¡å‹ï¼Œè‡³äºè¦å¯¼å‡ºå“ªäº›ä¿¡æ¯ï¼Œå°±å–å†³äºä½ äº†ï¼ŒåŠ¡å¿…åœ¨readme.mdä¸­å†™æ¸…æ¥šï¼Œä½ å¯¼å‡ºäº†å“ªäº›ä¿¡æ¯ã€‚</p>
<p>ä¹‹æ‰€ä»¥å†™äº†æœ¬æ–‡ï¼Œæ˜¯å› ä¸ºä¸Šä¸€ç¯‡â€œé€šè¿‡æ¸¸æˆæ·±å…¥äº†è§£å¼ºåŒ–å­¦ä¹ â€ è®­ç»ƒå®Œæ¨¡å‹åï¼Œæ€ä¹ˆæŠŠæ¨¡å‹åº”ç”¨åˆ°å®é™…åœºæ™¯ä¸­ï¼Œå°±å†™äº†è¿™ç¯‡ï¼Œç†è§£å¦‚ä½•åŠ è½½æ¨¡å‹ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/620688513">https://zhuanlan.zhihu.com/p/620688513</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/09/reinforce-learing-game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/09/reinforce-learing-game/" class="post-title-link" itemprop="url">é€šè¿‡æ¸¸æˆæ·±å…¥äº†è§£å¼ºåŒ–å­¦ä¹  ä¸Šç¯‡</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-09 21:11:59" itemprop="dateCreated datePublished" datetime="2024-04-09T21:11:59+08:00">2024-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-05-05 16:24:00" itemprop="dateModified" datetime="2024-05-05T16:24:00+08:00">2024-05-05</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>6.4k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>12 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æœ¬æ–‡å°†åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸€äº›å¼ºåŒ–å­¦ä¹ çš„åŸºæœ¬ç†è®ºï¼ŒåŒæ—¶ä½¿ç”¨ PyTorch çš„ REINFORCE æ–¹æ³•ç© <a target="_blank" rel="noopener" href="https://flappybird.io/">Flappy Bird</a> æ¸¸æˆã€‚</p>
<p>åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ›´å¤æ‚çš„ RL ç®—æ³•ï¼Œä¾‹å¦‚ Advantage Actor Critic ï¼ˆA2Cï¼‰ å’Œå½“å‰æœ€å…ˆè¿›çš„ç®—æ³• PPO</p>
<h2 id="å¼ºåŒ–å­¦ä¹ "><a href="#å¼ºåŒ–å­¦ä¹ " class="headerlink" title="å¼ºåŒ–å­¦ä¹ "></a>å¼ºåŒ–å­¦ä¹ </h2><p>å¼ºåŒ–å­¦ä¹ æ˜¯ä¸€ç§æœºå™¨å­¦ä¹ æ–¹æ³•ï¼Œä¸“æ³¨äºé€šè¿‡ä¸ç¯å¢ƒçš„äº¤äº’æ¥å­¦ä¹ è¡Œä¸ºç­–ç•¥ï¼Œæ—¨åœ¨å®ç°ç‰¹å®šç›®æ ‡æˆ–æœ€å¤§åŒ–ç»©æ•ˆæŒ‡æ ‡ã€‚å®ƒç”±ä¸‰ä¸ªä¸»è¦å…ƒç´ ç»„æˆï¼šç¯å¢ƒã€ä»£ç†å’Œå¥–åŠ±ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/01.webp"></p>
<ul>
<li>ä»£ç†ä»ç¯å¢ƒæ¥æ”¶çŠ¶æ€ ï¼ˆs_tï¼‰</li>
<li>æ ¹æ®è¯¥çŠ¶æ€ï¼Œä»£ç†å‘ç¯å¢ƒæä¾›æ“ä½œ ï¼ˆa_tï¼‰</li>
<li>ç¯å¢ƒè¿›å…¥æ–°çŠ¶æ€ ï¼ˆs_t+1ï¼‰ï¼Œå¹¶å‘ä»£ç†æä¾›ä¸€äº›å¥–åŠ± ï¼ˆr_t+1ï¼‰</li>
</ul>
<h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>ç¯å¢ƒæ˜¯ä¸ä»£ç†äº¤äº’çš„ç³»ç»Ÿã€‚å®ƒå®šä¹‰äº†ä»£ç†å¯èƒ½é‡åˆ°çš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ã€åœ¨è¿™äº›çŠ¶æ€ä¸‹å¯ä»¥é‡‡å–çš„æ“ä½œä»¥åŠè¿™äº›æ“ä½œçš„ç»“æœã€‚</p>
<p>ç¯å¢ƒé€šè¿‡æä¾›æ–°çš„çŠ¶æ€å’Œå¥–åŠ±ä¿¡æ¯æ¥å“åº”æ™ºèƒ½ä½“çš„è¡Œä¸ºï¼Œè¿™äº›ä¿¡æ¯ç”¨äºæŒ‡å¯¼æ™ºèƒ½ä½“çš„å­¦ä¹ è¿‡ç¨‹ã€‚ç¯å¢ƒå®šä¹‰ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>æ“ä½œç©ºé—´ï¼šå®šä¹‰ä»£ç†å¯èƒ½æ‰§è¡Œçš„ä¸€ç»„æ“ä½œ</li>
<li>è§‚å¯Ÿç©ºé—´ï¼šå®šä¹‰ä»£ç†å¯ä»¥è§‚å¯Ÿçš„æ‰€æœ‰å¯èƒ½çŠ¶æ€ã€‚è¿™äº›çŠ¶æ€æä¾›ä»£ç†å†³å®šå…¶ä¸‹ä¸€æ­¥æ“ä½œæ‰€éœ€çš„ä¿¡æ¯ã€‚çŠ¶æ€ç©ºé—´å¯ä»¥æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ— é™çš„ï¼Œå¯ä»¥æ˜¯è¿ç»­çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¦»æ•£çš„</li>
<li>å¥–åŠ±åŠŸèƒ½ï¼š å¥–åŠ±åŠŸèƒ½æä¾›å¯¹ä»£ç†è¡Œä¸ºçš„å³æ—¶è¯„ä¼°ï¼ˆå¥–åŠ±ï¼‰ï¼ŒæŒ‡å¯¼ä»£ç†å­¦ä¹ å¦‚ä½•è°ƒæ•´å…¶ç­–ç•¥ä»¥è·å¾—æ›´é«˜çš„æ€»å¥–åŠ±ã€‚</li>
<li>è½¬æ¢åŠ¨æ€ï¼š è½¬æ¢åŠ¨æ€æè¿°äº†åœ¨ç»™å®šçš„å½“å‰çŠ¶æ€å’Œé‡‡å–ç‰¹å®šæ“ä½œåç¯å¢ƒç§»åŠ¨åˆ°æ–°çŠ¶æ€çš„æ¦‚ç‡ã€‚</li>
</ul>
<h2 id="ä»£ç†"><a href="#ä»£ç†" class="headerlink" title="ä»£ç†"></a>ä»£ç†</h2><p>åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œä»£ç†æ˜¯æŒ‡å¯ä»¥è§‚å¯Ÿç¯å¢ƒã€åšå‡ºå†³ç­–å’Œæ‰§è¡Œæ“ä½œçš„å®ä½“ã€‚ä»£ç†çš„ç›®æ ‡æ˜¯å­¦ä¹ ä¸€ç§ç­–ç•¥ï¼Œè¿™æ˜¯ä¸€ç§åœ¨ç»™å®šç¯å¢ƒçŠ¶æ€ä¸‹é€‰æ‹©æœ€ä½³è¡ŒåŠ¨çš„æ–¹æ³•ï¼Œä»¥ä¾¿æœ€å¤§åŒ–è·å¾—çš„é•¿æœŸå›æŠ¥ã€‚</p>
<h2 id="å¥–åŠ±"><a href="#å¥–åŠ±" class="headerlink" title="å¥–åŠ±"></a>å¥–åŠ±</h2><p>å¥–åŠ±æ˜¯æŒ‡å¯¼ä»£ç†å­¦ä¹ è¿‡ç¨‹çš„å…³é”®ä¿¡å·ï¼Œæä¾›æœ‰å…³å…¶è¡Œä¸ºçš„åé¦ˆã€‚è¿™äº›å¥–åŠ±ï¼Œæ— è®ºæ˜¯ç§¯æçš„è¿˜æ˜¯æ¶ˆæçš„ï¼Œéƒ½æœ‰åŠ©äºä»£ç†äº†è§£å…¶è¡Œä¸ºåœ¨å®ç°ç›®æ ‡æ–¹é¢çš„åæœã€‚</p>
<p>ä»£ç†çš„ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡å­¦ä¹ ç­–ç•¥æ¥é€‰æ‹©å„ç§çŠ¶æ€ä¸‹çš„æœ€ä½³è¡ŒåŠ¨ï¼Œä»è€Œéšç€æ—¶é—´çš„æ¨ç§»æœ€å¤§åŒ–å…¶æ€»å›æŠ¥ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/02.webp"></p>
<p>Gt æ˜¯æ—¶é—´æ­¥é•¿ t çš„æ€»å¥–åŠ±ï¼ˆä¹Ÿç§°ä¸ºå›æŠ¥ï¼‰ã€‚å®ƒè¢«å®šä¹‰ä¸ºä»æ—¶é—´æ­¥é•¿ t åˆ°è¿‡ç¨‹ç»“æŸ ï¼ˆTï¼‰ çš„å¥–åŠ±æ€»å’Œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªå¥–åŠ±éƒ½åº”ç”¨æŠ˜æ‰£ç‡ Î³ã€‚è¯¥å› ç´ å†³å®šäº†æœªæ¥å¥–åŠ±åœ¨æ—¶é—´æ­¥é•¿ t å¤„å¯¹æ€»å¥–åŠ±çš„è´¡çŒ®ç¨‹åº¦ã€‚</p>
<p>è´´ç°ç‡Î³æ˜¯ä»‹äº 0 å’Œ 1 ä¹‹é—´çš„å€¼ã€‚ä»¥ 0.95 ä¸ºä¾‹ï¼Œé¢„è®¡åœ¨æ›´é¥è¿œçš„å°†æ¥è·å¾—çš„å¥–åŠ± Rt ä¹˜ä»¥ä¸€ä¸ªè¾ƒå°çš„æ•°å­— 0.95^ï¼ˆt-1ï¼‰ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºè¾¾åˆ°æœªæ¥æŸä¸ªçŠ¶æ€çš„æ¦‚ç‡ç›¸å¯¹è¾ƒä½ï¼Œå› æ­¤ï¼Œå®ƒæä¾›çš„å¥–åŠ±åº”è¯¥è¾ƒå°æ‰èƒ½è¢«è®¤ä¸ºæ˜¯åˆç†çš„ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/03.webp"></p>
<p>è¿™æ˜¯ä¸€ä¸ªè®¡ç®—å¥–åŠ±çš„ç®€å•ç¤ºä¾‹ã€‚â€œè›‡â€å’Œâ€œç›®æ ‡â€çš„å›¾åƒåˆ†åˆ«ä»£è¡¨åˆå§‹çŠ¶æ€å’Œæœ€ç»ˆçŠ¶æ€ã€‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤æ¡å¯èƒ½å®ç°ç›®æ ‡çš„é€”å¾„ï¼š</p>
<p>è·¯å¾„1ï¼šç›´ä¸Šï¼Œç„¶åå‘å³èµ°åˆ°ç›®æ ‡</p>
<p>è·¯å¾„ 2ï¼šå‘å³èµ°ï¼Œç„¶åå‘ä¸Šèµ°åˆ°æœé˜¿l</p>
<p>å½“è´´ç°ç‡ Î³ &#x3D; 1 æ—¶</p>
<ul>
<li>Rï¼ˆè·¯å¾„ 1ï¼‰ &#x3D; 2 + Î³ï¼ˆ-3ï¼‰ + Î³Â²ï¼ˆ0ï¼‰ + Î³Â³ï¼ˆ1ï¼‰ &#x3D; 0</li>
<li>Rï¼ˆè·¯å¾„ 2ï¼‰ &#x3D; 1+ Î³ï¼ˆ0ï¼‰ + Î³Â²ï¼ˆ3ï¼‰ + Î³Â³ï¼ˆ0ï¼‰ &#x3D; 4</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸åŒçš„è½¨è¿¹ï¼ˆè·¯å¾„ï¼‰å¯ä»¥è¾¾åˆ°ç›®æ ‡ï¼Œä½†æ¯ä¸ªè½¨è¿¹éƒ½å¯èƒ½å¯¼è‡´éå¸¸ä¸åŒçš„å›æŠ¥ï¼ˆ0 å’Œ 4ï¼‰ã€‚å› æ­¤ï¼Œæ‰¾åˆ°æœ€å¤§åŒ–æ€»å¥–åŠ±çš„æœ€ä½³è½¨è¿¹æ˜¯å¼ºåŒ–å­¦ä¹  ï¼ˆRLï¼‰ çš„ç›®æ ‡ã€‚</p>
<p>è½¨è¿¹ï¼š è½¨è¿¹ï¼ˆé€šå¸¸è¡¨ç¤ºä¸º Ï„ï¼‰æè¿°äº†ä»£ç†æ‰€ç»å†çš„ç‰¹å®šçŠ¶æ€ã€æ“ä½œå’Œå¥–åŠ±åºåˆ—ã€‚ä¾‹å¦‚ï¼šÏ„ &#x3D; ï¼ˆsâ‚€ï¼Œ aâ‚€ï¼Œ râ‚ï¼Œ sâ‚ï¼Œ aâ‚ï¼Œ râ‚‚ï¼Œ sâ‚‚ï¼Œ aâ‚‚ï¼Œ â€¦ï¼Œ s_Tï¼Œ a_Tï¼Œ r_T+1ï¼Œ s_T+1ï¼‰</p>
<h2 id="å€¼å‡½æ•°"><a href="#å€¼å‡½æ•°" class="headerlink" title="å€¼å‡½æ•°"></a>å€¼å‡½æ•°</h2><p>ä¸ºäº†å®šä¹‰æˆ‘ä»¬çš„çŠ¶æ€æœ‰å¤šå¥½ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªå‡½æ•°æ¥ç¡®å®šå®ƒï¼Œè¿™å°±æ˜¯å€¼å‡½æ•°ã€‚</p>
<p>ä»æœ¬è´¨ä¸Šè®²ï¼Œæ­¤å‡½æ•°ä¼°è®¡å¤„äºè¯¥çŠ¶æ€çš„é¢„æœŸå›æŠ¥ã€‚å®ƒè®©äººæ„Ÿå—åˆ°åœ¨ç‰¹å®šçŠ¶æ€ä¸‹ï¼Œéµå¾ªç‰¹å®šç­–ç•¥ï¼ˆä»£ç†éµå¾ªçš„ä¸€ç§ç­–ç•¥ï¼‰æ‰€èƒ½å¸¦æ¥çš„é•¿æœŸæ•ˆç›Šã€‚</p>
<p><img src="/../asset_reinforcelearinggame/04.webp"></p>
<p>ä¸Šé¢å®šä¹‰çš„å€¼å‡½æ•°å¯ä»¥é‡æ–°è¡¨è¿°ä¸º<a target="_blank" rel="noopener" href="https://huggingface.co/learn/deep-rl-course/unit2/bellman-equation">è´å°”æ›¼æ–¹ç¨‹</a>çš„å½¢å¼ï¼Œä»¥æé«˜æˆ‘ä»¬è®¡ç®—å…¶å€¼çš„èƒ½åŠ›ã€‚è¿™å…è®¸æˆ‘ä»¬ä»¥é€’å½’æ–¹å¼è®¡ç®—çŠ¶æ€å€¼ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/05.webp"></p>
<p>åœ¨å€¼å‡½æ•°ä¸­ï¼Œè½¬ç§»æ¦‚ç‡ Pï¼ˆa ï¼Œsâ†’sâ€²ï¼‰ çš„æœŸæœ›å€¼ç”¨äºè§£é‡Šåœ¨ç›¸åŒçŠ¶æ€ ï¼ˆsï¼‰ ä¸‹é‡‡å–ç›¸åŒæ“ä½œ ï¼ˆaï¼‰ çš„ç»“æœï¼ˆçŠ¶æ€ sâ€²ï¼‰å¯èƒ½ä¼šå˜åŒ–çš„å®é™…åœºæ™¯ã€‚</p>
<p>ç¬¦å· Ï€ è¡¨ç¤ºä»£ç†çš„ç­–ç•¥ï¼Œå…¶ä¸­ Ï€ï¼ˆa | sï¼‰ è¡¨ç¤ºä»£ç†åœ¨çŠ¶æ€ s ä¸­é€‰æ‹©æ“ä½œ a çš„æ¦‚ç‡ã€‚</p>
<p>çœ‹ä¸€ä¸ªä¾‹å­ï¼š<br><img src="/../asset_reinforcelearinggame/06.webp"></p>
<p>ï¼ˆr è¡¨ç¤ºä»ä¸€ç§çŠ¶æ€è¿‡æ¸¡åˆ°å¦ä¸€ç§çŠ¶æ€è·å¾—çš„å³æ—¶å¥–åŠ±ï¼Œä¾‹å¦‚ s1 -&gt; s3ï¼Œå¥–åŠ± &#x3D; 3ï¼‰</p>
<p>åœ¨æ­¤åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æœ‰å››ç§çŠ¶æ€ï¼šs1 ä½œä¸ºèµ·å§‹çŠ¶æ€ï¼Œs2ã€s3 å’Œ s4 ä½œä¸ºç»“æŸçŠ¶æ€ã€‚å¯ä»¥é€‰æ‹©ä¸¤ä¸ªåŠ¨ä½œï¼Œâ€œå·¦â€æˆ–â€œå³â€ï¼Œæ¯ä¸ªåŠ¨ä½œåœ¨è¿™äº›çŠ¶æ€ä¹‹é—´éƒ½æœ‰è‡ªå·±çš„ä¸€ç»„è½¬æ¢æ¦‚ç‡ã€‚</p>
<p>ä¸åŒçš„ç­–ç•¥ä¸‹çŠ¶æ€ 1 çš„å€¼ï¼š</p>
<ul>
<li>Vï¼ˆÏ€ &#x3D; å§‹ç»ˆå‘å·¦ï¼‰ &#x3D; 0.5 * 2 + 0.5 * 4 &#x3D; 3</li>
<li>Vï¼ˆÏ€ &#x3D; å§‹ç»ˆå‘å³ï¼‰ &#x3D; 0.33 * 3 + 0.67 * 4 &#x3D; 3.67</li>
<li>Vï¼ˆÏ€ &#x3D; 50% å·¦ï¼Œ50% å³ï¼‰ &#x3D; 0.5 * Vï¼ˆå·¦ï¼‰ + 0.5 * Vï¼ˆå³ï¼‰ &#x3D; 3.335<br>æ­¤ç¤ºä¾‹è€ƒè™‘äº†è½¬æ¢æ¦‚ç‡ï¼ˆä¾‹å¦‚ï¼Œaction &#x3D; rightï¼š33% åˆ° s3,67% åˆ° s4ï¼‰ï¼Œçªå‡ºäº†è½¬æ¢çš„éšæœºæ€§ï¼Œå³ç›¸åŒçš„æ“ä½œå¹¶ä¸èƒ½ä¿è¯æ¯æ¬¡éƒ½è·å¾—ç›¸åŒçš„ç»“æœã€‚</li>
</ul>
<p>ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼š<br><img src="/../asset_reinforcelearinggame/07.webp"></p>
<p>ä¸ºç®€å•èµ·è§ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å¿½ç•¥è½¬æ¢æ¦‚ç‡ï¼Œä»£ç†åªèƒ½é€‰æ‹©åœ¨å¼€å§‹æ—¶æ‰§è¡Œâ€œå‘ä¸Šâ€æˆ–â€œå‘ä¸‹â€æ“ä½œã€‚å¯¹äºåç»­çŠ¶æ€ï¼Œä»£ç†å§‹ç»ˆå‘å³ã€‚</p>
<p>ï¼ˆS1 ä¸ºèµ·å§‹çŠ¶æ€ï¼ŒS6 ä¸ºç»ˆæœ«çŠ¶æ€ï¼Œç»ˆæœ«çŠ¶æ€å€¼ &#x3D; 0ï¼‰</p>
<p>å¯¹äº Ï€ &#x3D; å§‹ç»ˆå‘ä¸Šï¼ŒÎ³ &#x3D; 1</p>
<ul>
<li>Vï¼ˆs6ï¼‰ &#x3D; 0</li>
<li>Vï¼ˆs3ï¼‰ &#x3D; Vï¼ˆs5ï¼‰ &#x3D; 10 + Î³Vï¼ˆs6ï¼‰ &#x3D; 10</li>
<li>Vï¼ˆs2ï¼‰ &#x3D; 2+ Î³Vï¼ˆs3ï¼‰ &#x3D; 12</li>
<li>Vï¼ˆs4ï¼‰ &#x3D; 4+ Î³Vï¼ˆs5ï¼‰ &#x3D; 14</li>
<li>Vï¼ˆs1ï¼‰ &#x3D; 1 + Î³Vï¼ˆs2ï¼‰ &#x3D; 13</li>
</ul>
<p>å¯¹äºÏ€ &#x3D;ï¼ˆ50% ä¸Šå‡ï¼Œ50% ä¸‹é™ï¼‰ï¼ŒÎ³ &#x3D; 1</p>
<ul>
<li>Vï¼ˆs6ï¼‰ &#x3D; 0</li>
<li>Vï¼ˆs3ï¼‰ &#x3D; Vï¼ˆs5ï¼‰ &#x3D; 10 + Î³Vï¼ˆs6ï¼‰ &#x3D; 10</li>
<li>Vï¼ˆs2ï¼‰ &#x3D; 2+ Î³Vï¼ˆs3ï¼‰ &#x3D; 12</li>
<li>Vï¼ˆs4ï¼‰ &#x3D; 4+ Î³Vï¼ˆs5ï¼‰ &#x3D; 14</li>
<li>Vï¼ˆs1ï¼‰ &#x3D; ï¼ˆ1 + Î³Vï¼ˆs2ï¼‰ï¼‰ * 0.5 + ï¼ˆ2 + Î³Vï¼ˆs4ï¼‰ï¼‰ * 0.5 &#x3D; 9.5</li>
</ul>
<h2 id="Q-å‡½æ•°"><a href="#Q-å‡½æ•°" class="headerlink" title="Q å‡½æ•°"></a>Q å‡½æ•°</h2><p>åœ¨å®è·µä¸­ï¼Œå¦‚æœæ‰€æœ‰çŠ¶æ€çš„å€¼éƒ½æ˜¯å·²çŸ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¡®ä¿ä»£ç†åœ¨æ¯ä¸ªæ—¶é—´ç‰‡ç§»åŠ¨åˆ°å…·æœ‰æœ€é«˜å€¼çš„çŠ¶æ€æ¥æœ€å¤§åŒ–ç´¯ç§¯å¥–åŠ±ã€‚</p>
<p>ä½†æ˜¯ï¼Œç”±äºè®¡ç®—çŠ¶æ€å€¼éœ€è¦äº†è§£è½¬ç§»æ¦‚ç‡ï¼Œè€Œè½¬ç§»æ¦‚ç‡é€šå¸¸æ˜¯æœªçŸ¥çš„ã€‚å› æ­¤ï¼Œä½¿ç”¨çŠ¶æ€-åŠ¨ä½œå‡½æ•°ï¼ˆQ å‡½æ•°ï¼‰æˆä¸ºæ›´å¥½çš„é€‰æ‹©ã€‚</p>
<p>ç”±äº Q å€¼å¯ä»¥ç›´æ¥ä»ç»éªŒä¸­å­¦ä¹ ï¼Œå› æ­¤æ— éœ€çŸ¥é“ç¯å¢ƒçš„è½¬æ¢æ¦‚ç‡ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/08.webp"></p>
<p>Q å‡½æ•°æˆ– action-value å‡½æ•°ï¼Œå®šä¹‰äº†åœ¨ç­–ç•¥ Ï€ ä¸‹çš„çŠ¶æ€ s ä¸­æ‰§è¡Œæ“ä½œ a çš„å€¼ã€‚Q å‡½æ•°å’Œå€¼å‡½æ•°ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼ŒQ å‡½æ•°æŒ‡å®šç¡®å®šæ€§åŠ¨ä½œçš„å€¼ï¼Œå› æ­¤æ— éœ€è®¡ç®—ç»™å®šç­–ç•¥ Ï€ï¼ˆaâˆ£sï¼‰ çš„åŠ¨ä½œæ¦‚ç‡ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/09.webp"></p>
<p>å€¼å‡½æ•°ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯æ‰€æœ‰å¯èƒ½æ“ä½œ a çš„ Q å‡½æ•°çš„æ€»å’Œã€‚</p>
<p><img src="/../asset_reinforcelearinggame/10.webp"><br>ä¸Šå¼ä¸­çš„Q*ï¼ˆsï¼Œ aï¼‰æ˜¯æœ€ä¼˜Qå‡½æ•°</p>
<p>åœ¨åƒ Q-learning è¿™æ ·åŸºäºä»·å€¼çš„æ–¹æ³•ä¸­ï¼Œå§‹ç»ˆä¸ºæ¯ä¸ªçŠ¶æ€é€‰æ‹©å…·æœ‰æœ€é«˜ Q å€¼çš„è¡ŒåŠ¨çš„ç­–ç•¥ç¡®ä¿äº†æ€»å¥–åŠ±çš„è‡ªåŠ¨æœ€å¤§åŒ–ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“åŠ¨ä½œç©ºé—´éå¸¸å¤§æˆ–è¿ç»­æ—¶ï¼Œè®¡ç®—æ‰€æœ‰å¯èƒ½çš„ Q å€¼ä»¥ç¡®å®šæ¯ä¸ªçŠ¶æ€çš„æœ€ä½³åŠ¨ä½œå˜å¾—ä¸åˆ‡å®é™…ã€‚</p>
<h2 id="åŸºäºç­–ç•¥çš„æ–¹æ³•"><a href="#åŸºäºç­–ç•¥çš„æ–¹æ³•" class="headerlink" title="åŸºäºç­–ç•¥çš„æ–¹æ³•"></a>åŸºäºç­–ç•¥çš„æ–¹æ³•</h2><p><img src="/../asset_reinforcelearinggame/11.webp"><br>å¼ºåŒ–å­¦ä¹ ä¸­åŸºäºç­–ç•¥çš„æ–¹æ³•ï¼Œç›´æ¥å‚æ•°åŒ–å’Œä¼˜åŒ–ä»£ç†é€‰æ‹©è¡ŒåŠ¨æ‰€éµå¾ªçš„ç­–ç•¥ï¼Œè€Œæ— éœ€æ˜ç¡®è®¡ç®—ä½œä¸ºä¸­é—´å‡½æ•°çš„ä»·å€¼å‡½æ•°ï¼ˆåŸºäºä»·å€¼çš„æ–¹æ³•ï¼‰ã€‚</p>
<p>è¯¥ç­–ç•¥ï¼Œç”¨ Ï€ï¼ˆaâˆ£s;Î¸ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå°†çŠ¶æ€æ˜ å°„åˆ°åŠ¨ä½œæ¦‚ç‡åˆ†å¸ƒçš„å‡½æ•°ï¼Œå…¶ä¸­ Î¸ è¡¨ç¤ºç­–ç•¥çš„å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œç¥ç»ç½‘ç»œçš„æƒé‡ï¼‰ã€‚</p>
<h2 id="å¼ºåŒ–"><a href="#å¼ºåŒ–" class="headerlink" title="å¼ºåŒ–"></a>å¼ºåŒ–</h2><p>REINFORCETEæ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥çš„ç­–ç•¥æ¢¯åº¦æ–¹æ³•ã€‚å®ƒé€šè¿‡ä¼°è®¡ç›¸å¯¹äºç­–ç•¥å‚æ•°çš„é¢„æœŸå›æŠ¥æ¢¯åº¦ï¼Œç„¶åä½¿ç”¨æ¢¯åº¦ä¸‹é™æ¥è°ƒæ•´è¿™äº›å‚æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚<br><img src="/../asset_reinforcelearinggame/12.webp"></p>
<p>æ¢¯åº¦åˆ»åº¦ä¸å›æŠ¥ ï¼ˆRï¼ˆÏ„ï¼‰ï¼‰ æˆæ­£æ¯”ï¼Œå›æŠ¥è¡¨ç¤ºæ‰€é‡‡å–çš„è¡ŒåŠ¨çš„è´¨é‡ã€‚åŒæ—¶ï¼Œæ¢¯åº¦æœ¬èº«ç”±é‡‡å–è¯¥è¡ŒåŠ¨çš„æ¦‚ç‡çš„å¯¹æ•°è¡¨ç¤ºã€‚</p>
<p>è¿™ç§æ–¹æ³•æ—¨åœ¨å¢åŠ äº§ç”Ÿé«˜å›æŠ¥çš„è¡ŒåŠ¨çš„æ¦‚ç‡ï¼Œå¹¶é™ä½å¯¼è‡´ä½å›æŠ¥çš„è¡ŒåŠ¨çš„æ¦‚ç‡ã€‚</p>
<h2 id="å¼ºåŒ–æ­¥éª¤"><a href="#å¼ºåŒ–æ­¥éª¤" class="headerlink" title="å¼ºåŒ–æ­¥éª¤"></a>å¼ºåŒ–æ­¥éª¤</h2><p>åœ¨ REINFORCE æ–¹æ³•ä¸­ï¼Œæœ‰å¿…è¦ä½¿ç”¨çœŸå®æ ·æœ¬è®¡ç®—å›æŠ¥ã€‚æ­¤å¤–ï¼Œå®æ–½è¿˜éœ€è¦é€šè¿‡<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Monte_Carlo_method">è’™ç‰¹å¡æ´›æ–¹æ³•</a>è·å¾—çš„å®Œæ•´è½¨è¿¹ã€‚</p>
<ul>
<li>ä½¿ç”¨éšæœºæƒé‡åˆå§‹åŒ–ç½‘ç»œã€‚</li>
<li>æ‰§è¡Œ N æ¬¡å®Œæ•´è¿‡ç¨‹ï¼Œæ”¶é›†å®ƒä»¬çš„è½¨è¿¹ï¼ˆsã€aã€rã€sâ€™ï¼‰</li>
<li>è®¡ç®—æ¯ä¸ªæ—¶é—´æ­¥é•¿çš„è¿”å›å€¼ã€‚</li>
<li>è®¡ç®—æŸå¤±å‡½æ•° L &#x3D; -Rï¼ˆÏ„ï¼‰logÏ€ï¼ˆa|sï¼‰</li>
<li>æ›´æ–°æ¨¡å‹æƒé‡</li>
</ul>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Gym ç¯å¢ƒæ¥ç© FlappyBird æ¸¸æˆã€‚</p>
<p><img src="/../asset_reinforcelearinggame/13.webp"></p>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œäº†è§£ç¯å¢ƒçš„ç»†èŠ‚éå¸¸é‡è¦ã€‚åœ¨å®æ–½ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ¯æ¬¡éƒ½é€šè¯»<a target="_blank" rel="noopener" href="https://github.com/markub3327/flappy-bird-gymnasium">æ–‡æ¡£</a>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.environ[&quot;KMP_DUPLICATE_LIB_OK&quot;]=&quot;TRUE&quot;  # å¦‚æœé‡åˆ°KMP_DUPLICATE_LIB å°±æœç”¨æ­¤è¡Œ</span><br><span class="line">import torch</span><br><span class="line">import torch.nn as nn</span><br><span class="line">import torch.optim as optim</span><br><span class="line">import torch.nn.functional as F</span><br><span class="line"></span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import gymnasium as gym</span><br><span class="line">import flappy_bird_gymnasium</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def make_env(env_id):</span><br><span class="line">    def wrapped_env():</span><br><span class="line">        env = gym.make(env_id, render_mode=&#x27;rgb_array&#x27;)</span><br><span class="line">        # could add some environment wrapper</span><br><span class="line">        return env</span><br><span class="line">    return wrapped_env</span><br><span class="line"></span><br><span class="line">env_id = &#x27;FlappyBird-v0&#x27;</span><br><span class="line">env = make_env(env_id)()</span><br><span class="line">obs, _ = env.reset()</span><br><span class="line">image = env.render()</span><br><span class="line"></span><br><span class="line">plt.imshow(image)</span><br><span class="line">plt.axis(&#x27;off&#x27;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/../asset_reinforcelearinggame/14.webp"></p>
<p>è§‚æµ‹ç”±ä¸€ä¸ª 1D é˜µåˆ—ç»„æˆï¼Œè¯¥é˜µåˆ—ç”± LIDAR ä¼ æ„Ÿå™¨æ”¶é›† 180 ä¸ªæ•°æ®ç‚¹ã€‚ä»£ç†å¯ä»¥é‡‡å–ä¸¤ç§å¯èƒ½çš„æ“ä½œï¼š0 è¡¨ç¤ºä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œ1 è¡¨ç¤ºæ‹æ‰“ã€‚</p>
<p><img src="/../asset_reinforcelearinggame/15.webp"></p>
<h2 id="BirdAgent-è®­ç»ƒ"><a href="#BirdAgent-è®­ç»ƒ" class="headerlink" title="BirdAgent &amp; è®­ç»ƒ"></a>BirdAgent &amp; è®­ç»ƒ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class BirdPolicy(nn.Module):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        super(BirdPolicy, self).__init__()</span><br><span class="line">        self.fc1 = nn.Linear(180, 128)  </span><br><span class="line">        self.relu = nn.ReLU()  </span><br><span class="line">        self.fc2 = nn.Linear(128, 2)  </span><br><span class="line">        self.softmax = nn.Softmax(dim=-1) </span><br><span class="line"></span><br><span class="line">    def forward(self, x):</span><br><span class="line">        x = self.relu(self.fc1(x))</span><br><span class="line">        x = self.fc2(x)</span><br><span class="line">        return self.softmax(x)</span><br></pre></td></tr></table></figure>

<p>ä»£ç†ä¸»è¦è´Ÿè´£æ ¹æ®ç¯å¢ƒæä¾›çš„çŠ¶æ€åšå‡ºå†³ç­–ã€‚å®ƒè¿”å›ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œè¡¨ç¤ºé€‰æ‹©æ¯ä¸ªå¯èƒ½æ“ä½œçš„å¯èƒ½æ€§ã€‚</p>
<p>å› æ­¤ï¼ŒåŠ¨ä½œæ•°ï¼ˆè¡¨ç¤ºä¸º n_actionï¼‰ç­‰äºç¯å¢ƒçš„åŠ¨ä½œç©ºé—´ï¼Œå³ 2ã€‚</p>
<p>æœ€åï¼Œè¿™é‡Œæ˜¯è®­ç»ƒå¾ªç¯~~ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">def REINFORCE(env, episodes, policy, device, optimizer):</span><br><span class="line">    for episode in range(episodes):</span><br><span class="line">        obs, _ = env.reset()</span><br><span class="line">        log_probs = []</span><br><span class="line">        rewards = []</span><br><span class="line">        done = False</span><br><span class="line">        </span><br><span class="line">        while not done:</span><br><span class="line">            # Add batch dimension</span><br><span class="line">            obs = torch.FloatTensor(obs).unsqueeze(0).to(device) </span><br><span class="line">            probs = policy(obs)</span><br><span class="line">            action = torch.distributions.Categorical(probs).sample()</span><br><span class="line">            log_prob = torch.log(probs.squeeze(0)[action])</span><br><span class="line">            obs, reward, done, _, info = env.step(action.item())</span><br><span class="line">            log_probs.append(log_prob)</span><br><span class="line">            rewards.append(reward)</span><br><span class="line">        Return = []</span><br><span class="line">        Gt = 0</span><br><span class="line"></span><br><span class="line">        for reward in rewards[::-1]:</span><br><span class="line">            # bellman equation</span><br><span class="line">            # computed from back to front</span><br><span class="line">            Gt = reward + 0.99 * Gt</span><br><span class="line">            Return.insert(0, Gt)</span><br><span class="line">        </span><br><span class="line">        Return = torch.tensor(Return).to(device)</span><br><span class="line">        policy_loss = []</span><br><span class="line">        for log_prob, Q in zip(log_probs, Return):</span><br><span class="line">            # compute policy gradient</span><br><span class="line">            policy_loss.append(-log_prob * Q)</span><br><span class="line">            </span><br><span class="line">        policy_loss = torch.cat(policy_loss).mean()</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        policy_loss.backward()</span><br><span class="line">        optimizer.step()</span><br><span class="line">            </span><br><span class="line">        if episode % 200 == 0:</span><br><span class="line">            print(f&#x27;Episode &#123;episode+1&#125;, Total Reward: &#123;sum(rewards)&#125;&#x27;)</span><br><span class="line">            torch.save(policy.state_dict(), f&quot;./weight_epoch.pt&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">device = &quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;</span><br><span class="line">policy = BirdPolicy().to(device) </span><br><span class="line">optimizer = optim.Adam(policy.parameters(), lr=1e-4)</span><br><span class="line"></span><br><span class="line"># train for 20000 iterations</span><br><span class="line">REINFORCE(env, 20000, policy, device, optimizer)</span><br></pre></td></tr></table></figure>

<p>è®­ç»ƒå®Œäº†ä»¥åï¼Œå¯ä»¥æ¨ç†ä¸€ä¸‹è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def INFERENCE(env, policy, device):</span><br><span class="line"></span><br><span class="line">    obs, _ = env.reset()</span><br><span class="line"></span><br><span class="line">    done = False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    policy.load_state_dict(torch.load(f&quot;./weight_epoch.pt&quot;, map_location=torch.device(&#x27;cpu&#x27;)))</span><br><span class="line">    # å¦‚æœæ¨¡å‹æ˜¯CUDAè®­ç»ƒå‡ºæ¥çš„ï¼Œæ¨ç†ç”¨CPUï¼Œéœ€è¦æ·»åŠ  map_location=torch.device(&#x27;cpu&#x27;) æ¥é€‚é…</span><br><span class="line">    policy.eval()</span><br><span class="line">    while not done:</span><br><span class="line">        obs = torch.FloatTensor(obs).unsqueeze(0).to(device)</span><br><span class="line">        probs = policy(obs)</span><br><span class="line">        action = torch.distributions.Categorical(probs).sample()</span><br><span class="line">        obs, reward, done, _, info = env.step(action.item())</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹ä»¥ä¸‹ä»£ç å°±å¯ä»¥çœ‹åˆ°å›¾åƒï¼š</p>
<pre><code># env = gym.make(env_id, render_mode=&#39;rgb_array&#39;)
env = gym.make(env_id, render_mode=&#39;human&#39;)
</code></pre>
<p>ä¿®æ”¹ä»¥ä¸‹ä»£ç å°±å¯ä»¥æ¨ç†ï¼š</p>
<pre><code># REINFORCE(env, 20000, policy, device, optimizer)
INFERENCE(env, policy, device)
</code></pre>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ç®€è¦ä»‹ç»äº†å¼ºåŒ–å­¦ä¹ çš„åŸºæœ¬åŸç†ï¼ŒåŒ…æ‹¬å€¼å‡½æ•°ã€Q å‡½æ•°ç­‰ã€‚æˆ‘è¿˜ä»ç­–ç•¥æ¢¯åº¦æ–¹æ³•ä¸­å¼•å…¥äº† REINFORCE ç®—æ³•ï¼Œå¹¶ç”¨å®ƒæ¥ç© Flappy Bird æ¸¸æˆã€‚</p>
<p>åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†ä»‹ç»å¦å¤–ä¸¤ç§ç­–ç•¥æ¢¯åº¦æ–¹æ³•ï¼ŒA2C å’Œ PPOï¼Œå¹¶åœ¨ä¸¤ä¸ªæ¸¸æˆä¸­å®ç°å®ƒä»¬ï¼š<a target="_blank" rel="noopener" href="https://gymnasium.farama.org/environments/box2d/car_racing/">èµ›è½¦</a>å’Œ<a target="_blank" rel="noopener" href="https://github.com/linyiLYi/snake-ai">è´ªåƒè›‡æ¸¸æˆ</a>ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://levelup.gitconnected.com/mastering-game-worlds-a-deep-dive-into-reinforcement-learning-5acccad89a18">https://levelup.gitconnected.com/mastering-game-worlds-a-deep-dive-into-reinforcement-learning-5acccad89a18</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/04/langchain-chess/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/04/langchain-chess/" class="post-title-link" itemprop="url">ä½¿ç”¨LangChainæœ€æ–°çš„ç»“æ„åŒ–è¾“å‡ºåŠŸèƒ½æ„å»ºå›½é™…è±¡æ£‹ä»£ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-04 17:16:15" itemprop="dateCreated datePublished" datetime="2024-04-04T17:16:15+08:00">2024-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-06 23:50:32" itemprop="dateModified" datetime="2024-04-06T23:50:32+08:00">2024-04-06</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>6.3k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>11 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>LangChainæœ€è¿‘æ·»åŠ äº†ä¸€ä¸ªAPIæ¥è¿”å›ç»“æ„åŒ–è¾“å‡ºã€‚å®ƒä½¿ç”¨æ¯ä¸ª LLM æä¾›å•†çš„å‡½æ•°è°ƒç”¨åŠŸèƒ½ã€‚è¦ä½¿ç”¨å®ƒï¼Œæ‚¨åªéœ€ä¸ºæ‰€éœ€çš„è¾“å‡ºå®šä¹‰ä¸€ä¸ª pydantic æ¨¡å‹ã€‚</p>
<p>ç»“æ„åŒ–è¾“å‡ºæ˜¯æ„å»ºå¤§å‹ç³»ç»Ÿçš„å…³é”®ï¼Œå…¶ä¸­å„ä¸ªéƒ¨åˆ†ä½¿ç”¨ JSON ç›¸äº’é€šä¿¡ã€‚æœ‰ç‚¹ç±»ä¼¼äº Web åº”ç”¨ç¨‹åºçš„åç«¯ API å’Œå‰ç«¯å¦‚ä½•è¿›è¡Œé€šä¿¡ã€‚</p>
<p>ä½¿ç”¨ LangChain çš„ç»“æ„åŒ–è¾“å‡ºåŠŸèƒ½æ¥æ„å»ºä¸€ä¸ªå›½é™…è±¡æ£‹ä»£ç†å¹¶ä½¿å…¶ä¸ Stockfish ä¸‹æ£‹ã€‚æ–¹æ³•å¦‚ä¸‹ã€‚</p>
<p>pip install -U python-dotenv langchain-openai chess</p>
<p>é¦–å…ˆï¼Œæˆ‘éœ€è¦å®šä¹‰æˆ‘çš„å›½é™…è±¡æ£‹ä»£ç†å°†è¾“å‡ºä»€ä¹ˆã€‚åœ¨ä¸ Stockfish çš„æ¯”èµ›ä¸­ï¼Œæˆ‘çš„ä»£ç†åº”è¯¥è‡³å°‘è¾“å‡ºå…¶ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼Œç»™å®šçš„è¾“å…¥åŒ…å«æ£‹ç›˜çŠ¶æ€ã€æ¸¸æˆä¸­çš„è¡ŒåŠ¨å†å²è®°å½•ä»¥åŠå¯¹è®¡åˆ’ä¸‹ä¸€æ­¥è¡ŒåŠ¨æœ‰ç”¨çš„å…¶ä»–æ•°æ®ã€‚</p>
<p>æˆ‘å†³å®šå°†å›½é™…è±¡æ£‹ä»£ç†çš„ä¸‹ä¸€æ­¥æ£‹å®šä¹‰ä¸ºåŒ…å«è¯¥æ£‹æ­¥çš„ pydantic ç±»ï¼Œä»¥åŠè§£é‡Šè¯¥æ£‹æ­¥çš„æ¨ç†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from langchain_openai import ChatOpenAI</span><br><span class="line">import chess</span><br><span class="line">import chess.engine</span><br><span class="line">from langchain_core.pydantic_v1 import BaseModel, Field</span><br><span class="line">from dotenv import load_dotenv</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class NextMove(BaseModel):</span><br><span class="line">    move: str = Field(..., description=&quot;Best next move to win the chess game. It should be in Standard Algebraic Notation. Always plan 5 moves ahead before deciding the best next move.&quot;)</span><br><span class="line">    reasoning: str = Field(..., description=&quot;Reasoning explaining why the move is the best&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model = ChatOpenAI(model=&quot;gpt-4&quot;)</span><br><span class="line">chess_agent = model.with_structured_output(NextMove)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦å®šä¹‰æˆ‘å°†ä½¿ç”¨çš„ Stockfish å¼•æ“çš„ç‰ˆæœ¬ã€‚<br>æˆ‘è¿˜åœ¨ play_game() å‡½æ•°ä¸­å®šä¹‰äº†æ¸¸æˆçš„é€»è¾‘ã€‚<br>æˆ‘æ·»åŠ äº†çŸ­æœŸè®°å¿†ï¼Œä»¥ä¾¿å›½é™…è±¡æ£‹ä»£ç†å¯ä»¥è®°ä½è¿‡å»çš„æ¯”èµ›ï¼Œå¹¶æœ‰å¯èƒ½åˆ©ç”¨è¿™äº›çŸ¥è¯†æ¥æé«˜æ°´å¹³ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"># Initialize a chess board and the chess engine</span><br><span class="line">engine = chess.engine.SimpleEngine.popen_uci(r&quot;F:\stockfish\stockfish\stockfish-windows-x86-64-avx2.exe&quot;)</span><br><span class="line"></span><br><span class="line"># Configure Stockfish to a specific skill level, e.g., 10</span><br><span class="line">engine.configure(&#123;&quot;Skill Level&quot;: 0&#125;)</span><br><span class="line"></span><br><span class="line">file_path = os.path.expanduser(&#x27;~\\learning_chess.txt&#x27;)</span><br><span class="line">try:</span><br><span class="line">    with open(file_path, &#x27;r&#x27;) as file:</span><br><span class="line">        past_game_performance = file.read()</span><br><span class="line">except FileNotFoundError:</span><br><span class="line">    print(f&quot;The file &#123;file_path&#125; does not exist. Creating a new one.&quot;)</span><br><span class="line">    with open(file_path, &#x27;w&#x27;) as file:</span><br><span class="line">        file.write(&quot;Initial content\n&quot;)</span><br><span class="line">        past_game_performance = &quot;Initial content\n&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def play_game():</span><br><span class="line">    moves = []  # Variable to store the list of moves</span><br><span class="line">    board = chess.Board()</span><br><span class="line"></span><br><span class="line">    def get_agent_move(board):</span><br><span class="line">        feedback = &quot;&quot;</span><br><span class="line">        while True:</span><br><span class="line"></span><br><span class="line">            prompt = f&quot;&quot;&quot;Current board: &#123;board&#125;\nMove history: &#123;moves&#125;</span><br><span class="line">            Choose the next move for black in UCI format. The available legal moves are &#123;list(board.legal_moves)&#125;.</span><br><span class="line">            The move you select should be among the legal moves in UCI format like this:&#x27;Move.from_uci(&#x27;g7g5&#x27;)&#x27; &#123;feedback&#125; Only reply with the move and nothing else.</span><br><span class="line">            Take into your past performance against stockfish: &#123;past_game_performance&#125;&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">            # No streaming</span><br><span class="line">            response = chess_agent.invoke(prompt)</span><br><span class="line"></span><br><span class="line">            next_move = response.move</span><br><span class="line"></span><br><span class="line">            try:</span><br><span class="line">                move = chess.Move.from_uci(next_move)</span><br><span class="line"></span><br><span class="line">                if move in board.legal_moves:</span><br><span class="line">                    return move</span><br><span class="line">                else:</span><br><span class="line">                    feedback = f&quot;Agent&#x27;s generated move &#123;move&#125; is not valid currently.&quot;</span><br><span class="line">            except:</span><br><span class="line">                feedback = &quot;Failed to parse the Agent&#x27;s generated move. Retrying...&quot;</span><br><span class="line"></span><br><span class="line">    while not board.is_game_over():</span><br><span class="line">        if board.turn:  # True for white&#x27;s turn, False for black&#x27;s turn</span><br><span class="line">            result = engine.play(board, chess.engine.Limit(time=2.0))</span><br><span class="line">            board.push(result.move)</span><br><span class="line">            moves.append(result.move.uci())  # Store UCI move in the list</span><br><span class="line">        else:</span><br><span class="line">            move = get_agent_move(board)</span><br><span class="line">            board.push(move)</span><br><span class="line">            moves.append(move.uci())  # Store UCI move in the list</span><br><span class="line">        print(board)</span><br><span class="line">        print(&quot;\n\n&quot;)</span><br><span class="line"></span><br><span class="line">    # Check the result of the game</span><br><span class="line">    winner = &quot;&quot;</span><br><span class="line">    if board.is_checkmate():</span><br><span class="line">        if board.turn:</span><br><span class="line">            winner = &quot;Black&quot;</span><br><span class="line">        else:</span><br><span class="line">            winner = &quot;White&quot;</span><br><span class="line">    elif board.is_stalemate() or board.is_insufficient_material() or board.is_seventyfive_moves() or board.is_fivefold_repetition() or board.is_variant_draw():</span><br><span class="line">        winner = &quot;Draw&quot;</span><br><span class="line"></span><br><span class="line">    # Write the result in the short term memory</span><br><span class="line">    with open(file_path, &#x27;a&#x27;) as file:</span><br><span class="line">        file.write(f&quot;\n&#123;&#x27; &#x27;.join(moves)&#125; =&gt; Winner: &#123;&#x27;AI Agent&#x27; if winner == &#x27;Black&#x27; else &#x27;Stockfish&#x27;&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    if winner == &quot;Black&quot;:</span><br><span class="line">        return &quot;Agent wins by checkmate.&quot;</span><br><span class="line">    elif winner == &quot;White&quot;:</span><br><span class="line">        return &quot;Stockfish wins by checkmate.&quot;</span><br><span class="line">    else:</span><br><span class="line">        return &quot;The game is a draw.&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨æä¾›çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘æ¦‚è¿°äº†åŸºäº GPT-4 çš„è‡ªå®šä¹‰ AI ä»£ç†ä¸ Stockfish å›½é™…è±¡æ£‹å¼•æ“ä¹‹é—´å›½é™…è±¡æ£‹æ¸¸æˆçš„è®¾ç½®å’Œæ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯ä»£ç å„æ®µä¸­å‘ç”Ÿçš„æƒ…å†µçš„ç»†åˆ†ï¼š</p>
<ul>
<li><p>åˆå§‹åŒ–å›½é™…è±¡æ£‹å¼•æ“ï¼šä½¿ç”¨è¯¥chess.engine.SimpleEngineæ–¹æ³•åˆå§‹åŒ– Stockfish å›½é™…è±¡æ£‹å¼•æ“ï¼ŒæŒ‡å®šç³»ç»Ÿä¸Šå®‰è£…çš„ Stockfish å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚</p>
</li>
<li><p>é…ç½®StockfishæŠ€èƒ½ç­‰çº§ï¼šé€šè¿‡è¯¥ engine.configure æ–¹æ³•å°†Stockfishå¼•æ“çš„æŠ€èƒ½ç­‰çº§è®¾ç½®ä¸º0 ã€‚è¿™éƒ¨åˆ†æœ‰ä¸€ä¸ªé”™è¯¯ï¼›è¦å°†æŠ€èƒ½ç­‰çº§è®¾ç½®ä¸º 10ï¼Œåˆ™åº”{â€œSkill Levelâ€: 10}æ”¹ä¸º{â€œSkill Levelâ€: 0}ã€‚</p>
</li>
<li><p>è¯»å–è¿‡å»çš„æ¸¸æˆè¡¨ç°ï¼šè¿‡å»æ¸¸æˆçš„è¡¨ç°æ˜¯ä»learning_chess.txtæ–‡æœ¬æ–‡ä»¶åŠ è½½ã€‚è¯¥ä¿¡æ¯ç”¨äºå‘ŠçŸ¥äººå·¥æ™ºèƒ½ä»£ç†åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­çš„å†³ç­–ã€‚</p>
</li>
<li><p>ç©æ¸¸æˆå‡½æ•°ï¼šè¯¥å‡½æ•°å°è£…äº†AIä»£ç†å’ŒStockfishå¼•æ“ä¹‹é—´ä¸‹æ£‹çš„é€»è¾‘ã€‚å®ƒåœ¨ä¸€ä¸ªåä¸º moves çš„åˆ—è¡¨ä¸­è·Ÿè¸ªæ¸¸æˆæœŸé—´æ‰€åšçš„åŠ¨ä½œmovesï¼Œå¹¶åˆ©ç”¨ä¸€ä¸ªchess.Board()å¯¹è±¡æ¥ç®¡ç†æ¸¸æˆçŠ¶æ€ã€‚</p>
</li>
<li><p>è·å–ä»£ç†ç§»åŠ¨å‡½æ•°ï¼šåœ¨è¯¥play_gameå‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªåµŒå¥—å‡½æ•°get_agent_moveï¼Œæ—¨åœ¨ç¡®å®š AI ä»£ç†çš„ä¸‹ä¸€æ­¥ç§»åŠ¨ã€‚å®ƒç”Ÿæˆä¸€ä¸ªæç¤ºï¼ŒåŒ…æ‹¬å½“å‰æ£‹ç›˜çŠ¶æ€ã€èµ°æ£‹å†å²å’Œåˆæ³•èµ°æ£‹ï¼Œç„¶åç­‰å¾…å›½é™…è±¡æ£‹ä»£ç†ï¼ˆå‡è®¾æ˜¯ LLM æˆ–ç±»ä¼¼çš„ AI æ¨¡å‹ï¼‰çš„å“åº”ã€‚è¯¥å“åº”è¢«è§£æå¹¶éªŒè¯ä¸ºåˆæ³•çš„å›½é™…è±¡æ£‹æ£‹æ­¥ã€‚</p>
</li>
<li><p>æ¸¸æˆå¾ªç¯ï¼šæ¸¸æˆä»¥å¾ªç¯æ–¹å¼è¿›è¡Œï¼Œå…¶ä¸­ Stockfish åœ¨å…¶å›åˆä¸­è¿›è¡Œç§»åŠ¨ï¼ˆç™½è‰²ï¼‰ï¼Œè€Œ AI ä»£ç†åœ¨å…¶å›åˆä¸­è¿›è¡Œç§»åŠ¨ï¼ˆé»‘è‰²ï¼‰ã€‚ç”±äºå°†æ­»ã€å¹³å±€æˆ–å…¶ä»–å¹³å±€æƒ…å†µï¼Œå°†è¿›è¡Œç§»åŠ¨ç›´è‡³æ¸¸æˆç»“æŸã€‚</p>
</li>
<li><p>ç¡®å®šå¹¶è®°å½•æ¸¸æˆç»“æœï¼šæ¸¸æˆç»“æŸæ—¶ï¼Œæ ¹æ®æ¸¸æˆçš„æœ€ç»ˆçŠ¶æ€ç¡®å®šç»“æœã€‚æ­¤ç»“æœå°†é™„åŠ åˆ°learning_chess.txtæ–‡ä»¶ä¸­ï¼Œç”¨æœ€æ–°çš„æ¸¸æˆåŠ¨ä½œå’Œç»“æœæ›´æ–°äººå·¥æ™ºèƒ½ä»£ç†çš„â€œçŸ­æœŸè®°å¿†â€ã€‚</p>
</li>
<li><p>è¿”å›æ¸¸æˆç»“æœï¼šæœ€åï¼Œè¯¥å‡½æ•°è¿”å›ä¸€æ¡å­—ç¬¦ä¸²æ¶ˆæ¯ï¼ŒæŒ‡ç¤º AI ä»£ç†æ˜¯å¦è·èƒœã€Stockfish è·èƒœï¼Œæˆ–è€…æ¸¸æˆæ˜¯å¦ä»¥å¹³å±€ç»“æŸã€‚</p>
</li>
</ul>
<p>ç„¶åæˆ‘å†³å®šæ¯”èµ› 3 æ¬¡ï¼Œçœ‹çœ‹ GPT-4 èƒ½å¦åœ¨å›½é™…è±¡æ£‹æ–¹é¢æœ‰æ‰€æ”¹è¿›å¹¶å‡»è´¥ Stockfish 16ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Number of games to play</span><br><span class="line">n_games = 3</span><br><span class="line"></span><br><span class="line"># Initialize a dictionary to store the results</span><br><span class="line">results = &#123;&quot;Agent wins&quot;: 0, &quot;Stockfish wins&quot;: 0, &quot;Draw&quot;: 0&#125;</span><br><span class="line"></span><br><span class="line"># Run the game n times</span><br><span class="line">for i in range(n_games):</span><br><span class="line">    # print(f&quot;Starting game &#123;i+1&#125;...&quot;)</span><br><span class="line">    result = play_game()</span><br><span class="line">    print(result)</span><br><span class="line"></span><br><span class="line">    # Update the results dictionary based on the outcome of the game</span><br><span class="line">    if &quot;Agent wins&quot; in result:</span><br><span class="line">        results[&quot;Agent wins&quot;] += 1</span><br><span class="line">    elif &quot;Stockfish wins&quot; in result:</span><br><span class="line">        results[&quot;Stockfish wins&quot;] += 1</span><br><span class="line">    else:</span><br><span class="line">        results[&quot;Draw&quot;] += 1</span><br><span class="line"></span><br><span class="line">    # print(f&quot;Game &#123;i+1&#125; finished.\n\n&quot;)</span><br><span class="line"></span><br><span class="line"># Print the final results</span><br><span class="line">print(&quot;Final results after playing&quot;, n_games, &quot;games:&quot;)</span><br><span class="line">print(&quot;Agent won:&quot;, results[&quot;Agent wins&quot;], &quot;games&quot;)</span><br><span class="line">print(&quot;Stockfish won:&quot;, results[&quot;Stockfish wins&quot;], &quot;games&quot;)</span><br><span class="line">print(&quot;Draw:&quot;, results[&quot;Draw&quot;], &quot;games&quot;)</span><br></pre></td></tr></table></figure>
<p>å¼€å§‹æ¯”èµ›ï¼š</p>
<p><img src="/../asset_chessopenai/01.png"></p>
<p><a href="/../asset_chessopenai/chess_record.txt">æ¯”èµ›è®°å½•æ–‡æœ¬</a></p>
<p>g1f3 e7e5 d2d4 e5d4 d1d4 g8f6 e2e4 b8c6 d4d3 d7d5 e4e5 f6e4 c1e3 f8e7 b1c3 e4c3 d3c3 c6e5 c3e5 f7f6 e5d4 e8g8 d4d2 c8f5 a1d1 f5e4 f3d4 e4g6 f1d3 f8f7 d3e2 d8d7 d4f3 d7e6 f3d4 e6e5 c2c4 e5e4 f2f3 e4f3 e2f3 e7d6 f3d5 d6f4 e3f4 g6d3 d2d3 g8h8 h1f1 f7f8 f4c7 f8g8 f1f3 g7g6 d4e6 g8g7 f3f6 g7g8 d3d4 g8g7 e1d2 g7f7 f6f7 h8g8 e6c5 a8f8 d4g7 &#x3D;&gt; Winner: Stockfish</p>
<p>åœ¨å°è¯•äº†å‡ ç§ç­–ç•¥ä¹‹åï¼Œæˆ‘å¾—å‡ºçš„ç»“è®ºæ˜¯ GPT-4 ä¸å¯èƒ½æˆä¸ºå›½é™…è±¡æ£‹ä¸­çš„ Stockfish å¼•æ“ã€‚</p>
<p>è¯¥å®éªŒæ­ç¤ºäº†å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li><p>ä¸“ä¸šåŒ–ä¸æ³›åŒ–ï¼š Stockfish åœ¨å›½é™…è±¡æ£‹æ–¹é¢çš„ä¸“ä¸šåŒ–ä½¿å…¶æ¯” GPT-4 ç­‰æ›´é€šç”¨çš„ AI æ¨¡å‹æ›´å…·ä¼˜åŠ¿ï¼Œè¿™å¼ºè°ƒäº†ç‰¹å®šäºä»»åŠ¡çš„ç¼–ç¨‹åœ¨æŸäº›é¢†åŸŸä»ç„¶å…·æœ‰æ˜¾ç€ä¼˜åŠ¿ã€‚</p>
</li>
<li><p>äººå·¥æ™ºèƒ½å­¦ä¹ å’Œé€‚åº”ï¼šåˆ©ç”¨è¿‡å»çš„æ¸¸æˆè¡¨ç°æ¥æŒ‡å¯¼æœªæ¥çš„å†³ç­–æ˜¯è¿ˆå‘æ›´å…·é€‚åº”æ€§çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿçš„ä¸€æ­¥ã€‚å°½ç®¡ GPT-4 æ²¡æœ‰è¶…è¶Š Stockfishï¼Œä½†ç»“åˆè¿‡å»ç»“æœçš„å­¦ä¹ æ–¹æ³•å¯¹äºèƒ½å¤Ÿéšç€æ—¶é—´çš„æ¨ç§»å­¦ä¹ å’Œè¿›åŒ–çš„ AI çš„å‘å±•è‡³å…³é‡è¦ã€‚</p>
</li>
<li><p>AIæ¨¡å‹ä¹‹é—´çš„åä½œï¼š GPT-4å’ŒLangChainçš„ç»“æ„åŒ–è¾“å‡ºçš„å®éªŒé¢„ç¤ºç€ä¸åŒAIæŠ€æœ¯ååŒå·¥ä½œä»¥è§£å†³å¤æ‚é—®é¢˜çš„æœªæ¥ã€‚å°†ä¸“ç”¨å¼•æ“ä¸é€šç”¨æ¨¡å‹é›†æˆå¯ä»¥äº§ç”Ÿåˆ©ç”¨ä¸¤ç§æ–¹æ³•ä¼˜åŠ¿çš„åˆ›æ–°è§£å†³æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://medium.com/ai-advances/can-gpt-4-beat-the-stockfish-engine-lets-use-langchain-to-find-out-0b25133ed563">https://medium.com/ai-advances/can-gpt-4-beat-the-stockfish-engine-lets-use-langchain-to-find-out-0b25133ed563</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/03/AirLLM-on-4G/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/03/AirLLM-on-4G/" class="post-title-link" itemprop="url">å¦‚ä½•åœ¨å•ä¸ª 4GB GPU ä¸Šè¿è¡Œ 70B LLM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-03 11:26:28 / ä¿®æ”¹æ—¶é—´ï¼š21:26:28" itemprop="dateCreated datePublished" datetime="2024-04-03T11:26:28+08:00">2024-04-03</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>4 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æ‚¨æ˜¯å¦æ›¾ç»æ¢¦æƒ³è¿‡ä½¿ç”¨æœ€å…ˆè¿›çš„å¤§å‹è¯­è¨€æ¨¡å‹ ï¼ˆLLMï¼‰ æ¥å®Œæˆæ‚¨çš„è‡ªç„¶è¯­è¨€å¤„ç† ï¼ˆNLPï¼‰ ä»»åŠ¡ï¼Œä½†å¯¹é«˜å†…å­˜è¦æ±‚æ„Ÿåˆ°æ²®ä¸§ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨å¯èƒ½ä¼šå¯¹ AirLLM æ„Ÿå…´è¶£ï¼Œè¿™æ˜¯ä¸€ä¸ªä¼˜åŒ–æ¨ç†å†…å­˜ä½¿ç”¨çš„ Python åŒ…ï¼Œå…è®¸ 70B LLM åœ¨å•ä¸ª 4GB GPU å¡ä¸Šè¿è¡Œæ¨ç†ã€‚ä¸éœ€è¦é‡åŒ–ã€è’¸é¦ã€ä¿®å‰ªæˆ–å…¶ä»–ä¼šå¯¼è‡´æ¨¡å‹æ€§èƒ½ä¸‹é™çš„æ¨¡å‹å‹ç¼©æŠ€æœ¯ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-AirLLM"><a href="#ä»€ä¹ˆæ˜¯-AirLLM" class="headerlink" title="ä»€ä¹ˆæ˜¯ AirLLM"></a>ä»€ä¹ˆæ˜¯ AirLLM</h2><p>å¤§å‹è¯­è¨€æ¨¡å‹ ï¼ˆLLMï¼‰ çš„è®¡ç®—æˆæœ¬å¾ˆé«˜ï¼Œå¹¶ä¸”éœ€è¦å¤§é‡å†…å­˜æ¥è®­ç»ƒå’Œè¿è¡Œã€‚è¿™æ ·åšçš„åŸå› æ˜¯ LLM æœ‰å¤§é‡çš„å±‚â€”â€”ä¸€ä¸ª 70B æ¨¡å‹å¯ä»¥æœ‰ 80 å¤šä¸ªå±‚ã€‚ä½†æ˜¯ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œè¯­è¨€æ¨¡å‹ä¸­çš„æ¯ä¸€å±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”ä»…ä¾èµ–äºå‰ä¸€å±‚çš„è¾“å‡ºã€‚å› æ­¤ï¼Œæ²¡æœ‰å¿…è¦å°†æ‰€æœ‰å±‚éƒ½ä¿ç•™åœ¨ GPU å†…å­˜ä¸­ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰§è¡Œè¯¥å±‚æ—¶ä»…ä»ç£ç›˜åŠ è½½å¿…è¦çš„å±‚ï¼Œæ‰§è¡Œæ‰€æœ‰è®¡ç®—ï¼Œç„¶åå®Œå…¨é‡Šæ”¾å†…å­˜ã€‚è¿™æ ·ï¼Œå•å±‚æ‰€éœ€çš„ GPU å†…å­˜ä»…ä¸è¯¥transformer å±‚çš„å‚æ•°å¤§å°å·®ä¸å¤šï¼Œå³å®Œæ•´å‹å·çš„ 1&#x2F;80ï¼Œå³ ~2GBã€‚</p>
<p>AirLLM èƒŒåçš„ä¸»è¦æ€æƒ³ç¡®å®æ˜¯å°†åŸå§‹ LLM æ‹†åˆ†ä¸ºæ›´å°çš„å­æ¨¡å‹ï¼Œæ¯ä¸ªå­æ¨¡å‹åŒ…å«ä¸€ä¸ªæˆ–å‡ ä¸ªå±‚ï¼Œå¹¶åœ¨æ¨ç†è¿‡ç¨‹ä¸­æŒ‰éœ€åŠ è½½å®ƒä»¬ã€‚è¿™æ ·ï¼Œåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œåªæœ‰å¿…è¦çš„å­æ¨¡å‹ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå…¶ä½™çš„éƒ½å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å®ƒè¿˜åº”ç”¨å—å¼é‡åŒ–æ¥è¿›ä¸€æ­¥å‹ç¼©å­æ¨¡å‹ï¼Œä»è€Œå‡å°‘ç£ç›˜åŠ è½½æ—¶é—´å’Œå†…å­˜ä½¿ç”¨é‡ã€‚</p>
<p>AirLLM æ”¯æŒ Hugging Face open LLM æ’è¡Œæ¦œä¸­çš„å¤§å¤šæ•°é¡¶çº§å‹å·ï¼Œä¾‹å¦‚ Platypus2ã€LLaMa2ã€Mistralã€Mixtralã€SOLARã€StellarBright ç­‰ã€‚</p>
<h2 id="å¦‚ä½•ä½¿ç”¨AirLLM"><a href="#å¦‚ä½•ä½¿ç”¨AirLLM" class="headerlink" title="å¦‚ä½•ä½¿ç”¨AirLLM"></a>å¦‚ä½•ä½¿ç”¨AirLLM</h2><p>ä½¿ç”¨ AirLLM éå¸¸ç®€å•ç›´è§‚ã€‚ä½ åªéœ€è¦å®‰è£… airllm pip åŒ…ï¼Œç„¶åä½¿ç”¨ AutoModel ç±»ä» Hugging Face ä¸­å¿ƒæˆ–æœ¬åœ°è·¯å¾„åŠ è½½ä½ é€‰æ‹©çš„ LLMã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ generate æ–¹æ³•æ‰§è¡Œç±»ä¼¼äºå¸¸è§„ transformer æ¨¡å‹çš„æ¨ç†ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç‰‡æ®µæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ AirLLM åŠ è½½å’Œä½¿ç”¨ Platypus2â€“70B-instruct æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å¯ä»¥å›ç­”è‡ªç„¶è¯­è¨€é—®é¢˜å¹¶éµå¾ªè¯´æ˜ã€‚</p>
<p>pip install airllm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">from airllm import AutoModel</span><br><span class="line"></span><br><span class="line">MAX_LENGTH = 128</span><br><span class="line"></span><br><span class="line"># load the model from the Hugging Face hub</span><br><span class="line">model = AutoModel.from_pretrained(&quot;garage-bAInd/Platypus2-70B-instruct&quot;)</span><br><span class="line"></span><br><span class="line"># or load the model from a local path</span><br><span class="line"># model = AutoModel.from_pretrained(&quot;/home/ubuntu/.cache/huggingface/hub/models--garage-bAInd--Platypus2-70B-instruct/snapshots/b585e74bcaae02e52665d9ac6d23f4d0dbc81a0f&quot;)</span><br><span class="line"></span><br><span class="line"># prepare the input text</span><br><span class="line">input_text = [</span><br><span class="line">    &#x27;What is the capital of United States?&#x27;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># tokenize the input text</span><br><span class="line">input_tokens = model.tokenizer(input_text,</span><br><span class="line">    return_tensors=&quot;pt&quot;,</span><br><span class="line">    return_attention_mask=False,</span><br><span class="line">    truncation=True,</span><br><span class="line">    max_length=MAX_LENGTH,</span><br><span class="line">    padding=False)</span><br><span class="line"></span><br><span class="line"># generate the output text</span><br><span class="line">generation_output = model.generate(</span><br><span class="line">    input_tokens[&#x27;input_ids&#x27;].cuda(),</span><br><span class="line">    max_new_tokens=20,</span><br><span class="line">    use_cache=True,</span><br><span class="line">    return_dict_in_generate=True)</span><br><span class="line"></span><br><span class="line"># decode the output text</span><br><span class="line">output = model.tokenizer.decode(generation_output.sequences[0])</span><br><span class="line"></span><br><span class="line"># print the output text</span><br><span class="line">print(output)</span><br></pre></td></tr></table></figure>
<p>æ­¤ä»£ç ç‰‡æ®µçš„è¾“å‡ºä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">What is the capital of United States?</span><br><span class="line">The capital of the United States is Washington, D.C.</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ¨ç†ä¸­ï¼ŒAirLLM å°†é€å±‚åˆ†è§£å¹¶ä¿å­˜åŸå§‹ LLMï¼Œå› æ­¤è¯·ç¡®ä¿æ‚¨æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ã€‚ä¹‹åï¼ŒAirLLM å°†æŒ‰éœ€åŠ è½½å­æ¨¡å‹ï¼Œå¹¶ä»¥æ›´å¿«çš„é€Ÿåº¦å’Œæ›´å°‘çš„å†…å­˜æ‰§è¡Œæ¨ç†ã€‚</p>
<h2 id="ä½¿ç”¨-AirLLM-æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#ä½¿ç”¨-AirLLM-æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="ä½¿ç”¨ AirLLM æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>ä½¿ç”¨ AirLLM æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h2><p>é€šè¿‡ä½¿ç”¨ AirLLMï¼Œæ‚¨å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li>è®¿é—®æœ€å…ˆè¿›çš„ LLMï¼šæ‚¨å¯ä»¥å°†æœ€å…ˆè¿›çš„ LLM ç”¨äºæ‚¨çš„ NLP ä»»åŠ¡ï¼Œä¾‹å¦‚é—®ç­”ã€æ–‡æœ¬ç”Ÿæˆã€æ–‡æœ¬æ‘˜è¦ã€æ–‡æœ¬åˆ†ç±»ç­‰ã€‚æ‚¨å¯ä»¥ä»å„ç§é€‚åˆæ‚¨çš„éœ€æ±‚å’Œåå¥½çš„æ¨¡å‹ä¸­è¿›è¡Œé€‰æ‹©ï¼Œä¾‹å¦‚ç‰¹å®šäºåŸŸçš„æ¨¡å‹ã€å¤šè¯­è¨€æ¨¡å‹æˆ–æŒ‡ä»¤ä¼˜åŒ–æ¨¡å‹ã€‚</li>
<li>ä½å†…å­˜è¦æ±‚ï¼šæ— éœ€æ‹…å¿ƒå†…å­˜ä¸è¶³é”™è¯¯æˆ–æ˜‚è´µçš„äº‘è®¡ç®—èµ„æºã€‚æ‚¨å¯ä»¥åœ¨å•ä¸ª 4GB GPU å¡ä¸Šè¿è¡Œæ¨ç†ï¼Œç”šè‡³å¯ä»¥åœ¨ CPU æˆ– Mac è®¾å¤‡ä¸Šè¿è¡Œæ¨ç†ã€‚</li>
<li>ç®€å•ç›´è§‚çš„ä½¿ç”¨ï¼šæ‚¨å¯ä»¥ä½¿ç”¨ AirLLM ä½œä¸ºå¸¸è§„ transformer å‹å·çš„ç›´æ¥æ›¿ä»£å“ï¼Œåªéœ€æœ€å°‘çš„ä»£ç æ›´æ”¹ã€‚</li>
</ul>
<h2 id="ä½¿ç”¨-AirLLM-çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ä½¿ç”¨-AirLLM-çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ä½¿ç”¨ AirLLM çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ä½¿ç”¨ AirLLM çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å¦‚å‰æ‰€è¿°ï¼ŒAirLLM åœ¨æ‰§è¡Œè¯¥å±‚æ—¶ä»…ä»ç£ç›˜åŠ è½½å¿…è¦çš„å±‚ï¼Œç„¶åå®Œå…¨é‡Šæ”¾å†…å­˜ã€‚ä½†æ˜¯ï¼Œä»é€Ÿåº¦è¾ƒæ…¢çš„å­˜å‚¨ï¼ˆå¦‚ç£ç›˜ I&#x2F;Oï¼‰æŒ‰é¡ºåºåŠ è½½æ•°æ®ä¼šå¢åŠ æ¨ç†è¿‡ç¨‹çš„å»¶è¿Ÿã€‚å¦‚æœ SSD çš„è¯»æ•°ä¸º 4GB&#x2F;sï¼Œè€Œå‹å·çš„è¯»æ•°ä¸º 80Gbï¼Œåˆ™æ‚¨å°†ç­‰å¾… 20 ç§’æ‰èƒ½ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼Œå¹¶ä¸”å¯¹äºæ¯ä¸ªä»¤ç‰Œï¼Œæ‚¨éœ€è¦å®Œå…¨é€šè¿‡ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://generativeai.pub/how-to-run-70b-llms-on-a-single-4gb-gpu-d1c61ed5258c">https://generativeai.pub/how-to-run-70b-llms-on-a-single-4gb-gpu-d1c61ed5258c</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/04/02/scratch-ai-agent-openai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | åµŒå…¥å¼è€å…µåšå®¢">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/02/scratch-ai-agent-openai/" class="post-title-link" itemprop="url">åˆ©ç”¨ OpenAI å·¥å…·ï¼šä»é›¶å¼€å§‹æ„å»ºå¯é çš„ AI ä»£ç†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-04-02 20:26:28" itemprop="dateCreated datePublished" datetime="2024-04-02T20:26:28+08:00">2024-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-04-03 21:26:28" itemprop="dateModified" datetime="2024-04-03T21:26:28+08:00">2024-04-03</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="æœ¬æ–‡å­—æ•°">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">æœ¬æ–‡å­—æ•°ï¼š</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>32 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>æ€è€ƒäººå·¥æ™ºèƒ½çš„æœªæ¥ï¼Œæˆ‘è„‘æµ·ä¸­æµ®ç°å‡ºã€Šé’¢é“ä¾ ã€‹ä¸­çš„è´¾ç»´æ–¯å’Œã€Šå‘½è¿ã€‹ï¼ˆæ¸¸æˆï¼‰ä¸­çš„æ‹‰æ–¯æ™®äº¬ã€‚åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œäººå·¥æ™ºèƒ½å……å½“äº†ä¸€ä¸ªé€šè¿‡è¯­éŸ³æ§åˆ¶çš„æ¥å£ï¼Œæä¾›é«˜çº§æŠ½è±¡çš„å¤æ‚ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œæ‰˜å°¼Â·æ–¯å¡”å…‹ä½¿ç”¨å®ƒæ¥ç®¡ç†ä»–çš„ç ”ç©¶ã€è¿›è¡Œè®¡ç®—å’Œè¿è¡Œæ¨¡æ‹Ÿã€‚ç”šè‡³ R2D2 ä¹Ÿå¯ä»¥å“åº”è¯­éŸ³å‘½ä»¤ï¼Œä¸é™Œç”Ÿçš„è®¡ç®—æœºç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œæå–æ•°æ®æˆ–ä¸å»ºç­‘ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚</p>
<p>åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œäººå·¥æ™ºèƒ½ä½¿å¾—ç”¨æˆ·å¯ä»¥ä¸å¤æ‚ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè€Œæ— éœ€å¯¹å…¶æœ‰æ·±å…¥çš„ç†è§£ã€‚è¿™å¯ä»¥ç±»æ¯”ä»Šå¤©å¤§å‹å…¬å¸ä¸­çš„ä¼ä¸šèµ„æºè®¡åˆ’ï¼ˆERPï¼‰ç³»ç»Ÿã€‚åœ¨å¤§å‹å…¬å¸ä¸­å¾ˆå°‘æœ‰äººå®Œå…¨äº†è§£å’Œç†è§£å†…éƒ¨ ERP ç³»ç»Ÿçš„æ¯ä¸ªæ–¹é¢ã€‚ä¸éš¾æƒ³è±¡ï¼Œåœ¨ä¸ä¹…çš„å°†æ¥ï¼Œäººå·¥æ™ºèƒ½å¯èƒ½å‡ ä¹ä¼šåœ¨ä¸ ERP ç³»ç»Ÿçš„æ¯ä¸ªäº¤äº’ä¸­æä¾›å¸®åŠ©ã€‚ä»æœ€ç»ˆç”¨æˆ·ç®¡ç†å®¢æˆ·æ•°æ®æˆ–è®°å½•è®¢å•ï¼Œåˆ°è½¯ä»¶å¼€å‘äººå‘˜ä¿®å¤é”™è¯¯æˆ–å®æ–½æ–°åŠŸèƒ½ï¼Œè¿™äº›äº¤äº’å¯èƒ½å¾ˆå¿«å°±ä¼šç”±ç†Ÿæ‚‰ ERP ç³»ç»Ÿçš„äººå·¥æ™ºèƒ½åŠ©æ‰‹æ¥å®Œæˆã€‚è¿™æ ·çš„äººå·¥æ™ºèƒ½åŠ©æ‰‹å°†çŸ¥é“å°†å®¢æˆ·æ•°æ®è¾“å…¥å“ªä¸ªæ•°æ®åº“ï¼Œä»¥åŠå“ªäº›æµç¨‹å’Œä»£ç å¯èƒ½ä¸é”™è¯¯ç›¸å…³ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬é¢ä¸´ç€å‡ ä¸ªæŒ‘æˆ˜å’Œåˆ›æ–°ã€‚æˆ‘ä»¬éœ€è¦é‡æ–°æ€è€ƒæµç¨‹åŠå…¶æ–‡æ¡£åŒ–ã€‚å¦‚ä»Šçš„ä¼ä¸šèµ„æºè®¡åˆ’ï¼ˆERPï¼‰æµç¨‹æ˜¯ä¸ºäººç±»ä½¿ç”¨è€Œè®¾è®¡çš„ï¼Œä¸åŒç”¨æˆ·æœ‰ä¸åŒçš„è§’è‰²ï¼Œæ–‡æ¡£æ˜¯ç»™äººç±»çœ‹çš„ï¼Œè¾“å…¥æ©ç æ˜¯ä¸ºäººç±»è®¾è®¡çš„ï¼Œç”¨æˆ·äº¤äº’æ—¨åœ¨ç›´è§‚ä¸”æ— è¯¯ã€‚å¯¹äºäººå·¥æ™ºèƒ½ï¼ˆAIï¼‰äº¤äº’ï¼Œè¿™äº›æ–¹é¢çš„è®¾è®¡å°†ä¼šæœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬éœ€è¦ä¸º AI äº¤äº’è®¾å®šç‰¹å®šçš„è§’è‰²ï¼Œå¹¶è®¾è®¡ä¸åŒçš„æµç¨‹ï¼Œä»¥å®ç°ç›´è§‚ä¸”æ— è¯¯çš„ AI äº¤äº’ã€‚è¿™åœ¨æˆ‘ä»¬ä¸æç¤ºä¿¡æ¯çš„å·¥ä½œä¸­å·²ç»æ˜¾ç°å‡ºæ¥ã€‚æˆ‘ä»¬è®¤ä¸ºçš„æ˜ç¡®ä»»åŠ¡å¾€å¾€å¹¶ä¸é‚£ä¹ˆç®€å•æ˜äº†ã€‚</p>
<h2 id="ä»æ¦‚å¿µåˆ°ç°å®ï¼šæ„å»º-AI-ä»£ç†çš„åŸºç¡€"><a href="#ä»æ¦‚å¿µåˆ°ç°å®ï¼šæ„å»º-AI-ä»£ç†çš„åŸºç¡€" class="headerlink" title="ä»æ¦‚å¿µåˆ°ç°å®ï¼šæ„å»º AI ä»£ç†çš„åŸºç¡€"></a>ä»æ¦‚å¿µåˆ°ç°å®ï¼šæ„å»º AI ä»£ç†çš„åŸºç¡€</h2><p>è®©æˆ‘ä»¬å›åˆ°ä»£ç†çš„æ¦‚å¿µã€‚ä»£ç†æ˜¯èƒ½å¤Ÿä½¿ç”¨æä¾›çš„å·¥å…·æ‰§è¡Œä»»åŠ¡å¹¶å†³ç­–å¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·çš„äººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œå®ƒä»¬æ˜¯æœ€ç»ˆå¯èƒ½å®ç°è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„æ„å»ºæ¨¡å—ã€‚å®ƒä»¬æ˜¯æˆ‘ä»¬å¸Œæœ›å°†å…¶æ•´åˆåˆ°å¤æ‚ç³»ç»Ÿçš„å„ä¸ªæ–¹é¢çš„è¿‡ç¨‹ç»„ä»¶ã€‚ä½†æ˜¯å®ƒä»¬å¾ˆéš¾å¯é åœ°éƒ¨ç½²ï¼ˆä¹‹å‰åœ¨internlmå®è·µlagentå°±ä¸æˆåŠŸï¼‰ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†æ¼”ç¤ºå¦‚ä½•è®¾è®¡å’Œä¼˜åŒ–ä¸€ä¸ªèƒ½å¤Ÿå¯é åœ°ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„ä»£ç†ã€‚</p>
<p>AI çš„æœªæ¥å®ä¼Ÿæ„¿æ™¯ä»¤äººé¼“èˆï¼Œä½†å®ç°è¿™ä¸€æ„¿æ™¯éœ€è¦é‡‡å–åˆ‡å®å¯è¡Œçš„æ­¥éª¤ã€‚ä¸ºäº†å±•ç¤ºæˆ‘ä»¬å¦‚ä½•å¼€å§‹æ„å»ºè¿™ç§å…ˆè¿› AI ç³»ç»Ÿçš„åŸºç¡€ï¼Œè®©æˆ‘ä»¬ä¸“æ³¨äºåˆ›å»ºä¸€ä¸ªå¸¸è§ä»»åŠ¡çš„åŸå‹ä»£ç†ï¼šâ€œè´¹ç”¨è·Ÿè¸ªâ€ã€‚è¿™ä¸ªåŸå‹å°†ä½œä¸ºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œå±•ç¤º AI å¦‚ä½•åœ¨é«˜æ•ˆç®¡ç†è´¢åŠ¡äº¤æ˜“æ–¹é¢æä¾›å¸®åŠ©ï¼Œå±•ç¤º AI åœ¨è‡ªåŠ¨åŒ–ä¾‹è¡Œä»»åŠ¡æ–¹é¢çš„æ½œåŠ›ï¼Œå¹¶çªå‡ºè®¾è®¡ä¸æ•°æ®åº“æ— ç¼äº¤äº’çš„ AI ç³»ç»Ÿæ‰€æ¶‰åŠçš„æŒ‘æˆ˜å’Œè€ƒè™‘å› ç´ ã€‚é€šè¿‡ä»ä¸€ä¸ªå…·ä½“è€Œæ˜“äºç†è§£çš„ç”¨ä¾‹å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—å®è´µçš„è§è§£ï¼Œä¸ºæœªæ¥æ›´å¤æ‚çš„ AI ä»£ç†çš„å¼€å‘æä¾›æŒ‡å¯¼ã€‚</p>
<h2 id="æœ¬æ–‡ç›®çš„"><a href="#æœ¬æ–‡ç›®çš„" class="headerlink" title="æœ¬æ–‡ç›®çš„"></a>æœ¬æ–‡ç›®çš„</h2><p>æœ¬æ–‡å°†ä¸ºä¸€ç³»åˆ—æ–‡ç« å¥ å®šåŸºç¡€ï¼Œæ—¨åœ¨å¼€å‘ä¸€ä¸ªèŠå¤©æœºå™¨äººï¼Œå®ƒå¯ä»¥ä½œä¸ºå°å‹ä¼ä¸šæ”¯æŒå’Œæ‰§è¡Œä¸šåŠ¡æµç¨‹çš„å”¯ä¸€äº¤äº’ç‚¹ï¼Œæˆ–è€…ä½œä¸ºä½ ä¸ªäººç”Ÿæ´»ä¸­ç»„ç»‡ä¸€åˆ‡éœ€è¦è·Ÿè¸ªçš„ä¸œè¥¿çš„èŠå¤©æœºå™¨äººã€‚ä»æ•°æ®ã€ä¾‹è¡Œäº‹åŠ¡ã€æ–‡ä»¶åˆ°å›¾ç‰‡ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç®€å•åœ°ä¸æˆ‘ä»¬çš„åŠ©æ‰‹èŠå¤©ï¼Œè®©å®ƒæ‰¾å‡ºå­˜å‚¨å’Œæ£€ç´¢æ•°æ®çš„ä½ç½®ã€‚</p>
<p>ä» AI æœªæ¥çš„å®ä¼Ÿæ„¿æ™¯è¿‡æ¸¡åˆ°å®é™…åº”ç”¨ï¼Œè®©æˆ‘ä»¬èšç„¦äºåˆ›å»ºä¸€ä¸ªåŸå‹ä»£ç†ã€‚è¿™ä¸ªä»£ç†å°†ä½œä¸ºå®ç°ä¹‹å‰è®¨è®ºçš„é›„å¿ƒå‹ƒå‹ƒçš„ç›®æ ‡çš„åŸºç¡€æ­¥éª¤ã€‚æˆ‘ä»¬å°†ç€æ‰‹å¼€å‘ä¸€ä¸ªâ€œè´¹ç”¨è·Ÿè¸ªâ€ä»£ç†ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•ä½†è‡³å…³é‡è¦çš„ä»»åŠ¡ï¼Œå±•ç¤ºäº† AI å¦‚ä½•èƒ½å¤Ÿæœ‰æ•ˆåœ°ååŠ©ç®¡ç†è´¢åŠ¡äº¤æ˜“ã€‚</p>
<p>è¿™ä¸ªâ€œè´¹ç”¨è·Ÿè¸ªâ€åŸå‹ä¸ä»…å±•ç¤ºäº†äººå·¥æ™ºèƒ½åœ¨è‡ªåŠ¨åŒ–ä¾‹è¡Œä»»åŠ¡æ–¹é¢çš„æ½œåŠ›ï¼Œè¿˜é˜æ˜äº†è®¾è®¡ä¸æ•°æ®åº“æ— ç¼äº¤äº’çš„äººå·¥æ™ºèƒ½ç³»ç»Ÿæ‰€æ¶‰åŠçš„æŒ‘æˆ˜å’Œè€ƒè™‘å› ç´ ã€‚é€šè¿‡ä¸“æ³¨äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æ¢ç´¢ä»£ç†è®¾è®¡ã€è¾“å…¥éªŒè¯ä»¥åŠå°†äººå·¥æ™ºèƒ½ä¸ç°æœ‰ç³»ç»Ÿæ•´åˆçš„å¤æ‚æ€§ï¼Œä¸ºæœªæ¥æ›´å¤æ‚çš„åº”ç”¨å¥ å®šåšå®åŸºç¡€ã€‚</p>
<h2 id="å®è·µï¼šæµ‹è¯•-OpenAI-å·¥å…·è°ƒç”¨"><a href="#å®è·µï¼šæµ‹è¯•-OpenAI-å·¥å…·è°ƒç”¨" class="headerlink" title="å®è·µï¼šæµ‹è¯• OpenAI å·¥å…·è°ƒç”¨"></a>å®è·µï¼šæµ‹è¯• OpenAI å·¥å…·è°ƒç”¨</h2><p>ä¸ºäº†è®©æˆ‘ä»¬çš„åŸå‹ä»£ç†ç¨‹åºè¿è¡Œèµ·æ¥å¹¶æ‰¾å‡ºæ½œåœ¨çš„ç“¶é¢ˆï¼Œæˆ‘ä»¬å°è¯•æµ‹è¯• OpenAI çš„å·¥å…·è°ƒç”¨åŠŸèƒ½ã€‚ä»ä¸€ä¸ªåŸºæœ¬çš„è´¹ç”¨è·Ÿè¸ªç¤ºä¾‹å¼€å§‹ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªæ¨¡æ‹ŸçœŸå®åº”ç”¨ç¨‹åºçš„åŸºç¡€éƒ¨åˆ†ã€‚è¿™ä¸ªé˜¶æ®µæ¶‰åŠåˆ›å»ºä¸€ä¸ªåŸºæœ¬æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨ langchain åº“çš„convert_to_openai_toolå‡½æ•°å°†å…¶è½¬æ¢ä¸º OpenAI å·¥å…·æ¨¡å¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åˆ¶ä½œä¸€ä¸ª report_tool ï¼Œä»¥ä¾¿æˆ‘ä»¬æœªæ¥çš„ä»£ç†ç¨‹åºå¯ä»¥ä¸ç»“æœè¿›è¡Œé€šä¿¡ï¼Œæˆ–è€…çªå‡ºæ˜¾ç¤ºç¼ºå¤±çš„ä¿¡æ¯æˆ–é—®é¢˜ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from pydantic.v1 import BaseModel, validator  </span><br><span class="line">from datetime import datetime</span><br><span class="line">from langchain_core.utils.function_calling import convert_to_openai_tool</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">class Expense(BaseModel):    </span><br><span class="line">   description: str    </span><br><span class="line">   net_amount: float    </span><br><span class="line">   gross_amount: float    </span><br><span class="line">   tax_rate: float    </span><br><span class="line">   date: datetime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Report(BaseModel):</span><br><span class="line">   report: str</span><br><span class="line"></span><br><span class="line">add_expense_tool = convert_to_openai_tool(Expense)</span><br><span class="line">report_tool = convert_to_openai_tool(Report)</span><br></pre></td></tr></table></figure>

<p>æ•°æ®æ¨¡å‹å’Œå·¥å…·è®¾ç½®å¥½ä¹‹åï¼Œä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨ OpenAI å®¢æˆ·ç«¯ SDK å‘èµ·ä¸€ä¸ªç®€å•çš„å·¥å…·è°ƒç”¨ã€‚åœ¨è¿™ä¸ªåˆå§‹æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ•…æ„æä¾›ä¸è¶³çš„ä¿¡æ¯ç»™æ¨¡å‹ï¼Œä»¥æŸ¥çœ‹å®ƒæ˜¯å¦èƒ½æ­£ç¡®åœ°æŒ‡ç¤ºç¼ºå¤±çš„å†…å®¹ã€‚è¿™ç§æ–¹æ³•ä¸ä»…æµ‹è¯•äº†ä»£ç†çš„åŠŸèƒ½èƒ½åŠ›ï¼Œè¿˜æµ‹è¯•äº†å®ƒçš„äº¤äº’å’Œé”™è¯¯å¤„ç†èƒ½åŠ›ã€‚</p>
<h3 id="è°ƒç”¨-OpenAI-API"><a href="#è°ƒç”¨-OpenAI-API" class="headerlink" title="è°ƒç”¨ OpenAI API"></a>è°ƒç”¨ OpenAI API</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ OpenAI å®¢æˆ·ç«¯ SDK æ¥å‘èµ·ä¸€ä¸ªç®€å•çš„å·¥å…·è°ƒç”¨ã€‚åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ•…æ„æä¾›äº†ä¸è¶³çš„ä¿¡æ¯ç»™æ¨¡å‹ï¼Œä»¥æŸ¥çœ‹å®ƒæ˜¯å¦èƒ½å¤Ÿé€šçŸ¥æˆ‘ä»¬ç¼ºå¤±çš„ç»†èŠ‚ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">from openai import OpenAI  </span><br><span class="line">from langchain_core.utils.function_calling import convert_to_openai_tool  </span><br><span class="line">  </span><br><span class="line">SYSTEM_MESSAGE = &quot;&quot;&quot;You are tasked with completing specific objectives and </span><br><span class="line">must report the outcomes. At your disposal, you have a variety of tools, </span><br><span class="line">each specialized in performing a distinct type of task.  </span><br><span class="line">  </span><br><span class="line">For successful task completion:  </span><br><span class="line">Thought: Consider the task at hand and determine which tool is best suited </span><br><span class="line">based on its capabilities and the nature of the work.  </span><br><span class="line">  </span><br><span class="line">Use the report_tool with an instruction detailing the results of your work.  </span><br><span class="line">If you encounter an issue and cannot complete the task:  </span><br><span class="line">  </span><br><span class="line">Use the report_tool to communicate the challenge or reason for the </span><br><span class="line">task&#x27;s incompletion.  </span><br><span class="line">You will receive feedback based on the outcomes of </span><br><span class="line">each tool&#x27;s task execution or explanations for any tasks that </span><br><span class="line">couldn&#x27;t be completed. This feedback loop is crucial for addressing </span><br><span class="line">and resolving any issues by strategically deploying the available tools.  </span><br><span class="line">&quot;&quot;&quot;  </span><br><span class="line">user_message = &quot;I have spend 5$ on a coffee today please track my expense. The tax rate is 0.2.&quot;</span><br><span class="line">  </span><br><span class="line">client = OpenAI()  </span><br><span class="line">model_name = &quot;gpt-3.5-turbo-0125&quot;  </span><br><span class="line">  </span><br><span class="line">messages = [  </span><br><span class="line">    &#123;&quot;role&quot;:&quot;system&quot;, &quot;content&quot;: SYSTEM_MESSAGE&#125;,  </span><br><span class="line">    &#123;&quot;role&quot;:&quot;user&quot;, &quot;content&quot;: user_message&#125;  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">response = client.chat.completions.create(  </span><br><span class="line">            model=model_name,  </span><br><span class="line">            messages=messages,  </span><br><span class="line">            tools=[  </span><br><span class="line">                convert_to_openai_tool(Expense),  </span><br><span class="line">                convert_to_openai_tool(ReportTool)]  </span><br><span class="line">        )</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥ä»å“åº”ä¸­è¯»å–å‡½æ•°è°ƒç”¨çš„å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def parse_function_args(response):</span><br><span class="line">    message = response.choices[0].message</span><br><span class="line">    return json.loads(message.tool_calls[0].function.arguments)</span><br><span class="line"></span><br><span class="line">print(parse_function_args(response))</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;description&#x27;: &#x27;Coffee&#x27;,</span><br><span class="line"> &#x27;net_amount&#x27;: 5,</span><br><span class="line"> &#x27;gross_amount&#x27;: None,</span><br><span class="line"> &#x27;tax_rate&#x27;: 0.2,</span><br><span class="line"> &#x27;date&#x27;: &#x27;2023-10-06T12:00:00Z&#x27;&#125;</span><br></pre></td></tr></table></figure>
<p> æ­£å¦‚æˆ‘ä»¬æ‰€è§‚å¯Ÿåˆ°çš„ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°äº†å‡ ä¸ªé—®é¢˜</p>
<ul>
<li><p>The gross_amount is not calculated.  æ€»é‡‘é¢æœªè®¡ç®—ã€‚</p>
</li>
<li><p>The date is hallucinated.  æ—¥æœŸæ˜¯å¹»è§‰ã€‚</p>
</li>
</ul>
<p>è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬å°è¯•è§£å†³è¿™äº›é—®é¢˜å¹¶ä¼˜åŒ–æˆ‘ä»¬çš„ä»£ç†å·¥ä½œæµç¨‹ã€‚</p>
<h2 id="ä¼˜åŒ–ï¼šå·¥å…·å¤„ç†æµç¨‹"><a href="#ä¼˜åŒ–ï¼šå·¥å…·å¤„ç†æµç¨‹" class="headerlink" title="ä¼˜åŒ–ï¼šå·¥å…·å¤„ç†æµç¨‹"></a>ä¼˜åŒ–ï¼šå·¥å…·å¤„ç†æµç¨‹</h2><p>ä¸ºäº†ä¼˜åŒ–ä»£ç†å·¥ä½œæµç¨‹ï¼Œæˆ‘å‘ç°å°†å·¥ä½œæµç¨‹ç½®äºæç¤ºå·¥ç¨‹ä¹‹ä¸Šè‡³å…³é‡è¦ã€‚è™½ç„¶å¾®è°ƒæç¤ºä»¥ä½¿ä»£ç†å­¦ä¼šå®Œç¾ä½¿ç”¨æä¾›çš„å·¥å…·å¹¶é¿å…é”™è¯¯å¯èƒ½å¾ˆè¯±äººï¼Œä½†æ›´æ˜æ™ºçš„åšæ³•æ˜¯é¦–å…ˆè°ƒæ•´å·¥å…·å’Œæµç¨‹ã€‚å½“å‘ç”Ÿå…¸å‹é”™è¯¯æ—¶ï¼Œæœ€åˆçš„è€ƒè™‘åº”è¯¥æ˜¯å¦‚ä½•åŸºäºä»£ç ä¿®å¤å®ƒã€‚</p>
<h3 id="å¤„ç†ç¼ºå¤±ä¿¡æ¯"><a href="#å¤„ç†ç¼ºå¤±ä¿¡æ¯" class="headerlink" title="å¤„ç†ç¼ºå¤±ä¿¡æ¯"></a>å¤„ç†ç¼ºå¤±ä¿¡æ¯</h3><p>å¤„ç†ç¼ºå¤±ä¿¡æ¯å¯¹äºåˆ›å»ºå¼ºå¤§å¯é çš„ä»£ç†ç¨‹åºæ¥è¯´æ˜¯ä¸€ä¸ªé‡è¦çš„è¯¾é¢˜ã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œä¸ºä»£ç†ç¨‹åºæä¾›åƒâ€œget_current_dateâ€è¿™æ ·çš„å·¥å…·æ˜¯ç‰¹å®šåœºæ™¯ä¸‹çš„ä¸€ç§è§£å†³æ–¹æ³•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¿…é¡»å‡è®¾åœ¨å„ç§æƒ…å¢ƒä¸­éƒ½ä¼šå‡ºç°ç¼ºå¤±ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸èƒ½ä»…ä»…ä¾é æç¤ºå·¥ç¨‹å’Œæ·»åŠ æ›´å¤šå·¥å…·æ¥é˜²æ­¢æ¨¡å‹äº§ç”Ÿç¼ºå¤±ä¿¡æ¯çš„å¹»è§‰ã€‚</p>
<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹å·¥å…·æ¨¡å¼ï¼Œå°†æ‰€æœ‰å‚æ•°è§†ä¸ºå¯é€‰ã€‚è¿™ç§æ–¹æ³•ç¡®ä¿ä»£ç†åªæäº¤å®ƒçŸ¥é“çš„å‚æ•°ï¼Œé¿å…ä¸å¿…è¦çš„å¹»è§‰ã€‚</p>
<p>å› æ­¤ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ OpenAI å·¥å…·æ¨¡å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_expense_tool = convert_to_openai_tool(Expense)</span><br><span class="line">print(add_expense_tool)</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;type&#x27;: &#x27;function&#x27;,</span><br><span class="line"> &#x27;function&#x27;: &#123;&#x27;name&#x27;: &#x27;Expense&#x27;,</span><br><span class="line">  &#x27;description&#x27;: &#x27;&#x27;,</span><br><span class="line">  &#x27;parameters&#x27;: &#123;&#x27;type&#x27;: &#x27;object&#x27;,</span><br><span class="line">   &#x27;properties&#x27;: &#123;&#x27;description&#x27;: &#123;&#x27;type&#x27;: &#x27;string&#x27;&#125;,</span><br><span class="line">    &#x27;net_amount&#x27;: &#123;&#x27;type&#x27;: &#x27;number&#x27;&#125;,</span><br><span class="line">    &#x27;gross_amount&#x27;: &#123;&#x27;type&#x27;: &#x27;number&#x27;&#125;,</span><br><span class="line">    &#x27;tax_rate&#x27;: &#123;&#x27;type&#x27;: &#x27;number&#x27;&#125;,</span><br><span class="line">    &#x27;date&#x27;: &#123;&#x27;type&#x27;: &#x27;string&#x27;, &#x27;format&#x27;: &#x27;date-time&#x27;&#125;&#125;,</span><br><span class="line">   &#x27;required&#x27;: [&#x27;description&#x27;,</span><br><span class="line">    &#x27;net_amount&#x27;,</span><br><span class="line">    &#x27;gross_amount&#x27;,</span><br><span class="line">    &#x27;tax_rate&#x27;,</span><br><span class="line">    &#x27;date&#x27;]&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç‰¹æ®Šçš„é”®requiredï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ç§»é™¤ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥é€šè¿‡ç§»é™¤è¯¥requiredé”®æ¥è°ƒæ•´add_expense_toolæ¨¡å¼ä»¥ä½¿å‚æ•°å˜ä¸ºå¯é€‰çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">del add_expense_tool[&quot;function&quot;][&quot;parameters&quot;][&quot;required&quot;]</span><br></pre></td></tr></table></figure>

<h3 id="è®¾è®¡å·¥å…·ç±»"><a href="#è®¾è®¡å·¥å…·ç±»" class="headerlink" title="è®¾è®¡å·¥å…·ç±»"></a>è®¾è®¡å·¥å…·ç±»</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå·¥å…·ç±»ï¼Œæœ€åˆæ£€æŸ¥è¾“å…¥å‚æ•°æ˜¯å¦ç¼ºå¤±ã€‚æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªToolç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š.run()ï¼Œ.validate_input()ï¼Œå’Œä¸€ä¸ªopenai_tool_schemaå±æ€§ï¼Œé€šè¿‡åˆ é™¤å¿…éœ€çš„å‚æ•°æ¥æ“ä½œå·¥å…·æ¨¡å¼ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å®šä¹‰äº†ToolResult BaseModelï¼Œå…¶ä¸­åŒ…å«contentå­—æ®µå’Œsuccesså­—æ®µï¼Œç”¨äºæ¯æ¬¡å·¥å…·è¿è¡Œçš„è¾“å‡ºå¯¹è±¡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">from pydantic import BaseModel</span><br><span class="line">from typing import Type, Callable, Dict, Any, List</span><br><span class="line"></span><br><span class="line">class ToolResult(BaseModel):  </span><br><span class="line">    content: str  </span><br><span class="line">    success: bool  </span><br><span class="line">  </span><br><span class="line">class Tool(BaseModel):  </span><br><span class="line">    name: str  </span><br><span class="line">    model: Type[BaseModel]  </span><br><span class="line">    function: Callable  </span><br><span class="line">    validate_missing: bool = False  </span><br><span class="line">  </span><br><span class="line">    class Config:  </span><br><span class="line">        arbitrary_types_allowed = True  </span><br><span class="line">  </span><br><span class="line">    def run(self, **kwargs) -&gt; ToolResult:</span><br><span class="line">        if self.validate_missing:</span><br><span class="line">            missing_values = self.validate_input(**kwargs)  </span><br><span class="line">            if missing_values:  </span><br><span class="line">                content = f&quot;Missing values: &#123;&#x27;, &#x27;.join(missing_values)&#125;&quot;  </span><br><span class="line">                return ToolResult(content=content, success=False)  </span><br><span class="line">        result = self.function(**kwargs)  </span><br><span class="line">        return ToolResult(content=str(result), success=True)  </span><br><span class="line">      </span><br><span class="line">    def validate_input(self, **kwargs) -&gt; List[str]:  </span><br><span class="line">        missing_values = []  </span><br><span class="line">        for key in self.model.__fields__.keys():  </span><br><span class="line">            if key not in kwargs:  </span><br><span class="line">                missing_values.append(key)  </span><br><span class="line">        return missing_values</span><br><span class="line">    @property</span><br><span class="line">    def openai_tool_schema(self) -&gt; Dict[str, Any]:</span><br><span class="line">        schema = convert_to_openai_tool(self.model)</span><br><span class="line">        if &quot;required&quot; in schema[&quot;function&quot;][&quot;parameters&quot;]:</span><br><span class="line">            del schema[&quot;function&quot;][&quot;parameters&quot;][&quot;required&quot;]</span><br><span class="line">        return schem</span><br></pre></td></tr></table></figure>
<p>è¯¥Toolç±»æ˜¯ AI ä»£ç†å·¥ä½œæµç¨‹ä¸­çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œä½œä¸ºä¸€ä¸ªè“å›¾æ¥åˆ›å»ºå’Œç®¡ç†å„ç§å·¥å…·ï¼Œè¿™äº›å·¥å…·ç”±ä»£ç†æ¥æ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚å®ƒè¢«è®¾è®¡ç”¨äºå¤„ç†è¾“å…¥éªŒè¯ï¼Œæ‰§è¡Œå·¥å…·çš„åŠŸèƒ½ï¼Œå¹¶ä»¥æ ‡å‡†åŒ–æ ¼å¼è¿”å›ç»“æœã€‚</p>
<h3 id="Tool-ç±»çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼š"><a href="#Tool-ç±»çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼š" class="headerlink" title="Tool ç±»çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼š"></a>Tool ç±»çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼š</h3><ul>
<li>name ï¼šå·¥å…·çš„åç§°ã€‚</li>
<li>model ï¼šå®šä¹‰å·¥å…·è¾“å…¥æ¨¡å¼çš„ Pydantic BaseModelã€‚</li>
<li>function ï¼šå·¥å…·æ‰§è¡Œçš„å¯è°ƒç”¨å‡½æ•°ã€‚</li>
<li>validate_missing ï¼šä¸€ä¸ªå¸ƒå°”æ ‡å¿—ï¼ŒæŒ‡ç¤ºæ˜¯å¦validate missingçš„è¾“å…¥å€¼ï¼ˆé»˜è®¤ä¸º False ï¼‰ã€‚</li>
</ul>
<h3 id="è¿™ä¸ªToolç±»æœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š"><a href="#è¿™ä¸ªToolç±»æœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š" class="headerlink" title="è¿™ä¸ªToolç±»æœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š"></a>è¿™ä¸ªToolç±»æœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•ï¼š</h3><ul>
<li><p>run(self, **kwargs) -&gt; ToolResult: è¯¥æ–¹æ³•è´Ÿè´£ä½¿ç”¨æä¾›çš„è¾“å…¥å‚æ•°æ‰§è¡Œtoolçš„åŠŸèƒ½ã€‚é¦–å…ˆæ£€æŸ¥validate_missing æ˜¯å¦è®¾ç½®ä¸ºTrueã€‚å¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨validate_input()æ–¹æ³•æ£€æŸ¥ç¼ºå°‘çš„è¾“å…¥å€¼ã€‚å¦‚æœæ‰¾åˆ°ä»»ä½•ç¼ºå°‘çš„å€¼ï¼Œåˆ™è¿”å›ä¸€ä¸ªå¸¦æœ‰é”™è¯¯æ¶ˆæ¯çš„ToolResultå¯¹è±¡ï¼Œå¹¶è®¾ç½®success ä¸ºFalseã€‚å¦‚æœæ‰€æœ‰å¿…éœ€çš„è¾“å…¥å€¼éƒ½å­˜åœ¨ï¼Œåˆ™ç»§ç»­ä½¿ç”¨æä¾›çš„å‚æ•°æ‰§è¡Œtoolçš„function ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸¦æœ‰ç»“æœçš„å¯¹è±¡ToolResult ï¼Œå¹¶è®¾ç½®success ä¸ºTrueã€‚</p>
</li>
<li><p>validate_input(self, **kwargs) -&gt; List[str]: è¯¥æ–¹æ³•å°†ä¼ é€’ç»™toolçš„è¾“å…¥å‚æ•°ä¸åœ¨modelä¸­å®šä¹‰çš„é¢„æœŸè¾“å…¥æ¨¡å¼è¿›è¡Œæ¯”è¾ƒã€‚å®ƒéå†modelä¸­å®šä¹‰çš„å­—æ®µï¼Œå¹¶æ£€æŸ¥æ¯ä¸ªå­—æ®µæ˜¯å¦å­˜åœ¨äºè¾“å…¥å‚æ•°ä¸­ã€‚å¦‚æœæœ‰ä»»ä½•å­—æ®µç¼ºå¤±ï¼Œå®ƒå°†å­—æ®µåç§°è¿½åŠ åˆ°ç¼ºå¤±å€¼åˆ—è¡¨ä¸­ã€‚æœ€åï¼Œå®ƒè¿”å›ç¼ºå¤±å€¼åˆ—è¡¨ã€‚</p>
</li>
</ul>
<p>è¯¥Toolç±»è¿˜æœ‰ä¸€ä¸ªåä¸ºopenai_tool_schemaçš„å±æ€§ï¼Œå®ƒè¿”å›è¯¥å·¥å…·çš„ OpenAI å·¥å…·æ¨¡å¼ã€‚å®ƒä½¿ç”¨convert_to_openai_tool()å‡½æ•°å°†modelè½¬æ¢ä¸º OpenAI å·¥å…·æ¨¡å¼æ ¼å¼ã€‚æ­¤å¤–ï¼Œå®ƒä»æ¨¡å¼ä¸­åˆ é™¤â€requiredâ€é”®ï¼Œä½¿æ‰€æœ‰è¾“å…¥å‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚è¿™ä½¿å¾—ä»£ç†å¯ä»¥ä»…æä¾›å¯ç”¨ä¿¡æ¯ï¼Œè€Œæ— éœ€è™šæ„ç¼ºå¤±çš„å€¼ã€‚</p>
<p>é€šè¿‡å°è£…å·¥å…·çš„åŠŸèƒ½ã€è¾“å…¥éªŒè¯å’Œæ¨¡å¼ç”Ÿæˆï¼Œè¯¥Toolç±»ä¸ºåœ¨ AI ä»£ç†çš„å·¥ä½œæµä¸­åˆ›å»ºå’Œç®¡ç†å·¥å…·æä¾›äº†ä¸€ä¸ªå¹²å‡€ä¸”å¯é‡ç”¨çš„æ¥å£ã€‚å®ƒæŠ½è±¡äº†å¤„ç†ç¼ºå¤±å€¼çš„å¤æ‚æ€§ï¼Œå¹¶ç¡®ä¿ä»£ç†èƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†ä¸å®Œæ•´çš„ä¿¡æ¯ï¼ŒåŒæ—¶æ ¹æ®å¯ç”¨çš„è¾“å…¥æ‰§è¡Œé€‚å½“çš„å·¥å…·ã€‚</p>
<h3 id="æµ‹è¯•ç¼ºå¤±ä¿¡æ¯çš„å¤„ç†æµç¨‹"><a href="#æµ‹è¯•ç¼ºå¤±ä¿¡æ¯çš„å¤„ç†æµç¨‹" class="headerlink" title="æµ‹è¯•ç¼ºå¤±ä¿¡æ¯çš„å¤„ç†æµç¨‹"></a>æµ‹è¯•ç¼ºå¤±ä¿¡æ¯çš„å¤„ç†æµç¨‹</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ‰©å±•æˆ‘ä»¬çš„ OpenAI API è°ƒç”¨ã€‚æˆ‘ä»¬å¸Œæœ›å®¢æˆ·ç«¯èƒ½å¤Ÿåˆ©ç”¨æˆ‘ä»¬çš„å·¥å…·ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å“åº”å¯¹è±¡èƒ½å¤Ÿç›´æ¥è§¦å‘ tool.run()ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬æ–°åˆ›å»ºçš„ Tool ç±»ä¸­åˆå§‹åŒ–æˆ‘ä»¬çš„å·¥å…·ã€‚æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè™šæ‹Ÿå‡½æ•°ï¼Œå®ƒä»¬è¿”å›ä¸€ä¸ªæˆåŠŸæ¶ˆæ¯å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def add_expense_func(**kwargs):  </span><br><span class="line">    return f&quot;Added expense: &#123;kwargs&#125; to the database.&quot;</span><br><span class="line"></span><br><span class="line">add_expense_tool = Tool(  </span><br><span class="line">    name=&quot;add_expense_tool&quot;,  </span><br><span class="line">    model=Expense,  </span><br><span class="line">    function=add_expense_func  </span><br><span class="line">)  </span><br><span class="line">  </span><br><span class="line">def report_func(report: str = None):  </span><br><span class="line">    return f&quot;Reported: &#123;report&#125;&quot;  </span><br><span class="line">  </span><br><span class="line">report_tool = Tool(  </span><br><span class="line">    name=&quot;report_tool&quot;,  </span><br><span class="line">    model=ReportTool,  </span><br><span class="line">    function=report_func  </span><br><span class="line">)  </span><br><span class="line">  </span><br><span class="line">tools = [add_expense_tool, report_tool]</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒä»¥å®¢æˆ·ç«¯çš„å“åº”ä½œä¸ºè¾“å…¥ï¼Œå¹¶å¸®åŠ©ä¸æˆ‘ä»¬çš„å·¥å…·è¿›è¡Œäº¤äº’ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def get_tool_from_response(response, tools=tools):  </span><br><span class="line">    tool_name = response.choices[0].message.tool_calls[0].function.name  </span><br><span class="line">    for t in tools:  </span><br><span class="line">        if t.name == tool_name:  </span><br><span class="line">            return t  </span><br><span class="line">    raise ValueError(f&quot;Tool &#123;tool_name&#125; not found in tools list.&quot;)</span><br><span class="line"></span><br><span class="line">def parse_function_args(response):  </span><br><span class="line">    message = response.choices[0].message  </span><br><span class="line">    return json.loads(message.tool_calls[0].function.arguments)</span><br><span class="line"></span><br><span class="line">def run_tool_from_response(response, tools=tools):  </span><br><span class="line">    tool = get_tool_from_response(response, tools)  </span><br><span class="line">    tool_kwargs = parse_function_args(response)  </span><br><span class="line">    return tool.run(**tool_kwargs)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ–°å·¥å…·æ‰§è¡Œå®¢æˆ·ç«¯å¹¶ä½¿ç”¨è¯¥run_tool_from_response å‡½æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">response = client.chat.completions.create(  </span><br><span class="line">            model=model_name,  </span><br><span class="line">            messages=messages,  </span><br><span class="line">            tools=[tool.openai_tool_schema for tool in tools]  </span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">tool_result = run_tool_from_response(response, tools=tools)</span><br><span class="line">print(tool_result)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¸Šè¿°ä»£ç åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">content=&#x27;Missing values: gross_amount, date&#x27; success=False</span><br></pre></td></tr></table></figure>

<p>å®Œç¾ï¼Œæˆ‘ä»¬ç°åœ¨çœ‹åˆ°æˆ‘ä»¬çš„å·¥å…·æ˜¾ç¤ºå­˜åœ¨ç¼ºå¤±å€¼ã€‚å¤šäºäº†æˆ‘ä»¬å°†æ‰€æœ‰å‚æ•°éƒ½è®¾ä¸ºå¯é€‰çš„æŠ€å·§ï¼Œæˆ‘ä»¬ç°åœ¨é¿å…äº†è™šæ„çš„å‚æ•°ã€‚</p>
<h2 id="æ„å»ºä»£ç†å·¥ä½œæµç¨‹"><a href="#æ„å»ºä»£ç†å·¥ä½œæµç¨‹" class="headerlink" title="æ„å»ºä»£ç†å·¥ä½œæµç¨‹"></a>æ„å»ºä»£ç†å·¥ä½œæµç¨‹</h2><p>æˆ‘ä»¬ç›®å‰çš„æµç¨‹è¿˜ä¸èƒ½ä»£è¡¨ä¸€ä¸ªçœŸæ­£çš„ä»£ç†ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ‰§è¡Œäº†ä¸€ä¸ª API å·¥å…·è°ƒç”¨ã€‚ä¸ºäº†å°†å…¶è½¬åŒ–ä¸ºä»£ç†å·¥ä½œæµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ï¼Œå°†å·¥å…·æ‰§è¡Œçš„ç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚åŸºæœ¬æµç¨‹åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š<br><img src="/../asset_scratchaiagentopenai/01.webp"></p>
<p>è®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„ OpenAIAgent ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">class StepResult(BaseModel):  </span><br><span class="line">    event: str   </span><br><span class="line">    content: str  </span><br><span class="line">    success: bool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class OpenAIAgent:  </span><br><span class="line">      </span><br><span class="line">    def __init__(  </span><br><span class="line">            self,   </span><br><span class="line">            tools: list[Tool],   </span><br><span class="line">            client: OpenAI,   </span><br><span class="line">            system_message: str = SYSTEM_MESSAGE,   </span><br><span class="line">            model_name: str = &quot;gpt-3.5-turbo-0125&quot;,  </span><br><span class="line">            max_steps: int = 5,  </span><br><span class="line">            verbose: bool = True  </span><br><span class="line">    ):  </span><br><span class="line">        self.tools = tools  </span><br><span class="line">        self.client = client  </span><br><span class="line">        self.model_name = model_name  </span><br><span class="line">        self.system_message = system_message  </span><br><span class="line">        self.step_history = []  </span><br><span class="line">        self.max_steps = max_steps  </span><br><span class="line">        self.verbose = verbose  </span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">    def to_console(self, tag: str, message: str, color: str = &quot;green&quot;):  </span><br><span class="line">        if self.verbose:  </span><br><span class="line">            color_prefix = Fore.__dict__[color.upper()]  </span><br><span class="line">            print(color_prefix + f&quot;&#123;tag&#125;: &#123;message&#125;&#123;Style.RESET_ALL&#125;&quot;)</span><br></pre></td></tr></table></figure>

<p>åƒæˆ‘ä»¬çš„ToolResultå¯¹è±¡ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªStepResult  å®šä¹‰ä¸ºæ¯ä¸ªä»£ç†æ­¥éª¤çš„å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº† OpenAIAgent ç±»çš„__init__ æ–¹æ³•å’Œä¸€ä¸ª to_console() æ–¹æ³•ï¼Œç”¨äºå°†æˆ‘ä»¬çš„ä¸­é—´æ­¥éª¤å’Œå·¥å…·è°ƒç”¨æ‰“å°åˆ°æ§åˆ¶å°ï¼Œä½¿ç”¨ colorama è¿›è¡Œå½©è‰²æ‰“å°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä»£ç†çš„æ ¸å¿ƒï¼Œrun() å’Œrun_step() æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">class OpenAIAgent:</span><br><span class="line"></span><br><span class="line">    # ... __init__...</span><br><span class="line">    </span><br><span class="line">    # ... to_console ...</span><br><span class="line">    </span><br><span class="line">    def run(self, user_input: str):  </span><br><span class="line">        </span><br><span class="line">        openai_tools = [tool.openai_tool_schema for tool in self.tools]    </span><br><span class="line">        self.step_history = [    </span><br><span class="line">            &#123;&quot;role&quot;:&quot;system&quot;, &quot;content&quot;:self.system_message&#125;,    </span><br><span class="line">            &#123;&quot;role&quot;:&quot;user&quot;, &quot;content&quot;:user_input&#125;    </span><br><span class="line">        ]    </span><br><span class="line">          </span><br><span class="line">        step_result = None    </span><br><span class="line">        i = 0</span><br><span class="line">        </span><br><span class="line">        self.to_console(&quot;START&quot;, f&quot;Starting Agent with Input: &#123;user_input&#125;&quot;)</span><br><span class="line">          </span><br><span class="line">        while i &lt; self.max_steps:  </span><br><span class="line">            step_result = self.run_step(self.step_history, openai_tools)    </span><br><span class="line">            </span><br><span class="line">            if step_result.event == &quot;finish&quot;:    </span><br><span class="line">                break  </span><br><span class="line">            elif step_result.event == &quot;error&quot;:  </span><br><span class="line">                self.to_console(step_result.event, step_result.content, &quot;red&quot;)  </span><br><span class="line">            else:  </span><br><span class="line">                self.to_console(step_result.event, step_result.content, &quot;yellow&quot;)  </span><br><span class="line">            i += 1   </span><br><span class="line">              </span><br><span class="line">        self.to_console(&quot;Final Result&quot;, step_result.content, &quot;green&quot;)  </span><br><span class="line">        return step_result.content</span><br></pre></td></tr></table></figure>

<p>åœ¨è¯¥run() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ä½¿ç”¨é¢„å®šä¹‰çš„ system_message å’Œ user_input æ¥åˆå§‹åŒ–step_historyï¼Œå®ƒä»¬å°†ä½œä¸ºæˆ‘ä»¬çš„æ¶ˆæ¯å­˜å‚¨å™¨ã€‚ç„¶åæˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„ while å¾ªç¯ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­è°ƒç”¨ run_step  å‡½æ•°ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ª StepResult å¯¹è±¡ã€‚æˆ‘ä»¬åˆ¤æ–­ä»£ç†æ˜¯å¦å®Œæˆäº†ä»»åŠ¡æˆ–æ˜¯å¦å‘ç”Ÿäº†é”™è¯¯ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æ§åˆ¶å°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">class OpenAIAgent:</span><br><span class="line"></span><br><span class="line">    # ... __init__...</span><br><span class="line">    </span><br><span class="line">    # ... to_console ...</span><br><span class="line">    # ... run ...</span><br><span class="line">    def run_step(self, messages: list[dict], tools):  </span><br><span class="line">          </span><br><span class="line">        # plan the next step  </span><br><span class="line">        response = self.client.chat.completions.create(  </span><br><span class="line">            model=self.model_name,  </span><br><span class="line">            messages=messages,  </span><br><span class="line">            tools=tools  </span><br><span class="line">        )  </span><br><span class="line">          </span><br><span class="line">        # add message to history  </span><br><span class="line">        self.step_history.append(response.choices[0].message)  </span><br><span class="line">        </span><br><span class="line">        # check if tool call is present  </span><br><span class="line">        if not response.choices[0].message.tool_calls:  </span><br><span class="line">            return StepResult(</span><br><span class="line">                event=&quot;Error&quot;,</span><br><span class="line">                content=&quot;No tool calls were returned.&quot;, </span><br><span class="line">                success=False</span><br><span class="line">                )  </span><br><span class="line">          </span><br><span class="line">        tool_name = response.choices[0].message.tool_calls[0].function.name  </span><br><span class="line">        tool_kwargs = parse_function_args(response)  </span><br><span class="line">          </span><br><span class="line">        # execute the tool call  </span><br><span class="line">        self.to_console(</span><br><span class="line">        &quot;Tool Call&quot;, f&quot;Name: &#123;tool_name&#125;\nArgs: &#123;tool_kwargs&#125;&quot;, &quot;magenta&quot;</span><br><span class="line">        )  </span><br><span class="line">        tool_result = run_tool_from_response(response, tools=self.tools)  </span><br><span class="line">        tool_result_msg = self.tool_call_message(response, tool_result)  </span><br><span class="line">        self.step_history.append(tool_result_msg)  </span><br><span class="line">          </span><br><span class="line">        if tool_result.success:  </span><br><span class="line">            step_result = StepResult(  </span><br><span class="line">                event=&quot;tool_result&quot;,   </span><br><span class="line">                content=tool_result.content,   </span><br><span class="line">                success=True)  </span><br><span class="line">        else:  </span><br><span class="line">            step_result = StepResult(  </span><br><span class="line">                event=&quot;error&quot;,   </span><br><span class="line">                content=tool_result.content,   </span><br><span class="line">                success=False  </span><br><span class="line">            )   </span><br><span class="line">          </span><br><span class="line">        return step_result  </span><br><span class="line">          </span><br><span class="line">      </span><br><span class="line">    def tool_call_message(self, response, tool_result: ToolResult):  </span><br><span class="line">        tool_call = response.choices[0].message.tool_calls[0]  </span><br><span class="line">        return &#123;  </span><br><span class="line">            &quot;tool_call_id&quot;: tool_call.id,  </span><br><span class="line">            &quot;role&quot;: &quot;tool&quot;,  </span><br><span class="line">            &quot;name&quot;: tool_call.function.name,  </span><br><span class="line">            &quot;content&quot;: tool_result.content,  </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæ¯ä¸ªæ­¥éª¤å®šä¹‰äº†é€»è¾‘ã€‚æˆ‘ä»¬é¦–å…ˆé€šè¿‡ä¹‹å‰æµ‹è¯•è¿‡çš„å®¢æˆ·ç«¯ API è°ƒç”¨å·¥å…·æ¥è·å–ä¸€ä¸ªå“åº”å¯¹è±¡ã€‚æˆ‘ä»¬å°†å“åº”æ¶ˆæ¯å¯¹è±¡é™„åŠ åˆ°æˆ‘ä»¬çš„ step_history ä¸­ã€‚ç„¶åæˆ‘ä»¬éªŒè¯æ˜¯å¦åœ¨å“åº”å¯¹è±¡ä¸­åŒ…å«äº†ä¸€ä¸ªå·¥å…·è°ƒç”¨ï¼Œå¦åˆ™æˆ‘ä»¬åœ¨ StepResult ä¸­è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ç„¶åæˆ‘ä»¬å°†å·¥å…·è°ƒç”¨è®°å½•åˆ°æ§åˆ¶å°ï¼Œå¹¶ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„run_tool_from_response() æ–¹æ³•è¿è¡Œæ‰€é€‰çš„å·¥å…·ã€‚æˆ‘ä»¬è¿˜éœ€è¦å°†å·¥å…·ç»“æœé™„åŠ åˆ°æˆ‘ä»¬çš„æ¶ˆæ¯å†å²ä¸­ã€‚OpenAI å·²ç»ä¸ºæ­¤å®šä¹‰äº†ä¸€ä¸ªç‰¹å®šçš„æ ¼å¼ï¼Œä»¥ä¾¿æ¨¡å‹çŸ¥é“å“ªä¸ªå·¥å…·è°ƒç”¨ä¸å“ªä¸ªè¾“å‡ºç›¸å…³è”ï¼Œé€šè¿‡å°† tool_call_id ä¼ é€’ç»™æˆ‘ä»¬çš„æ¶ˆæ¯å­—å…¸ã€‚è¿™æ˜¯é€šè¿‡æˆ‘ä»¬çš„æ–¹æ³• tool_call_message() å®Œæˆçš„ï¼Œè¯¥æ–¹æ³•æ¥å—å“åº”å¯¹è±¡å’Œå·¥å…·ç»“æœä½œä¸ºè¾“å…¥å‚æ•°ã€‚åœ¨æ¯ä¸ªæ­¥éª¤ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å°†å·¥å…·ç»“æœåˆ†é…ç»™ä¸€ä¸ª StepResult å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¿˜æŒ‡ç¤ºæ­¥éª¤æ˜¯å¦æˆåŠŸï¼Œå¹¶å°†å…¶è¿”å›ç»™æˆ‘ä»¬çš„å¾ªç¯ run() ä¸­ã€‚</p>
<h2 id="è¿è¡Œä»£ç†"><a href="#è¿è¡Œä»£ç†" class="headerlink" title="è¿è¡Œä»£ç†"></a>è¿è¡Œä»£ç†</h2><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„ç¤ºä¾‹æ¥æµ‹è¯•æˆ‘ä»¬çš„ä»£ç†ï¼Œç›´æ¥å°†å…¶é…å¤‡ä¸ºä¸€ä¸ªget_current_date_tool ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¹‹å‰å®šä¹‰çš„validate_missing å±æ€§è®¾ç½®ä¸ºFalse ï¼Œå› ä¸ºè¯¥å·¥å…·ä¸éœ€è¦ä»»ä½•è¾“å…¥å‚æ•°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class DateTool(BaseModel):  </span><br><span class="line">    x: str = None  </span><br><span class="line"></span><br><span class="line">get_date_tool = Tool(  </span><br><span class="line">    name=&quot;get_current_date&quot;,  </span><br><span class="line">    model=DateTool,  </span><br><span class="line">    function=lambda: datetime.now().strftime(&quot;%Y-%m-%d&quot;),  </span><br><span class="line">    validate_missing=False  </span><br><span class="line">)  </span><br><span class="line">      </span><br><span class="line">tools = [  </span><br><span class="line">    add_expense_tool,   </span><br><span class="line">    report_tool,  </span><br><span class="line">    get_date_tool  </span><br><span class="line">]  </span><br><span class="line">  </span><br><span class="line">agent = OpenAIAgent(tools, client)</span><br><span class="line">agent.run(&quot;I have spent 5$ on a coffee today please track my expense. The tax rate is 0.2.&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">START: Starting Agent with Input: </span><br><span class="line">&quot;I have spend 5$ on a coffee today please track my expense. The tax rate is 0.2.&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: get_current_date</span><br><span class="line">Args: &#123;&#125;</span><br><span class="line">tool_result: 2024-03-15</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: add_expense_tool</span><br><span class="line">Args: &#123;&#x27;description&#x27;: &#x27;Coffee expense&#x27;, &#x27;net_amount&#x27;: 5, &#x27;tax_rate&#x27;: 0.2, &#x27;date&#x27;: &#x27;2024-03-15&#x27;&#125;</span><br><span class="line">error: Missing values: gross_amount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: add_expense_tool</span><br><span class="line">Args: &#123;&#x27;description&#x27;: &#x27;Coffee expense&#x27;, &#x27;net_amount&#x27;: 5, &#x27;tax_rate&#x27;: 0.2, &#x27;date&#x27;: &#x27;2024-03-15&#x27;, &#x27;gross_amount&#x27;: 6&#125;</span><br><span class="line">tool_result: Added expense: &#123;&#x27;description&#x27;: &#x27;Coffee expense&#x27;, &#x27;net_amount&#x27;: 5, &#x27;tax_rate&#x27;: 0.2, &#x27;date&#x27;: &#x27;2024-03-15&#x27;, &#x27;gross_amount&#x27;: 6&#125; to the database.</span><br><span class="line">Error: No tool calls were returned.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: Name: report_tool</span><br><span class="line">Args: &#123;&#x27;report&#x27;: &#x27;Expense successfully tracked for coffee purchase.&#x27;&#125;</span><br><span class="line">tool_result: Reported: Expense successfully tracked for coffee purchase.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Final Result: Reported: Expense successfully tracked for coffee purchase.</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆåŠŸæ‰§è¡Œæˆ‘ä»¬çš„åŸå‹ä»£ç†ä¹‹åï¼Œå€¼å¾—å¼ºè°ƒçš„æ˜¯ä»£ç†æ ¹æ®è®¡åˆ’æœ‰æ•ˆåœ°åˆ©ç”¨äº†æŒ‡å®šçš„å·¥å…·ã€‚æœ€åˆï¼Œå®ƒè°ƒç”¨äº†get_current_date_toolï¼Œä¸ºè´¹ç”¨è®°å½•å»ºç«‹äº†åŸºç¡€æ—¶é—´æˆ³ã€‚éšåï¼Œåœ¨å°è¯•é€šè¿‡add_expense_tool è¿›è¡Œè´¹ç”¨è®°å½•æ—¶ï¼Œæˆ‘ä»¬æ™ºèƒ½è®¾è®¡çš„å·¥å…·ç±»å‘ç°äº†ä¸€ä¸ªç¼ºå¤±çš„gross_amountâ€”â€”è¿™æ˜¯å‡†ç¡®è´¢åŠ¡è·Ÿè¸ªæ‰€å¿…éœ€çš„å…³é”®ä¿¡æ¯ã€‚ä»¤äººå°è±¡æ·±åˆ»çš„æ˜¯ï¼Œä»£ç†é€šè¿‡ä½¿ç”¨æä¾›çš„tax_rateè‡ªåŠ¨è§£å†³äº†è¿™ä¸ªgross_amount è®¡ç®—é—®é¢˜ã€‚</p>
<p>è°ƒè¯•å‘ç°AI Agentä¸ä¼šæˆåŠŸï¼Œä¸æˆåŠŸlogå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">START: Starting Agent with Input: I have spend 5$ on a coffee today please track my expense. The tax rate is 0.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: Name: get_current_date</span><br><span class="line">Args: &#123;&#125;</span><br><span class="line">tool_result: 2024-04-03</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: Name: add_expense_tool</span><br><span class="line">Args: &#123;&#x27;description&#x27;: &#x27;Coffee&#x27;, &#x27;net_amount&#x27;: 5, &#x27;tax_rate&#x27;: 0.2, &#x27;date&#x27;: &#x27;2024-04-03&#x27;&#125;</span><br><span class="line">error: Missing values: gross_amount</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: Name: add_expense_tool</span><br><span class="line">Args: &#123;&#x27;description&#x27;: &#x27;Coffee&#x27;, &#x27;net_amount&#x27;: 5, &#x27;tax_rate&#x27;: 0.2, &#x27;date&#x27;: &#x27;2024-04-03&#x27;, &#x27;gross_amount&#x27;: 6&#125;</span><br><span class="line">tool_result: Added expense: &#123;&#x27;description&#x27;: &#x27;Coffee&#x27;, &#x27;net_amount&#x27;: 5, &#x27;tax_rate&#x27;: 0.2, &#x27;date&#x27;: &#x27;2024-04-03&#x27;, &#x27;gross_amount&#x27;: 6&#125; to the database.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Tool Call: Name: report_tool</span><br><span class="line">Args: &#123;&#x27;report&#x27;: &#x27;Expense of $5 for coffee today has been successfully tracked with a tax rate of 0.2.&#x27;&#125;</span><br><span class="line">tool_result: Reported: Expense of $5 for coffee today has been successfully tracked with a tax rate of 0.2.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Error: No tool calls were returned.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Final Result: No tool calls were returned.</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºopenaiçš„æ¨¡å‹åˆ¤æ–­å·¥å…·è°ƒç”¨å®Œæˆå°±ä¼šåœæ­¢å·¥å…·è°ƒç”¨ï¼Œè¿”å›response.choices[0].message.tool_calls ä¸ºç©ºï¼Œéœ€è¦æ”¹ä¸€ä¸‹æºä»£ç ã€‚<br>å¦‚ä¸‹ï¼šåœ¨agent.pyä¸­æ·»åŠ check if task is completedå¦‚ä¸‹ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># add message to history</span><br><span class="line">self.step_history.append(response.choices[0].message)</span><br><span class="line"># check if task is completed</span><br><span class="line">if response.choices[0].finish_reason == &quot;stop&quot;:</span><br><span class="line">    step_result = StepResult(event=&quot;finish&quot;, content=&quot;Task completed.&quot;, success=True)</span><br><span class="line">    return step_result</span><br></pre></td></tr></table></figure>


<p>åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ï¼Œéœ€è¦æåˆ°çš„æ˜¯ï¼Œè¾“å…¥è´¹ç”¨çš„æ€§è´¨â€”â€”æ— è®ºæ˜¯èŠ±åœ¨å’–å•¡ä¸Šçš„ 5 ç¾å…ƒæ˜¯å‡€é¢è¿˜æ˜¯æ¯›é¢â€”â€”å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸ºäº†ä½¿ä»£ç†èƒ½å¤ŸæˆåŠŸå®Œæˆä»»åŠ¡ï¼Œè¿™ç§æ˜ç¡®æ€§å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚ç„¶è€Œï¼Œè¿™ä¸ºæˆ‘ä»¬æ”¹è¿›ä»£ç†çš„ç†è§£å’Œäº¤äº’èƒ½åŠ›æä¾›äº†æœ‰ä»·å€¼çš„è§è§£ï¼šå°†è¿™äº›è¯¦ç»†ä¿¡æ¯çº³å…¥æˆ‘ä»¬çš„åˆå§‹ç³»ç»Ÿæç¤ºä¸­ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ä»£ç†åœ¨å¤„ç†è´¹ç”¨è®°å½•æ–¹é¢çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚è¿™ä¸ªè°ƒæ•´å°†ç¡®ä¿ä»ä¸€å¼€å§‹å°±æ›´å…¨é¢åœ°æŒæ¡è´¢åŠ¡æ•°æ®ã€‚</p>
<h2 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h2><ul>
<li>è¿­ä»£å¼€å‘ï¼šè¯¥é¡¹ç›®å¼ºè°ƒäº†è¿­ä»£å¼€å‘å‘¨æœŸçš„å…³é”®æ€§ï¼Œé€šè¿‡åé¦ˆä¿ƒè¿›æŒç»­æ”¹è¿›ã€‚åœ¨äººå·¥æ™ºèƒ½é¢†åŸŸï¼Œè¿™ç§æ–¹æ³•è‡³å…³é‡è¦ï¼Œå› ä¸ºå˜åŒ–æ˜¯å¸¸æ€ï¼Œéœ€è¦ä¸€ç§é€‚åº”æ€§å¼ºã€å“åº”è¿…é€Ÿçš„å¼€å‘ç­–ç•¥ã€‚</li>
<li>å¤„ç†ä¸ç¡®å®šæ€§ï¼šæˆ‘ä»¬çš„è¿‡ç¨‹çªæ˜¾äº†ä¼˜é›…åœ°ç®¡ç†æ¨¡ç³Šå’Œé”™è¯¯çš„é‡è¦æ€§ã€‚åˆ›æ–°ï¼Œå¦‚å¯é€‰å‚æ•°å’Œä¸¥æ ¼çš„è¾“å…¥éªŒè¯ï¼Œå·²è¢«è¯æ˜å¯¹æé«˜ä»£ç†çš„å¯é æ€§å’Œç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚</li>
<li>ç‰¹å®šä»»åŠ¡çš„å®šåˆ¶ä»£ç†å·¥ä½œæµç¨‹ï¼šè¿™é¡¹å·¥ä½œçš„ä¸€ä¸ªå…³é”®æ´å¯Ÿæ˜¯å®šåˆ¶ä»£ç†å·¥ä½œæµç¨‹ä»¥é€‚åº”ç‰¹å®šçš„ç”¨ä¾‹çš„é‡è¦æ€§ã€‚é™¤äº†ç»„è£…ä¸€å¥—å·¥å…·ä¹‹å¤–ï¼Œå·¥å…·äº¤äº’å’Œå“åº”çš„æˆ˜ç•¥è®¾è®¡è‡³å…³é‡è¦ã€‚è¿™ç§å®šåˆ¶ç¡®ä¿ä»£ç†æœ‰æ•ˆåœ°åº”å¯¹ç‰¹å®šæŒ‘æˆ˜ï¼Œä»è€Œå®ç°æ›´åŠ ä¸“æ³¨å’Œé«˜æ•ˆçš„é—®é¢˜è§£å†³æ–¹æ³•ã€‚</li>
</ul>
<h2 id="å±•æœ›æœªæ¥"><a href="#å±•æœ›æœªæ¥" class="headerlink" title="å±•æœ›æœªæ¥"></a>å±•æœ›æœªæ¥</h2><p>æ¥ä¸‹æ¥çš„æ–‡ç« å°†ç€é‡æ‰©å±•æˆ‘ä»¬åŸå‹çš„åŠŸèƒ½ï¼Œå¹¶å°†å…¶ä¸ç°å®ä¸–ç•Œçš„ç³»ç»Ÿé›†æˆã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨è®¾è®¡ä¸€ä¸ªå¼ºå¤§çš„é¡¹ç›®ç»“æ„ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç†èƒ½å¤Ÿä¸ SQL æ•°æ®åº“æ— ç¼äº¤äº’ã€‚é€šè¿‡åˆ©ç”¨æœ¬æ–‡ä¸­å¼€å‘çš„ä»£ç†ï¼Œæˆ‘ä»¬å°†å±•ç¤º AI å¦‚ä½•é«˜æ•ˆåœ°ç®¡ç†å’Œæ“ä½œå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä¸ºè‡ªåŠ¨åŒ–æ•°æ®ç›¸å…³ä»»åŠ¡æ‰“å¼€äº†æ— é™å¯èƒ½æ€§ã€‚</p>
<p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæœ¬ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« å°†ä»‹ç»é«˜çº§æŸ¥è¯¢åŠŸèƒ½ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç†èƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„æ•°æ®æ£€ç´¢å’Œæ“ä½œä»»åŠ¡ã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨è·¯ç”±ä»£ç†çš„æ¦‚å¿µï¼Œå®ƒå°†å……å½“ä¸€ä¸ªä¸­å¤®æ¢çº½ï¼Œç”¨äºç®¡ç†å¤šä¸ªå­ä»£ç†ï¼Œæ¯ä¸ªå­ä»£ç†è´Ÿè´£ä¸ç‰¹å®šçš„æ•°æ®åº“è¡¨è¿›è¡Œäº¤äº’ã€‚è¿™ç§åˆ†å±‚ç»“æ„å°†å…è®¸ç”¨æˆ·ç”¨è‡ªç„¶è¯­è¨€æå‡ºè¯·æ±‚ï¼Œç„¶åè·¯ç”±ä»£ç†å°†è§£é‡Šå¹¶å°†å…¶æŒ‡ç¤ºç»™é€‚å½“çš„å­ä»£ç†æ‰§è¡Œã€‚</p>
<p>ä¸ºäº†è¿›ä¸€æ­¥æå‡æˆ‘ä»¬åŸºäºäººå·¥æ™ºèƒ½çš„ç³»ç»Ÿçš„å®ç”¨æ€§å’Œå®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†å¼•å…¥åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ç³»ç»Ÿã€‚è¿™å°†ç¡®ä¿ç”¨æˆ·æ ¹æ®å…¶åˆ†é…çš„è§’è‰²æ‹¥æœ‰é€‚å½“çš„æƒé™æ¥è®¿é—®å’Œä¿®æ”¹æ•°æ®ã€‚é€šè¿‡å®æ–½è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å±•ç¤ºäººå·¥æ™ºèƒ½ä»£ç†å¦‚ä½•åœ¨ç°å®åœºæ™¯ä¸­éƒ¨ç½²ï¼ŒåŒæ—¶ä¿æŒæ•°æ®çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚</p>
<p>é€šè¿‡è¿™äº›å³å°†æ¨å‡ºçš„å¢å¼ºåŠŸèƒ½ï¼Œæˆ‘ä»¬æ—¨åœ¨å±•ç¤º AI ä»£ç†åœ¨ç®€åŒ–æ•°æ®ç®¡ç†æµç¨‹å’Œä¸ºç”¨æˆ·æä¾›æ›´ç›´è§‚é«˜æ•ˆçš„ä¸æ•°æ®åº“äº¤äº’æ–¹å¼æ–¹é¢çš„çœŸæ­£æ½œåŠ›ã€‚é€šè¿‡ç»“åˆè‡ªç„¶è¯­è¨€å¤„ç†ã€æ•°æ®åº“ç®¡ç†å’ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶çš„èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†ä¸ºå¼€å‘èƒ½å¤Ÿå½»åº•æ”¹å˜ä¼ä¸šå’Œä¸ªäººå¤„ç†æ•°æ®æ–¹å¼çš„å¤æ‚ AI åŠ©æ‰‹å¥ å®šåŸºç¡€ã€‚</p>
<h2 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h2><p>æ‰€æ¶µç›–é¡¹ç›®çš„å…¨éƒ¨æºä»£ç éƒ½å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚æ‚¨å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/elokus/AgentDemo">https://github.com/elokus/AgentDemo</a> è®¿é—®å®ƒã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://towardsdatascience.com/leverage-openai-tool-calling-building-a-reliable-ai-agent-from-scratch-4e21fcd15b62">https://towardsdatascience.com/leverage-openai-tool-calling-building-a-reliable-ai-agent-from-scratch-4e21fcd15b62</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Howard Huang</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">638k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">19:19</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">
    <!--ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨-->
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.umd.js" integrity="sha256-+2+qOqR8CKoHh/AsVR9k2qaDBKWjYNC2nozhYmv5j9k=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>



  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
