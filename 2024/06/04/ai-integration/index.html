<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"szhowardhuang.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="由于许多企业拥有运行多年的大型复杂系统，对它们进行重大更改是有风险且昂贵的。 本文讨论如何将人工智能添加到现有的应用程序中，即使这些应用程序很难或不可能更改。我们将探讨实现这一目标的实际方法。 业务用例我们模拟一个供应链管理公司，它有多个部门，每个部门都暴露自己的 REST API，要得到一个查询的答案，必须通过这些部门的 API 和数据库调用。我们将引入人工智能，但保持所有现有流程不变。  该公">
<meta property="og:type" content="article">
<meta property="og:title" content="如何在应用程序中集成AI">
<meta property="og:url" content="https://szhowardhuang.github.io/2024/06/04/ai-integration/index.html">
<meta property="og:site_name" content="嵌入式老兵博客">
<meta property="og:description" content="由于许多企业拥有运行多年的大型复杂系统，对它们进行重大更改是有风险且昂贵的。 本文讨论如何将人工智能添加到现有的应用程序中，即使这些应用程序很难或不可能更改。我们将探讨实现这一目标的实际方法。 业务用例我们模拟一个供应链管理公司，它有多个部门，每个部门都暴露自己的 REST API，要得到一个查询的答案，必须通过这些部门的 API 和数据库调用。我们将引入人工智能，但保持所有现有流程不变。  该公">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_aiintegration/01.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_aiintegration/02.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_aiintegration/03.gif">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_aiintegration/04.gif">
<meta property="article:published_time" content="2024-06-04T12:26:26.689Z">
<meta property="article:modified_time" content="2024-06-05T08:30:38.413Z">
<meta property="article:author" content="Howard Huang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://szhowardhuang.github.io/asset_aiintegration/01.png">


<link rel="canonical" href="https://szhowardhuang.github.io/2024/06/04/ai-integration/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://szhowardhuang.github.io/2024/06/04/ai-integration/","path":"2024/06/04/ai-integration/","title":"如何在应用程序中集成AI"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>如何在应用程序中集成AI | 嵌入式老兵博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">嵌入式老兵博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%9A%E5%8A%A1%E7%94%A8%E4%BE%8B"><span class="nav-number">1.</span> <span class="nav-text">业务用例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83"><span class="nav-number">2.</span> <span class="nav-text">设置环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%95%8C%E9%9D%A2-dashboard-py"><span class="nav-number">3.</span> <span class="nav-text">客户端界面 dashboard.py</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LLM%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">3.1.</span> <span class="nav-text">LLM客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-get-supply-chain-data-%E5%87%BD%E6%95%B0"><span class="nav-number">3.2.</span> <span class="nav-text">定义 get_supply_chain_data 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-run-conversation-%E5%87%BD%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">定义 run_conversation 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gradio-%E7%95%8C%E9%9D%A2%E8%AE%BE%E7%BD%AE"><span class="nav-number">3.4.</span> <span class="nav-text">Gradio 界面设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gradio-%E7%95%8C%E9%9D%A2%E7%BB%84%E4%BB%B6"><span class="nav-number">3.5.</span> <span class="nav-text">Gradio 界面组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5%E5%92%8C%E8%BE%93%E5%87%BA%E7%BB%84%E4%BB%B6"><span class="nav-number">3.6.</span> <span class="nav-text">设置用户输入和输出组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E4%BE%9B%E5%BA%94%E9%93%BE%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-number">3.7.</span> <span class="nav-text">更新供应链统计数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-Gradio-%E7%95%8C%E9%9D%A2"><span class="nav-number">3.8.</span> <span class="nav-text">启动 Gradio 界面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AC%E5%8F%B8%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F-data-retriever-py"><span class="nav-number">4.</span> <span class="nav-text">公司数据处理系统 data_retriever.py</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%BA%93%E5%B9%B6%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97"><span class="nav-number">4.1.</span> <span class="nav-text">导入库并设置日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-SupplyChainDataRetriever-%E7%B1%BB"><span class="nav-number">4.2.</span> <span class="nav-text">定义 SupplyChainDataRetriever 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%9F%A5%E8%AF%A2%E6%98%A0%E5%B0%84"><span class="nav-number">4.3.</span> <span class="nav-text">获取查询映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E7%B4%A2%E4%BE%9B%E5%BA%94%E9%93%BE%E6%95%B0%E6%8D%AE"><span class="nav-number">4.4.</span> <span class="nav-text">检索供应链数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-number">4.5.</span> <span class="nav-text">文本预处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86%E6%9F%A5%E8%AF%A2%E4%B8%8E%E6%B4%BB%E5%8A%A8%E5%8C%B9%E9%85%8D"><span class="nav-number">4.6.</span> <span class="nav-text">将查询与活动匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">4.7.</span> <span class="nav-text">从文件中读取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%B2%A1%E6%9C%89%E5%8C%B9%E9%85%8D%E6%B4%BB%E5%8A%A8"><span class="nav-number">4.8.</span> <span class="nav-text">处理没有匹配活动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F-server-py"><span class="nav-number">5.</span> <span class="nav-text">数据处理系统 server.py</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%BA%93%E5%B9%B6%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-number">5.1.</span> <span class="nav-text">导入库并设置日志记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96-Flask-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%92%8C%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2%E5%99%A8"><span class="nav-number">5.2.</span> <span class="nav-text">初始化 Flask 应用程序和数据检索器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E4%BA%8E%E4%BE%9B%E5%BA%94%E9%93%BE%E6%95%B0%E6%8D%AE%E6%A3%80%E7%B4%A2%E7%9A%84-Flask-%E8%B7%AF%E7%94%B1"><span class="nav-number">5.3.</span> <span class="nav-text">用于供应链数据检索的 Flask 路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-Flask-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">5.4.</span> <span class="nav-text">启动 Flask 应用程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E7%B3%BB%E7%BB%9F-mapping-server-py"><span class="nav-number">6.</span> <span class="nav-text">映射系统 mapping_server.py</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-MappingAPI-%E7%B1%BB"><span class="nav-number">6.1.</span> <span class="nav-text">定义 MappingAPI 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E7%B4%A2%E6%98%A0%E5%B0%84%E6%95%B0%E6%8D%AE"><span class="nav-number">6.2.</span> <span class="nav-text">检索映射数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-Flask-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-1"><span class="nav-number">6.3.</span> <span class="nav-text">启动 Flask 应用程序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E8%BF%90%E8%A1%8C"><span class="nav-number">7.</span> <span class="nav-text">开始运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%9D%E8%80%83"><span class="nav-number">8.</span> <span class="nav-text">思考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard Huang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/06/04/ai-integration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入式老兵博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="如何在应用程序中集成AI | 嵌入式老兵博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          如何在应用程序中集成AI
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-06-04 20:26:26" itemprop="dateCreated datePublished" datetime="2024-06-04T20:26:26+08:00">2024-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-05 16:30:38" itemprop="dateModified" datetime="2024-06-05T16:30:38+08:00">2024-06-05</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>21 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>由于许多企业拥有运行多年的大型复杂系统，对它们进行重大更改是有风险且昂贵的。</p>
<p>本文讨论如何将人工智能添加到现有的应用程序中，即使这些应用程序很难或不可能更改。我们将探讨实现这一目标的实际方法。</p>
<h2 id="业务用例"><a href="#业务用例" class="headerlink" title="业务用例"></a>业务用例</h2><p>我们模拟一个供应链管理公司，它有多个部门，每个部门都暴露自己的 REST API，要得到一个查询的答案，必须通过这些部门的 API 和数据库调用。我们将引入人工智能，但保持所有现有流程不变。</p>
<p><img src="/../asset_aiintegration/01.png"></p>
<p>该公司的中央部门是“Data Processing System”，负责数据管理和处理的核心操作。它通过不同的接口与其他各部门进行交互。 “Client Call”组件代表客户请求或查询进入系统的入口点。然后将这些请求传递给“Data Processing System”进行处理。该“Data Processing System”系统还与“Central Data Management”组件通信，后者作为管理和存储与供应链操作相关数据的集中存储库。</p>
<p>“Company Data Handling System”是另一个关键部门，包括一个“Data Retrieval Server”。该服务器存储和管理公司的内部数据，其中包括有关库存、订单、物流和其他运营细节的信息。 “AI Integration System” 组件专门设计用于将人工智能功能集成到现有系统中。它与“Company Data Handling System”互动，并间接访问“Central Data Management”组件，使其能够利用来自多个来源的数据进行基于 AI 的决策或自动化。</p>
<p>“Mapping System” 部门连接到包含有地理数据、路由信息以及与供应链映射和物流相关的其他细节的“Supply Chain Mapping DB”（数据库）。“System Admin Dashboard”允许授权员工登录并访问管理功能或监控系统性能。该仪表板与“AI Integration System”互动，以提供洞见、报告或对 AI 功能进行控制。</p>
<p>最后，“REST API call”组件公开了一个 RESTful API，允许外部系统或应用与其交互，并可能利用其功能或数据。</p>
<h2 id="设置环境"><a href="#设置环境" class="headerlink" title="设置环境"></a>设置环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/szhowardhuang/ai_integration</span><br><span class="line"><span class="built_in">cd</span> ai_integration</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<h2 id="客户端界面-dashboard-py"><a href="#客户端界面-dashboard-py" class="headerlink" title="客户端界面 dashboard.py"></a>客户端界面 dashboard.py</h2><h3 id="LLM客户端"><a href="#LLM客户端" class="headerlink" title="LLM客户端"></a>LLM客户端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client = Groq(api_key=os.getenv(<span class="string">&#x27;GROQ_API_KEY&#x27;</span>))</span><br><span class="line">MODEL = <span class="string">&#x27;mixtral-8x7b-32768&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>申请Groq的API，并配置好LLM模型 mixtral</li>
</ul>
<h3 id="定义-get-supply-chain-data-函数"><a href="#定义-get-supply-chain-data-函数" class="headerlink" title="定义 get_supply_chain_data 函数"></a>定义 get_supply_chain_data 函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_supply_chain_data</span>(<span class="params">query</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Get the supply chain data for a given query by calling the Flask API.&quot;&quot;&quot;</span></span><br><span class="line">    url = <span class="string">f&#x27;http://127.0.0.1:5000/supply-chain-data?query=<span class="subst">&#123;query&#125;</span>&#x27;</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(response.json())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;API request failed&quot;</span>, <span class="string">&quot;status_code&quot;</span>: response.status_code&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此函数通过向 Flask API 端点发出 HTTP GET 请求来检索供应链数据。</p>
</li>
<li><p>它需要一个 query 参数，该参数代表与供应链活动相关的查询。</p>
</li>
<li><p>URL 是使用提供的查询参数构建的。</p>
</li>
<li><p>该函数检查响应状态码。如果是 200（OK），则返回响应的 JSON 表示。否则，返回一个包含错误消息和状态码的 JSON 对象。</p>
</li>
</ul>
<h3 id="定义-run-conversation-函数"><a href="#定义-run-conversation-函数" class="headerlink" title="定义 run_conversation 函数"></a>定义 run_conversation 函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_conversation</span>(<span class="params">user_prompt</span>):</span><br><span class="line">    messages = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a function calling LLM that uses the data extracted from the get_supply_chain_data function to answer questions related to supply chain management. Include the relevant supply chain activity and data in your response.&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: user_prompt,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    tools = [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">            <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_supply_chain_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Get the supply chain data for a given query&quot;</span>,</span><br><span class="line">                <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">                            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The query related to a supply chain activity&quot;</span>,</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;query&quot;</span>],</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此函数管理用户和 AI 模型之间的对话。</p>
</li>
<li><p>它准备好消息，包括系统消息和用户消息，其中包含它们的提示词。</p>
</li>
<li><p>它准备了 AI 模型在对话过程中可以使用的工具。包括一个名为“get_supply_chain_data”的函数，以及它的描述和参数。</p>
</li>
</ul>
<h3 id="Gradio-界面设置"><a href="#Gradio-界面设置" class="headerlink" title="Gradio 界面设置"></a>Gradio 界面设置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">background_path = os.path.join(os.getcwd(), <span class="string">&#x27;images&#x27;</span>, <span class="string">&#x27;background.png&#x27;</span>).replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> gr.Blocks(css=<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    ...CSS Styling...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>) <span class="keyword">as</span> demo:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此部分为用户交互设置了 Gradio 界面。</p>
</li>
<li><p>它构建了界面中背景图像的路径。</p>
</li>
<li><p>界面布局和样式是在 gr.Blocks 上下文管理器中使用 CSS 定义的。</p>
</li>
</ul>
<h3 id="Gradio-界面组件"><a href="#Gradio-界面组件" class="headerlink" title="Gradio 界面组件"></a>Gradio 界面组件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gr.Markdown(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;header&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Supply Chain Management Company&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Your AI-powered supply chain management&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line">gr.Markdown(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;img src=&quot;<span class="subst">&#123;background_path&#125;</span>&quot; class=&quot;background-image&quot;&gt;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> gr.Row():</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>定义了 Gradio 界面的组件，包括一个带有标题和描述的标题栏，以及一张图片。</p>
</li>
<li><p>标题提供有关供应链管理系统的信息。</p>
</li>
<li><p>图像作为界面的背景。</p>
</li>
</ul>
<h3 id="设置用户输入和输出组件"><a href="#设置用户输入和输出组件" class="headerlink" title="设置用户输入和输出组件"></a>设置用户输入和输出组件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> gr.Row():</span><br><span class="line">    <span class="keyword">with</span> gr.Column(scale=<span class="number">1</span>):</span><br><span class="line">        user_input = gr.Textbox(</span><br><span class="line">            label=<span class="string">&quot;Enter your query&quot;</span>,</span><br><span class="line">            placeholder=<span class="string">&quot;Ask a question about supply chain management...&quot;</span>,</span><br><span class="line">            lines=<span class="number">3</span>,</span><br><span class="line">            elem_id=<span class="string">&quot;user-input&quot;</span></span><br><span class="line">        )</span><br><span class="line">        submit_button = gr.Button(<span class="string">&quot;Submit&quot;</span>, variant=<span class="string">&quot;primary&quot;</span>, elem_classes=<span class="string">&quot;submit-button&quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> gr.Column(scale=<span class="number">2</span>):</span><br><span class="line">        output_text = gr.Textbox(</span><br><span class="line">            label=<span class="string">&quot;Response&quot;</span>,</span><br><span class="line">            lines=<span class="number">10</span>,</span><br><span class="line">            elem_id=<span class="string">&quot;output-text&quot;</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此部分在行列布局中设置了用户输入（文本框和提交按钮）和输出（文本框）的组件。</p>
</li>
<li><p>用户可以在文本框中输入与供应链管理相关的查询。</p>
</li>
<li><p>提交查询后，AI 模型的响应将显示在输出文本框中。</p>
</li>
</ul>
<h3 id="更新供应链统计数据"><a href="#更新供应链统计数据" class="headerlink" title="更新供应链统计数据"></a>更新供应链统计数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">stats_text = gr.Text(value=<span class="string">&quot;Loading...&quot;</span>, label=<span class="string">&quot;Supply Chain Stats&quot;</span>, interactive=<span class="literal">False</span>, elem_classes=<span class="string">&quot;stats&quot;</span>)</span><br><span class="line"></span><br><span class="line">submit_button.click(</span><br><span class="line">    gradio_interface,</span><br><span class="line">    inputs=user_input,</span><br><span class="line">    outputs=output_text,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">threading.Thread(target=update_stats_text, daemon=<span class="literal">True</span>).start()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此部分初始化文本组件以显示供应链统计数据。</p>
</li>
<li><p>它为提交按钮设置了一个点击事件处理程序。当按钮被点击时，使用者输入调用 gradio_interface 函数，并在输出文本框中显示输出。</p>
</li>
<li><p>此外，它启动一个单独的线程，持续更新显示在界面上的供应链统计数据。</p>
</li>
</ul>
<h3 id="启动-Gradio-界面"><a href="#启动-Gradio-界面" class="headerlink" title="启动 Gradio 界面"></a>启动 Gradio 界面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">demo.launch()</span><br></pre></td></tr></table></figure>

<ul>
<li>最后，这一行启动了 Gradio 界面，使用户能够与 AI 驱动的供应链管理系统进行交互。</li>
</ul>
<h2 id="公司数据处理系统-data-retriever-py"><a href="#公司数据处理系统-data-retriever-py" class="headerlink" title="公司数据处理系统 data_retriever.py"></a>公司数据处理系统 data_retriever.py</h2><h3 id="导入库并设置日志"><a href="#导入库并设置日志" class="headerlink" title="导入库并设置日志"></a>导入库并设置日志</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> stopwords</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> word_tokenize</span><br><span class="line"><span class="keyword">from</span> nltk.stem <span class="keyword">import</span> WordNetLemmatizer</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">nltk.download(<span class="string">&#x27;punkt&#x27;</span>)</span><br><span class="line">nltk.download(<span class="string">&#x27;stopwords&#x27;</span>)</span><br><span class="line">nltk.download(<span class="string">&#x27;wordnet&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化词形还原器</span></span><br><span class="line">lemmatizer = WordNetLemmatizer()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>导入了必要的库，如 json ， os ， logging 和 requests 。</p>
</li>
<li><p>设置日志以跟踪程序执行过程中的信息、警告和错误。</p>
</li>
<li><p>载入NLP模型，并初始化词形还原器</p>
</li>
</ul>
<h3 id="定义-SupplyChainDataRetriever-类"><a href="#定义-SupplyChainDataRetriever-类" class="headerlink" title="定义 SupplyChainDataRetriever 类"></a>定义 SupplyChainDataRetriever 类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SupplyChainDataRetriever</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, database_folder, mapping_api_url=<span class="string">&#x27;http://localhost:5001/mapping&#x27;</span></span>):</span><br><span class="line">        self.database_folder = database_folder</span><br><span class="line">        self.query_mapping = self.fetch_query_mapping(mapping_api_url)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>定义了一个名为 SupplyChainDataRetriever 的类，用于根据用户查询来检索供应链数据。</p>
</li>
<li><p>该类使用 database_folder 路径和可选的 mapping_api_url 进行查询映射初始化。</p>
</li>
</ul>
<h3 id="获取查询映射"><a href="#获取查询映射" class="headerlink" title="获取查询映射"></a>获取查询映射</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_query_mapping</span>(<span class="params">self, mapping_api_url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(mapping_api_url)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line">    <span class="keyword">except</span> requests.exceptions.RequestException <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error fetching query_mapping: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    logger.info(<span class="string">f&quot;SupplyChainDataRetriever instance created with database folder: <span class="subst">&#123;database_folder&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>该方法从指定的 API 端点获取查询映射。</p>
</li>
<li><p>它向 mapping_api_url 发送 HTTP GET 请求并处理任何异常。</p>
</li>
<li><p>如果成功，它将返回包含查询映射的 JSON 响应。</p>
</li>
</ul>
<h3 id="检索供应链数据"><a href="#检索供应链数据" class="headerlink" title="检索供应链数据"></a>检索供应链数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_supply_chain_data</span>(<span class="params">self, query</span>):</span><br><span class="line">    query = query.lower()</span><br><span class="line">    logger.info(<span class="string">f&quot;Received query: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> activity, filename <span class="keyword">in</span> self.query_mapping.items():</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>该方法根据用户的查询检索供应链数据。</p>
</li>
<li><p>它首先将查询转换为小写，以进行不区分大小写的匹配，并记录接收到的查询。</p>
</li>
<li><p>然后，它通过查询映射字典进行迭代，以找到查询和已知供应链活动之间的匹配。</p>
</li>
</ul>
<h3 id="文本预处理"><a href="#文本预处理" class="headerlink" title="文本预处理"></a>文本预处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 预处理函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess_text</span>(<span class="params">text</span>):</span><br><span class="line">    tokens  = re.split(<span class="string">r&#x27;[\s_]+&#x27;</span>, text)</span><br><span class="line">    <span class="comment"># 转为小写</span></span><br><span class="line">    tokens = [token.lower() <span class="keyword">for</span> token <span class="keyword">in</span> tokens]</span><br><span class="line">    <span class="comment"># 去除停用词和词形还原</span></span><br><span class="line">    tokens = [lemmatizer.lemmatize(word) <span class="keyword">for</span> word <span class="keyword">in</span> tokens <span class="keyword">if</span> word.isalpha() <span class="keyword">and</span> word <span class="keyword">not</span> <span class="keyword">in</span> stopwords.words(<span class="string">&#x27;english&#x27;</span>)]</span><br><span class="line">    <span class="keyword">return</span> tokens</span><br></pre></td></tr></table></figure>

<ul>
<li>preprocess_text根据空格和下划线来分词，并进行词形还原</li>
</ul>
<h3 id="将查询与活动匹配"><a href="#将查询与活动匹配" class="headerlink" title="将查询与活动匹配"></a>将查询与活动匹配</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文本预处理</span></span><br><span class="line">activity_words = preprocess_text(activity)</span><br><span class="line">query_words = preprocess_text(query)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征提取：使用TF-IDF</span></span><br><span class="line">vectorizer = TfidfVectorizer()</span><br><span class="line">tfidf_matrix = vectorizer.fit_transform([<span class="string">&#x27; &#x27;</span>.join(activity_words), <span class="string">&#x27; &#x27;</span>.join(query_words)])</span><br><span class="line"><span class="comment"># 计算余弦相似度</span></span><br><span class="line">similarity_score = cosine_similarity(tfidf_matrix[<span class="number">0</span>:<span class="number">1</span>], tfidf_matrix[<span class="number">1</span>:<span class="number">2</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Text Similarity Score: <span class="subst">&#123;similarity_score[<span class="number">0</span>][<span class="number">0</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> similarity_score[<span class="number">0</span>][<span class="number">0</span>] &gt;= <span class="number">0.3</span>:</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在这里，将活动和查询预处理，分成一组词。</p>
</li>
<li><p>使用余弦相似度比较活动和查询之间的相似度</p>
</li>
</ul>
<h3 id="从文件中读取数据"><a href="#从文件中读取数据" class="headerlink" title="从文件中读取数据"></a>从文件中读取数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file_path = os.path.join(self.database_folder, filename)</span><br><span class="line"><span class="keyword">if</span> os.path.exists(file_path):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        data = json.load(file)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    logger.error(<span class="string">f&quot;File not found: <span class="subst">&#123;file_path&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果找到匹配查询的活动，根据 database_folder 和文件名构建文件路径。</p>
</li>
<li><p>检查文件是否存在，如果存在，从文件中读取 JSON 数据并返回。</p>
</li>
<li><p>如果文件不存在，会记录一个错误消息。</p>
</li>
</ul>
<h3 id="处理没有匹配活动"><a href="#处理没有匹配活动" class="headerlink" title="处理没有匹配活动"></a>处理没有匹配活动</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error_message = &#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;No data found for the given query&quot;</span>&#125;</span><br><span class="line">logger.warning(<span class="string">f&quot;No data found for query: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> error_message</span><br></pre></td></tr></table></figure>

<ul>
<li>如果未找到与查询匹配的活动，会记录一个警告并返回一个错误消息。</li>
</ul>
<h2 id="数据处理系统-server-py"><a href="#数据处理系统-server-py" class="headerlink" title="数据处理系统 server.py"></a>数据处理系统 server.py</h2><h3 id="导入库并设置日志记录"><a href="#导入库并设置日志记录" class="headerlink" title="导入库并设置日志记录"></a>导入库并设置日志记录</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">from</span> data_retriever <span class="keyword">import</span> SupplyChainDataRetriever</span><br><span class="line"><span class="keyword">import</span> logging</span><br></pre></td></tr></table></figure>

<ul>
<li>导入了必要的库，比如 Flask 用于创建 Web 应用程序，logging 用于在程序执行过程中跟踪信息、警告和错误。</li>
</ul>
<h3 id="初始化-Flask-应用程序和数据检索器"><a href="#初始化-Flask-应用程序和数据检索器" class="headerlink" title="初始化 Flask 应用程序和数据检索器"></a>初始化 Flask 应用程序和数据检索器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br><span class="line">data_retriever = SupplyChainDataRetriever(<span class="string">&#x27;database&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建了一个名为 app 的 Flask 应用实例。</p>
</li>
<li><p>实例化了一个名为 data_retriever 的 SupplyChainDataRetriever 对象，用于根据用户查询来检索供应链数据。传递了名为 ‘database’ 的文件夹，其中存储着包含数据的 JSON 文件。</p>
</li>
</ul>
<h3 id="用于供应链数据检索的-Flask-路由"><a href="#用于供应链数据检索的-Flask-路由" class="headerlink" title="用于供应链数据检索的 Flask 路由"></a>用于供应链数据检索的 Flask 路由</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/supply-chain-data&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">supply_chain</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Flask route to handle supply chain data retrieval requests.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Query Parameters:</span></span><br><span class="line"><span class="string">        query (str): The user&#x27;s query related to a supply chain activity.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        JSON response: The corresponding supply chain data or an error message.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    query = request.args.get(<span class="string">&#x27;query&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> query:</span><br><span class="line">        logger.error(<span class="string">&quot;Missing query parameter&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&#x27;error&#x27;</span>: <span class="string">&#x27;Missing query&#x27;</span>&#125;), <span class="number">400</span></span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">f&quot;Received query: <span class="subst">&#123;query&#125;</span>&quot;</span>)</span><br><span class="line">    data = data_retriever.get_supply_chain_data(query)</span><br><span class="line">    logger.info(<span class="string">f&quot;Returning data: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> jsonify(data)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>定义了一个 Flask 路由 &#x2F;supply-chain-data 来处理作为 HTTP GET 请求发送的供应链数据检索请求。</p>
</li>
<li><p>路由声明一个名为 ‘query’ 的查询参数，该参数代表与供应链活动相关的用户查询。</p>
</li>
<li><p>如果缺少查询参数，会记录一个错误并返回一个带有错误消息和状态码 400（错误请求）的 JSON 响应。</p>
</li>
<li><p>记录接收到的查询，使用 data_retriever 对象检索相应的供应链数据，并用 JSON 响应来返回之前的记录数据。</p>
</li>
</ul>
<h3 id="启动-Flask-应用程序"><a href="#启动-Flask-应用程序" class="headerlink" title="启动 Flask 应用程序"></a>启动 Flask 应用程序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    logger.info(<span class="string">&quot;Starting Flask application&quot;</span>)</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果脚本直接执行（而不是作为模块导入），启动 Flask 应用程序。</p>
</li>
<li><p>记录了一条消息，表明 Flask 应用程序正在启动。</p>
</li>
<li><p>启动 Flask 开发服务器，并启用了调试模式，以便在开发过程中进行简单调试。</p>
</li>
</ul>
<p>以这种方式构建代码，使用 Flask 创建了一个网络服务，为用户查询提供基于供应链数据的 API 端点。日志配置确保为调试和监控目的记录相关信息。</p>
<h2 id="映射系统-mapping-server-py"><a href="#映射系统-mapping-server-py" class="headerlink" title="映射系统 mapping_server.py"></a>映射系统 mapping_server.py</h2><h3 id="定义-MappingAPI-类"><a href="#定义-MappingAPI-类" class="headerlink" title="定义 MappingAPI 类"></a>定义 MappingAPI 类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MappingAPI</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mapping_file_path=<span class="literal">None</span></span>):</span><br><span class="line">        self.app = Flask(__name__)</span><br><span class="line">        self.app.add_url_rule(<span class="string">&#x27;/mapping&#x27;</span>, <span class="string">&#x27;mapping&#x27;</span>, self.get_mapping, methods=[<span class="string">&#x27;GET&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mapping_file_path <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            mapping_file_path = os.path.join(<span class="string">&#x27;center_dept_database&#x27;</span>, <span class="string">&#x27;mapping.json&#x27;</span>)</span><br><span class="line">        self.mapping_file_path = mapping_file_path</span><br></pre></td></tr></table></figure>

<ul>
<li><p>定义了一个名为 MappingAPI 的类，用于创建一个基于 Flask 的 API，用于提供中心和部门之间的 JSON 映射。</p>
</li>
<li><p>在构造函数（ <strong>init</strong> ）中，实例化了一个 Flask 应用程序（ app ），并为 &#x2F;mapping 端点添加了一个 URL 规则，通过 HTTP GET 访问时将调用 get_mapping 方法。</p>
</li>
<li><p>将映射文件的默认路径设置为 ‘center_dept_database&#x2F;mapping.json’ ，但在初始化 MappingAPI 对象时，可以通过提供不同的路径来覆盖它。</p>
</li>
</ul>
<h3 id="检索映射数据"><a href="#检索映射数据" class="headerlink" title="检索映射数据"></a>检索映射数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_mapping</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(self.mapping_file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        mapping_data = json.load(file)</span><br><span class="line">    <span class="keyword">return</span> jsonify(mapping_data)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>此方法从由 mapping_file_path 指定的 JSON 文件中检索映射数据。</p>
</li>
<li><p>它打开文件，读取其内容，并将 JSON 数据加载到 Python 字典中（ mapping_data ）。</p>
</li>
<li><p>然后，使用 Flask 的 jsonify 函数将映射数据作为 JSON 响应返回。</p>
</li>
</ul>
<h3 id="启动-Flask-应用程序-1"><a href="#启动-Flask-应用程序-1" class="headerlink" title="启动 Flask 应用程序"></a>启动 Flask 应用程序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5001</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Starting MappingAPI on <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>&quot;</span>)</span><br><span class="line">    self.app.run(host=host, port=port, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    mapping_api = MappingAPI()</span><br><span class="line">    mapping_api.run()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>run 方法启动 Flask 开发服务器。</p>
</li>
<li><p>它需要可选参数 host 和 port 来指定服务器的主机名和端口号。默认情况下，它在端口 5001 上监听所有接口（ ‘0.0.0.0’ ）。</p>
</li>
<li><p>当脚本直接执行（ if <strong>name</strong> &#x3D;&#x3D; ‘<strong>main</strong>‘: ）时，它会创建一个 MappingAPI 的实例，并使用 run 方法运行 Flask 应用程序。</p>
</li>
<li><p>此外，它打印一条消息，指示 API 服务器的启动。</p>
</li>
</ul>
<p>这段代码，用于创建一个简单的基于 Flask 的 API，用于提供中心和部门之间的 JSON 映射。该 API 提供了一个用于检索映射数据的单个端点，使其易于部署和配置到各种应用程序中。</p>
<h2 id="开始运行"><a href="#开始运行" class="headerlink" title="开始运行"></a>开始运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#start mapping server</span></span><br><span class="line">python mapping_server.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#start backend server</span></span><br><span class="line">python server.py</span><br><span class="line"></span><br><span class="line"><span class="comment">#test</span></span><br><span class="line">http://127.0.0.1:5000/supply-chain-data?query=order_tracking</span><br><span class="line"></span><br><span class="line">python dashboard.py</span><br></pre></td></tr></table></figure>

<p>打开浏览器，查看 <a target="_blank" rel="noopener" href="http://127.0.0.1:5000/supply-chain-data?query=order_tracking">http://127.0.0.1:5000/supply-chain-data?query=order_tracking</a> ， 成功的话，可以看到json字串。</p>
<p>打开浏览器，查看 <a target="_blank" rel="noopener" href="http://127.0.0.1:7860/">http://127.0.0.1:7860</a> ， 页面如下：</p>
<p><img src="/../asset_aiintegration/02.png"></p>
<p>询问一下当前的库存 what is our current inventory?</p>
<p><img src="/../asset_aiintegration/03.gif"></p>
<p>询问一下货物的具体状态 i need shipment details for delivered status</p>
<p><img src="/../asset_aiintegration/04.gif"></p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>本文中我们探讨的供应链管理项目的例子，展示了如何将人工智能能力无缝集成到现有业务系统中，而无需进行重大改造。通过利用现代人工智能技术的灵活性和强大功能，我们能够增强供应链管理系统的功能，同时保留其核心运营和工作流程。</p>
<p>在整个开发过程中，我们非常强调减少对现有系统架构的影响。我们并没有试图替换或修改已建立的组件，而是引入了一个“AI 集成系统”，它充当现有基础设施和 AI 功能之间的桥梁。这种方法使我们能够保持现有系统的完整性，同时利用 AI 的好处。</p>
<p>这种整合策略的关键优势之一是能够利用现有系统中已有的大量数据。通过访问和处理这些数据，我们能够通过人工智能模型生成智能的用户查询响应，为特定供应链活动和情景提供有价值的见解和建议。</p>
<p>展望未来，将人工智能无缝集成到现有业务生态系统中的重要性只会继续增长。随着技术进步和对智能自动化和决策支持需求的增加，采用这种方法的组织将更好地把握人工智能带来的机遇，同时最大限度地减少对其运营的干扰。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://ai.gopubby.com/master-ai-integration-how-to-integrate-ai-in-your-application-6b936376df61">https://ai.gopubby.com/master-ai-integration-how-to-integrate-ai-in-your-application-6b936376df61</a></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/05/28/singleimageto3d/" rel="prev" title="通过单个图像进行 3D 重建">
                  <i class="fa fa-angle-left"></i> 通过单个图像进行 3D 重建
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Howard Huang</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">286k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:39</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">
    <!--由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动-->
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
