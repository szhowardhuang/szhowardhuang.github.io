<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"szhowardhuang.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="图像-文本-翻译器 介绍一篇关于Google Cloud端到端开发体验的博客。  在这篇博客中，我将讨论如何构建一个无服务器 AI 应用程序，该应用程序获取用户上传的图像，提取它找到的任何文本，并在必要时对其进行翻译。我将利用：  Cloud Run 以 Python Flask 应用程序的形式托管 UI。 Cloud Functions，用于托管后端逻辑以响应用户上传图像。 Google 预">
<meta property="og:type" content="article">
<meta property="og:title" content="使用 Google Cloud 预训练 AI 构建无服务器图像文本提取器和翻译器">
<meta property="og:url" content="https://szhowardhuang.github.io/2024/07/03/serveless-ai/index.html">
<meta property="og:site_name" content="嵌入式老兵博客">
<meta property="og:description" content="图像-文本-翻译器 介绍一篇关于Google Cloud端到端开发体验的博客。  在这篇博客中，我将讨论如何构建一个无服务器 AI 应用程序，该应用程序获取用户上传的图像，提取它找到的任何文本，并在必要时对其进行翻译。我将利用：  Cloud Run 以 Python Flask 应用程序的形式托管 UI。 Cloud Functions，用于托管后端逻辑以响应用户上传图像。 Google 预">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/01.jpg">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/02.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/03.gif">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/04.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/11.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/06.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/07.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/08.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/09.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/10.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/11.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/12.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/13.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/14.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/15.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/16.jpg">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/17.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/18.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/19.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/20.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/21.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/22.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/23.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/24.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/25.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/26.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/27.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/28.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/29.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/30.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/31.png">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/32.gif">
<meta property="og:image" content="https://szhowardhuang.github.io/asset_serveless_ai/33.png">
<meta property="article:published_time" content="2024-07-03T09:52:25.501Z">
<meta property="article:modified_time" content="2024-07-04T03:16:21.347Z">
<meta property="article:author" content="Howard Huang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://szhowardhuang.github.io/asset_serveless_ai/01.jpg">


<link rel="canonical" href="https://szhowardhuang.github.io/2024/07/03/serveless-ai/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://szhowardhuang.github.io/2024/07/03/serveless-ai/","path":"2024/07/03/serveless-ai/","title":"使用 Google Cloud 预训练 AI 构建无服务器图像文本提取器和翻译器"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>使用 Google Cloud 预训练 AI 构建无服务器图像文本提取器和翻译器 | 嵌入式老兵博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">嵌入式老兵博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AI-%E5%92%8C-AI-%E4%BA%A7%E5%93%81%E6%A6%82%E8%A7%88"><span class="nav-number">2.</span> <span class="nav-text">AI 和 AI 产品概览</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD"><span class="nav-number">2.1.</span> <span class="nav-text">人工智能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0"><span class="nav-number">2.2.</span> <span class="nav-text">机器学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%BC%8F%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%EF%BC%88Gen-AI%EF%BC%89"><span class="nav-number">2.3.</span> <span class="nav-text">生成式人工智能（Gen AI）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-%E7%9A%84%E9%A2%84%E8%AE%AD%E7%BB%83%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-API"><span class="nav-number">2.4.</span> <span class="nav-text">Google 的预训练机器学习 API</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%94%B3%E8%AF%B7%E5%8A%A8%E6%9C%BA"><span class="nav-number">3.</span> <span class="nav-text">申请动机</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E6%9E%B6%E6%9E%84"><span class="nav-number">4.</span> <span class="nav-text">应用程序架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Webapp-UI-%E2%80%94-Cloud-Run"><span class="nav-number">4.1.</span> <span class="nav-text">The Webapp UI — Cloud Run</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E7%AB%AF-%E2%80%94-%E4%BA%91%E5%87%BD%E6%95%B0"><span class="nav-number">4.2.</span> <span class="nav-text">后端 — 云函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%8F%90%E5%8F%96%E5%92%8C%E7%BF%BB%E8%AF%91"><span class="nav-number">4.3.</span> <span class="nav-text">文本提取和翻译</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%88%91%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="nav-number">5.</span> <span class="nav-text">我的开发环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#WSL"><span class="nav-number">5.1.</span> <span class="nav-text">WSL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Visual-Studio-%E4%BB%A3%E7%A0%81"><span class="nav-number">5.2.</span> <span class="nav-text">Visual Studio 代码</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">6.</span> <span class="nav-text">开发项目结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E6%AC%A1%E6%80%A7-Google-%E9%A1%B9%E7%9B%AE%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%9D%83%E9%99%90"><span class="nav-number">7.</span> <span class="nav-text">一次性 Google 项目设置和权限</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Google-Cloud-%E9%A1%B9%E7%9B%AE"><span class="nav-number">7.1.</span> <span class="nav-text">创建 Google Cloud 项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E7%94%A8-API"><span class="nav-number">7.2.</span> <span class="nav-text">启用 API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%B8%90%E6%88%B7%E5%92%8C%E8%A7%92%E8%89%B2"><span class="nav-number">7.3.</span> <span class="nav-text">服务帐户和角色</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="nav-number">8.</span> <span class="nav-text">本地开发环境设置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Git-%E8%AE%BE%E7%BD%AE"><span class="nav-number">8.1.</span> <span class="nav-text">Git 设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C-VS-Code"><span class="nav-number">8.2.</span> <span class="nav-text">运行 VS Code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E9%BB%98%E8%AE%A4%E5%87%AD%E6%8D%AE-%EF%BC%88ADC%EF%BC%89"><span class="nav-number">8.3.</span> <span class="nav-text">安装应用程序默认凭据 （ADC）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AA%E4%BC%9A%E8%AF%9D%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="nav-number">9.</span> <span class="nav-text">每个会话的设置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%91%E5%87%BD%E6%95%B0%E5%90%8E%E7%AB%AF"><span class="nav-number">10.</span> <span class="nav-text">云函数后端</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91"><span class="nav-number">10.1.</span> <span class="nav-text">功能的本地开发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95"><span class="nav-number">10.2.</span> <span class="nav-text">本地测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E4%BA%91%E5%8A%9F%E8%83%BD%EF%BC%88%E5%88%B0-Google-Cloud%EF%BC%89"><span class="nav-number">10.3.</span> <span class="nav-text">部署云功能（到 Google Cloud）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%BA%91%E5%87%BD%E6%95%B0"><span class="nav-number">10.4.</span> <span class="nav-text">测试云函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E6%96%B0%E7%89%88%E6%9C%AC"><span class="nav-number">10.5.</span> <span class="nav-text">部署新版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%87%BD%E6%95%B0"><span class="nav-number">10.6.</span> <span class="nav-text">删除函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%83%A7%E7%93%B6%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2"><span class="nav-number">11.</span> <span class="nav-text">烧瓶用户界面</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Flask-Web-%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">11.1.</span> <span class="nav-text">创建 Flask Web 应用程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81"><span class="nav-number">11.2.</span> <span class="nav-text">应用程序代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%AF%B9-Flask-%E4%B8%BB%E9%A1%B5%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="nav-number">11.3.</span> <span class="nav-text">处理对 Flask 主页的请求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E6%88%91%E4%BB%AC%E7%9A%84%E5%87%BD%E6%95%B0%E8%BF%9B%E8%A1%8C%E7%BB%8F%E8%BF%87%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%B0%83%E7%94%A8"><span class="nav-number">11.4.</span> <span class="nav-text">对我们的函数进行经过身份验证的调用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E8%BE%93%E5%85%A5"><span class="nav-number">11.5.</span> <span class="nav-text">获取用户输入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E8%B0%83%E8%AF%95"><span class="nav-number">11.6.</span> <span class="nav-text">启动和调试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">11.7.</span> <span class="nav-text">测试应用程序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Google-Cloud-Run"><span class="nav-number">12.</span> <span class="nav-text">部署到 Google Cloud Run</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2"><span class="nav-number">12.1.</span> <span class="nav-text">重新部署</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89-DNS-%E6%98%A0%E5%B0%84"><span class="nav-number">12.2.</span> <span class="nav-text">（可选）设置自定义 DNS 映射</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%9A%E4%BB%B7%E5%92%8C%E6%88%90%E6%9C%AC%E7%AE%A1%E7%90%86"><span class="nav-number">13.</span> <span class="nav-text">定价和成本管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-Cloud-%E5%87%BD%E6%95%B0"><span class="nav-number">13.1.</span> <span class="nav-text">Google Cloud 函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-Cloud-Run%EF%BC%88%E8%B0%B7%E6%AD%8C%E4%BA%91%E8%BF%90%E8%A1%8C%E9%85%92%E5%BA%97%EF%BC%89"><span class="nav-number">13.2.</span> <span class="nav-text">Google Cloud Run（谷歌云运行酒店）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cloud-Vision-API"><span class="nav-number">13.3.</span> <span class="nav-text">Cloud Vision API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%91%E7%BF%BB%E8%AF%91-API"><span class="nav-number">13.4.</span> <span class="nav-text">云翻译 API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E6%88%90%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%AD%96%E7%95%A5"><span class="nav-number">13.5.</span> <span class="nav-text">一些成本控制策略</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">14.</span> <span class="nav-text">性能注意事项</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E3%80%81%E4%B8%80%E8%88%AC%E8%A7%82%E5%AF%9F%E5%92%8C%E6%8F%90%E7%A4%BA"><span class="nav-number">15.</span> <span class="nav-text">一些常见问题、一般观察和提示</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E5%BC%8F%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%EF%BC%81"><span class="nav-number">15.1.</span> <span class="nav-text">生成式人工智能！</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%90%8C%E6%97%B6%E4%BD%BF%E7%94%A8-Cloud-Run-%E5%92%8C-Cloud-Functions%EF%BC%9F"><span class="nav-number">15.2.</span> <span class="nav-text">为什么同时使用 Cloud Run 和 Cloud Functions？</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="nav-number">16.</span> <span class="nav-text">结束语</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">17.</span> <span class="nav-text">下一步是什么？</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%BA%E5%8F%91%E5%89%8D"><span class="nav-number">18.</span> <span class="nav-text">出发前</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5"><span class="nav-number">19.</span> <span class="nav-text">相关链接</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">19.1.</span> <span class="nav-text">应用程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">19.2.</span> <span class="nav-text">应用程序的源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E8%AE%BE%E7%BD%AE"><span class="nav-number">19.3.</span> <span class="nav-text">开发设置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%91%E5%87%BD%E6%95%B0"><span class="nav-number">19.4.</span> <span class="nav-text">云函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%91%E8%BF%90%E8%A1%8C"><span class="nav-number">19.5.</span> <span class="nav-text">云运行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AI-ML-API"><span class="nav-number">19.6.</span> <span class="nav-text">AI&#x2F;ML API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A4%E8%AF%81"><span class="nav-number">19.7.</span> <span class="nav-text">认证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DNS-%E5%92%8C-SSL-%E9%85%8D%E7%BD%AE"><span class="nav-number">19.8.</span> <span class="nav-text">DNS 和 SSL 配置</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Howard Huang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">70</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://szhowardhuang.github.io/2024/07/03/serveless-ai/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Howard Huang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="嵌入式老兵博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="使用 Google Cloud 预训练 AI 构建无服务器图像文本提取器和翻译器 | 嵌入式老兵博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          使用 Google Cloud 预训练 AI 构建无服务器图像文本提取器和翻译器
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-03 17:52:25" itemprop="dateCreated datePublished" datetime="2024-07-03T17:52:25+08:00">2024-07-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-04 11:16:21" itemprop="dateModified" datetime="2024-07-04T11:16:21+08:00">2024-07-04</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>29k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>53 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><img src="/../asset_serveless_ai/01.jpg"></p>
<p> 图像-文本-翻译器</p>
<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>一篇关于Google Cloud端到端开发体验的博客。</p>
<p><img src="/../asset_serveless_ai/02.png"></p>
<p>在这篇博客中，我将讨论如何构建一个无服务器 AI 应用程序，该应用程序获取用户上传的图像，提取它找到的任何文本，并在必要时对其进行翻译。我将利用：</p>
<ul>
<li>Cloud Run 以 Python Flask 应用程序的形式托管 UI。</li>
<li>Cloud Functions，用于托管后端逻辑以响应用户上传图像。</li>
<li><strong>Google 预构建的图像和翻译 AI 机器学习 API。</strong></li>
<li>使用 Visual Studio Code 进行本地开发，以及 functions-framework 用于本地 Cloud Functions 开发的 Cloud Code，以及用于本地 Cloud Run 开发的 Cloud Code。</li>
</ul>
<h1 id="AI-和-AI-产品概览"><a href="#AI-和-AI-产品概览" class="headerlink" title="AI 和 AI 产品概览"></a>AI 和 AI 产品概览</h1><h2 id="人工智能"><a href="#人工智能" class="headerlink" title="人工智能"></a>人工智能</h2><p>人工智能是一个广义的术语，用于描述利用机器自动化来执行通常需要人类智能的任务。例如语音识别、视觉感知、语言翻译、决策。</p>
<p><img src="/../asset_serveless_ai/03.gif"></p>
<h2 id="机器学习"><a href="#机器学习" class="headerlink" title="机器学习"></a>机器学习</h2><p>人工智能的一个特定子领域，与教机器识别数据模式有关，并且能够在没有明确编码解决方案的情况下进行预测和解决问题。</p>
<h2 id="生成式人工智能（Gen-AI）"><a href="#生成式人工智能（Gen-AI）" class="headerlink" title="生成式人工智能（Gen AI）"></a>生成式人工智能（Gen AI）</h2><p>AI 的一个子类，能够生成与训练数据相似但不相同的新数据。Gen AI 依赖于基础模型，例如大型语言模型 （）、LLMs生成图像模型和多模态模型。多模态模型是一种能够处理多种类型的输入数据（例如文本、图像和视频）并生成多种类型内容的模型。</p>
<p><img src="/../asset_serveless_ai/04.png"></p>
<p>多模态 Gen AI — 例如 Google Gemini Pro</p>
<p>我的解决方案不会使用 Gen AI。但我在这里提到它，因为 Gen AI 非常普遍，我想确保你了解这些模型与我在解决方案中使用的预测模型有何不同。</p>
<h2 id="Google-的预训练机器学习-API"><a href="#Google-的预训练机器学习-API" class="headerlink" title="Google 的预训练机器学习 API"></a>Google 的预训练机器学习 API</h2><p>这些是 Google 预先构建和训练的 ML 模型，用于执行特定任务。它们被归类为预测模型，而不是生成模型。示例包括：</p>
<ul>
<li>Google Cloud Vision API — 用于分类、面部识别和文本检测等任务。</li>
<li>Google Cloud Natural Language API— 用于理解文本背后的含义。这包括识别文本的重要元素，以及情感分析。</li>
<li>Google Cloud Translation API — 用于将一种语言翻译成另一种语言。</li>
<li>Google Cloud Video — 用于视频分析和注释。</li>
</ul>
<h1 id="申请动机"><a href="#申请动机" class="headerlink" title="申请动机"></a>申请动机</h1><p>我学习乌克兰语已经有一段时间了,乌克兰有一种模因。有时我会理解这个模因。通常我不会。</p>
<p><img src="/../asset_serveless_ai/11.png"></p>
<p> 乌克兰模因</p>
<p>所以我想……“我想要一个应用程序，我可以上传一个模因（或任何图像），从中提取文本，并将该文本翻译成我的母语。”</p>
<p>当然，还有其他方法可以做到这一点。但我认为这是一个很好的用例，可以在 Google Cloud 中从头开始构建一个新的无服务器应用程序。</p>
<h1 id="应用程序架构"><a href="#应用程序架构" class="headerlink" title="应用程序架构"></a>应用程序架构</h1><p>这是一个非常简单的应用程序架构，托管在 Google Cloud 无服务器服务上：</p>
<p><img src="/../asset_serveless_ai/06.png"></p>
<p>图像-文本-翻译器应用程序的体系结构</p>
<h2 id="The-Webapp-UI-—-Cloud-Run"><a href="#The-Webapp-UI-—-Cloud-Run" class="headerlink" title="The Webapp UI — Cloud Run"></a>The Webapp UI — Cloud Run</h2><p>在这里，我在 Google Cloud Run 上将 Flask Web 应用程序作为容器运行。Web 应用程序执行以下几项操作：</p>
<ol>
<li>它呈现包含用于捕获用户输入（例如语言和图像上传）的表单的前端页面。</li>
<li>它处理来自用户的请求，捕获图像，并将其发送到 Cloud Function 后端。</li>
</ol>
<p>我之所以选择 Cloud Run，是因为：</p>
<ul>
<li>它提供了一种托管和运行容器化应用程序的无服务器方式。（即我们的 Python Flask Web 应用程序。</li>
<li>它非常适合托管简单的无状态 Web 应用程序，例如这个应用程序。</li>
<li>它会自动扩展，并在没有需求时缩减到 0 个实例。</li>
</ul>
<h2 id="后端-—-云函数"><a href="#后端-—-云函数" class="headerlink" title="后端 — 云函数"></a>后端 — 云函数</h2><p>Cloud Function 从用户处接收图像（通过 Web 应用程序界面），然后调用相应的 Google Cloud API，以便从图像中提取文本并进行翻译。</p>
<p>我之所以选择 Cloud Functions，是因为：</p>
<ul>
<li>它非常适合执行短期处理，以响应事件。因此，非常适合运行我们的提取和翻译任务，以响应用户上传的图像。</li>
<li>它会自动缩放，并在没有需求时缩减到 0。</li>
<li>我们可以将图像处理与实际用户前端解耦。因此，如果我们想使用不同的前端，我们可以轻松地做到这一点，而无需更改云函数中的代码。</li>
</ul>
<h2 id="文本提取和翻译"><a href="#文本提取和翻译" class="headerlink" title="文本提取和翻译"></a>文本提取和翻译</h2><p>我正在使用 Google 预构建的 Vision API 和 Translation API。但是，为什么不使用生成式AI模型，例如Gemini Pro Vision呢？</p>
<ul>
<li>视觉和翻译 API 是专门为我想要执行的任务而构建的。</li>
<li>相反，Gemini Pro Gen AI 多模态基础模型可以响应自然语言提示，实现相同的结果。但是，我们在这里不需要自然语言交互。为什么？因为我们确切地知道我们希望 API 在响应图像上传时执行什么操作。</li>
<li>尽管 Gemino Pro Vision 作为多模态基础模型具有更多的多功能性，但这种功能伴随着更高的价格标签。Vision API 每月允许 1000 次免费调用;翻译 API 每月免费提供前五十万个字符的翻译。</li>
</ul>
<h1 id="我的开发环境"><a href="#我的开发环境" class="headerlink" title="我的开发环境"></a>我的开发环境</h1><h2 id="WSL"><a href="#WSL" class="headerlink" title="WSL"></a>WSL</h2><p>我正在运行 Windows，其中包含适用于 Linux 的 Windows 子系统 （WSL）。对于那些不熟悉 WSL 的人来说，它是一个开箱即用的环境（包含在 Windows 10 及更高版本中），允许直接在 Windows 中运行完整的 Linux 环境。我碰巧在使用 Ubuntu。</p>
<p>在 WSL 中工作的好处是我可以用 bash 编写任何必要的脚本，这意味着我的代码将更具可移植性。例如，我可以在自己的环境中运行与在 Google Cloud Shell 中相同的脚本。</p>
<h2 id="Visual-Studio-代码"><a href="#Visual-Studio-代码" class="headerlink" title="Visual Studio 代码"></a>Visual Studio 代码</h2><p>VS Code 是我选择的代码编辑器。它是免费和开源的。它在 Windows、Linux 和 Mac 上运行，并具有许多有用的插件，例如 Git 集成和 Google Cloud Code：一组 AI 辅助插件（包括 Gemini Code Assist），用于促进使用 Google Cloud 服务的本地开发。</p>
<h1 id="开发项目结构"><a href="#开发项目结构" class="headerlink" title="开发项目结构"></a>开发项目结构</h1><p>如果你想查看 git 存储库，你可以在这里找到它。</p>
<p>整体结构如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">└── image-text-translator</span><br><span class="line">    ├── docs/                   - Documentation for the repo</span><br><span class="line">    |</span><br><span class="line">    ├── infra-tf/               - Terraform for installing infra</span><br><span class="line">    |</span><br><span class="line">    ├── scripts/                - For environment setup and helper scripts</span><br><span class="line">    |   └── setup.sh            - Setup helper script</span><br><span class="line">    |</span><br><span class="line">    ├── app/                    - The Application</span><br><span class="line">    │   ├── ui_cr/                - Browser UI (Cloud Run)</span><br><span class="line">    │   │   ├── static/             - Static content for frontend</span><br><span class="line">    |   |   ├── templates/          - HTML templates for frontend</span><br><span class="line">    |   |   ├── app.py              - The Flask application</span><br><span class="line">    |   |   ├── requirements.txt    - The UI Python requirements</span><br><span class="line">    |   |   ├── Dockerfile             - Dockerfile to build the Flask container</span><br><span class="line">    |   |   └── .dockerignore          - Files to ignore in Dockerfile</span><br><span class="line">    |   |</span><br><span class="line">    │   └── backend_gcf/          - Backend (Cloud Function)</span><br><span class="line">    │       ├── main.py             - The backend CF application</span><br><span class="line">    │       └── requirements.txt    - The backend CF Python requirements</span><br><span class="line">    |</span><br><span class="line">    ├── testing/</span><br><span class="line">    │   └── images/</span><br><span class="line">    |</span><br><span class="line">    ├── requirements.txt          - Python requirements for project local dev</span><br><span class="line">    └── README.md</span><br></pre></td></tr></table></figure>

<h1 id="一次性-Google-项目设置和权限"><a href="#一次性-Google-项目设置和权限" class="headerlink" title="一次性 Google 项目设置和权限"></a>一次性 Google 项目设置和权限</h1><h2 id="创建-Google-Cloud-项目"><a href="#创建-Google-Cloud-项目" class="headerlink" title="创建 Google Cloud 项目"></a>创建 Google Cloud 项目</h2><p>为您的应用创建 Google Cloud 项目。这是我的：</p>
<p><img src="/../asset_serveless_ai/07.png"></p>
<p>创建您的 Google Cloud 项目</p>
<p>从具有足够权限的帐户（例如 或 Project Admin Org Admin .</p>
<h2 id="启用-API"><a href="#启用-API" class="headerlink" title="启用 API"></a>启用 API</h2><p>最终，我们将对这种配置进行 Terraform。但最初，这些是您需要启用的 API：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># Authenticate to Google Cloud</span><br><span class="line">gcloud auth list</span><br><span class="line"></span><br><span class="line"># Check we have the correct project selected</span><br><span class="line">export PROJECT_ID=&lt;enter your project ID&gt;</span><br><span class="line">gcloud config set project $PROJECT_ID</span><br><span class="line"></span><br><span class="line"># Enable Cloud Build API</span><br><span class="line">gcloud services enable cloudbuild.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Storage API</span><br><span class="line">gcloud services enable storage-api.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Artifact Registry API</span><br><span class="line">gcloud services enable artifactregistry.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Eventarc API</span><br><span class="line">gcloud services enable eventarc.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Run Admin API</span><br><span class="line">gcloud services enable run.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Logging API</span><br><span class="line">gcloud services enable logging.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Pub/Sub API</span><br><span class="line">gcloud services enable pubsub.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Functions API</span><br><span class="line">gcloud services enable cloudfunctions.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Translation API</span><br><span class="line">gcloud services enable translate.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Cloud Vision API</span><br><span class="line">gcloud services enable vision.googleapis.com</span><br><span class="line"></span><br><span class="line"># Enable Service Account Credentials API</span><br><span class="line">gcloud services enable iamcredentials.googleapis.com</span><br></pre></td></tr></table></figure>

<h2 id="服务帐户和角色"><a href="#服务帐户和角色" class="headerlink" title="服务帐户和角色"></a>服务帐户和角色</h2><p>服务帐户是管理应用程序（而不是最终用户）的身份验证和授权的标准方法。我们的 Cloud Run 应用程序需要向 Cloud Function 进行身份验证，而 Cloud Function 需要向 Cloud Cloud Vision 和 Translation API 进行身份验证。</p>
<p>因此，让我们创建一个服务帐户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Make sure your PROJECT_ID variable is set before doing this!</span><br><span class="line">export SVC_ACCOUNT=image-text-translator-sa</span><br><span class="line">export SVC_ACCOUNT_EMAIL=$SVC_ACCOUNT@$PROJECT_ID.iam.gserviceaccount.com</span><br><span class="line"></span><br><span class="line"># Attaching a user-managed service account is the preferred way to provide credentials to ADC for production code running on Google Cloud.</span><br><span class="line">gcloud iam service-accounts create $SVC_ACCOUNT</span><br></pre></td></tr></table></figure>

<p>现在，我们将多个角色绑定到我们的服务帐户：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># Grant roles to the service account</span><br><span class="line">gcloud projects add-iam-policy-binding $PROJECT_ID \</span><br><span class="line">  --member=&quot;serviceAccount:$SVC_ACCOUNT_EMAIL&quot; \</span><br><span class="line">  --role=roles/run.admin</span><br><span class="line"></span><br><span class="line">gcloud projects add-iam-policy-binding $PROJECT_ID \</span><br><span class="line">  --member=&quot;serviceAccount:$SVC_ACCOUNT_EMAIL&quot; \</span><br><span class="line">  --role=roles/run.invoker</span><br><span class="line"></span><br><span class="line">gcloud projects add-iam-policy-binding $PROJECT_ID \</span><br><span class="line">  --member=&quot;serviceAccount:$SVC_ACCOUNT_EMAIL&quot; \</span><br><span class="line">  --role=roles/cloudfunctions.admin</span><br><span class="line"></span><br><span class="line">gcloud projects add-iam-policy-binding $PROJECT_ID \</span><br><span class="line">  --member=&quot;serviceAccount:$SVC_ACCOUNT_EMAIL&quot; \</span><br><span class="line">  --role=roles/cloudfunctions.invoker</span><br><span class="line"></span><br><span class="line">gcloud projects add-iam-policy-binding $PROJECT_ID \</span><br><span class="line">  --member=&quot;serviceAccount:$SVC_ACCOUNT_EMAIL&quot; \</span><br><span class="line">  --role=&quot;roles/cloudtranslate.user&quot;</span><br><span class="line"></span><br><span class="line"># Grant the required role to the principal that will attach the service account to other resources.</span><br><span class="line">gcloud iam service-accounts add-iam-policy-binding $SVC_ACCOUNT_EMAIL \</span><br><span class="line">  --member=&quot;group:gcp-devops@my-org.com&quot; \</span><br><span class="line">  --role=roles/iam.serviceAccountUser</span><br><span class="line"></span><br><span class="line"># Allow service account impersonation</span><br><span class="line">gcloud iam service-accounts add-iam-policy-binding $SVC_ACCOUNT_EMAIL \</span><br><span class="line">  --member=&quot;group:gcp-devops@my-org.com&quot; \</span><br><span class="line">  --role=roles/iam.serviceAccountTokenCreator</span><br><span class="line"></span><br><span class="line"># Ensure your account has access to deploy to Cloud Functions and Cloud Run</span><br><span class="line">gcloud projects add-iam-policy-binding $PROJECT_ID \</span><br><span class="line">   --member=&quot;group:gcp-devops@my-org.com&quot; \</span><br><span class="line">   --role roles/run.admin</span><br></pre></td></tr></table></figure>

<h1 id="本地开发环境设置"><a href="#本地开发环境设置" class="headerlink" title="本地开发环境设置"></a>本地开发环境设置</h1><p>（您需要在计划进行开发的任何计算机上执行这些步骤。</p>
<p>打开终端。（我正在从 Windows 终端打开 Ubuntu Shell。如果您尚未这样做，则需要将 Google gcloud CLI 和支持工具安装到您的本地环境中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Install Google Cloud CLI in your local Linux environment.</span><br><span class="line"># See https://cloud.google.com/sdk/docs/install</span><br><span class="line"></span><br><span class="line"># Setup Python and pip in Gcloud CLI</span><br><span class="line"># See https://cloud.google.com/python/docs/setup</span><br><span class="line"></span><br><span class="line"># Install additional Google Cloud CLI packages for local dev</span><br><span class="line">sudo apt install google-cloud-cli-gke-gcloud-auth-plugin kubectl google-cloud-cli-skaffold google-cloud-cli-minikube</span><br></pre></td></tr></table></figure>

<p>在这里（从现在开始），我们将使用我们的开发人员帐户进行身份验证，而不是组织管理员帐户。为什么？我遵循最小特权原则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Authenticate to Google Cloud</span><br><span class="line">gcloud auth login</span><br></pre></td></tr></table></figure>

<p>身份验证时，单击显示的第一个链接。然后，系统会提示您提供密码。</p>
<p><img src="/../asset_serveless_ai/08.png"></p>
<p>向 Google Cloud 进行身份验证</p>
<p>接下来，我们将设置应用程序项目文件夹并安装一些依赖项。如果您要遵循并从头开始构建应用程序，则接下来的步骤如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># This is where I keep my project</span><br><span class="line">cd ~/localdev/gcp/image-text-translator</span><br><span class="line"></span><br><span class="line"># Create a Python virtual env. For example...</span><br><span class="line">python3 -m venv .venv</span><br><span class="line"># And now ACTIVATE it</span><br><span class="line"></span><br><span class="line"># Add Python packages we need...</span><br><span class="line">python3 -m pip install Flask</span><br><span class="line">python3 -m pip install pillow # For image handling</span><br><span class="line">python3 -m pip install functions-framework</span><br><span class="line">python3 -m pip install google-cloud-storage google-cloud-translate google-cloud-vision google-auth</span><br><span class="line"></span><br><span class="line"># And create the requirements.txt file</span><br><span class="line">python3 -m pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure>

<p>或者，如果你想克隆我的 git 存储库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/derailed-dash/image-text-translator.git</span><br><span class="line"></span><br><span class="line">cd image-text-translator</span><br><span class="line"></span><br><span class="line"># Create a Python virtual env. For example...</span><br><span class="line">python3 -m venv .venv</span><br><span class="line"># And now ACTIVATE it. E.g.</span><br><span class="line">source .venv/bin/activate</span><br><span class="line"></span><br><span class="line"># Install the Python dependencies now</span><br><span class="line">python3 -m pip install -r requirements.txt</span><br></pre></td></tr></table></figure>

<h2 id="Git-设置"><a href="#Git-设置" class="headerlink" title="Git 设置"></a>Git 设置</h2><p>如果你从头开始构建所有内容（没有克隆我的存储库），你现在应该设置你的 Git 和 GitHub 环境。别忘了先创建 .gitignore .查看我的存储库以了解它应该是什么样子。然后按照下列步骤操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Setup git in Cloud Shell, if you haven&#x27;t done so before</span><br><span class="line">git config --global user.email &quot;bob@wherever.com&quot;</span><br><span class="line">git config --global user.name &quot;Bob&quot;</span><br><span class="line">git config --global core.autocrlf input # really important if you&#x27;re using WSL!</span><br><span class="line"></span><br><span class="line"># Create local git repo.</span><br><span class="line"># Before proceeding, make sure you have created .gitignore file </span><br><span class="line"># to ignore .terraform dirs and local state, plans, etc.</span><br><span class="line">git init</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line"></span><br><span class="line"># Let&#x27;s authenticate the GitHub command line tool</span><br><span class="line"># It is already installed on Cloud Shell</span><br><span class="line">gh auth login</span><br><span class="line"></span><br><span class="line"># Now let&#x27;s use gh cli to create a remote repo in GitHub.</span><br><span class="line"># You can make it private, if you prefer</span><br><span class="line">gh repo create image-text-translator --public --source=.</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h2 id="运行-VS-Code"><a href="#运行-VS-Code" class="headerlink" title="运行 VS Code"></a>运行 VS Code</h2><p>让我们从项目文件夹中打开 VS Code：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># From /path/to/your/image-text-translator</span><br><span class="line">code .</span><br></pre></td></tr></table></figure>

<p>VS Code 足够聪明，可以配置所需的任何必要的 WSL 插件。</p>
<p><img src="/../asset_serveless_ai/09.png"></p>
<p>VS Code 知道它在 WSL 环境中工作</p>
<h2 id="安装应用程序默认凭据-（ADC）"><a href="#安装应用程序默认凭据-（ADC）" class="headerlink" title="安装应用程序默认凭据 （ADC）"></a>安装应用程序默认凭据 （ADC）</h2><p>ADC 是一种策略，它允许身份验证库根据当前环境自动查找凭据。这很有用，因为我们既可以在本地环境（使用 Cloud SDK）中利用 ADC，也可以在 Google Cloud 上的目标环境中利用 ADC。</p>
<p>ADC 可以配置为使用我们的服务帐户凭据。有两种方法可以做到这一点：</p>
<ol>
<li>我们可以使用自己的用户身份模拟服务帐户。</li>
<li>我们可以为我们的服务帐户创建一个私钥，并将 ADC 指向此密钥的位置。</li>
</ol>
<p>我最初尝试使用模拟：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud auth application-default login --impersonate-service-account $SVC_ACCOUNT_EMAIL</span><br></pre></td></tr></table></figure>

<p>不幸的是，在对 Cloud Run 的 Cloud Function 调用进行身份验证时，我很难做到这一点。因此，我创建了一个服务帐户密钥，我们可以将 ADC 指向：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gcloud auth application-default login</span><br><span class="line"></span><br><span class="line"># If these are not already set...</span><br><span class="line">export SVC_ACCOUNT=image-text-translator-sa</span><br><span class="line">export SVC_ACCOUNT_EMAIL=$SVC_ACCOUNT@$PROJECT_ID.iam.gserviceaccount.com</span><br><span class="line"></span><br><span class="line"># Create a service account key for local dev</span><br><span class="line">gcloud iam service-accounts keys create ~/.config/gcloud/$SVC_ACCOUNT.json \</span><br><span class="line">  --iam-account=$SVC_ACCOUNT_EMAIL</span><br><span class="line"></span><br><span class="line"># Configure the ADC environment variable</span><br><span class="line"># which is automatically detected by client libraries</span><br><span class="line">export GOOGLE_APPLICATION_CREDENTIALS=~/.config/gcloud/$SVC_ACCOUNT.json</span><br></pre></td></tr></table></figure>

<p>我们实际上需要在每个会话中设置这个 GOOGLE_APPLICATION_CREDENTIALS 环境变量。这就把我们带到了…</p>
<h1 id="每个会话的设置"><a href="#每个会话的设置" class="headerlink" title="每个会话的设置"></a>每个会话的设置</h1><p>您需要在每个新的终端会话中运行这些命令。（或者，您可以运行命令 source <project_dir>&#x2F;scripts&#x2F;setup.sh 来运行这些命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">export PROJECT_ID=$(gcloud config list --format=&#x27;value(core.project)&#x27;)</span><br><span class="line">export REGION=europe-west4</span><br><span class="line">export SVC_ACCOUNT=image-text-translator-sa</span><br><span class="line">export SVC_ACCOUNT_EMAIL=$SVC_ACCOUNT@$PROJECT_ID.iam.gserviceaccount.com</span><br><span class="line">export GOOGLE_APPLICATION_CREDENTIALS=~/.config/gcloud/$SVC_ACCOUNT.json</span><br><span class="line"></span><br><span class="line"># Functions</span><br><span class="line">export FUNCTIONS_PORT=8081</span><br><span class="line">export BACKEND_GCF=https://$REGION-$PROJECT_ID.cloudfunctions.net/extract-and-translate</span><br><span class="line"></span><br><span class="line"># Flask</span><br><span class="line">export FLASK_SECRET_KEY=some-secret-1234</span><br><span class="line">export FLASK_RUN_PORT=8080</span><br><span class="line"></span><br><span class="line">echo &quot;Environment variables configured:&quot;</span><br><span class="line">echo PROJECT_ID=&quot;$PROJECT_ID&quot;</span><br><span class="line">echo REGION=&quot;$REGION&quot;</span><br><span class="line">echo SVC_ACCOUNT_EMAIL=&quot;$SVC_ACCOUNT_EMAIL&quot;</span><br><span class="line">echo BACKEND_GCF=&quot;$BACKEND_GCF&quot;</span><br><span class="line">echo FUNCTIONS_PORT=&quot;$FUNCTIONS_PORT&quot;</span><br><span class="line">echo FLASK_RUN_PORT=&quot;$FLASK_RUN_PORT&quot;</span><br></pre></td></tr></table></figure>

<h1 id="云函数后端"><a href="#云函数后端" class="headerlink" title="云函数后端"></a>云函数后端</h1><h2 id="功能的本地开发"><a href="#功能的本地开发" class="headerlink" title="功能的本地开发"></a>功能的本地开发</h2><p>我不会重现所有代码，因为您可以在 GitHub 中查看它。我只想指出几件关键的事情。</p>
<p>在我的 backend-gcf 文件夹中，我创建了一个 requirements.txt .这是为了定义必须安装的 Python 包。当您部署 Cloud Functions 时，Cloud Functions 会自动安装这些软件包。</p>
<p>然后我创建一个 main.py .以下是作为云函数入口点的部分函数： extract_and_translate() 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@functions_framework.http</span><br><span class="line">def extract_and_translate(request):</span><br><span class="line">    &quot;&quot;&quot;Extract and translate the text from an image.</span><br><span class="line">    The image can be POSTed in the request, or it can be a GCS object reference.</span><br><span class="line"></span><br><span class="line">    If a POSTed image, enctype should be multipart/form-data and the file should be named &#x27;uploaded&#x27;.</span><br><span class="line">    If we&#x27;re passing a GCS object reference, content-type should be &#x27;application/json&#x27;, </span><br><span class="line">    with two attributes:</span><br><span class="line">    - bucket: name of GCS bucket in which the file is stored.</span><br><span class="line">    - filename: name of the file to be read.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # Check if the request method is POST</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        # Get the uploaded file from the request</span><br><span class="line">        uploaded = request.files.get(&#x27;uploaded&#x27;)  # Assuming the input filename is &#x27;uploaded&#x27;</span><br><span class="line">        to_lang = request.form.get(&#x27;to_lang&#x27;, &quot;en&quot;)</span><br><span class="line">        print(f&quot;&#123;uploaded=&#125;, &#123;to_lang=&#125;&quot;)</span><br><span class="line">        if not uploaded:</span><br><span class="line">            return flask.jsonify(&#123;&quot;error&quot;: &quot;No file uploaded.&quot;&#125;), 400</span><br><span class="line"></span><br><span class="line">        if uploaded: # Process the uploaded file</span><br><span class="line">            file_contents = uploaded.read()  # Read the file contents</span><br><span class="line">            image = vision.Image(content=file_contents)</span><br><span class="line">        else:</span><br><span class="line">            return flask.jsonify(&#123;&quot;error&quot;: &quot;Unable to read uploaded file.&quot;&#125;), 400</span><br></pre></td></tr></table></figure>

<p>这是不言自明的。</p>
<ul>
<li>我们检查函数是否已收到 POST。 （稍后，我们将创建 Cloud Run 应用程序来 POST 请求。</li>
<li>如果是这样，我们将在请求中查找一个名为 uploaded 的对象。（我们的 Cloud Run 应用程序会将其附加到请求中。</li>
<li>如果我们发现这个对象附加了，我们把它读成二进制，然后用它来创建 vision.Image 对象。</li>
<li>接下来我们调用函数 detect_text() ，传入图像。此函数将使用 Vision API 查看图像中是否有任何文本。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Use the Vision API to extract text from the image</span><br><span class="line">detected = detect_text(image)</span><br><span class="line">if detected:</span><br><span class="line">   translated = translate_text(detected, to_lang)</span><br><span class="line">   if translated[&quot;text&quot;] != &quot;&quot;:</span><br><span class="line">       return translated[&quot;text&quot;]</span><br></pre></td></tr></table></figure>

<p>如果是这样，它将返回包含此文本的 Python 字典。然后，它会将此文本传递到函数中 translate_text() ，以将文本翻译成我们选择的语言。</p>
<p>detect_text() 功能如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">def detect_text(image: vision.Image) -&gt; dict | None:</span><br><span class="line">    &quot;&quot;&quot;Extract the text from the Image object &quot;&quot;&quot;</span><br><span class="line">    text_detection_response = vision_client.text_detection(image=image)</span><br><span class="line">    annotations = text_detection_response.text_annotations</span><br><span class="line"></span><br><span class="line">    if annotations:</span><br><span class="line">        text = annotations[0].description</span><br><span class="line">    else:</span><br><span class="line">        text = &quot;&quot;</span><br><span class="line">    print(f&quot;Extracted text from image:\n&#123;text&#125;&quot;)</span><br><span class="line"></span><br><span class="line">    # Returns language identifer in ISO 639-1 format. E.g. en.</span><br><span class="line">    # See https://en.wikipedia.org/wiki/List_of_ISO_639_language_codes</span><br><span class="line">    detect_language_response = translate_client.detect_language(text)</span><br><span class="line">    src_lang = detect_language_response[&quot;language&quot;]</span><br><span class="line">    print(f&quot;Detected language: &#123;src_lang&#125;.&quot;)</span><br><span class="line"></span><br><span class="line">    message = &#123;</span><br><span class="line">        &quot;text&quot;: text,</span><br><span class="line">        &quot;src_lang&quot;: src_lang,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return message</span><br></pre></td></tr></table></figure>

<p>此代码不仅检测图像中的任何文本，还使用 Google 语言 API 来确定文本的语言。</p>
<p>接下来， translate_text() 函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">def translate_text(message: dict, to_lang: str) -&gt; dict:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Translates the text in the message from the specified source language</span><br><span class="line">    to the requested target language, then sends a message requesting another</span><br><span class="line">    service save the result.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    text = message[&quot;text&quot;]</span><br><span class="line">    src_lang = message[&quot;src_lang&quot;]</span><br><span class="line"></span><br><span class="line">    translated = &#123; # before translating</span><br><span class="line">        &quot;text&quot;: text,</span><br><span class="line">        &quot;src_lang&quot;: src_lang,</span><br><span class="line">        &quot;to_lang&quot;: to_lang,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if src_lang != to_lang and src_lang != &quot;und&quot;:</span><br><span class="line">        print(f&quot;Translating text into &#123;to_lang&#125;.&quot;)</span><br><span class="line">        translated_text = translate_client.translate(</span><br><span class="line">                text, target_language=to_lang, source_language=src_lang)</span><br><span class="line"></span><br><span class="line">        translated = &#123;</span><br><span class="line">            &quot;text&quot;: unescape(translated_text[&quot;translatedText&quot;]),</span><br><span class="line">            &quot;src_lang&quot;: src_lang,</span><br><span class="line">            &quot;to_lang&quot;: to_lang,</span><br><span class="line">        &#125;</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;No translation required.&quot;)</span><br><span class="line"></span><br><span class="line">    return translated</span><br></pre></td></tr></table></figure>

<p>我们检查源语言和目标语言是否不同，并且源语言是否未定义。如果我们通过了此检查，我们将使用 Google 翻译 API 来翻译文本。</p>
<h2 id="本地测试"><a href="#本地测试" class="headerlink" title="本地测试"></a>本地测试</h2><p>首先，让我们在本地运行该函数。从我们的 backend-gcf 文件夹中运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Run the function</span><br><span class="line">functions-framework --target extract_and_translate \</span><br><span class="line">  --debug --port $FUNCTIONS_PORT</span><br></pre></td></tr></table></figure>

<p>它应该看起来像这样：</p>
<p><img src="/../asset_serveless_ai/10.png"></p>
<p>在本地运行我们的函数</p>
<p>我将用这张图片进行测试：</p>
<p><img src="/../asset_serveless_ai/11.png"></p>
<p> 乌克兰语中的模因</p>
<p>从第二个终端，让我们对函数进行 POST 操作，使用 curl ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># You will first need to authenticate and set the environment vars in this terminal</span><br><span class="line">source ./scripts/setup.sh</span><br><span class="line"></span><br><span class="line"># now invoke</span><br><span class="line">curl -X POST localhost:$FUNCTIONS_PORT \</span><br><span class="line">   -H &quot;Content-Type: multipart/form-data&quot; \</span><br><span class="line">   -F &quot;uploaded=@./testing/images/ua_meme.jpg&quot; \</span><br><span class="line">   -F &quot;to_lang=en&quot;</span><br></pre></td></tr></table></figure>

<p> 它有效！！</p>
<p><img src="/../asset_serveless_ai/12.png"></p>
<p>我们申请的回应</p>
<h2 id="部署云功能（到-Google-Cloud）"><a href="#部署云功能（到-Google-Cloud）" class="headerlink" title="部署云功能（到 Google Cloud）"></a>部署云功能（到 Google Cloud）</h2><p>现在我们已经在本地测试了它，我们可以将其部署到 Google Cloud。同样，我们必须从我们的 backend-gcf 文件夹中运行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># From the backend-gcf folder</span><br><span class="line">gcloud functions deploy extract-and-translate \</span><br><span class="line">  --gen2 --max-instances 1 \</span><br><span class="line">  --region $REGION \</span><br><span class="line">  --runtime=python312 --source=. \</span><br><span class="line">  --trigger-http --entry-point=extract_and_translate \</span><br><span class="line">  --no-allow-unauthenticated</span><br><span class="line"></span><br><span class="line"># Allow this function to be called by the service account</span><br><span class="line">gcloud functions add-invoker-policy-binding extract-and-translate \</span><br><span class="line">  --region=$REGION \</span><br><span class="line">  --member=&quot;serviceAccount:$SVC_ACCOUNT_EMAIL&quot;</span><br></pre></td></tr></table></figure>

<p> 部署结果：</p>
<p><img src="/../asset_serveless_ai/13.png"></p>
<p> 部署成功！</p>
<p>这是一件很酷的事情……借助 VS Code 中的 Cloud Code 扩展，我们现在可以看到我们在 Google Cloud 中部署的云功能！</p>
<p><img src="/../asset_serveless_ai/14.png"></p>
<p>在 Google Cloud 中查看我们的云功能，从 VS Code 中的 Cloud Code 查看</p>
<h2 id="测试云函数"><a href="#测试云函数" class="headerlink" title="测试云函数"></a>测试云函数</h2><p>我们只需要一个稍微不同的 curl 命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST https://$REGION-$PROJECT_ID.cloudfunctions.net/extract-and-translate \</span><br><span class="line">    -H &quot;Authorization: Bearer $(gcloud auth print-identity-token)&quot; \</span><br><span class="line">    -H &quot;Content-Type: multipart/form-data&quot; \</span><br><span class="line">    -F &quot;uploaded=@./testing/images/ua_meme.jpg&quot; \</span><br><span class="line">    -F &quot;to_lang=en&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_serveless_ai/15.png"></p>
<p> 它有效！</p>
<p>让我们用这个模因测试英语到英语：</p>
<p><img src="/../asset_serveless_ai/16.jpg"></p>
<p> 测试英语反式</p>
<p><img src="/../asset_serveless_ai/17.png"></p>
<p> 提取英语</p>
<p>现在我将尝试翻译成乌克兰语：</p>
<p><img src="/../asset_serveless_ai/18.png"></p>
<p> 翻译成乌克兰语</p>
<p>呜呜！它有效！现在到法语：</p>
<p><img src="/../asset_serveless_ai/19.png"></p>
<p> 翻译成法语</p>
<p>万岁！所有测试似乎都在起作用。</p>
<p>注意：如果您尝试在不传入经过身份验证和授权的凭据的情况下使用该函数，则会看到以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;403 Forbidden&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body text=#000000 bgcolor=#ffffff&gt;</span><br><span class="line">&lt;h1&gt;Error: Forbidden&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;Your client does not have permission to get URL &lt;code&gt;/extract-and-translate&lt;/code&gt; from this server.&lt;/h2&gt;</span><br><span class="line">&lt;h2&gt;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="部署新版本"><a href="#部署新版本" class="headerlink" title="部署新版本"></a>部署新版本</h2><p>如果我们更新代码并想要重新部署，我们可以重新运行相同的 deploy 命令。</p>
<p><img src="/../asset_serveless_ai/20.png"></p>
<p>通过重新部署来更新我们的功能</p>
<h2 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h2><p>如果要删除 Cloud Funtion，只需运行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcloud functions delete extract-and-translate --region=$REGION</span><br></pre></td></tr></table></figure>

<h1 id="烧瓶用户界面"><a href="#烧瓶用户界面" class="headerlink" title="烧瓶用户界面"></a>烧瓶用户界面</h1><p>我们将使用 Cloud Run 创建一个简单的 Flask Python Web 应用程序。此应用程序将呈现表单页面，并处理表单。然后，在检索表单响应（包括上传的图像）后，它将调用我们的云函数。</p>
<h2 id="创建-Flask-Web-应用程序"><a href="#创建-Flask-Web-应用程序" class="headerlink" title="创建 Flask Web 应用程序"></a>创建 Flask Web 应用程序</h2><p>本文不打算作为 Flask 教程。因此，我的建议是查看 GitHub 存储库 ui_cr 文件夹中的代码。</p>
<p>但这里有一些关键点：</p>
<ul>
<li>我创建了一个 requirements.txt 来定义此应用程序所需的 Python 包。</li>
<li>我创建了一个 Dockerfile 负责将我们的 Flask 应用程序打包到 Docker 容器中。（稍后我们将需要此功能才能部署到 Cloud Run。为此，它复制 ui_cr 文件夹的内容，安装 Python 依赖项（如 中 requirements.txt 所定义），然后定义应用程序的入口点。即运行 python app.py .</li>
</ul>
<p>我们的 ui_cr 文件夹具有以下结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── ui_cr/                - Browser UI (Cloud Run)</span><br><span class="line">    ├── static/             - Static content for frontend</span><br><span class="line">    ├── templates/          - HTML templates for frontend</span><br><span class="line">    ├── app.py              - The Flask application</span><br><span class="line">    ├── requirements.txt    - The UI Python requirements</span><br><span class="line">    ├── Dockerfile             - Dockerfile to build the Flask container</span><br><span class="line">    └── .dockerignore          - Files to ignore in Dockerfile</span><br></pre></td></tr></table></figure>

<h2 id="应用程序代码"><a href="#应用程序代码" class="headerlink" title="应用程序代码"></a>应用程序代码</h2><p>我不打算详细介绍代码。但我会强调一些有趣的观点和陷阱。</p>
<p>让我们来看看 app.py 。首先，实例化 Flask 应用程序的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def create_app():</span><br><span class="line">    &quot;&quot;&quot; Create and configure the app &quot;&quot;&quot;</span><br><span class="line">    flask_app = Flask(__name__, instance_relative_config=True)</span><br><span class="line">    flask_app.config.from_mapping(</span><br><span class="line">        SECRET_KEY=&#x27;dev&#x27;, # override with FLASK_SECRET_KEY env var</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    # Load envs starting with FLASK_</span><br><span class="line">    # E.g. FLASK_SECRET_KEY, FLASK_PORT</span><br><span class="line">    flask_app.config.from_prefixed_env()</span><br><span class="line">    client = translate.Client()</span><br><span class="line">    flask_app.languages = &#123;lang[&#x27;language&#x27;]: lang[&#x27;name&#x27;] for lang in client.get_languages()&#125;</span><br><span class="line">    flask_app.backend_func = os.environ.get(&#x27;BACKEND_GCF&#x27;, &#x27;undefined&#x27;)</span><br><span class="line">    return flask_app</span><br><span class="line"></span><br><span class="line">app = create_app()</span><br></pre></td></tr></table></figure>

<ul>
<li>Flask 应用程序需要密钥才能管理会话。我们可以使用环境变量 FLASK_SECRET_KEY 将密钥传递给应用程序。</li>
<li>我正在使用 Google 翻译 API 检索要翻译的可用语言列表。我将使用它在我的表单中填充下拉选择。</li>
<li>我们需要传递目标函数的 URL。同样，我将为此使用一个环境变量： BACKEND_GCF .</li>
</ul>
<h2 id="处理对-Flask-主页的请求"><a href="#处理对-Flask-主页的请求" class="headerlink" title="处理对 Flask 主页的请求"></a>处理对 Flask 主页的请求</h2><p>在这里，我们处理对 &#x2F; 的请求。当我们的用户第一次访问该页面时，他们将发送一个 GET 请求。但是，当他们提交带有要翻译的图像的表格时，该请求将作为 POST 收到。因此，我们需要同时处理两者。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def entry():</span><br><span class="line">    &quot;&quot;&quot; Render the upload form &quot;&quot;&quot;</span><br><span class="line">    message = &quot;Upload your image!&quot;</span><br><span class="line">    to_lang = os.environ.get(&#x27;TO_LANG&#x27;, &#x27;en&#x27;)</span><br><span class="line">    encoded_img = &quot;&quot;</span><br><span class="line">    translation = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    if request.method == &#x27;POST&#x27;: # Form has been posted</span><br><span class="line">        app.logger.debug(&quot;Got POST&quot;)</span><br><span class="line">        file = request.files.get(&#x27;file&#x27;)</span><br><span class="line">        to_lang = request.form.get(&#x27;to_lang&#x27;)</span><br><span class="line"></span><br><span class="line">        if file is None:</span><br><span class="line">            flash(&#x27;No file part.&#x27;)</span><br><span class="line">        elif file.filename == &#x27;&#x27;:</span><br><span class="line">            flash(&#x27;No file selected for uploading.&#x27;)</span><br><span class="line">        elif not allowed_file(file.filename):</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            flash(f&#x27;&#123;secure_filename(filename)&#125; is not a supported image format. &#x27;</span><br><span class="line">                  f&#x27;Supported formats are: &#123;ALLOWED_EXTENSIONS&#125;&#x27;)</span><br><span class="line">        else:</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            app.logger.debug(&quot;Got %s&quot;, filename)</span><br><span class="line">            app.logger.debug(&quot;Translating to %s&quot;, to_lang)</span><br><span class="line"></span><br><span class="line">            # We don&#x27;t need to save the image. We just want to binary encode it.</span><br><span class="line">            try:</span><br><span class="line">                img = Image.open(file.stream)</span><br><span class="line">                with BytesIO() as buf:</span><br><span class="line">                    if img_format := img.format: # e.g. JPEG, GIF, PNG</span><br><span class="line">                        img.save(buf, img_format.lower())</span><br><span class="line">                        content_type = f&quot;image/&#123;img_format.lower()&#125;&quot;</span><br><span class="line">                        image_bytes = buf.getvalue()</span><br><span class="line">                        encoded_img = base64.b64encode(image_bytes).decode()</span><br><span class="line">                    else:</span><br><span class="line">                        flash(&#x27;Unable to determine image format.&#x27;)</span><br><span class="line">            except UnidentifiedImageError:</span><br><span class="line">                # This will happen if we resubmit the form</span><br><span class="line">                flash(&#x27;Unable to process image.&#x27;)</span><br><span class="line"></span><br><span class="line">            if encoded_img:</span><br><span class="line">                message = f&quot;Processed &lt;&#123;secure_filename(filename)&#125;&gt;. Feel free to upload a new image.&quot;</span><br><span class="line">                func_response = make_authorized_post_request(endpoint=app.backend_func,</span><br><span class="line">                                        image_data=image_bytes, to_lang=to_lang,</span><br><span class="line">                                        filename=filename, content_type=content_type)</span><br><span class="line">                app.logger.debug(&quot;Function response code: %s&quot;, func_response.status_code)</span><br><span class="line">                app.logger.debug(&quot;Function response text: %s&quot;, func_response.text)</span><br><span class="line">                translation = func_response.text</span><br><span class="line"></span><br><span class="line">    return render_template(&#x27;index.html&#x27;,</span><br><span class="line">                           languages=app.languages,</span><br><span class="line">                           message=message,</span><br><span class="line">                           to_lang=to_lang,</span><br><span class="line">                           img_data=encoded_img,</span><br><span class="line">                           translation=translation), 200</span><br></pre></td></tr></table></figure>

<p>我们验证输入，然后 - 如果图像已上传并且是有效的图像 - 我们向云函数发出请求。此请求需要传递上传图像的原始字节。</p>
<p>此外，我希望能够在返回的页面中向用户显示上传的图像。我想避免将上传的图像保存在后端的磁盘上，所以我采取了这种方法：</p>
<ul>
<li>将上传的图像转换为内存中的 BytesIO 对象。</li>
<li>将内存中的对象转换为 JPEG。</li>
<li>在缓冲区中检索图像的原始字节数据。（这也是我将发送到函数的原始 make_authorised_post_request() 数据。</li>
<li>使用 Base64 编码对 JPEG 二进制图像数据进行编码，这是一种可以安全地发送回浏览器的字符串表示形式。</li>
</ul>
<h2 id="对我们的函数进行经过身份验证的调用"><a href="#对我们的函数进行经过身份验证的调用" class="headerlink" title="对我们的函数进行经过身份验证的调用"></a>对我们的函数进行经过身份验证的调用</h2><p>从 Cloud Run Flask 应用程序调用 Cloud Function 时，我们需要在请求标头中包含服务帐户访问令牌。Google 客户端库将自动从 ADC 检索凭据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">def make_authorized_post_request(endpoint:str,</span><br><span class="line">                                 image_data, to_lang:str,</span><br><span class="line">                                 filename:str, content_type:str):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Make a POST request to the specified HTTP endpoint by authenticating with the ID token</span><br><span class="line">    obtained from the google-auth client library using the specified audience value.</span><br><span class="line">    Expects the image_data to be a bytes representation of the image.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if endpoint == &quot;undefined&quot;:</span><br><span class="line">        raise ValueError(&quot;Unable to retrieve Function endpoint.&quot;)</span><br><span class="line"></span><br><span class="line">    # Cloud Functions uses your function&#x27;s URL as the `audience` value</span><br><span class="line">    # For Cloud Functions, `endpoint` and `audience` should be equal</span><br><span class="line">    # ADC requires valid service account credentials</span><br><span class="line">    audience = endpoint</span><br><span class="line">    auth_req = GoogleAuthRequest()</span><br><span class="line"></span><br><span class="line">    # Requests OAuth 2.0 access token for the service identity</span><br><span class="line">    # from the instance metadata server or with local ADC. E.g.</span><br><span class="line">    # export GOOGLE_APPLICATION_CREDENTIALS=/path/to/svc_account.json</span><br><span class="line">    id_token = google.oauth2.id_token.fetch_id_token(auth_req, audience)</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;Authorization&quot;: f&quot;Bearer &#123;id_token&#125;&quot;,</span><br><span class="line">        # &quot;Content-Type&quot;: &quot;multipart/form-data&quot; # Let requests library decide on the content-type</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    files = &#123;</span><br><span class="line">        &quot;uploaded&quot;: (filename, image_data, content_type),</span><br><span class="line">        &quot;to_lang&quot;: (None, to_lang)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # Send the HTTP POST request to the Cloud Function</span><br><span class="line">    response = requests.post(endpoint, headers=headers, files=files, timeout=10)</span><br><span class="line"></span><br><span class="line">    return response</span><br></pre></td></tr></table></figure>

<h2 id="获取用户输入"><a href="#获取用户输入" class="headerlink" title="获取用户输入"></a>获取用户输入</h2><p>Flask 使用 Jinja2 模板将内容渲染回浏览器。这些是包含嵌入代码的 HTML 文件。当我们从 中 app.py 调用 render_template() 时，我们会传入一些变量，然后在模板中引用这些变量。</p>
<h2 id="启动和调试"><a href="#启动和调试" class="headerlink" title="启动和调试"></a>启动和调试</h2><p>我们可以通过以下几种方式在本地启动 Flask 应用程序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cd app/ui_cr/</span><br><span class="line">source ../../scripts/setup.sh  # Initialise vars if we&#x27;re in a new terminal</span><br><span class="line"></span><br><span class="line"># Run the Flask App</span><br><span class="line">python app.py</span><br><span class="line"></span><br><span class="line"># Or with the Flask command.</span><br><span class="line"># This will automatically load any environment vars starting FLASK_</span><br><span class="line"># The --debug tells Flask to automatically reload after any changes</span><br><span class="line"># and to set the app.logger to debug.</span><br><span class="line">python -m flask --app app run --debug</span><br></pre></td></tr></table></figure>

<p>此外，如果要使用 VS Code 交互式调试器，我建议创建如下所示的启动配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;configurations&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;name&quot;: &quot;Python Debugger: Flask&quot;,</span><br><span class="line">            &quot;type&quot;: &quot;debugpy&quot;,</span><br><span class="line">            &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">            &quot;module&quot;: &quot;flask&quot;,</span><br><span class="line">            &quot;cwd&quot;: &quot;$&#123;workspaceFolder&#125;/app/ui_cr&quot;,</span><br><span class="line">            &quot;env&quot;: &#123;</span><br><span class="line">                &quot;FLASK_APP&quot;: &quot;app.py&quot;,</span><br><span class="line">                &quot;FLASK_DEBUG&quot;: &quot;1&quot;,</span><br><span class="line">                &quot;FLASK_RUN_PORT&quot;: &quot;8080&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;args&quot;: [</span><br><span class="line">                &quot;run&quot;,</span><br><span class="line">                &quot;--debug&quot;,</span><br><span class="line">                &quot;--no-debugger&quot;,</span><br><span class="line">                &quot;--no-reload&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;jinja&quot;: true,</span><br><span class="line">            &quot;autoStartBrowser&quot;: false</span><br><span class="line">        &#125;,</span><br><span class="line">        // Other configurations</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试应用程序"><a href="#测试应用程序" class="headerlink" title="测试应用程序"></a>测试应用程序</h2><p>好了，我们就可以运行应用程序了！</p>
<p><img src="/../asset_serveless_ai/21.png"></p>
<p> 启动 Flask 应用程序</p>
<p>以下是它在浏览器中的样子：</p>
<p><img src="/../asset_serveless_ai/22.png"></p>
<p> 运行应用程序</p>
<p>让我们用它来翻译我们的乌克兰模因：</p>
<p><img src="/../asset_serveless_ai/23.png"></p>
<p> 它有效！</p>
<p> 万岁！</p>
<h1 id="部署到-Google-Cloud-Run"><a href="#部署到-Google-Cloud-Run" class="headerlink" title="部署到 Google Cloud Run"></a>部署到 Google Cloud Run</h1><p>现在，我们已准备好将 Flask 应用程序部署到 Cloud Run。回想一下，Cloud Run 是一个无服务器容器运行时，因此我们需要先将应用程序打包为容器映像，然后才能部署它。</p>
<p>我们将运行以下步骤：</p>
<ol>
<li>创建一个 Google Artifact Registry （GAR） 存储库，用于存储我们的 Flask 应用容器映像。</li>
<li>使用 Cloud Build 从源代码构建容器映像并存储在 GAR 中。</li>
<li>将我们的应用程序从 GAR 部署到 Cloud Run。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcloud artifacts repositories create image-text-translator-artifacts \</span><br><span class="line">  --repository-format=docker \</span><br><span class="line">  --location=$REGION \</span><br><span class="line">  --project=$PROJECT_ID</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_serveless_ai/24.png"></p>
<p> 构建存储库</p>
<p>您可以在 Cloud Console 中检查存储库是否已创建：</p>
<p><img src="/../asset_serveless_ai/25.png"></p>
<p> 工件注册表</p>
<p>现在构建 Docker 映像：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export IMAGE_NAME=$REGION-docker.pkg.dev/$PROJECT_ID/image-text-translator-artifacts/image-text-translator-ui</span><br><span class="line"></span><br><span class="line"># configure Docker to use the Google Cloud CLI to authenticate requests to Artifact Registry.</span><br><span class="line">gcloud auth configure-docker $REGION-docker.pkg.dev</span><br><span class="line"></span><br><span class="line"># Build the image and push it to Artifact Registry</span><br><span class="line"># Run from the ui_cr folder</span><br><span class="line">gcloud builds submit --tag $IMAGE_NAME:v0.1 .</span><br></pre></td></tr></table></figure>

<p>这需要一分钟左右的时间。现在，我们的容器映像已被推送到存储库：</p>
<p><img src="/../asset_serveless_ai/26.png"></p>
<p>Google Artifact Registry 中的容器映像</p>
<p>最后，我们可以使用映像部署到 Cloud Run。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># create a random secret key for our Flask application</span><br><span class="line">export RANDOM_SECRET_KEY=$(openssl rand -base64 32)</span><br><span class="line"></span><br><span class="line">gcloud run deploy image-text-translator-ui \</span><br><span class="line">  --image=$IMAGE_NAME:v0.1 \</span><br><span class="line">  --region=$REGION \</span><br><span class="line">  --platform=managed \</span><br><span class="line">  --allow-unauthenticated \</span><br><span class="line">  --max-instances=1 \</span><br><span class="line">  --service-account=$SVC_ACCOUNT \</span><br><span class="line">  --set-env-vars BACKEND_GCF=$BACKEND_GCF,FLASK_SECRET_KEY=$RANDOM_SECRET_KEY</span><br></pre></td></tr></table></figure>

<p>输出如下所示：</p>
<p><img src="/../asset_serveless_ai/27.png"></p>
<p> 部署到 Cloud Run</p>
<p>我们可以验证我们的服务是否已部署在 Google Cloud 控制台中：</p>
<p><img src="/../asset_serveless_ai/28.png"></p>
<p> 我们的 Cloud Run 服务</p>
<h2 id="重新部署"><a href="#重新部署" class="headerlink" title="重新部署"></a>重新部署</h2><p>如果我们想部署应用程序的新版本，我们可以这样做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Check our IMAGE_NAME is set</span><br><span class="line">export IMAGE_NAME=$REGION-docker.pkg.dev/$PROJECT_ID/image-text-translator-artifacts/image-text-translator-ui</span><br><span class="line"># Set our new version number</span><br><span class="line">export VERSION=v0.2</span><br><span class="line"></span><br><span class="line"># Rebuild the container image and push to the GAR</span><br><span class="line">gcloud builds submit --tag $IMAGE_NAME:$VERSION .</span><br><span class="line"></span><br><span class="line"># create a random secret key for our Flask application</span><br><span class="line">export RANDOM_SECRET_KEY=$(openssl rand -base64 32)</span><br><span class="line"></span><br><span class="line"># Redeploy</span><br><span class="line">gcloud run deploy image-text-translator-ui \</span><br><span class="line">  --image=$IMAGE_NAME:$VERSION \</span><br><span class="line">  --region=$REGION \</span><br><span class="line">  --platform=managed \</span><br><span class="line">  --allow-unauthenticated \</span><br><span class="line">  --max-instances=1 \</span><br><span class="line">  --service-account=$SVC_ACCOUNT \</span><br><span class="line">  --set-env-vars BACKEND_GCF=$BACKEND_GCF,FLASK_SECRET_KEY=$RANDOM_SECRET_KEY</span><br></pre></td></tr></table></figure>

<h2 id="（可选）设置自定义-DNS-映射"><a href="#（可选）设置自定义-DNS-映射" class="headerlink" title="（可选）设置自定义 DNS 映射"></a>（可选）设置自定义 DNS 映射</h2><p>像 <a target="_blank" rel="noopener" href="https://image-text-translator-ui-adisqviovq-ez.a.run.app/">https://image-text-translator-ui-adisqviovq-ez.a.run.app/</a> 这样的 URL 不是很令人难忘！因此，您可能希望映射到自定义域。您可以在此处找到详细的指南。</p>
<blockquote>
<p>此时，我发现 Cloud Run 不支持该区域 europe-west2 的域映射。因此，我最终使用 europe-west4 .</p>
</blockquote>
<p>假设您已经创建了子域 image-text-translator.mydomain.com ，并且想要将此地址用于应用程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Verify your domain ownership with Google</span><br><span class="line">gcloud domains verify mydomain.com</span><br><span class="line"># Check it</span><br><span class="line">gcloud domains list-user-verified</span><br><span class="line"></span><br><span class="line"># Create a mapping to your domain</span><br><span class="line">gcloud beta run domain-mappings create \</span><br><span class="line">  --region $REGION \</span><br><span class="line">  --service image-text-translator-ui \</span><br><span class="line">  --domain image-text-translator.mydomain.com</span><br></pre></td></tr></table></figure>

<p><img src="/../asset_serveless_ai/29.png"></p>
<p>创建域映射的输出</p>
<p>现在我们需要获取此域映射的 DNS 记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Obtain the DNS records. We want everything under `resourceRecords`.</span><br><span class="line">gcloud beta run domain-mappings describe \</span><br><span class="line">  --region $REGION \</span><br><span class="line">  --domain image-text-translator.mydomain.com</span><br></pre></td></tr></table></figure>

<p>获取 下 resourceRecords 显示的任何 DNS 记录，并在 DNS 注册机构中创建这些 DNS 记录。对我来说，只有一条 CNAME 记录需要添加：</p>
<p><img src="/../asset_serveless_ai/30.png"></p>
<p> 要添加的 DNS 记录</p>
<p>DNS 记录的传播以及 Google 配置托管 SSL 证书可能需要相当长的时间。对我来说，花了将近两个小时。</p>
<p>在等待期间，您可以使用以下工具检查进度：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://toolbox.googleapps.com/apps/dig/">https://toolbox.googleapps.com/apps/dig/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a></li>
</ul>
<p>但最后……这一切都在我的域中工作！</p>
<p><img src="/../asset_serveless_ai/31.png"></p>
<p>从您的域运行应用</p>
<h1 id="定价和成本管理"><a href="#定价和成本管理" class="headerlink" title="定价和成本管理"></a>定价和成本管理</h1><p>在撰写本文时…</p>
<h2 id="Google-Cloud-函数"><a href="#Google-Cloud-函数" class="headerlink" title="Google Cloud 函数"></a>Google Cloud 函数</h2><p>成本是函数调用、使用的计算和网络出口的总和。</p>
<ul>
<li>每个月的前 100 万次计算秒数是免费的，前 200 万次函数调用也是免费的。</li>
<li>前 400,000 GB 秒和前 200,000 GHz 秒的计算时间是免费的。</li>
<li>此外，由于 Cloud Functions 在不使用时会缩放到 0，因此对于零星或低利用率的工作负载来说，这可能非常经济高效。</li>
</ul>
<h2 id="Google-Cloud-Run（谷歌云运行酒店）"><a href="#Google-Cloud-Run（谷歌云运行酒店）" class="headerlink" title="Google Cloud Run（谷歌云运行酒店）"></a>Google Cloud Run（谷歌云运行酒店）</h2><p>成本是所用 CPU 和内存的组合。</p>
<ul>
<li>前 240000 vCPU 秒每月免费。之后，计算按每 vCPU 秒 0.00001800 USD 收费。</li>
<li>前 450,000 GiB 秒每月免费。之后，内存按 0.000000200 USD&#x2F;GiB 秒收费</li>
<li>由于 Cloud Run 在不使用时会扩展到 0，因此这对于零星或低利用率的工作负载来说可能非常经济高效。</li>
</ul>
<h2 id="Cloud-Vision-API"><a href="#Cloud-Vision-API" class="headerlink" title="Cloud Vision API"></a>Cloud Vision API</h2><p>每个月免费对每个图像进行前 1000 次文本检测。之后，每 1.50 张图像收费 1000 美元。</p>
<h2 id="云翻译-API"><a href="#云翻译-API" class="headerlink" title="云翻译 API"></a>云翻译 API</h2><p>每个月前 050 万个字符免费，用于检测和翻译呼叫。之后，它按每百万个字符 20 美元收费。</p>
<h2 id="一些成本控制策略"><a href="#一些成本控制策略" class="headerlink" title="一些成本控制策略"></a>一些成本控制策略</h2><p>应考虑实施以下成本控制策略：</p>
<ul>
<li>在结算帐号中设置预算提醒。如果超过预算阈值（例如 50%、75%、90%、100%），您将收到电子邮件通知。注意：这不会限制您的支出。它只是在达到阈值时提醒您。</li>
<li>限制自动缩放。虽然 Cloud Run 和 Cloud Functions 都是无服务器自动缩放服务，但我预计我的小应用程序不会有任何重大需求。因此，我将 Cloud Function 和 Cloud Run 服务都设置为 max-instances 1。这意味着每个服务永远不会部署多个并发实例。</li>
<li>更复杂的策略：当超出预算时，向 Pub&#x2F;Sub 发送通知。 使用 Pub&#x2F;Sub 事件触发云函数，然后将项目与计费帐户分离，从而有效地禁用项目中的所有资源。</li>
</ul>
<h1 id="性能注意事项"><a href="#性能注意事项" class="headerlink" title="性能注意事项"></a>性能注意事项</h1><p>扩展到 0 的无服务器服务的缺点之一是，如果需求较低且零星，则通常不会有正在运行的服务实例。对于Cloud Functions来说，这并不是一个真正的问题，因为Cloud Functions是超轻量级的，启动速度非常快。但是我们的 Cloud Run Flask 应用程序稍大一些，冷启动可能需要几秒钟。因此，我们的用户在访问页面时会发现应用程序很慢。</p>
<p>有几种策略可以通过 Cloud Run 处理此问题：</p>
<ol>
<li>我们可以将最小实例配置为 1。如果我们这样做，我们的 Cloud Run 服务将永远不会扩展到 0。总会有一个实例准备好处理请求。但是，这意味着我们将为此实例付费……一直以来。这通常是一个很好的策略。但是对于我点头的低利用率应用程序，我真的不想这样做。</li>
<li>我们可以配置 Cloud Run 启动 CPU 提升。在这里，Google Cloud 在启动期间为我们的 Cloud Run 容器动态分配更多 CPU，这可以显着缩短我们的启动时间。而且，由于这些额外的 CPU 仅分配给那些不频繁的冷启动，因此它通常比保持实例一直运行更具成本效益。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcloud beta run services update image-text-translator-ui \</span><br><span class="line">  --region=$REGION --cpu-boost</span><br></pre></td></tr></table></figure>

<p>此外，请检查 Flask 应用程序是否未在启用调试的情况下部署。这肯定会影响您的启动时间！</p>
<h1 id="一些常见问题、一般观察和提示"><a href="#一些常见问题、一般观察和提示" class="headerlink" title="一些常见问题、一般观察和提示"></a>一些常见问题、一般观察和提示</h1><h2 id="生成式人工智能！"><a href="#生成式人工智能！" class="headerlink" title="生成式人工智能！"></a>生成式人工智能！</h2><p>当然，我需要再次提到Gen AI！！虽然我没有在实际解决方案中使用任何 Gen AI，但我在构建解决方案时大量使用它来获得建议和答案。特别是，我与 Gemini Code Assist（包含在 VS Code 的 Cloud Code 插件中）和 ChatGPT 4 进行了多次对话。我估计，使用这些工具解决问题已经消除了我总时间和精力的 40%。</p>
<h2 id="为什么同时使用-Cloud-Run-和-Cloud-Functions？"><a href="#为什么同时使用-Cloud-Run-和-Cloud-Functions？" class="headerlink" title="为什么同时使用 Cloud Run 和 Cloud Functions？"></a>为什么同时使用 Cloud Run 和 Cloud Functions？</h2><p>为什么不只包含从我的 Flask 应用程序提取和翻译 API 调用？这样我就完全不需要 Cloud Functions。</p>
<p> 原因有二：</p>
<ol>
<li>我想将提取和翻译逻辑与 UI 分离。这样一来，如果我想更换 UI 或添加另一个 UI（例如移动应用程序），我仍然可以在不更改它的情况下使用我的 Cloud Function。</li>
<li>我想构建一个需要集成两个无服务器组件的应用程序。这样，我就可以演示一个如何调用另一个，还可以演示其他必要的元素，例如使用服务帐户。</li>
</ol>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>大功告成！让我们回顾一下我们取得的成就：</p>
<ul>
<li>我们创建了一个 Google Cloud 项目来托管我们的应用程序。</li>
<li>我们建立了一个本地开发项目和环境。</li>
<li>我们定义了一个服务帐户并为其分配了角色。</li>
<li>我们配置了应用程序默认凭据，以便我们的代码可以在部署到的任何环境中查找凭据。</li>
<li>我们构建了一个 Google Cloud 函数（在 Python 中），用于接收图像数据，从图像中提取任何文本，然后将其翻译成任何指定的语言。我们通过调用 Google 的预制 AI API 来做到这一点。</li>
<li>我们已使用 Functions 框架在本地测试了 Cloud Function。</li>
<li>我们已将云功能部署到 GCP 并对其进行了测试。它只能由经过身份验证和授权的客户端调用。</li>
<li>我们使用 Flask 构建了一个 Python Web 用户界面应用程序。</li>
<li>我们使用 HTML Jinja 模板、CSS 样式表和 Javascript 构建了一个前端。</li>
<li>我们已将 Flask Web 应用程序配置为能够对函数进行经过身份验证的调用。</li>
<li>在本地测试 Flask 应用后，我们使用 Google Cloud Build 将应用打包为容器映像。</li>
<li>我们已将该图像推送到 Google Artifact Registry。</li>
<li>我们已从 Artifact Registry 部署到 Cloud Run。</li>
<li>我们已使用自己的域名公开了我们的 Cloud Run 服务。</li>
<li>我们回顾了一些成本管理最佳实践和控制措施。</li>
<li>我们实施了 cpu-boost 加速 Cloud Run 的冷启动。</li>
</ul>
<p><img src="/../asset_serveless_ai/32.gif"></p>
<p> 唷！</p>
<p>这很有趣！我希望你也喜欢它！</p>
<h1 id="下一步是什么？"><a href="#下一步是什么？" class="headerlink" title="下一步是什么？"></a>下一步是什么？</h1><p>我将跟进第二部分。在第 2 部分中，我将介绍：</p>
<ul>
<li>使用 Terraform 部署我们的 Google Cloud 基础架构。</li>
<li>设置 CI&#x2F;CD 管道，以自动生成和部署更改。</li>
<li>其他一些应用程序增强功能。</li>
</ul>
<h1 id="出发前"><a href="#出发前" class="headerlink" title="出发前"></a>出发前</h1><ul>
<li>请与您认为会感兴趣的任何人分享。它可能会帮助他们，它真的帮助了我！</li>
<li>请给我鼓掌！你知道你不止一次鼓掌，对吧？</li>
<li>随意发表评论💬。</li>
<li>关注并订阅，这样您就不会错过我的内容。转到我的个人资料页面，然后单击以下图标：</li>
</ul>
<p><img src="/../asset_serveless_ai/33.png"></p>
<p> 关注并订阅</p>
<h1 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h1><h2 id="应用程序"><a href="#应用程序" class="headerlink" title="应用程序"></a>应用程序</h2><ul>
<li><a target="_blank" rel="noopener" href="https://image-text-translator.just2good.co.uk/">https://image-text-translator.just2good.co.uk/</a></li>
</ul>
<h2 id="应用程序的源代码"><a href="#应用程序的源代码" class="headerlink" title="应用程序的源代码"></a>应用程序的源代码</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/derailed-dash/image-text-translator">GitHub 中的源代码存储库</a></li>
</ul>
<h2 id="开发设置"><a href="#开发设置" class="headerlink" title="开发设置"></a>开发设置</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/sdk/docs/install"> Gcloud CLI 设置</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/python/docs/setup">适用于 Gcloud CLI 的 Python 设置</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/code/docs/vscode">适用于 VS Code 的云代码</a></li>
<li><a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/python/tutorial-flask">VS Code：示例 Python 烧瓶教程</a></li>
</ul>
<h2 id="云函数"><a href="#云函数" class="headerlink" title="云函数"></a>云函数</h2><ul>
<li>使用 Python 设置和调用 Cloud Functions，包括本地开发</li>
<li>适用于 Python 的 Functions 框架 — 适用于本地开发</li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/terraform-ml-image-annotation-gcf">Cloud Functions — 图像注释</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/functions/docs/calling/http">Cloud Functions — HTTP 触发器</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/functions/docs/tutorials/ocr">OCR 和 CF 翻译</a></li>
</ul>
<h2 id="云运行"><a href="#云运行" class="headerlink" title="云运行"></a>云运行</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/code/docs/vscode/create-service">在 VS Code 中从示例应用程序创建 Cloud Run 服务Create a Cloud Run service from a sample application in VS Code</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/code/docs/vscode/develop-service">在 Cloud Code 中本地开发云运行服务</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/code/docs/vscode/debug-service">在 VS Code 中调试云运行</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/run/helloworld">Cloud Run — Hello World</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/python-docs-samples/tree/main/run/image-processing">Cloud Run — 图像处理</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/run/docs/mapping-custom-domains">将自定义域映射到 Cloud Run 服务</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/run?utm_source=google&utm_medium=cpc&utm_campaign=emea-gb-all-en-dr-skws-all-all-trial-%7Bmatchtype%7D-gcp-1707574&utm_content=text-ad-none-any-DEV_%7Bdevice%7D-CRE_%7Bcreative%7D-ADGP_%7B_dsadgroup%7D-KWID_%7B_dstrackerid%7D-%7Btargetid%7D-userloc_%7Bloc_physical_ms%7D&utm_term=KW_%7Bkeyword%7D-NET_%7Bnetwork%7D-PLAC_%7Bplacement%7D&%7B_dsmrktparam%7D%7Bignore%7D=&%7B_dsmrktparam%7D=&gclsrc=aw.ds&gad_source=1&gclid=CjwKCAjw-O6zBhASEiwAOHeGxWZDg7nObT9R0wHudfnP1YHPkCpAq7PFfcyV7QBKZNQjp6jpgO2g0hoCLzcQAvD_BwE&hl=en#pricing"> Cloud Run 定价</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/blog/products/serverless/announcing-startup-cpu-boost-for-cloud-run--cloud-functions">云运行启动 CPU 提升</a></li>
</ul>
<h2 id="AI-ML-API"><a href="#AI-ML-API" class="headerlink" title="AI&#x2F;ML API"></a>AI&#x2F;ML API</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/vision/docs/ocr">视觉 API — 检测图像中的文本</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/vision/pricing">Google Cloud Vision API 定价</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/translate/docs/basic/translating-text">翻译 API — 翻译文本</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/translate/pricing/?gad_source=1&gclid=CjwKCAjw-O6zBhASEiwAOHeGxdMh6YLV1qcoix8_RgmX5O8Ql2HTmUdPBBX-ckt1bDnothunMt_u4hoCk8kQAvD_BwE&gclsrc=aw.ds">Google Cloud Translation API 定价</a></li>
</ul>
<h2 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/docs/authentication/application-default-credentials">Appication 默认凭据的工作原理</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/docs/authentication/provide-credentials-adc#local-dev">设置应用程序默认凭据</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/python-docs-samples/blob/main/auth/service-to-service/auth.py">Python 服务到服务身份验证</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/functions/docs/securing/managing-access-iam#gcloud">管理对函数的访问</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/functions/docs/securing/authenticating">Cloud Functions：对调用进行身份验证</a></li>
<li><a target="_blank" rel="noopener" href="https://cloud.google.com/run/docs/securing/service-identity">Cloud Run：服务标识</a></li>
<li>Cloud Run：对服务到服务进行身份验证 — 创建服务帐户;获取 Google 签名的 ID 令牌，并将该令牌添加到标头。</li>
</ul>
<h2 id="DNS-和-SSL-配置"><a href="#DNS-和-SSL-配置" class="headerlink" title="DNS 和 SSL 配置"></a>DNS 和 SSL 配置</h2><ul>
<li><a target="_blank" rel="noopener" href="https://toolbox.googleapps.com/apps/dig/">https://toolbox.googleapps.com/apps/dig/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://medium.com/google-cloud/building-a-serverless-image-text-extractor-and-translator-using-google-cloud-pre-trained-ai-adfdccdb18d9">使用 Google Cloud 预训练 AI 构建无服务器图像文本提取器和翻译器 |by 达兹博 （Darren Lester） |Google Cloud - 社区 |2024年6月 |中等 — Building a Serverless Image Text Extractor and Translator Using Google Cloud Pre-Trained AI | by Dazbo (Darren Lester) | Google Cloud - Community | Jun, 2024 | Medium</a></p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/06/20/erp-introduce/" rel="prev" title="ERP介绍">
                  <i class="fa fa-angle-left"></i> ERP介绍
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/07/04/knowledge-transfer-tutorial/" rel="next" title="英文知识搬运教程">
                  英文知识搬运教程 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Howard Huang</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">638k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">19:19</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">
    <!--由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动-->
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.33/fancybox/fancybox.umd.js" integrity="sha256-+2+qOqR8CKoHh/AsVR9k2qaDBKWjYNC2nozhYmv5j9k=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>



  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
